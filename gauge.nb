Notebook[{
Cell[BoxData[
 RowBox[{
  RowBox[{"SetDirectory", "[", 
   RowBox[{"NotebookDirectory", "[", "]"}], "]"}], ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.7673569687731447`*^9, 
  3.7673569687738857`*^9}},ExpressionUUID->"de20a98f-e354-4b6f-9a89-\
03be16dbf4b4"],

Cell["\<\
Disable current notebook FileOutlineCache and CellChangeTimes.  See: \
https://stackoverflow.com/questions/2816628/version-control-of-mathematica-\
notebooks \
\>", "Text",ExpressionUUID->"9ee48861-dafe-44bf-a94c-3fd335597e53"],

Cell[CellGroupData[{

Cell["Library", \
"Section",ExpressionUUID->"9f82eb6c-b95c-4051-b624-87f36d09b10f"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"getLink", "[", 
     RowBox[{"dir_", ",", "coords_List"}], "]"}], ":=", 
    RowBox[{"gaugeField", "[", 
     RowBox[{"[", 
      RowBox[{"dir", ",", 
       RowBox[{"linearSiteIndex", "[", "coords", "]"}]}], "]"}], "]"}]}], 
   ";"}], " "}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"setLink", "[", 
     RowBox[{"dir_", ",", "coords_List", ",", "mat_"}], "]"}], ":=", 
    RowBox[{
     RowBox[{"gaugeField", "[", 
      RowBox[{"[", 
       RowBox[{"dir", ",", 
        RowBox[{"linearSiteIndex", "[", "coords", "]"}]}], "]"}], "]"}], "=", 
     "mat"}]}], ";"}], " "}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"latticeVolume", "[", "]"}], ":=", 
   RowBox[{"Apply", "[", 
    RowBox[{"Times", ",", " ", "latticeDimensions"}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"latticeCoordinates", "[", "ii_", "]"}], ":=", 
   RowBox[{"(*", " ", 
    RowBox[{
    "This", " ", "is", " ", "not", " ", "necessarily", " ", "the", " ", 
     "inverse", " ", "of", " ", 
     RowBox[{"linearSiteIndex", ".", "  ", "It"}], " ", "is", " ", "simply", 
     " ", "a", " ", "way", " ", "to", " ", "iterate", " ", "over", " ", "the",
      " ", "whole", " ", 
     RowBox[{"lattice", "."}]}], " ", "*)"}], 
   RowBox[{"Block", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"i", "=", 
        RowBox[{"ii", "-", "1"}]}], ",", "j"}], "}"}], ",", 
     RowBox[{"Table", "[", 
      RowBox[{
       RowBox[{
        RowBox[{
         RowBox[{"{", 
          RowBox[{"i", ",", "j"}], "}"}], "=", 
         RowBox[{"QuotientRemainder", "[", 
          RowBox[{"i", ",", 
           RowBox[{"latticeDimensions", "[", 
            RowBox[{"[", "k", "]"}], "]"}]}], "]"}]}], ";", 
        RowBox[{"j", "+", "1"}]}], ",", 
       RowBox[{"{", 
        RowBox[{"k", ",", "nd"}], "}"}]}], "]"}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"shift", "[", 
    RowBox[{"dir_", ",", "coords_", ",", 
     RowBox[{"size_:", "1"}]}], "]"}], ":=", 
   RowBox[{"(*", " ", 
    RowBox[{
     RowBox[{"Wrap", "-", "around"}], ",", " ", 
     RowBox[{
     "assuming", " ", "periodic", " ", "boundary", " ", "conditions"}]}], " ",
     "*)"}], 
   RowBox[{"Block", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"cc", "=", "coords"}], "}"}], ",", 
     RowBox[{
      RowBox[{
       RowBox[{"cc", "[", 
        RowBox[{"[", "dir", "]"}], "]"}], "=", 
       RowBox[{"1", "+", 
        RowBox[{"Mod", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"cc", "[", 
            RowBox[{"[", "dir", "]"}], "]"}], "+", "size", "-", "1"}], ",", 
          RowBox[{"latticeDimensions", "[", 
           RowBox[{"[", "dir", "]"}], "]"}]}], "]"}]}]}], ";", "cc"}]}], 
    "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"plaquette", "[", 
    RowBox[{"dir1_", ",", "dir2_", ",", " ", "coords_List"}], "]"}], ":=", 
   RowBox[{"Re", "[", 
    RowBox[{"Tr", "[", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"getLink", "[", 
       RowBox[{"dir1", ",", "coords"}], "]"}], ".", 
      RowBox[{"getLink", "[", 
       RowBox[{"dir2", ",", 
        RowBox[{"shift", "[", 
         RowBox[{"dir1", ",", "coords"}], "]"}]}], "]"}], ".", 
      RowBox[{"ConjugateTranspose", "[", 
       RowBox[{"getLink", "[", 
        RowBox[{"dir1", ",", 
         RowBox[{"shift", "[", 
          RowBox[{"dir2", ",", "coords"}], "]"}]}], "]"}], "]"}], ".", 
      RowBox[{"ConjugateTranspose", "[", 
       RowBox[{"getLink", "[", 
        RowBox[{"dir2", ",", "coords"}], "]"}], "]"}]}], "]"}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"averagePlaquette", "[", "]"}], ":=", 
   RowBox[{"Chop", "[", 
    RowBox[{
     RowBox[{"Sum", "[", 
      RowBox[{
       RowBox[{"Re", "[", 
        RowBox[{"plaquette", "[", 
         RowBox[{"dir1", ",", "dir2", ",", 
          RowBox[{"latticeCoordinates", "[", "k", "]"}]}], "]"}], "]"}], ",", 
       
       RowBox[{"{", 
        RowBox[{"k", ",", 
         RowBox[{"latticeVolume", "[", "]"}]}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"dir1", ",", "2", ",", "nd"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"dir2", ",", 
         RowBox[{"dir1", "-", "1"}]}], "}"}]}], "]"}], "*", 
     RowBox[{"2", "/", 
      RowBox[{"(", 
       RowBox[{
        RowBox[{"latticeVolume", "[", "]"}], "*", "nc", "*", "nd", "*", 
        RowBox[{"(", 
         RowBox[{"nd", "-", "1"}], ")"}]}], ")"}]}]}], "]"}]}], 
  ";"}]}], "Input",
 InitializationCell->
  True,ExpressionUUID->"6c880b77-3e17-4cda-b61a-af6936bf44d6"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"randomSUMatrix", "[", "n_", "]"}], ":=", 
   RowBox[{"Block", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"mat", "=", 
       RowBox[{"RandomVariate", "[", 
        RowBox[{"CircularUnitaryMatrixDistribution", "[", "n", "]"}], "]"}]}],
       "}"}], ",", 
     RowBox[{"mat", "/", 
      RowBox[{
       RowBox[{"Det", "[", "mat", "]"}], "^", 
       RowBox[{"(", 
        RowBox[{"1", "/", "n"}], ")"}]}]}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"centerSUMatrix", "[", 
    RowBox[{"n_", ",", "j_"}], "]"}], ":=", 
   RowBox[{
    RowBox[{"IdentityMatrix", "[", "n", "]"}], " ", 
    RowBox[{"Exp", "[", 
     RowBox[{"2", " ", "Pi", " ", "I", " ", 
      RowBox[{"j", "/", "n"}]}], "]"}]}]}], ";", 
  RowBox[{
   RowBox[{"matrixEqual", "[", 
    RowBox[{"m1_", ",", "m2_", ",", 
     RowBox[{"tol_:", "$MachineEpsilon"}]}], "]"}], ":=", 
   RowBox[{"Block", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"norm", "=", 
       RowBox[{"Norm", "[", 
        RowBox[{
         RowBox[{"Flatten", "[", 
          RowBox[{"m1", "-", "m2"}], "]"}], ",", "Infinity"}], "]"}]}], "}"}],
      ",", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{"norm", "<", 
        RowBox[{"tol", " ", 
         RowBox[{"Sqrt", "[", 
          RowBox[{
           RowBox[{"Length", "[", "m1", "]"}], " ", 
           RowBox[{"Length", "[", 
            RowBox[{"m1", "[", 
             RowBox[{"[", "1", "]"}], "]"}], "]"}]}], "]"}]}]}], ",", "True", 
       ",", 
       RowBox[{
        RowBox[{"Print", "[", 
         RowBox[{"\"\<Matrices not equal, norm:  \>\"", ",", "norm"}], "]"}], 
        ";", "False"}]}], "]"}]}], "]"}]}], ";", 
  RowBox[{
   RowBox[{"SUMatrixQ", "[", 
    RowBox[{
     RowBox[{"mat_", "?", "SquareMatrixQ"}], ",", 
     RowBox[{"tol_:", "$MachineEpsilon"}]}], "]"}], ":=", 
   RowBox[{"Block", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"norm", "=", 
       RowBox[{"Norm", "[", 
        RowBox[{
         RowBox[{"Flatten", "[", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{
             RowBox[{"Det", "[", "mat", "]"}], "-", "1"}], ",", 
            RowBox[{
             RowBox[{"mat", ".", 
              RowBox[{"ConjugateTranspose", "[", "mat", "]"}]}], "-", 
             RowBox[{"IdentityMatrix", "[", 
              RowBox[{"Length", "[", "mat", "]"}], "]"}]}]}], "}"}], "]"}], 
         ",", "Infinity"}], "]"}]}], "}"}], ",", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{"norm", "<", 
        RowBox[{"tol", " ", 
         RowBox[{"Length", "[", "mat", "]"}]}]}], ",", "True", ",", 
       RowBox[{
        RowBox[{"Print", "[", 
         RowBox[{"\"\<Not SU matrix, error:  \>\"", ",", " ", "norm"}], "]"}],
         ";", "False"}]}], "]"}]}], "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"suGenerators", "[", 
    RowBox[{"n_:", "nc"}], "]"}], ":=", 
   RowBox[{
    RowBox[{"suGenerators", "[", "n", "]"}], "=", 
    RowBox[{"(*", " ", 
     RowBox[{
      RowBox[{
      "Construct", " ", "the", " ", "generators", " ", "for", " ", "SU", 
       RowBox[{
        RowBox[{"(", "N", ")"}], ".", "  ", "Normalization"}], " ", 
       RowBox[{"Tr", "[", 
        RowBox[{"T_a", " ", "T_b"}], "]"}]}], " ", "=", " ", 
      RowBox[{"delta_", 
       RowBox[{
        RowBox[{"{", "ab", "}"}], "/", "2."}]}]}], " ", "*)"}], 
    RowBox[{"Join", "[", 
     RowBox[{
      RowBox[{"Flatten", "[", 
       RowBox[{
        RowBox[{"Table", "[", 
         RowBox[{
          RowBox[{"If", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"(", 
              RowBox[{
               RowBox[{"i", "\[Equal]", "k1"}], "&&", 
               RowBox[{"j", "\[Equal]", "k2"}]}], ")"}], "||", 
             RowBox[{"(", 
              RowBox[{
               RowBox[{"i", "\[Equal]", "k2"}], "&&", 
               RowBox[{"j", "\[Equal]", "k1"}]}], ")"}]}], ",", 
            RowBox[{"1", "/", "2"}], ",", "0"}], "]"}], ",", 
          RowBox[{"{", 
           RowBox[{"i", ",", "2", ",", "n"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"j", ",", 
            RowBox[{"i", "-", "1"}]}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"k1", ",", "n"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"k2", ",", "n"}], "}"}]}], "]"}], ",", "1"}], "]"}], ",", 
      RowBox[{"Flatten", "[", 
       RowBox[{
        RowBox[{"Table", "[", 
         RowBox[{
          RowBox[{"Which", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"i", "\[Equal]", "k1"}], "&&", 
             RowBox[{"j", "\[Equal]", "k2"}]}], ",", 
            RowBox[{"I", "/", "2"}], ",", 
            RowBox[{
             RowBox[{"i", "\[Equal]", "k2"}], "&&", 
             RowBox[{"j", "\[Equal]", "k1"}]}], ",", 
            RowBox[{
             RowBox[{"-", "I"}], "/", "2"}], ",", "True", ",", "0"}], "]"}], 
          ",", 
          RowBox[{"{", 
           RowBox[{"i", ",", "2", ",", "n"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"j", ",", 
            RowBox[{"i", "-", "1"}]}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"k1", ",", "n"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"k2", ",", "n"}], "}"}]}], "]"}], ",", "1"}], "]"}], ",", 
      RowBox[{"Table", "[", 
       RowBox[{
        RowBox[{"Which", "[", 
         RowBox[{
          RowBox[{"k1", "!=", "k2"}], ",", "0", ",", 
          RowBox[{"k1", "<", "i"}], ",", 
          RowBox[{"1", "/", 
           RowBox[{"Sqrt", "[", 
            RowBox[{"2", " ", "i", " ", 
             RowBox[{"(", 
              RowBox[{"i", "-", "1"}], ")"}]}], "]"}]}], ",", 
          RowBox[{"k1", "\[Equal]", "i"}], ",", 
          RowBox[{
           RowBox[{"(", 
            RowBox[{"1", "-", "i"}], ")"}], "/", 
           RowBox[{"Sqrt", "[", 
            RowBox[{"2", " ", "i", " ", 
             RowBox[{"(", 
              RowBox[{"i", "-", "1"}], ")"}]}], "]"}]}], ",", "True", ",", 
          "0"}], "]"}], ",", 
        RowBox[{"{", 
         RowBox[{"i", ",", "2", ",", "n"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"k1", ",", "n"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"k2", ",", "n"}], "}"}]}], "]"}]}], "]"}]}]}], ";", 
  RowBox[{
   RowBox[{"suSymmetric", "[", 
    RowBox[{"n_:", "nc"}], "]"}], ":=", " ", 
   RowBox[{
    RowBox[{"suSymmetric", "[", "n", "]"}], "=", 
    RowBox[{"(*", " ", 
     RowBox[{
      RowBox[{
      "Construct", " ", "the", " ", "symmetric", " ", "coefficients", " ", 
       "d_", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"a", ",", "b", ",", "c"}], "}"}], ".", "  ", "This"}], " ", 
       "tensor", " ", "is", " ", "sparse"}], ",", " ", 
      RowBox[{
      "but", " ", "we", " ", "will", " ", "be", " ", "inefficient", " ", 
       "for", " ", 
       RowBox[{"now", "."}]}]}], " ", "*)"}], 
    RowBox[{"Block", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"gen", "=", 
        RowBox[{"suGenerators", "[", "n", "]"}]}], "}"}], ",", 
      RowBox[{"2", " ", 
       RowBox[{"Outer", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"Tr", "[", 
           RowBox[{
            RowBox[{"(", 
             RowBox[{
              RowBox[{"#1", ".", "#2"}], "+", 
              RowBox[{"#2", ".", "#1"}]}], ")"}], ".", "#3"}], "]"}], "&"}], 
         ",", "gen", ",", "gen", ",", "gen", ",", "1"}], "]"}]}]}], 
     "]"}]}]}]}]}], "Input",
 InitializationCell->
  True,ExpressionUUID->"530fec0d-608d-4463-8494-a846af9a2893"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"SUPower", "[", 
    RowBox[{"mat_", ",", "power_"}], "]"}], ":=", 
   RowBox[{"Block", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"values", ",", "vectors", ",", "phases", ",", "phaseSum", ",", 
       RowBox[{"fix", "=", "True"}], ",", "delta", ",", "result", ",", " ", 
       RowBox[{"debug", "=", "False"}]}], "}"}], ",", 
     RowBox[{
      RowBox[{
       RowBox[{"{", 
        RowBox[{"values", ",", "vectors"}], "}"}], "=", 
       RowBox[{"Eigensystem", "[", "mat", "]"}]}], ";", 
      RowBox[{"phases", "=", 
       RowBox[{"Arg", "[", "values", "]"}]}], ";", 
      RowBox[{"phaseSum", "=", 
       RowBox[{"Chop", "[", 
        RowBox[{"Plus", "@@", "phases"}], "]"}]}], ";", " ", 
      "\[IndentingNewLine]", 
      RowBox[{"(*", " ", 
       RowBox[{"Gram", "-", 
        RowBox[{"Schmidt", " ", "orthogonalization"}]}], " ", "*)"}], 
      "\[IndentingNewLine]", 
      RowBox[{"vectors", "=", 
       RowBox[{"Orthogonalize", "[", "vectors", "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"(*", " ", 
       RowBox[{
        RowBox[{"Sanity", " ", 
         RowBox[{"check", ".", "  ", 
          RowBox[{"QDP", "++"}]}], " ", "default", " ", "is", " ", "single", 
         " ", "precision"}], ",", " ", 
        RowBox[{
        "so", " ", "we", " ", "set", " ", "the", " ", "tolerance", " ", 
         RowBox[{"high", "."}]}]}], " ", "*)"}], " ", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"Abs", "[", 
          RowBox[{
           RowBox[{"Mod", "[", 
            RowBox[{
             RowBox[{"phaseSum", "+", "Pi"}], ",", 
             RowBox[{"2", "Pi"}]}], "]"}], "-", "Pi"}], "]"}], ">", 
         RowBox[{"10", "^", 
          RowBox[{"-", "6"}]}]}], ",", 
        RowBox[{
         RowBox[{"Print", "[", 
          RowBox[{"\"\<phaseSum=\>\"", ",", "phaseSum"}], "]"}], ";", 
         RowBox[{"Abort", "[", "]"}]}]}], "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{"(*", " ", 
       RowBox[{
        RowBox[{"If", " ", "the", " ", "total", " ", "is", " ", "nonzero"}], 
        ",", " ", 
        RowBox[{"need", " ", "to", " ", "shift"}]}], " ", "*)"}], " ", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"phaseSum", "!=", "0"}], ",", 
        RowBox[{
         RowBox[{
          RowBox[{"phases", "[", 
           RowBox[{"[", "1", "]"}], "]"}], "-=", "phaseSum"}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"While", "[", 
          RowBox[{"fix", ",", 
           RowBox[{
            RowBox[{"fix", "=", "False"}], ";", 
            RowBox[{"Do", "[", 
             RowBox[{
              RowBox[{"If", "[", 
               RowBox[{
                RowBox[{
                 RowBox[{
                  RowBox[{"phases", "[", 
                   RowBox[{"[", "i", "]"}], "]"}], "-", 
                  RowBox[{"phases", "[", 
                   RowBox[{"[", "j", "]"}], "]"}]}], ">", 
                 RowBox[{"2", "*", "Pi"}]}], ",", 
                RowBox[{
                 RowBox[{"delta", "=", 
                  RowBox[{"Floor", "[", 
                   RowBox[{
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"phases", "[", 
                    RowBox[{"[", "i", "]"}], "]"}], "-", 
                    RowBox[{"phases", "[", 
                    RowBox[{"[", "j", "]"}], "]"}], "+", 
                    RowBox[{"2", "*", "Pi"}]}], ")"}], "/", 
                    RowBox[{"(", 
                    RowBox[{"4", "*", "Pi"}], ")"}]}], "]"}]}], ";", 
                 RowBox[{
                  RowBox[{"phases", "[", 
                   RowBox[{"[", "i", "]"}], "]"}], "-=", 
                  RowBox[{"2", "*", "Pi", "*", "delta"}]}], ";", 
                 RowBox[{
                  RowBox[{"phases", "[", 
                   RowBox[{"[", "j", "]"}], "]"}], "+=", 
                  RowBox[{"2", "*", "Pi", "*", "delta"}]}], ";", 
                 RowBox[{"fix", "=", "True"}]}]}], "]"}], ",", 
              RowBox[{"{", 
               RowBox[{"i", ",", 
                RowBox[{"Length", "[", "mat", "]"}]}], "}"}], ",", 
              RowBox[{"{", 
               RowBox[{"j", ",", 
                RowBox[{"Length", "[", "mat", "]"}]}], "}"}]}], "]"}]}]}], 
          "]"}]}]}], "]"}], ";", 
      RowBox[{"result", "=", 
       RowBox[{
        RowBox[{"Transpose", "[", "vectors", "]"}], ".", 
        RowBox[{"DiagonalMatrix", "[", 
         RowBox[{"Exp", "[", 
          RowBox[{"I", "*", "phases", "*", "power"}], "]"}], "]"}], ".", 
        RowBox[{"Conjugate", "[", "vectors", "]"}]}]}], ";", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"debug", " ", "&&", " ", 
         RowBox[{"Not", "[", 
          RowBox[{"SUMatrixQ", "[", "result", "]"}], "]"}]}], ",", 
        RowBox[{"Print", "[", "\"\<matrix power not SU\>\"", "]"}]}], "]"}], 
      ";", "result"}]}], "]"}]}], ";", 
  RowBox[{
   RowBox[{"centerPhases", "[", "mat_", "]"}], ":=", 
   RowBox[{"(*", " ", 
    RowBox[{"Used", " ", "for", " ", "some", " ", "testing"}], " ", "*)"}], 
   " ", 
   RowBox[{"Block", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"delta", ",", 
       RowBox[{"phases", "=", 
        RowBox[{"Arg", "[", 
         RowBox[{"Eigenvalues", "[", "mat", "]"}], "]"}]}]}], "}"}], ",", 
     RowBox[{
      RowBox[{
       RowBox[{"phases", "[", 
        RowBox[{"[", "1", "]"}], "]"}], "-=", 
       RowBox[{"Apply", "[", 
        RowBox[{"Plus", ",", "phases"}], "]"}]}], ";", 
      RowBox[{"Do", "[", 
       RowBox[{
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{
           RowBox[{
            RowBox[{"phases", "[", 
             RowBox[{"[", "i", "]"}], "]"}], "-", 
            RowBox[{"phases", "[", 
             RowBox[{"[", "j", "]"}], "]"}]}], ">", 
           RowBox[{"2", "*", "Pi"}]}], ",", 
          RowBox[{
           RowBox[{"delta", "=", 
            RowBox[{"Floor", "[", 
             RowBox[{
              RowBox[{"(", 
               RowBox[{
                RowBox[{"phases", "[", 
                 RowBox[{"[", "i", "]"}], "]"}], "-", 
                RowBox[{"phases", "[", 
                 RowBox[{"[", "j", "]"}], "]"}], "+", 
                RowBox[{"2", "*", "Pi"}]}], ")"}], "/", 
              RowBox[{"(", 
               RowBox[{"4", "*", "Pi"}], ")"}]}], "]"}]}], ";", 
           RowBox[{
            RowBox[{"phases", "[", 
             RowBox[{"[", "i", "]"}], "]"}], "-=", 
            RowBox[{"2", "*", "Pi", "*", "delta"}]}], ";", 
           RowBox[{
            RowBox[{"phases", "[", 
             RowBox[{"[", "j", "]"}], "]"}], "+=", 
            RowBox[{"2", "*", "Pi", "*", "delta"}]}]}]}], "]"}], ",", 
        RowBox[{"{", 
         RowBox[{"i", ",", 
          RowBox[{"Length", "[", "phases", "]"}]}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"j", ",", 
          RowBox[{"Length", "[", "phases", "]"}]}], "}"}]}], "]"}], ";", 
      RowBox[{"Sort", "[", 
       RowBox[{"phases", ",", 
        RowBox[{
         RowBox[{"Order", "[", 
          RowBox[{
           RowBox[{"Abs", "[", "#1", "]"}], ",", 
           RowBox[{"Abs", "[", "#2", "]"}]}], "]"}], "&"}]}], "]"}]}]}], 
    "]"}]}]}]], "Input",
 InitializationCell->
  True,ExpressionUUID->"e954d9cb-b767-487e-9f12-96995a7f14d7"],

Cell[BoxData[
 RowBox[{
  RowBox[{"setAxialGauge", "[", "dir_", "]"}], ":=", 
  RowBox[{"(*", " ", 
   RowBox[{
    RowBox[{
    "Set", " ", "gauge", " ", "for", " ", "the", " ", "current", " ", 
     "lattice", " ", 
     RowBox[{"configuration", ".", "  ", "This"}], " ", "should", " ", "be", 
     " ", "exact"}], ",", " ", 
    RowBox[{
    "so", " ", "the", " ", "average", " ", "plaquette", " ", "should", " ", 
     "be", " ", 
     RowBox[{"unchanged", "."}]}]}], " ", "*)"}], "\[IndentingNewLine]", 
  RowBox[{"Do", "[", 
   RowBox[{
    RowBox[{"Block", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
        RowBox[{"coords", "=", 
         RowBox[{"latticeCoordinates", "[", "i", "]"}]}], ",", 
        RowBox[{"debug", "=", "False"}]}], "}"}], ",", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"coords", "[", 
          RowBox[{"[", "dir", "]"}], "]"}], "\[Equal]", "1"}], ",", 
        RowBox[{"Block", "[", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{
            RowBox[{"v", "=", 
             RowBox[{"IdentityMatrix", "[", "nc", "]"}]}], ",", "vt", ",", 
            "ct"}], "}"}], ",", 
          RowBox[{"(*", " ", 
           RowBox[{"Initial", " ", "values"}], " ", "*)"}], 
          "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"If", "[", 
            RowBox[{"False", ",", 
             RowBox[{"Do", "[", 
              RowBox[{
               RowBox[{"Print", "[", 
                RowBox[{"{", 
                 RowBox[{"j", ",", 
                  RowBox[{"getLink", "[", 
                   RowBox[{"dir", ",", 
                    RowBox[{"shift", "[", 
                    RowBox[{"dir", ",", "coords", ",", 
                    RowBox[{"j", "-", "1"}]}], "]"}]}], "]"}]}], "}"}], "]"}],
                ",", 
               RowBox[{"{", 
                RowBox[{"j", ",", 
                 RowBox[{"latticeDimensions", "[", 
                  RowBox[{"[", "dir", "]"}], "]"}]}], "}"}]}], "]"}]}], "]"}],
            ";", "\[IndentingNewLine]", 
           RowBox[{"Do", "[", 
            RowBox[{
             RowBox[{"v", "=", 
              RowBox[{"v", ".", 
               RowBox[{"getLink", "[", 
                RowBox[{"dir", ",", 
                 RowBox[{"shift", "[", 
                  RowBox[{"dir", ",", "coords", ",", 
                   RowBox[{"j", "-", "1"}]}], "]"}]}], "]"}]}]}], ",", 
             RowBox[{"{", 
              RowBox[{"j", ",", 
               RowBox[{"latticeDimensions", "[", 
                RowBox[{"[", "dir", "]"}], "]"}]}], "}"}]}], "]"}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"If", "[", 
            RowBox[{"debug", ",", 
             RowBox[{"Print", "[", 
              RowBox[{"\"\<Full product:\>\"", ",", " ", "v"}], "]"}]}], 
            "]"}], ";", 
           RowBox[{"v", "=", 
            RowBox[{"SUPower", "[", 
             RowBox[{"v", ",", 
              RowBox[{"1", "/", 
               RowBox[{"latticeDimensions", "[", 
                RowBox[{"[", "dir", "]"}], "]"}]}]}], "]"}]}], ";", 
           RowBox[{"If", "[", 
            RowBox[{"debug", ",", 
             RowBox[{"Print", "[", 
              RowBox[{"\"\<Root:\>\"", ",", " ", "v"}], "]"}]}], "]"}], ";", 
           RowBox[{"Do", "[", 
            RowBox[{"(*", " ", 
             RowBox[{
             "Apply", " ", "gauge", " ", "choice", " ", "to", " ", "each", 
              " ", "site"}], " ", "*)"}], "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{
              RowBox[{"ct", "=", 
               RowBox[{"shift", "[", 
                RowBox[{"dir", ",", "coords", ",", 
                 RowBox[{"j", "-", "1"}]}], "]"}]}], ";", 
              RowBox[{"vt", "=", 
               RowBox[{
                RowBox[{"ConjugateTranspose", "[", 
                 RowBox[{"getLink", "[", 
                  RowBox[{"dir", ",", 
                   RowBox[{"shift", "[", 
                    RowBox[{"dir", ",", "ct", ",", 
                    RowBox[{"-", "1"}]}], "]"}]}], "]"}], "]"}], ".", "v"}]}],
               ";", 
              RowBox[{"Do", "[", 
               RowBox[{
                RowBox[{
                 RowBox[{"setLink", "[", 
                  RowBox[{"dd", ",", 
                   RowBox[{"shift", "[", 
                    RowBox[{"dd", ",", "ct", ",", 
                    RowBox[{"-", "1"}]}], "]"}], ",", 
                   RowBox[{"(*", " ", 
                    RowBox[{
                    RowBox[{
                    "In", " ", "order", " ", "to", " ", "decrease", " ", 
                    "the", " ", "floating", " ", "point", " ", "error"}], ",",
                     " ", 
                    RowBox[{
                    "just", " ", "set", " ", "the", " ", "axial", " ", 
                    "direction", " ", "link", " ", "to", " ", "the", " ", 
                    "correct", " ", 
                    RowBox[{"value", "."}]}]}], " ", "*)"}], 
                   RowBox[{"If", "[", 
                    RowBox[{
                    RowBox[{"dd", "\[Equal]", "dir"}], ",", "v", ",", 
                    RowBox[{
                    RowBox[{"getLink", "[", 
                    RowBox[{"dd", ",", 
                    RowBox[{"shift", "[", 
                    RowBox[{"dd", ",", "ct", ",", 
                    RowBox[{"-", "1"}]}], "]"}]}], "]"}], ".", "vt"}]}], 
                    "]"}]}], "]"}], ";", 
                 RowBox[{"setLink", "[", 
                  RowBox[{"dd", ",", "ct", ",", 
                   RowBox[{
                    RowBox[{"ConjugateTranspose", "[", "vt", "]"}], ".", 
                    RowBox[{"getLink", "[", 
                    RowBox[{"dd", ",", "ct"}], "]"}]}]}], "]"}]}], ",", 
                RowBox[{"{", 
                 RowBox[{"dd", ",", "nd"}], "}"}]}], "]"}]}], ",", 
             RowBox[{"{", 
              RowBox[{"j", ",", "2", ",", 
               RowBox[{"latticeDimensions", "[", 
                RowBox[{"[", "dir", "]"}], "]"}]}], "}"}]}], "]"}], ";", 
           RowBox[{"(*", " ", 
            RowBox[{
            "Verify", " ", "that", " ", "it", " ", "all", " ", "worked", " ", 
             "out"}], " ", "*)"}], "\[IndentingNewLine]", 
           RowBox[{"If", "[", 
            RowBox[{"debug", ",", 
             RowBox[{
              RowBox[{"Do", "[", 
               RowBox[{
                RowBox[{"Print", "[", 
                 RowBox[{"{", 
                  RowBox[{"j", ",", 
                   RowBox[{"getLink", "[", 
                    RowBox[{"dir", ",", 
                    RowBox[{"shift", "[", 
                    RowBox[{"dir", ",", "coords", ",", 
                    RowBox[{"j", "-", "1"}]}], "]"}]}], "]"}]}], "}"}], "]"}],
                 ",", 
                RowBox[{"{", 
                 RowBox[{"j", ",", 
                  RowBox[{"latticeDimensions", "[", 
                   RowBox[{"[", "dir", "]"}], "]"}]}], "}"}]}], "]"}], ";", 
              "\[IndentingNewLine]", 
              RowBox[{"Print", "[", 
               RowBox[{"\"\<Final link diff:\>\"", ",", 
                RowBox[{"Chop", "[", 
                 RowBox[{"v", "-", 
                  RowBox[{"getLink", "[", 
                   RowBox[{"dir", ",", 
                    RowBox[{"shift", "[", 
                    RowBox[{"dir", ",", "coords", ",", 
                    RowBox[{"-", "1"}]}], "]"}]}], "]"}]}], "]"}]}], 
               "]"}]}]}], "]"}]}]}], "]"}]}], "]"}]}], "]"}], ",", 
    RowBox[{"{", 
     RowBox[{"i", ",", 
      RowBox[{"latticeVolume", "[", "]"}]}], "}"}]}], "]"}]}]], "Input",
 InitializationCell->
  True,ExpressionUUID->"9083f81b-6c62-4ab0-b753-7947975525cd"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"sumStaples", "[", 
    RowBox[{"dir1_", ",", "coords_"}], "]"}], ":=", 
   RowBox[{"(*", " ", 
    RowBox[{
    "returns", " ", "a", " ", "general", " ", "matrix", " ", "in", " ", 
     "color", " ", "space"}], " ", "*)"}], " ", 
   RowBox[{"Block", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"total", "=", 
       RowBox[{"Array", "[", 
        RowBox[{
         RowBox[{"0.0", "&"}], ",", 
         RowBox[{"{", 
          RowBox[{"nc", ",", "nc"}], "}"}]}], "]"}]}], "}"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"Do", "[", 
       RowBox[{
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{"dir2", "\[NotEqual]", "dir1"}], ",", 
          RowBox[{"(*", " ", 
           RowBox[{"forward", " ", "staple"}], " ", "*)"}], 
          RowBox[{
           RowBox[{"total", " ", "+=", " ", 
            RowBox[{
             RowBox[{"getLink", "[", 
              RowBox[{"dir2", ",", 
               RowBox[{"shift", "[", 
                RowBox[{"dir1", ",", "coords"}], "]"}]}], "]"}], ".", 
             RowBox[{"ConjugateTranspose", "[", 
              RowBox[{"getLink", "[", 
               RowBox[{"dir1", ",", 
                RowBox[{"shift", "[", 
                 RowBox[{"dir2", ",", "coords"}], "]"}]}], "]"}], "]"}], ".", 
             
             RowBox[{"ConjugateTranspose", "[", 
              RowBox[{"getLink", "[", 
               RowBox[{"dir2", ",", "coords"}], "]"}], "]"}]}]}], ";", 
           RowBox[{"(*", 
            RowBox[{
             RowBox[{" ", 
              RowBox[{"backward", " ", 
               RowBox[{"staple", ".", "  ", "Note"}], " ", "that", " ", "we", 
               " ", "simply", " ", "demand", " ", "that", " ", 
               RowBox[{"Re", "[", " ", 
                RowBox[{"Tr", "[", " ", 
                 RowBox[{"F", " ", "U"}], "]"}], "]"}]}], "]"}], ",", " ", 
             RowBox[{
             "where", " ", "F", " ", "is", " ", "the", " ", "staple"}], ",", 
             " ", 
             RowBox[{
             "gives", " ", "the", " ", "plaquette", " ", "used", " ", "in", 
              " ", "the", " ", 
              RowBox[{"action", ".", "  ", "Thus"}]}], ",", " ", 
             RowBox[{
             "we", " ", "are", " ", "free", " ", "to", " ", "take", " ", 
              "the", " ", "complex", " ", "conjugate", " ", 
              RowBox[{
               RowBox[{"(", 
                RowBox[{"charge", " ", "congugate"}], ")"}], "."}]}]}], " ", 
            "*)"}], " ", 
           RowBox[{"total", " ", "+=", " ", 
            RowBox[{
             RowBox[{"ConjugateTranspose", "[", 
              RowBox[{"getLink", "[", 
               RowBox[{"dir2", ",", 
                RowBox[{"shift", "[", 
                 RowBox[{"dir2", ",", 
                  RowBox[{"shift", "[", 
                   RowBox[{"dir1", ",", "coords"}], "]"}], ",", 
                  RowBox[{"-", "1"}]}], "]"}]}], "]"}], "]"}], ".", 
             RowBox[{"ConjugateTranspose", "[", 
              RowBox[{"getLink", "[", 
               RowBox[{"dir1", ",", 
                RowBox[{"shift", "[", 
                 RowBox[{"dir2", ",", "coords", ",", 
                  RowBox[{"-", "1"}]}], "]"}]}], "]"}], "]"}], ".", 
             RowBox[{"getLink", "[", 
              RowBox[{"dir2", ",", 
               RowBox[{"shift", "[", 
                RowBox[{"dir2", ",", "coords", ",", 
                 RowBox[{"-", "1"}]}], "]"}]}], "]"}]}]}]}]}], "]"}], ",", 
        RowBox[{"{", 
         RowBox[{"dir2", ",", "nd"}], "}"}]}], "]"}], ";", "total"}]}], 
    "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"stapleTest", "[", "]"}], ":=", 
   RowBox[{"(*", " ", 
    RowBox[{
    "Find", " ", "the", " ", "average", " ", "plaquette", " ", "using", " ", 
     "the", " ", "staples", " ", "times", " ", "the", " ", 
     RowBox[{"link", ".", "  ", "This"}], " ", "should", " ", "be", " ", 
     "equal", " ", "to", " ", "the", " ", "normal", " ", "average", " ", 
     RowBox[{"plaquette", ".", " ", "Each"}], " ", "plaquette", " ", 
     "contributes", " ", "to", " ", "4", " ", 
     RowBox[{"staples", "."}]}], " ", "*)"}], 
   RowBox[{"Chop", "[", 
    RowBox[{
     RowBox[{"Sum", "[", 
      RowBox[{
       RowBox[{"Tr", "[", 
        RowBox[{
         RowBox[{"sumStaples", "[", 
          RowBox[{"dir", ",", 
           RowBox[{"latticeCoordinates", "[", "k", "]"}]}], "]"}], ".", 
         RowBox[{"getLink", "[", 
          RowBox[{"dir", ",", 
           RowBox[{"latticeCoordinates", "[", "k", "]"}]}], "]"}]}], "]"}], 
       ",", 
       RowBox[{"{", 
        RowBox[{"k", ",", 
         RowBox[{"latticeVolume", "[", "]"}]}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"dir", ",", "nd"}], "}"}]}], "]"}], "*", 
     RowBox[{"2", "/", 
      RowBox[{"(", 
       RowBox[{
        RowBox[{"latticeVolume", "[", "]"}], "*", "nd", "*", 
        RowBox[{"(", 
         RowBox[{"nd", "-", "1"}], ")"}], "*", "nc", "*", "4"}], ")"}]}]}], 
    "]"}]}], ";"}]}], "Input",
 InitializationCell->
  True,ExpressionUUID->"6c519afd-3e5e-4857-bc41-ea14ed4387ed"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"saddlePointStep", "[", 
    RowBox[{"u2Staples_", ",", "u1_"}], "]"}], ":=", " ", 
   RowBox[{"(*", " ", 
    RowBox[{
     RowBox[{
     "One", " ", "iteration", " ", "of", " ", "the", " ", "saddle", " ", 
      "point", " ", 
      RowBox[{"search", ".", "  ", "Set"}], " ", "zzz", " ", "to", " ", "a", 
      " ", "large", " ", "number", " ", "to", " ", "test", " ", "this", " ", 
      "against", " ", "the", " ", "explicit", " ", 
      RowBox[{"calculation", ".", "  ", "Choose"}], " ", "\"\<cutoff\>\"", 
      " ", "to", " ", "suppress", " ", "shifts", " ", "that", " ", "are", " ",
       "too", " ", 
      RowBox[{"large", ".", "  ", "I"}], " ", "used", " ", "the", " ", 
      "sumStaples"}], "=", 
     RowBox[{
     "1", " ", "case", " ", "to", " ", "tune", " ", "\"\<cutoff.\>\""}]}], 
    "  ", "*)"}], " ", 
   RowBox[{"Block", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"zzz", "=", "1"}], ",", 
       RowBox[{"cutoff", "=", "Pi"}], ",", 
       RowBox[{"debug", "=", "False"}], ",", 
       RowBox[{"ff", "=", 
        RowBox[{"u2Staples", ".", "u1"}]}], ",", "grad", ",", "mm", ",", "oo",
        ",", "values", ",", "shifts", ",", "sqrtU", ",", 
       RowBox[{"nc", "=", 
        RowBox[{"Length", "[", "u2Staples", "]"}]}]}], "}"}], ",", 
     RowBox[{
      RowBox[{"grad", "=", 
       RowBox[{"Map", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"Tr", "[", 
           RowBox[{"ff", ".", "#"}], "]"}], "&"}], ",", 
         RowBox[{"suGenerators", "[", "nc", "]"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{"debug", ",", 
        RowBox[{"Print", "[", 
         RowBox[{"\"\<grad:  \>\"", ",", "grad"}], "]"}]}], "]"}], ";", 
      RowBox[{"mm", "=", 
       RowBox[{
        RowBox[{
         RowBox[{
          RowBox[{"Re", "[", 
           RowBox[{"Tr", "[", "ff", "]"}], "]"}], "/", 
          RowBox[{"(", 
           RowBox[{"2.0", " ", 
            RowBox[{"Length", "[", "ff", "]"}]}], ")"}]}], " ", 
         RowBox[{"IdentityMatrix", "[", 
          RowBox[{"Length", "[", "grad", "]"}], "]"}]}], "+", 
        RowBox[{
         RowBox[{
          RowBox[{"suSymmetric", "[", "nc", "]"}], ".", 
          RowBox[{"Re", "[", "grad", "]"}]}], "/", "2.0"}]}]}], ";", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"values", ",", "oo"}], "}"}], "=", 
       RowBox[{"Eigensystem", "[", "mm", "]"}]}], ";", "\[IndentingNewLine]", 
      
      RowBox[{"(*", " ", 
       RowBox[{
       "Using", " ", "the", " ", "fact", " ", "that", " ", "the", " ", 
        "periodicity", " ", "of", " ", "B_a", " ", "is", " ", "4", " ", "Pi", 
        " ", "or", " ", 
        RowBox[{"less", "."}]}], " ", "*)"}], " ", 
      RowBox[{"shifts", "=", 
       RowBox[{"MapThread", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"If", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"2", " ", "Pi", " ", "zzz", "  ", 
              RowBox[{"Abs", "[", "#2", "]"}]}], "<", 
             RowBox[{"Abs", "[", "#1", "]"}]}], ",", "0", ",", 
            RowBox[{
             RowBox[{
              RowBox[{"-", "#1"}], "/", "#2"}], " ", 
             RowBox[{"Exp", "[", 
              RowBox[{
               RowBox[{"-", 
                RowBox[{
                 RowBox[{"(", 
                  RowBox[{"#1", "/", 
                   RowBox[{"(", 
                    RowBox[{"#2", " ", "cutoff", " ", "zzz"}], ")"}]}], ")"}],
                  "^", "2"}]}], "/", "2"}], " ", "]"}]}]}], "]"}], "&"}], ",", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"oo", ".", 
            RowBox[{"Im", "[", "grad", "]"}]}], ",", "values"}], "}"}]}], 
        "]"}]}], ";", 
      RowBox[{"If", "[", 
       RowBox[{"debug", ",", 
        RowBox[{"Print", "[", 
         RowBox[{"\"\<shifts:  \>\"", ",", "shifts"}], "]"}]}], "]"}], ";", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"u1", ".", 
         RowBox[{"MatrixExp", "[", 
          RowBox[{"I", " ", 
           RowBox[{"shifts", ".", "oo", ".", 
            RowBox[{"suGenerators", "[", "nc", "]"}]}]}], "]"}]}], ",", 
        RowBox[{"Max", "[", 
         RowBox[{"Abs", "[", "shifts", "]"}], "]"}]}], "}"}]}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"linkSaddlePoint", "[", 
    RowBox[{"dir_", ",", "coords_", ",", 
     RowBox[{"maxCount_:", "20"}], ",", 
     RowBox[{"tol_:", 
      RowBox[{"10", "^", 
       RowBox[{"-", "6"}]}]}]}], "]"}], ":=", " ", 
   RowBox[{"(*", " ", 
    RowBox[{
    "Saddle", " ", "point", " ", "search", " ", "for", " ", "a", " ", 
     "single", " ", 
     RowBox[{"link", "."}]}], " ", "*)"}], "\[IndentingNewLine]", 
   RowBox[{"Block", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"maxShift", "=", 
        RowBox[{"4", " ", "Pi"}]}], ",", 
       RowBox[{"debug", "=", "False"}], ",", 
       RowBox[{"u1", "=", 
        RowBox[{"SUPower", "[", 
         RowBox[{
          RowBox[{"getLink", "[", 
           RowBox[{"dir", ",", "coords"}], "]"}], ",", "0.5"}], "]"}]}], ",", 
       "u2", ",", "u2SumStaples", ",", 
       RowBox[{"count", "=", "1"}], ",", "uu"}], "}"}], ",", 
     RowBox[{
      RowBox[{"u2", "=", "u1"}], ";", "\[IndentingNewLine]", 
      RowBox[{"u2SumStaples", "=", 
       RowBox[{"u2", ".", 
        RowBox[{"sumStaples", "[", 
         RowBox[{"dir", ",", "coords"}], "]"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"While", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"maxShift", ">", "tol"}], "&&", 
         RowBox[{"count", "<=", "maxCount"}]}], ",", 
        RowBox[{
         RowBox[{"count", "++"}], ";", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"u1", ",", "maxShift"}], "}"}], "=", 
          RowBox[{"saddlePointStep", "[", 
           RowBox[{"u2SumStaples", ",", "u1"}], "]"}]}], ";", 
         RowBox[{"If", "[", 
          RowBox[{"debug", ",", 
           RowBox[{"Print", "[", 
            RowBox[{"\"\<Max shift:  \>\"", ",", "maxShift"}], "]"}]}], 
          "]"}]}]}], "]"}], ";", 
      RowBox[{"uu", "=", 
       RowBox[{"u1", ".", "u2"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{"debug", ",", 
        RowBox[{"SUMatrixQ", "[", "uu", "]"}]}], "]"}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{"debug", ",", 
        RowBox[{"Print", "[", "\"\<Link not updated.\>\"", "]"}], ",", 
        RowBox[{"setLink", "[", 
         RowBox[{"dir", ",", "coords", ",", "uu"}], "]"}]}], "]"}], ";", 
      RowBox[{"{", "maxShift", "}"}]}]}], "]"}]}], ";", 
  RowBox[{
   RowBox[{"latticeSaddlePoint", "[", 
    RowBox[{
     RowBox[{"maxCount_:", "20"}], ",", 
     RowBox[{"tol_:", 
      RowBox[{"10", "^", 
       RowBox[{"-", "6"}]}]}]}], "]"}], ":=", 
   RowBox[{"Block", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"count", "=", "1"}], ",", 
       RowBox[{"maxShift", "=", 
        RowBox[{"4", " ", "Pi"}]}], ",", "linkShift"}], "}"}], ",", 
     RowBox[{"While", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"count", "<", "maxCount"}], "&&", 
        RowBox[{"maxShift", ">", "tol"}]}], ",", 
       RowBox[{
        RowBox[{"maxShift", "=", "0"}], ";", 
        RowBox[{"Do", "[", 
         RowBox[{
          RowBox[{
           RowBox[{
            RowBox[{"{", "linkShift", "}"}], "=", 
            RowBox[{"linkSaddlePoint", "[", 
             RowBox[{"dir", ",", 
              RowBox[{"latticeCoordinates", "[", "k", "]"}], ",", "1"}], 
             "]"}]}], ";", 
           RowBox[{"maxShift", "=", 
            RowBox[{"Max", "[", 
             RowBox[{"linkShift", ",", "maxShift"}], "]"}]}]}], ",", 
          RowBox[{"{", 
           RowBox[{"dir", ",", "nd"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"k", ",", 
            RowBox[{"latticeVolume", "[", "]"}]}], "}"}]}], "]"}], ";", 
        RowBox[{"Print", "[", 
         RowBox[{"{", 
          RowBox[{"count", ",", " ", "maxShift", ",", 
           RowBox[{"averagePlaquette", "[", "]"}]}], "}"}], "]"}], ";", 
        RowBox[{"count", "++"}]}]}], "]"}]}], "]"}]}], ";"}]}], "Input",
 InitializationCell->
  True,ExpressionUUID->"45eaa5ca-b19a-4f30-a3a3-d2a24b4f1500"]
}, Closed]],

Cell[CellGroupData[{

Cell["Analysis", \
"Section",ExpressionUUID->"1c93cf5a-79ab-498c-bcfe-5a738bfce9fe"],

Cell[CellGroupData[{

Cell["Test matrixPower, SU(N)  generators.", \
"Subsection",ExpressionUUID->"3768ebd7-60d1-412e-8a86-45056134f460"],

Cell[BoxData[
 RowBox[{"x", "=", 
  RowBox[{"centerSUMatrix", "[", 
   RowBox[{"7", ",", "1"}], 
   "]"}]}]], "Input",ExpressionUUID->"83f7ac9d-741e-4e0d-8947-0dbc40a223f5"],

Cell[BoxData[
 RowBox[{
  RowBox[{"x", "=", 
   RowBox[{"randomSUMatrix", "[", "7", "]"}]}], 
  ";"}]], "Input",ExpressionUUID->"3972b830-e5b1-4e08-84e7-b6ace11488f2"],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"x", "=", 
  RowBox[{"gaugeField", "[", 
   RowBox[{"[", 
    RowBox[{"3", ",", "15"}], "]"}], "]"}]}]], "Input",
 CellChangeTimes->{{3.766972462904788*^9, 3.766972464175539*^9}, {
  3.767356782678484*^9, 3.7673567833886337`*^9}, {3.767357017701527*^9, 
  3.767357038858267*^9}, {3.76735796456426*^9, 3.767357975954447*^9}, {
  3.7673907291441927`*^9, 
  3.7673907295357113`*^9}},ExpressionUUID->"09e0ea41-9489-459d-9d9f-\
8418726ad0fa"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{
     RowBox[{
      RowBox[{"-", "0.286707907915115`"}], "-", 
      RowBox[{"0.126614078879356`", " ", "\[ImaginaryI]"}]}], ",", 
     RowBox[{
      RowBox[{"-", "0.453057885169983`"}], "+", 
      RowBox[{"0.223333477973938`", " ", "\[ImaginaryI]"}]}], ",", 
     RowBox[{"0.67569375038147`", "\[VeryThinSpace]", "-", 
      RowBox[{"0.435966104269028`", " ", "\[ImaginaryI]"}]}]}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"0.499684810638428`", "\[VeryThinSpace]", "-", 
      RowBox[{"0.676115691661835`", " ", "\[ImaginaryI]"}]}], ",", 
     RowBox[{"0.40719085931778`", "\[VeryThinSpace]", "+", 
      RowBox[{"0.271043479442596`", " ", "\[ImaginaryI]"}]}], ",", 
     RowBox[{"0.160523325204849`", "\[VeryThinSpace]", "-", 
      RowBox[{"0.167768090963364`", " ", "\[ImaginaryI]"}]}]}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{
      RowBox[{"-", "0.428560137748718`"}], "-", 
      RowBox[{"0.106237903237343`", " ", "\[ImaginaryI]"}]}], ",", 
     RowBox[{"0.110135458409786`", "\[VeryThinSpace]", "+", 
      RowBox[{"0.702468574047089`", " ", "\[ImaginaryI]"}]}], ",", 
     RowBox[{
      RowBox[{"-", "0.007040038704872`"}], "+", 
      RowBox[{"0.547182321548462`", " ", "\[ImaginaryI]"}]}]}], "}"}]}], 
  "}"}]], "Output",ExpressionUUID->"21d4ae7a-b27e-47c8-9143-dabc835e3cb2"]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"SUMatrixQ", "[", "x", 
  "]"}]], "Input",ExpressionUUID->"80906468-84a1-4026-96bd-690bba264101"],

Cell[BoxData["True"], \
"Output",ExpressionUUID->"e4a1c7c7-4eee-4d70-b108-ad266c5e42a5"]
}, Open  ]],

Cell["Take the root", \
"Text",ExpressionUUID->"acb868d4-d5e8-4657-ad42-0d4081390ddf"],

Cell[BoxData[
 RowBox[{
  RowBox[{"z", "=", 
   RowBox[{"SUPower", "[", 
    RowBox[{"x", ",", "0.2"}], "]"}]}], 
  ";"}]], "Input",ExpressionUUID->"62f8217a-e245-48d9-8c8c-d98248f435b0"],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"SUMatrixQ", "[", "z", 
  "]"}]], "Input",ExpressionUUID->"eaaf0de9-62f1-4337-af34-c735668926af"],

Cell[BoxData["True"], \
"Output",ExpressionUUID->"7fd4892b-24cf-4cca-ab50-5505db4a8b6e"]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"Norm", "[", 
  RowBox[{
   RowBox[{
    RowBox[{"z", ".", "z", ".", "z", ".", "z", ".", "z"}], "-", 
    RowBox[{"SUPower", "[", 
     RowBox[{"x", ",", "1"}], "]"}]}], ",", "Infinity"}], 
  "]"}]], "Input",ExpressionUUID->"d657ec9c-b8dc-4229-bc27-6cea2129aed5"],

Cell[BoxData["2.3862737962066544`*^-15"], \
"Output",ExpressionUUID->"6ba43939-4c2e-4ca8-979a-c83d2a8a9ed0"]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"matrixEqual", "[", 
  RowBox[{
   RowBox[{"z", ".", "z", ".", "z", ".", "z", ".", "z"}], ",", "x"}], 
  "]"}]], "Input",ExpressionUUID->"e3d96ab9-95ac-4bd9-80bc-ce055550bf5c"],

Cell[BoxData["True"], \
"Output",ExpressionUUID->"205cfb55-6cc4-41b7-ab4b-fe83ed8250de"]
}, Open  ]],

Cell["Test normalization & orthogonality of the SU (N) generators", \
"Text",ExpressionUUID->"0df0843e-f046-4bef-9c91-a32daf7728d0"],

Cell[BoxData[
 RowBox[{"TableForm", "[", 
  RowBox[{"Block", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"x", "=", 
      RowBox[{"suGenerators", "[", "4", "]"}]}], "}"}], ",", 
    RowBox[{"Table", "[", 
     RowBox[{
      RowBox[{"Tr", "[", 
       RowBox[{
        RowBox[{"x", "[", 
         RowBox[{"[", "i", "]"}], "]"}], ".", 
        RowBox[{"x", "[", 
         RowBox[{"[", "j", "]"}], "]"}]}], "]"}], ",", 
      RowBox[{"{", 
       RowBox[{"i", ",", 
        RowBox[{"Length", "[", "x", "]"}]}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{"j", ",", 
        RowBox[{"Length", "[", "x", "]"}]}], "}"}]}], "]"}]}], "]"}], 
  "]"}]], "Input",ExpressionUUID->"a1b2d7e8-3313-41b8-aeba-77693b57720d"]
}, Closed]],

Cell[CellGroupData[{

Cell["Test Axial gauge", \
"Subsection",ExpressionUUID->"e5feee6c-2068-491e-8d64-92dee0a2fe65"],

Cell[BoxData[
 RowBox[{"<<", 
  "\"\<test-4.m\>\""}]], \
"Input",ExpressionUUID->"5a200ad1-31a0-4112-b7a3-c5e52782264c"],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"averagePlaquette", "[", 
  "]"}]], "Input",ExpressionUUID->"7746dad0-5a33-4528-8a58-3d38bc371635"],

Cell[BoxData["0.815348021267465`"], \
"Output",ExpressionUUID->"b2dc8871-83a6-4e5a-b00a-ae87456dbb70"]
}, Open  ]],

Cell[BoxData[
 RowBox[{"setAxialGauge", "[", "3", 
  "]"}]], "Input",ExpressionUUID->"0458857f-8518-4dd3-a723-da3b171368e2"],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"averagePlaquette", "[", 
  "]"}]], "Input",ExpressionUUID->"9d6889ff-b3a2-42df-8839-08eb31fce7f6"],

Cell[BoxData["0.8153483292850945`"], \
"Output",ExpressionUUID->"8efa4177-e234-407d-a9db-05d275bf4e3b"]
}, Open  ]]
}, Closed]],

Cell[CellGroupData[{

Cell["Test staples", \
"Subsection",ExpressionUUID->"20cab966-72db-4a0e-a3c9-c441209a6695"],

Cell[BoxData[
 RowBox[{"<<", 
  "\"\<test-3-3-5.m\>\""}]], \
"Input",ExpressionUUID->"5d45f07a-0025-4042-b13a-72760f17db4e"],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"xxx", "=", 
  RowBox[{
  "averagePlaquette", "[", 
   "]"}]}]], "Input",ExpressionUUID->"aaa03ae6-2b2d-4a32-a3c4-9427ff5483c8"],

Cell[BoxData["0.4780676533645084`"], \
"Output",ExpressionUUID->"e849b974-1f92-4655-b88d-6cf1031d43f8"]
}, Open  ]],

Cell["Set all links to the identity", \
"Text",ExpressionUUID->"4f5ae57b-7c05-4e93-9f03-e22def70aed2"],

Cell[BoxData[
 RowBox[{
  RowBox[{"gaugeField", "=", 
   RowBox[{"Array", "[", 
    RowBox[{
     RowBox[{
      RowBox[{"IdentityMatrix", "[", "nc", "]"}], "&"}], ",", 
     RowBox[{"{", 
      RowBox[{"nd", ",", 
       RowBox[{"latticeVolume", "[", "]"}]}], "}"}]}], "]"}]}], 
  ";"}]], "Input",ExpressionUUID->"3dd601f5-6d42-4caf-ac7d-19ea7a372c98"],

Cell[BoxData[
 RowBox[{"sumStaples", "[", 
  RowBox[{"1", ",", 
   RowBox[{"{", 
    RowBox[{"1", ",", "1", ",", "1"}], "}"}]}], 
  "]"}]], "Input",ExpressionUUID->"52f87409-1652-4a2e-a522-7d91bad2517f"],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"stapleTest", "[", 
  "]"}]], "Input",ExpressionUUID->"dbb8f2f1-a08d-4f24-8bc4-8c4b47047fe8"],

Cell[BoxData["0.47806765336450835`"], \
"Output",ExpressionUUID->"94571947-0f41-44ea-83a9-a4f046a5732f"]
}, Open  ]]
}, Closed]],

Cell[CellGroupData[{

Cell["Identity staple example, SU(3)", \
"Subsection",ExpressionUUID->"4cc5e141-3548-47ec-a602-316212f17611"],

Cell["\<\
Special case where the sum of staples is proportional to the identity matrix.\
\
\>", "Text",ExpressionUUID->"d2ec2c3f-ee99-44cc-bd63-8307a5fd7309"],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"diagValue", "=", 
  RowBox[{
   RowBox[{"Cos", "[", "x1", "]"}], "+", 
   RowBox[{"Cos", "[", "x2", "]"}], "+", 
   RowBox[{"Cos", "[", 
    RowBox[{
     RowBox[{"-", "x1"}], "-", "x2"}], 
    "]"}]}]}]], \
"Input",ExpressionUUID->"2be3d327-4cbf-40f5-beb7-ed9f45dfd695"],

Cell[BoxData[
 RowBox[{
  RowBox[{"Cos", "[", "x1", "]"}], "+", 
  RowBox[{"Cos", "[", "x2", "]"}], "+", 
  RowBox[{"Cos", "[", 
   RowBox[{"x1", "+", "x2"}], 
   "]"}]}]], "Output",ExpressionUUID->"c4e45ad3-7f7d-44e4-bc45-d4f43d30c7af"]
}, Open  ]],

Cell["Saddle Points", \
"Text",ExpressionUUID->"eeb9143c-73af-42a5-ac96-d05baf2929f1"],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"Solve", "[", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{
     RowBox[{
      RowBox[{"D", "[", 
       RowBox[{"diagValue", ",", "x1"}], "]"}], "\[Equal]", "0"}], ",", 
     RowBox[{
      RowBox[{"D", "[", 
       RowBox[{"diagValue", ",", "x2"}], "]"}], "\[Equal]", "0"}]}], "}"}], 
   ",", 
   RowBox[{"{", 
    RowBox[{"x1", ",", "x2"}], "}"}]}], 
  "]"}]], "Input",ExpressionUUID->"aac00b40-a44d-44cc-af31-df8704faaea1"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{
     RowBox[{"x1", "\[Rule]", 
      RowBox[{"ConditionalExpression", "[", 
       RowBox[{
        RowBox[{"2", " ", "\[Pi]", " ", 
         RowBox[{"C", "[", "1", "]"}]}], ",", 
        RowBox[{
         RowBox[{"C", "[", "1", "]"}], "\[Element]", 
         TemplateBox[{},
          "Integers"]}]}], "]"}]}], ",", 
     RowBox[{"x2", "\[Rule]", 
      RowBox[{"ConditionalExpression", "[", 
       RowBox[{
        RowBox[{"2", " ", "\[Pi]", " ", 
         RowBox[{"C", "[", "2", "]"}]}], ",", 
        RowBox[{
         RowBox[{"C", "[", "2", "]"}], "\[Element]", 
         TemplateBox[{},
          "Integers"]}]}], "]"}]}]}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"x1", "\[Rule]", 
      RowBox[{"ConditionalExpression", "[", 
       RowBox[{
        RowBox[{"2", " ", "\[Pi]", " ", 
         RowBox[{"C", "[", "1", "]"}]}], ",", 
        RowBox[{
         RowBox[{"C", "[", "1", "]"}], "\[Element]", 
         TemplateBox[{},
          "Integers"]}]}], "]"}]}], ",", 
     RowBox[{"x2", "\[Rule]", 
      RowBox[{"ConditionalExpression", "[", 
       RowBox[{
        RowBox[{"\[Pi]", "+", 
         RowBox[{"2", " ", "\[Pi]", " ", 
          RowBox[{"C", "[", "2", "]"}]}]}], ",", 
        RowBox[{
         RowBox[{"C", "[", "2", "]"}], "\[Element]", 
         TemplateBox[{},
          "Integers"]}]}], "]"}]}]}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"x1", "\[Rule]", 
      RowBox[{"ConditionalExpression", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"-", 
          FractionBox[
           RowBox[{"2", " ", "\[Pi]"}], "3"]}], "+", 
         RowBox[{"2", " ", "\[Pi]", " ", 
          RowBox[{"C", "[", "1", "]"}]}]}], ",", 
        RowBox[{
         RowBox[{"C", "[", "1", "]"}], "\[Element]", 
         TemplateBox[{},
          "Integers"]}]}], "]"}]}], ",", 
     RowBox[{"x2", "\[Rule]", 
      RowBox[{"ConditionalExpression", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"-", 
          FractionBox[
           RowBox[{"2", " ", "\[Pi]"}], "3"]}], "+", 
         RowBox[{"2", " ", "\[Pi]", " ", 
          RowBox[{"C", "[", "2", "]"}]}]}], ",", 
        RowBox[{
         RowBox[{"C", "[", "2", "]"}], "\[Element]", 
         TemplateBox[{},
          "Integers"]}]}], "]"}]}]}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"x1", "\[Rule]", 
      RowBox[{"ConditionalExpression", "[", 
       RowBox[{
        RowBox[{
         FractionBox[
          RowBox[{"2", " ", "\[Pi]"}], "3"], "+", 
         RowBox[{"2", " ", "\[Pi]", " ", 
          RowBox[{"C", "[", "1", "]"}]}]}], ",", 
        RowBox[{
         RowBox[{"C", "[", "1", "]"}], "\[Element]", 
         TemplateBox[{},
          "Integers"]}]}], "]"}]}], ",", 
     RowBox[{"x2", "\[Rule]", 
      RowBox[{"ConditionalExpression", "[", 
       RowBox[{
        RowBox[{
         FractionBox[
          RowBox[{"2", " ", "\[Pi]"}], "3"], "+", 
         RowBox[{"2", " ", "\[Pi]", " ", 
          RowBox[{"C", "[", "2", "]"}]}]}], ",", 
        RowBox[{
         RowBox[{"C", "[", "2", "]"}], "\[Element]", 
         TemplateBox[{},
          "Integers"]}]}], "]"}]}]}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"x1", "\[Rule]", 
      RowBox[{"ConditionalExpression", "[", 
       RowBox[{
        RowBox[{"\[Pi]", "+", 
         RowBox[{"2", " ", "\[Pi]", " ", 
          RowBox[{"C", "[", "1", "]"}]}]}], ",", 
        RowBox[{
         RowBox[{"C", "[", "1", "]"}], "\[Element]", 
         TemplateBox[{},
          "Integers"]}]}], "]"}]}], ",", 
     RowBox[{"x2", "\[Rule]", 
      RowBox[{"ConditionalExpression", "[", 
       RowBox[{
        RowBox[{"2", " ", "\[Pi]", " ", 
         RowBox[{"C", "[", "2", "]"}]}], ",", 
        RowBox[{
         RowBox[{"C", "[", "2", "]"}], "\[Element]", 
         TemplateBox[{},
          "Integers"]}]}], "]"}]}]}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"x1", "\[Rule]", 
      RowBox[{"ConditionalExpression", "[", 
       RowBox[{
        RowBox[{"\[Pi]", "+", 
         RowBox[{"2", " ", "\[Pi]", " ", 
          RowBox[{"C", "[", "1", "]"}]}]}], ",", 
        RowBox[{
         RowBox[{"C", "[", "1", "]"}], "\[Element]", 
         TemplateBox[{},
          "Integers"]}]}], "]"}]}], ",", 
     RowBox[{"x2", "\[Rule]", 
      RowBox[{"ConditionalExpression", "[", 
       RowBox[{
        RowBox[{"\[Pi]", "+", 
         RowBox[{"2", " ", "\[Pi]", " ", 
          RowBox[{"C", "[", "2", "]"}]}]}], ",", 
        RowBox[{
         RowBox[{"C", "[", "2", "]"}], "\[Element]", 
         TemplateBox[{},
          "Integers"]}]}], "]"}]}]}], "}"}]}], 
  "}"}]], "Output",ExpressionUUID->"35cebbc3-81ae-4254-bc34-aa1760d39ff5"]
}, Open  ]],

Cell["Hessian", "Text",ExpressionUUID->"12b71963-6683-409f-87c5-84a4abb0f8f6"],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"hess", "=", 
  RowBox[{"Outer", "[", 
   RowBox[{
    RowBox[{
     RowBox[{"D", "[", 
      RowBox[{"diagValue", ",", "#1", ",", "#2"}], "]"}], "&"}], ",", 
    RowBox[{"{", 
     RowBox[{"x1", ",", "x2"}], "}"}], ",", 
    RowBox[{"{", 
     RowBox[{"x1", ",", "x2"}], "}"}]}], 
   "]"}]}]], "Input",ExpressionUUID->"d41ccd97-2f91-4490-ad3a-a6e36fdcd49e"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{
     RowBox[{
      RowBox[{"-", 
       RowBox[{"Cos", "[", "x1", "]"}]}], "-", 
      RowBox[{"Cos", "[", 
       RowBox[{"x1", "+", "x2"}], "]"}]}], ",", 
     RowBox[{"-", 
      RowBox[{"Cos", "[", 
       RowBox[{"x1", "+", "x2"}], "]"}]}]}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"-", 
      RowBox[{"Cos", "[", 
       RowBox[{"x1", "+", "x2"}], "]"}]}], ",", 
     RowBox[{
      RowBox[{"-", 
       RowBox[{"Cos", "[", "x2", "]"}]}], "-", 
      RowBox[{"Cos", "[", 
       RowBox[{"x1", "+", "x2"}], "]"}]}]}], "}"}]}], 
  "}"}]], "Output",ExpressionUUID->"930d8983-f50e-4061-bfc9-2b4d36f5c19d"]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"dh", "=", 
  RowBox[{
  "Det", "[", "hess", 
   "]"}]}]], "Input",ExpressionUUID->"3f939435-6cdc-4615-a7c5-c9e22ebecabe"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"Cos", "[", "x1", "]"}], " ", 
   RowBox[{"Cos", "[", "x2", "]"}]}], "+", 
  RowBox[{
   RowBox[{"Cos", "[", "x1", "]"}], " ", 
   RowBox[{"Cos", "[", 
    RowBox[{"x1", "+", "x2"}], "]"}]}], "+", 
  RowBox[{
   RowBox[{"Cos", "[", "x2", "]"}], " ", 
   RowBox[{"Cos", "[", 
    RowBox[{"x1", "+", "x2"}], 
    "]"}]}]}]], \
"Output",ExpressionUUID->"bf762f93-d187-4159-9e59-79613358c2fe"]
}, Open  ]],

Cell[BoxData[
 RowBox[{"Block", "[", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{"limit", "=", 
     RowBox[{"Pi", " ", 
      RowBox[{"4", "/", "3"}]}]}], "}"}], ",", 
   RowBox[{"Show", "[", 
    RowBox[{
     RowBox[{"Plot3D", "[", 
      RowBox[{"diagValue", ",", 
       RowBox[{"{", 
        RowBox[{"x1", ",", 
         RowBox[{"-", "limit"}], ",", "limit"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"x2", ",", 
         RowBox[{"-", " ", "limit"}], ",", " ", "limit"}], "}"}], ",", 
       RowBox[{"RegionFunction", "\[Rule]", 
        RowBox[{"Function", "[", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"x1", ",", "x2"}], "}"}], ",", 
          RowBox[{"Block", "[", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{"x3", "=", 
              RowBox[{
               RowBox[{"-", "x1"}], "-", "x2"}]}], "}"}], ",", 
            RowBox[{
             RowBox[{
              RowBox[{"Abs", "[", 
               RowBox[{"x1", "-", "x2"}], "]"}], "<", 
              RowBox[{"2", " ", "Pi"}]}], "&&", 
             RowBox[{
              RowBox[{"Abs", "[", 
               RowBox[{"x1", "-", "x3"}], "]"}], "<", 
              RowBox[{"2", "Pi"}]}], "&&", 
             RowBox[{
              RowBox[{"Abs", "[", 
               RowBox[{"x2", "-", "x3"}], "]"}], "<", 
              RowBox[{"2", " ", "Pi"}]}]}]}], "]"}]}], "]"}]}]}], "]"}], ",", 
     
     RowBox[{"Graphics3D", "[", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"PointSize", "[", "0.02", "]"}], ",", 
        RowBox[{"Table", "[", 
         RowBox[{
          RowBox[{"Point", "[", 
           RowBox[{"{", 
            RowBox[{"x1", ",", "x2", ",", "diagValue"}], "}"}], "]"}], ",", 
          RowBox[{"{", 
           RowBox[{"x1", ",", 
            RowBox[{
             RowBox[{
              RowBox[{"-", "4"}], "/", "3"}], " ", "Pi"}], ",", 
            RowBox[{"2", " ", "Pi"}], ",", 
            RowBox[{"2", " ", "Pi"}]}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"x2", ",", 
            RowBox[{
             RowBox[{
              RowBox[{"-", "4"}], "/", "3"}], " ", "Pi"}], ",", 
            RowBox[{"2", " ", "Pi"}], ",", 
            RowBox[{"2", " ", "Pi"}]}], "}"}]}], "]"}], ",", 
        RowBox[{"Table", "[", 
         RowBox[{
          RowBox[{"Point", "[", 
           RowBox[{"{", 
            RowBox[{"x1", ",", "x2", ",", "diagValue"}], "}"}], "]"}], ",", 
          RowBox[{"{", 
           RowBox[{"x1", ",", 
            RowBox[{
             RowBox[{
              RowBox[{"-", "2"}], "/", "3"}], " ", "Pi"}], ",", 
            RowBox[{"2", " ", "Pi"}], ",", 
            RowBox[{"2", " ", "Pi"}]}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"x2", ",", 
            RowBox[{
             RowBox[{
              RowBox[{"-", "2"}], "/", "3"}], " ", "Pi"}], ",", 
            RowBox[{"2", " ", "Pi"}], ",", 
            RowBox[{"2", " ", "Pi"}]}], "}"}]}], "]"}], ",", 
        RowBox[{"Table", "[", 
         RowBox[{
          RowBox[{"Point", "[", 
           RowBox[{"{", 
            RowBox[{"x1", ",", "x2", ",", "diagValue"}], "}"}], "]"}], ",", 
          RowBox[{"{", 
           RowBox[{"x1", ",", 
            RowBox[{"-", "Pi"}], ",", "Pi", ",", "Pi"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"x2", ",", 
            RowBox[{"-", "Pi"}], ",", "Pi", ",", "Pi"}], "}"}]}], "]"}]}], 
       "}"}], "]"}]}], "]"}]}], 
  "]"}]], "Input",ExpressionUUID->"991dc36f-f44b-4be0-b199-d3e660b45d88"],

Cell[CellGroupData[{

Cell["Test saddle point routine", \
"Subsubsection",ExpressionUUID->"e2c1e1c9-09dd-481d-8e26-ac43fae8999b"],

Cell["Run this as a group", \
"Text",ExpressionUUID->"47fa80ba-e192-46b6-8daa-4cf1a9601052"],

Cell[CellGroupData[{

Cell[BoxData[{
 RowBox[{
  RowBox[{"sqrtU1", "=", 
   RowBox[{"SUPower", "[", 
    RowBox[{
     RowBox[{"u1", "=", 
      RowBox[{"randomSUMatrix", "[", "3", "]"}]}], ",", "0.5"}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{"phi1", "=", 
  RowBox[{
  "centerPhases", "[", "u1", 
   "]"}]}]}], "Input",ExpressionUUID->"ef4268d2-4f7a-46ee-a542-aa7852924906"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   RowBox[{"-", "0.42391752922662185`"}], ",", 
   RowBox[{"-", "2.2314878567767438`"}], ",", "2.6554053860033657`"}], 
  "}"}]], "Output",ExpressionUUID->"00f0aee0-152d-4e71-81f2-c900e5377b5f"]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"{", 
    RowBox[{"sqrtU2", ",", "maxShift"}], "}"}], "=", 
   RowBox[{"saddlePointStep", "[", 
    RowBox[{"sqrtU1", ",", "sqrtU1"}], "]"}]}], ";", 
  "maxShift"}]], \
"Input",ExpressionUUID->"fa4a126a-316b-47a5-aff1-c6f332f6ab2f"],

Cell[BoxData["1.461588118924735`"], \
"Output",ExpressionUUID->"b76d8ab5-a119-42c4-9e8f-730ca2ceddbe"]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"phi2", "=", 
  RowBox[{"centerPhases", "[", 
   RowBox[{"sqrtU2", ".", "sqrtU1"}], 
   "]"}]}]], "Input",ExpressionUUID->"f3858f74-1a5d-4a8b-9bd1-a26773e1dd62"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   RowBox[{"-", "0.17067307975431892`"}], ",", 
   RowBox[{"-", "3.006417470315977`"}], ",", "3.177090550070296`"}], 
  "}"}]], "Output",ExpressionUUID->"6b3ea9c7-def2-46cc-86b7-d4a0bda206a4"]
}, Open  ]],

Cell[BoxData[
 RowBox[{"Block", "[", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{"limit", "=", 
     RowBox[{"3", 
      RowBox[{"Pi", "/", "2"}]}]}], "}"}], ",", 
   RowBox[{"Show", "[", 
    RowBox[{
     RowBox[{"DensityPlot", "[", 
      RowBox[{"diagValue", ",", 
       RowBox[{"{", 
        RowBox[{"x1", ",", 
         RowBox[{"-", "limit"}], ",", "limit"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"x2", ",", 
         RowBox[{"-", "limit"}], ",", "limit"}], "}"}], ",", 
       RowBox[{"Epilog", "\[Rule]", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"Thickness", "[", "0.02", "]"}], ",", 
          RowBox[{"Line", "[", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"Take", "[", 
              RowBox[{"phi1", ",", "2"}], "]"}], ",", 
             RowBox[{"Take", "[", 
              RowBox[{"phi2", ",", "2"}], "]"}]}], "}"}], "]"}], ",", 
          RowBox[{"PointSize", "[", "0.02", "]"}], ",", 
          RowBox[{"Table", "[", 
           RowBox[{
            RowBox[{"Point", "[", 
             RowBox[{"{", 
              RowBox[{"y1", ",", "y2"}], "}"}], "]"}], ",", 
            RowBox[{"{", 
             RowBox[{"y1", ",", 
              RowBox[{
               RowBox[{
                RowBox[{"-", "4"}], "/", "3"}], " ", "Pi"}], ",", 
              RowBox[{"2", " ", "Pi"}], ",", 
              RowBox[{"2", " ", "Pi"}]}], "}"}], ",", 
            RowBox[{"{", 
             RowBox[{"y2", ",", 
              RowBox[{
               RowBox[{
                RowBox[{"-", "4"}], "/", "3"}], " ", "Pi"}], ",", 
              RowBox[{"2", " ", "Pi"}], ",", 
              RowBox[{"2", " ", "Pi"}]}], "}"}]}], "]"}], ",", 
          RowBox[{"Table", "[", 
           RowBox[{
            RowBox[{"Point", "[", 
             RowBox[{"{", 
              RowBox[{"y1", ",", "y2"}], "}"}], "]"}], ",", 
            RowBox[{"{", 
             RowBox[{"y1", ",", 
              RowBox[{
               RowBox[{
                RowBox[{"-", "2"}], "/", "3"}], " ", "Pi"}], ",", 
              RowBox[{"2", " ", "Pi"}], ",", 
              RowBox[{"2", " ", "Pi"}]}], "}"}], ",", 
            RowBox[{"{", 
             RowBox[{"y2", ",", 
              RowBox[{
               RowBox[{
                RowBox[{"-", "2"}], "/", "3"}], " ", "Pi"}], ",", 
              RowBox[{"2", " ", "Pi"}], ",", 
              RowBox[{"2", " ", "Pi"}]}], "}"}]}], "]"}], ",", 
          RowBox[{"Table", "[", 
           RowBox[{
            RowBox[{"Point", "[", 
             RowBox[{"{", 
              RowBox[{"y1", ",", "y2"}], "}"}], "]"}], ",", 
            RowBox[{"{", 
             RowBox[{"y1", ",", 
              RowBox[{"-", "Pi"}], ",", "Pi", ",", "Pi"}], "}"}], ",", 
            RowBox[{"{", 
             RowBox[{"y2", ",", 
              RowBox[{"-", "Pi"}], ",", "Pi", ",", "Pi"}], "}"}]}], "]"}]}], 
         "}"}]}]}], "]"}], ",", 
     RowBox[{"DensityPlot", "[", 
      RowBox[{"dh", ",", 
       RowBox[{"{", 
        RowBox[{"x1", ",", 
         RowBox[{"-", "limit"}], ",", "limit"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"x2", ",", 
         RowBox[{"-", "limit"}], ",", "limit"}], "}"}], ",", 
       RowBox[{"PlotRange", "\[Rule]", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"-", "0.1"}], ",", "0.1"}], "}"}]}]}], "]"}]}], "]"}]}], 
  "]"}]], "Input",ExpressionUUID->"09cffa08-559d-4f78-a2e7-00e20fe4e89e"]
}, Open  ]]
}, Closed]],

Cell[CellGroupData[{

Cell["Test nearest stationary point", \
"Subsection",ExpressionUUID->"9dede09f-9070-4bf1-8654-dea410dfb23d"],

Cell["\<\
Test stationary point routine against an explicit calculation for a random \
staple and starting matrix.  To compare,  remove the damping factors in the \
function saddlePointStep[] by setting zzz to a large number.  Don\
\[CloseCurlyQuote]t forget to set it back again, when you are done.\
\>", "Text",ExpressionUUID->"421a4773-ab78-4dd3-8766-dda06e8bb383"],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"makeRandomStaple", "[", 
    RowBox[{
     RowBox[{"nd_:", "nd"}], ",", 
     RowBox[{"nc_:", "nc"}]}], "]"}], ":=", 
   RowBox[{"Sum", "[", 
    RowBox[{
     RowBox[{"randomSUMatrix", "[", "nc", "]"}], ",", 
     RowBox[{"{", 
      RowBox[{"2", " ", "nd"}], "}"}]}], "]"}]}], ";", 
  RowBox[{"Clear", "[", "bb", "]"}], ";", 
  RowBox[{"bVector", "=", 
   RowBox[{
    RowBox[{"Table", "[", 
     RowBox[{
      RowBox[{"bb", "[", "i", "]"}], ",", 
      RowBox[{"{", 
       RowBox[{"i", ",", 
        RowBox[{
         RowBox[{"nc", "^", "2"}], "-", "1"}]}], "}"}]}], "]"}], ".", 
    RowBox[{
    "suGenerators", "[", "3", 
     "]"}]}]}]}]], \
"Input",ExpressionUUID->"60218984-2666-4eb2-96b6-c94d5847f6a1"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{
     RowBox[{
      FractionBox[
       RowBox[{"bb", "[", "7", "]"}], "2"], "+", 
      FractionBox[
       RowBox[{"bb", "[", "8", "]"}], 
       RowBox[{"2", " ", 
        SqrtBox["3"]}]]}], ",", 
     RowBox[{
      FractionBox[
       RowBox[{"bb", "[", "1", "]"}], "2"], "-", 
      RowBox[{
       FractionBox["1", "2"], " ", "\[ImaginaryI]", " ", 
       RowBox[{"bb", "[", "4", "]"}]}]}], ",", 
     RowBox[{
      FractionBox[
       RowBox[{"bb", "[", "2", "]"}], "2"], "-", 
      RowBox[{
       FractionBox["1", "2"], " ", "\[ImaginaryI]", " ", 
       RowBox[{"bb", "[", "5", "]"}]}]}]}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{
      FractionBox[
       RowBox[{"bb", "[", "1", "]"}], "2"], "+", 
      RowBox[{
       FractionBox["1", "2"], " ", "\[ImaginaryI]", " ", 
       RowBox[{"bb", "[", "4", "]"}]}]}], ",", 
     RowBox[{
      RowBox[{"-", 
       FractionBox[
        RowBox[{"bb", "[", "7", "]"}], "2"]}], "+", 
      FractionBox[
       RowBox[{"bb", "[", "8", "]"}], 
       RowBox[{"2", " ", 
        SqrtBox["3"]}]]}], ",", 
     RowBox[{
      FractionBox[
       RowBox[{"bb", "[", "3", "]"}], "2"], "-", 
      RowBox[{
       FractionBox["1", "2"], " ", "\[ImaginaryI]", " ", 
       RowBox[{"bb", "[", "6", "]"}]}]}]}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{
      FractionBox[
       RowBox[{"bb", "[", "2", "]"}], "2"], "+", 
      RowBox[{
       FractionBox["1", "2"], " ", "\[ImaginaryI]", " ", 
       RowBox[{"bb", "[", "5", "]"}]}]}], ",", 
     RowBox[{
      FractionBox[
       RowBox[{"bb", "[", "3", "]"}], "2"], "+", 
      RowBox[{
       FractionBox["1", "2"], " ", "\[ImaginaryI]", " ", 
       RowBox[{"bb", "[", "6", "]"}]}]}], ",", 
     RowBox[{"-", 
      FractionBox[
       RowBox[{"bb", "[", "8", "]"}], 
       SqrtBox["3"]]}]}], "}"}]}], 
  "}"}]], "Output",ExpressionUUID->"5e58b33e-a475-45b5-93ff-b8063bfef46a"]
}, Open  ]],

Cell[CellGroupData[{

Cell["Run test", \
"Subsubsection",ExpressionUUID->"eff30825-ec25-43b0-b47d-75d4387f0c39"],

Cell["Make random staple and starting link.", \
"Text",ExpressionUUID->"6cf4fdf9-e93d-4338-887a-b0ae44568a37"],

Cell[BoxData[
 RowBox[{
  RowBox[{"testStaple", "=", 
   RowBox[{"makeRandomStaple", "[", 
    RowBox[{"3", ",", "3"}], "]"}]}], ";", 
  RowBox[{"uu", "=", 
   RowBox[{"randomSUMatrix", "[", "3", "]"}]}], ";", 
  RowBox[{"sqrtU", "=", 
   RowBox[{"SUPower", "[", 
    RowBox[{"uu", ",", "0.5"}], "]"}]}], 
  ";"}]], "Input",ExpressionUUID->"e4128afb-ea9c-41cc-a3ef-5c248ca64d30"],

Cell["\<\
Explicitly find the second order expansion of the exponential.\
\>", "Text",ExpressionUUID->"9018acc2-f423-4644-8c9a-3b4b146f9e39"],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"expr", "=", 
  RowBox[{
   RowBox[{"Re", "[", 
    RowBox[{"Expand", "[", 
     RowBox[{"Tr", "[", 
      RowBox[{"testStaple", ".", "sqrtU", ".", 
       RowBox[{"Simplify", "[", 
        RowBox[{
         RowBox[{"IdentityMatrix", "[", "nc", "]"}], "+", 
         RowBox[{"I", " ", "bVector"}], "-", 
         RowBox[{
          RowBox[{"bVector", ".", "bVector"}], "/", 
          RowBox[{"2", "!"}]}]}], "]"}], ".", "sqrtU"}], "]"}], "]"}], "]"}], 
   "//.", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{
      RowBox[{"Re", "[", 
       RowBox[{"a_", "+", "b_"}], "]"}], "\[Rule]", 
      RowBox[{
       RowBox[{"Re", "[", "a", "]"}], "+", 
       RowBox[{"Re", "[", "b", "]"}]}]}], ",", 
     RowBox[{
      RowBox[{"Re", "[", 
       RowBox[{"a_", " ", 
        RowBox[{"bb", "[", "i_", "]"}]}], "]"}], "\[Rule]", 
      RowBox[{
       RowBox[{"Re", "[", "a", "]"}], " ", 
       RowBox[{"bb", "[", "i", "]"}]}]}], ",", 
     RowBox[{
      RowBox[{"Re", "[", 
       RowBox[{"a_", " ", 
        RowBox[{
         RowBox[{"bb", "[", "i_", "]"}], "^", "n_"}]}], "]"}], "\[Rule]", 
      RowBox[{
       RowBox[{"Re", "[", "a", "]"}], " ", 
       RowBox[{
        RowBox[{"bb", "[", "i", "]"}], "^", "n"}]}]}]}], 
    "}"}]}]}]], \
"Input",ExpressionUUID->"23e0daec-3f42-4399-9c8e-e27b7e2d63e1"],

Cell[BoxData[
 RowBox[{"0.06480721510015602`", "\[VeryThinSpace]", "-", 
  RowBox[{"0.12821903742340007`", " ", 
   RowBox[{"bb", "[", "1", "]"}]}], "-", 
  RowBox[{"0.017530096842705692`", " ", 
   SuperscriptBox[
    RowBox[{"bb", "[", "1", "]"}], "2"]}], "+", 
  RowBox[{"0.74032458994588`", " ", 
   RowBox[{"bb", "[", "2", "]"}]}], "+", 
  RowBox[{"0.044067467499046734`", " ", 
   RowBox[{"bb", "[", "1", "]"}], " ", 
   RowBox[{"bb", "[", "2", "]"}]}], "+", 
  RowBox[{"0.04415017909701744`", " ", 
   SuperscriptBox[
    RowBox[{"bb", "[", "2", "]"}], "2"]}], "+", 
  RowBox[{"0.18307710974403357`", " ", 
   RowBox[{"bb", "[", "3", "]"}]}], "+", 
  RowBox[{"0.0685215523956914`", " ", 
   RowBox[{"bb", "[", "1", "]"}], " ", 
   RowBox[{"bb", "[", "3", "]"}]}], "+", 
  RowBox[{"0.20636379875421682`", " ", 
   RowBox[{"bb", "[", "2", "]"}], " ", 
   RowBox[{"bb", "[", "3", "]"}]}], "-", 
  RowBox[{"0.04282188602935076`", " ", 
   SuperscriptBox[
    RowBox[{"bb", "[", "3", "]"}], "2"]}], "+", 
  RowBox[{"1.1955226336823765`", " ", 
   RowBox[{"bb", "[", "4", "]"}]}], "+", 
  RowBox[{"0.07577736042296279`", " ", 
   RowBox[{"bb", "[", "2", "]"}], " ", 
   RowBox[{"bb", "[", "4", "]"}]}], "+", 
  RowBox[{"0.04796607819258446`", " ", 
   RowBox[{"bb", "[", "3", "]"}], " ", 
   RowBox[{"bb", "[", "4", "]"}]}], "-", 
  RowBox[{"0.017530096842705692`", " ", 
   SuperscriptBox[
    RowBox[{"bb", "[", "4", "]"}], "2"]}], "+", 
  RowBox[{"0.7683469773000366`", " ", 
   RowBox[{"bb", "[", "5", "]"}]}], "-", 
  RowBox[{"0.07577736042296279`", " ", 
   RowBox[{"bb", "[", "1", "]"}], " ", 
   RowBox[{"bb", "[", "5", "]"}]}], "-", 
  RowBox[{"0.09139772558091842`", " ", 
   RowBox[{"bb", "[", "3", "]"}], " ", 
   RowBox[{"bb", "[", "5", "]"}]}], "+", 
  RowBox[{"0.044067467499046734`", " ", 
   RowBox[{"bb", "[", "4", "]"}], " ", 
   RowBox[{"bb", "[", "5", "]"}]}], "+", 
  RowBox[{"0.04415017909701744`", " ", 
   SuperscriptBox[
    RowBox[{"bb", "[", "5", "]"}], "2"]}], "-", 
  RowBox[{"0.9795360462471192`", " ", 
   RowBox[{"bb", "[", "6", "]"}]}], "+", 
  RowBox[{"0.04796607819258446`", " ", 
   RowBox[{"bb", "[", "1", "]"}], " ", 
   RowBox[{"bb", "[", "6", "]"}]}], "+", 
  RowBox[{"0.09139772558091842`", " ", 
   RowBox[{"bb", "[", "2", "]"}], " ", 
   RowBox[{"bb", "[", "6", "]"}]}], "-", 
  RowBox[{"0.0685215523956914`", " ", 
   RowBox[{"bb", "[", "4", "]"}], " ", 
   RowBox[{"bb", "[", "6", "]"}]}], "+", 
  RowBox[{"0.20636379875421682`", " ", 
   RowBox[{"bb", "[", "5", "]"}], " ", 
   RowBox[{"bb", "[", "6", "]"}]}], "-", 
  RowBox[{"0.04282188602935076`", " ", 
   SuperscriptBox[
    RowBox[{"bb", "[", "6", "]"}], "2"]}], "+", 
  RowBox[{"0.04009956035686858`", " ", 
   RowBox[{"bb", "[", "7", "]"}]}], "+", 
  RowBox[{"0.0685215523956914`", " ", 
   RowBox[{"bb", "[", "2", "]"}], " ", 
   RowBox[{"bb", "[", "7", "]"}]}], "-", 
  RowBox[{"0.044067467499046734`", " ", 
   RowBox[{"bb", "[", "3", "]"}], " ", 
   RowBox[{"bb", "[", "7", "]"}]}], "+", 
  RowBox[{"0.04796607819258446`", " ", 
   RowBox[{"bb", "[", "5", "]"}], " ", 
   RowBox[{"bb", "[", "7", "]"}]}], "+", 
  RowBox[{"0.07577736042296279`", " ", 
   RowBox[{"bb", "[", "6", "]"}], " ", 
   RowBox[{"bb", "[", "7", "]"}]}], "-", 
  RowBox[{"0.017530096842705692`", " ", 
   SuperscriptBox[
    RowBox[{"bb", "[", "7", "]"}], "2"]}], "+", 
  RowBox[{"1.4817108975112037`", " ", 
   RowBox[{"bb", "[", "8", "]"}]}], "+", 
  RowBox[{"0.23828838952348166`", " ", 
   RowBox[{"bb", "[", "1", "]"}], " ", 
   RowBox[{"bb", "[", "8", "]"}]}], "-", 
  RowBox[{"0.03956093672094349`", " ", 
   RowBox[{"bb", "[", "2", "]"}], " ", 
   RowBox[{"bb", "[", "8", "]"}]}], "-", 
  RowBox[{"0.02544236422307973`", " ", 
   RowBox[{"bb", "[", "3", "]"}], " ", 
   RowBox[{"bb", "[", "8", "]"}]}], "-", 
  RowBox[{"0.1055370029349256`", " ", 
   RowBox[{"bb", "[", "4", "]"}], " ", 
   RowBox[{"bb", "[", "8", "]"}]}], "-", 
  RowBox[{"0.027693228156459276`", " ", 
   RowBox[{"bb", "[", "5", "]"}], " ", 
   RowBox[{"bb", "[", "8", "]"}]}], "+", 
  RowBox[{"0.043750079438676856`", " ", 
   RowBox[{"bb", "[", "6", "]"}], " ", 
   RowBox[{"bb", "[", "8", "]"}]}], "+", 
  RowBox[{"0.10042669042537271`", " ", 
   RowBox[{"bb", "[", "7", "]"}], " ", 
   RowBox[{"bb", "[", "8", "]"}]}], "+", 
  RowBox[{"0.006728894326013007`", " ", 
   SuperscriptBox[
    RowBox[{"bb", "[", "8", "]"}], 
    "2"]}]}]], "Output",ExpressionUUID->"f1ab42a3-7020-47d9-be62-bdf84e006f0e"]
}, Open  ]],

Cell["Find the stationary point, based on this :", \
"Text",ExpressionUUID->"c826456f-d6d2-490c-9154-bca451db0758"],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"sp", "=", 
  RowBox[{
   RowBox[{"Solve", "[", 
    RowBox[{
     RowBox[{"Table", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"D", "[", 
         RowBox[{"expr", ",", 
          RowBox[{"bb", "[", "i", "]"}]}], "]"}], "\[Equal]", "0"}], ",", 
       RowBox[{"{", 
        RowBox[{"i", ",", 
         RowBox[{
          RowBox[{"nc", "^", "2"}], "-", "1"}]}], "}"}]}], "]"}], ",", 
     RowBox[{"Table", "[", 
      RowBox[{
       RowBox[{"bb", "[", "i", "]"}], ",", 
       RowBox[{"{", 
        RowBox[{"i", ",", 
         RowBox[{
          RowBox[{"nc", "^", "2"}], "-", "1"}]}], "}"}]}], "]"}]}], "]"}], 
   "[", 
   RowBox[{"[", "1", "]"}], 
   "]"}]}]], "Input",ExpressionUUID->"2b861771-d68a-46bb-8c40-c22b0977c952"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   RowBox[{
    RowBox[{"bb", "[", "1", "]"}], "\[Rule]", "3.8883859183148437`"}], ",", 
   RowBox[{
    RowBox[{"bb", "[", "2", "]"}], "\[Rule]", 
    RowBox[{"-", "5.249366003196768`"}]}], ",", 
   RowBox[{
    RowBox[{"bb", "[", "3", "]"}], "\[Rule]", 
    RowBox[{"-", "4.927835034690193`"}]}], ",", 
   RowBox[{
    RowBox[{"bb", "[", "4", "]"}], "\[Rule]", "23.175057943245008`"}], ",", 
   RowBox[{
    RowBox[{"bb", "[", "5", "]"}], "\[Rule]", "6.28661812583194`"}], ",", 
   RowBox[{
    RowBox[{"bb", "[", "6", "]"}], "\[Rule]", 
    RowBox[{"-", "11.723830992667104`"}]}], ",", 
   RowBox[{
    RowBox[{"bb", "[", "7", "]"}], "\[Rule]", "2.8457373793233165`"}], ",", 
   RowBox[{
    RowBox[{"bb", "[", "8", "]"}], "\[Rule]", "7.857140243064931`"}]}], 
  "}"}]], "Output",ExpressionUUID->"124e21a4-0930-4da0-a3fe-734ceaa46828"]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"v1", "=", 
  RowBox[{"sqrtU", ".", 
   RowBox[{"MatrixExp", "[", 
    RowBox[{
     RowBox[{"I", " ", "bVector"}], "/.", "sp"}], "]"}], ".", 
   "sqrtU"}]}]], \
"Input",ExpressionUUID->"e06328e9-73c7-4301-9885-a9f22773b87d"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{
     RowBox[{
      RowBox[{"-", "0.7476090097180903`"}], "-", 
      RowBox[{"0.22951155957908623`", " ", "\[ImaginaryI]"}]}], ",", 
     RowBox[{"0.335741264180556`", "\[VeryThinSpace]", "+", 
      RowBox[{"0.5054562066571192`", " ", "\[ImaginaryI]"}]}], ",", 
     RowBox[{
      RowBox[{"-", "0.12932578812907483`"}], "+", 
      RowBox[{"0.058922659571202074`", " ", "\[ImaginaryI]"}]}]}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{
      RowBox[{"-", "0.4933955814756885`"}], "-", 
      RowBox[{"0.24481846300884166`", " ", "\[ImaginaryI]"}]}], ",", 
     RowBox[{
      RowBox[{"-", "0.3668340714264703`"}], "-", 
      RowBox[{"0.6704165582206421`", " ", "\[ImaginaryI]"}]}], ",", 
     RowBox[{
      RowBox[{"-", "0.14886520486988583`"}], "+", 
      RowBox[{"0.3007295689378918`", " ", "\[ImaginaryI]"}]}]}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{
      RowBox[{"-", "0.28892965125124753`"}], "+", 
      RowBox[{"0.03936482676197267`", " ", "\[ImaginaryI]"}]}], ",", 
     RowBox[{
      RowBox[{"-", "0.10207975338637645`"}], "-", 
      RowBox[{"0.19325101068579753`", " ", "\[ImaginaryI]"}]}], ",", 
     RowBox[{"0.16228835165880864`", "\[VeryThinSpace]", "-", 
      RowBox[{"0.9169876382891939`", " ", "\[ImaginaryI]"}]}]}], "}"}]}], 
  "}"}]], "Output",ExpressionUUID->"80e0c613-8f89-4d14-a7c2-ef4d00cd2cb6"]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"centerPhases", "[", "v1", 
  "]"}]], "Input",ExpressionUUID->"6fb03293-0c2f-4e97-a01a-b5ea42a2d767"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   RowBox[{"-", "1.1796409843003421`"}], ",", 
   RowBox[{"-", "1.9120374739044288`"}], ",", "3.091678458204771`"}], 
  "}"}]], "Output",ExpressionUUID->"dcf1fac0-ba54-414f-a097-cdf935a82a85"]
}, Open  ]],

Cell["\<\
Now, compare this with the library routine (with damping factors removed) :\
\>", "Text",ExpressionUUID->"e5688f7e-90de-4241-b938-3a07f5b71438"],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{
  RowBox[{"{", 
   RowBox[{"u2", ",", "maxShift"}], "}"}], "=", 
  RowBox[{"saddlePointStep", "[", 
   RowBox[{
    RowBox[{"sqrtU", ".", "testStaple"}], ",", "sqrtU"}], 
   "]"}]}]], "Input",ExpressionUUID->"3205681f-17ca-474f-a3b7-f8de3638a1b7"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"0.13653527957725262`", "\[VeryThinSpace]", "+", 
        RowBox[{"0.09344271430127482`", " ", "\[ImaginaryI]"}]}], ",", 
       RowBox[{"0.18638498242262888`", "\[VeryThinSpace]", "-", 
        RowBox[{"0.47568146206556344`", " ", "\[ImaginaryI]"}]}], ",", 
       RowBox[{
        RowBox[{"-", "0.43382351553214704`"}], "-", 
        RowBox[{"0.7234718508142421`", " ", "\[ImaginaryI]"}]}]}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{
        RowBox[{"-", "0.13009828063605627`"}], "-", 
        RowBox[{"0.8588794300927556`", " ", "\[ImaginaryI]"}]}], ",", 
       RowBox[{"0.3312192016472867`", "\[VeryThinSpace]", "-", 
        RowBox[{"0.3374258739224083`", " ", "\[ImaginaryI]"}]}], ",", 
       RowBox[{"0.08635107604282788`", "\[VeryThinSpace]", "+", 
        RowBox[{"0.11992361599436807`", " ", "\[ImaginaryI]"}]}]}], "}"}], 
     ",", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"0.4609487847724426`", "\[VeryThinSpace]", "-", 
        RowBox[{"0.07452084494063346`", " ", "\[ImaginaryI]"}]}], ",", 
       RowBox[{
        RowBox[{"-", "0.5655193775672323`"}], "-", 
        RowBox[{"0.4422818542946204`", " ", "\[ImaginaryI]"}]}], ",", 
       RowBox[{"0.5095544846271818`", "\[VeryThinSpace]", "-", 
        RowBox[{"0.08307637233384942`", " ", "\[ImaginaryI]"}]}]}], "}"}]}], 
    "}"}], ",", "1.7152198809204242`"}], 
  "}"}]], "Output",ExpressionUUID->"6d17a551-1c02-44bb-acc2-584c0b966895"]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"v2", "=", 
  RowBox[{
  "u2", ".", 
   "sqrtU"}]}]], \
"Input",ExpressionUUID->"dd17c2cc-76f9-40e9-9421-294637f08ec3"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{
     RowBox[{
      RowBox[{"-", "0.19551866997240502`"}], "+", 
      RowBox[{"0.23457433474901726`", " ", "\[ImaginaryI]"}]}], ",", 
     RowBox[{"0.6609245706650578`", "\[VeryThinSpace]", "-", 
      RowBox[{"0.19763814325071666`", " ", "\[ImaginaryI]"}]}], ",", 
     RowBox[{
      RowBox[{"-", "0.3378406089868933`"}], "-", 
      RowBox[{"0.5627867538528791`", " ", "\[ImaginaryI]"}]}]}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"0.1850793871964294`", "\[VeryThinSpace]", "-", 
      RowBox[{"0.6892884244432391`", " ", "\[ImaginaryI]"}]}], ",", 
     RowBox[{"0.14448007317984154`", "\[VeryThinSpace]", "-", 
      RowBox[{"0.5656073243540151`", " ", "\[ImaginaryI]"}]}], ",", 
     RowBox[{"0.33902905551563495`", "\[VeryThinSpace]", "-", 
      RowBox[{"0.18681608862934684`", " ", "\[ImaginaryI]"}]}]}], "}"}], ",", 
   
   RowBox[{"{", 
    RowBox[{
     RowBox[{"0.5542781940117429`", "\[VeryThinSpace]", "+", 
      RowBox[{"0.3002500677367288`", " ", "\[ImaginaryI]"}]}], ",", 
     RowBox[{
      RowBox[{"-", "0.4279854774363637`"}], "-", 
      RowBox[{"0.012655845219736728`", " ", "\[ImaginaryI]"}]}], ",", 
     RowBox[{"0.11833457994329791`", "\[VeryThinSpace]", "-", 
      RowBox[{"0.6366245112640231`", " ", "\[ImaginaryI]"}]}]}], "}"}]}], 
  "}"}]], "Output",ExpressionUUID->"c15029bb-d429-4f25-b65e-1821559a1942"]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"centerPhases", "[", "v2", 
  "]"}]], "Input",ExpressionUUID->"babbff2a-0862-4183-90b6-926d61350f5f"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   RowBox[{"-", "0.7797693846319387`"}], ",", 
   RowBox[{"-", "1.5363557587051466`"}], ",", "2.3161251433370853`"}], 
  "}"}]], "Output",ExpressionUUID->"4c38d5e0-b7e0-4a17-812b-efbc05bb599b"]
}, Open  ]]
}, Open  ]]
}, Closed]],

Cell[CellGroupData[{

Cell["Junk", \
"Subsection",ExpressionUUID->"830a836a-e29d-44bd-b114-bab532fe3e60"],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{
  RowBox[{"s1", "=", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"0", ",", "1"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"1", ",", "0"}], "}"}]}], "}"}]}], ";", " ", 
  RowBox[{"s2", "=", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"0", ",", "I"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"-", "I"}], ",", "0"}], "}"}]}], "}"}]}], ";", " ", 
  RowBox[{"s3", "=", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"1", ",", "0"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"0", ",", 
       RowBox[{"-", "1"}]}], "}"}]}], "}"}]}], ";", 
  RowBox[{"f", "=", 
   RowBox[{"Simplify", "[", 
    RowBox[{
     RowBox[{
      RowBox[{"MatrixExp", "[", 
       RowBox[{"I", " ", "theta", " ", 
        RowBox[{"(", 
         RowBox[{
          RowBox[{"a1", " ", "s1"}], "+", 
          RowBox[{"a2", " ", "s2"}], "+", 
          RowBox[{"a3", " ", "s3"}]}], ")"}]}], "]"}], "/.", 
      RowBox[{
       RowBox[{
        RowBox[{"a1", "^", "2"}], "+", 
        RowBox[{"a2", "^", "2"}], "+", 
        RowBox[{"a3", "^", "2"}]}], "\[Rule]", "1"}]}], "/.", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{
        RowBox[{"Exp", "[", 
         RowBox[{"I", " ", "theta"}], "]"}], "\[Rule]", 
        RowBox[{
         RowBox[{"Cos", "[", "theta", "]"}], "+", 
         RowBox[{"I", " ", 
          RowBox[{"Sin", "[", "theta", "]"}]}]}]}], ",", 
       RowBox[{
        RowBox[{"Exp", "[", 
         RowBox[{
          RowBox[{"-", "I"}], " ", "theta"}], "]"}], "\[Rule]", 
        RowBox[{
         RowBox[{"Cos", "[", "theta", "]"}], "-", 
         RowBox[{"I", " ", 
          RowBox[{"Sin", "[", "theta", "]"}]}]}]}]}], "}"}]}], 
    "]"}]}]}]], \
"Input",ExpressionUUID->"00f5f4df-f14c-43d8-88c5-d862949ce502"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{
     RowBox[{
      RowBox[{"Cos", "[", "theta", "]"}], "+", 
      RowBox[{"\[ImaginaryI]", " ", "a3", " ", 
       RowBox[{"Sin", "[", "theta", "]"}]}]}], ",", 
     RowBox[{"\[ImaginaryI]", " ", 
      RowBox[{"(", 
       RowBox[{"a1", "+", 
        RowBox[{"\[ImaginaryI]", " ", "a2"}]}], ")"}], " ", 
      RowBox[{"Sin", "[", "theta", "]"}]}]}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{
      RowBox[{"(", 
       RowBox[{
        RowBox[{"\[ImaginaryI]", " ", "a1"}], "+", "a2"}], ")"}], " ", 
      RowBox[{"Sin", "[", "theta", "]"}]}], ",", 
     RowBox[{
      RowBox[{"Cos", "[", "theta", "]"}], "-", 
      RowBox[{"\[ImaginaryI]", " ", "a3", " ", 
       RowBox[{"Sin", "[", "theta", "]"}]}]}]}], "}"}]}], "}"}]], "Output",
 CellChangeTimes->{
  3.7640901297796173`*^9, {3.764090185432784*^9, 3.764090208688999*^9}, {
   3.764090390002452*^9, 3.764090413839761*^9}, {3.7640905106279488`*^9, 
   3.764090530963612*^9}, {3.764090590495772*^9, 
   3.76409063039958*^9}},ExpressionUUID->"7733d0cf-d618-48c6-95e1-\
ed20dd1f2e00"]
}, Open  ]],

Cell[BoxData[
 RowBox[{"<<", 
  "\"\<test-3-2-4.m\>\""}]], \
"Input",ExpressionUUID->"b31e1c13-01ce-4c66-82c6-5133d181c395"],

Cell[BoxData[
 RowBox[{"<<", 
  "\"\<test-3-3-5.m\>\""}]], \
"Input",ExpressionUUID->"a2ec32e7-ba2c-43dc-af29-c7f177e8dd73"],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{"beta", ",", "nc", ",", "nd", ",", "latticeDimensions", ",", 
   RowBox[{"Dimensions", "[", "gaugeField", "]"}]}], "}"}]], "Input",
 CellChangeTimes->{{3.766971654166103*^9, 3.766971666373981*^9}, {
  3.767019041979619*^9, 
  3.7670190717957973`*^9}},ExpressionUUID->"edff2e52-b925-4a63-94aa-\
e4f4b97d7412"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{"5.800000190734863`", ",", "3", ",", "3", ",", 
   RowBox[{"{", 
    RowBox[{"2", ",", "4", ",", "6"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"3", ",", "48", ",", "3", ",", "3"}], "}"}]}], 
  "}"}]], "Output",ExpressionUUID->"0d19c89c-89b4-4bc8-8da9-88cc70cab4f8"]
}, Open  ]]
}, Open  ]]
}, Open  ]]
},
WindowSize->{1145, 692},
WindowMargins->{{Automatic, 27}, {0, Automatic}},
PrivateNotebookOptions->{"FileOutlineCache"->False},
TrackCellChangeTimes->False,
FrontEndVersion->"11.2 for Linux x86 (64-bit) (September 10, 2017)",
StyleDefinitions->"Default.nb"
]

