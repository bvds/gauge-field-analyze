Notebook[{
Cell[BoxData[
 RowBox[{
  RowBox[{"SetDirectory", "[", 
   RowBox[{"NotebookDirectory", "[", "]"}], "]"}], ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.7673569687731447`*^9, 
  3.7673569687738857`*^9}},ExpressionUUID->"521048f1-0f5b-40c7-9fcc-\
57a33d77e506"],

Cell["\<\
Disable current notebook FileOutlineCache and CellChangeTimes.  See: \
https://stackoverflow.com/questions/2816628/version-control-of-mathematica-\
notebooks \
\>", "Text",ExpressionUUID->"35ca5f76-e844-4a00-a9bb-a561656c5ecf"],

Cell[CellGroupData[{

Cell["Library", \
"Title",ExpressionUUID->"f375741d-7d1c-47d0-bfe3-71618e4fe201"],

Cell["\<\
For parallelization, I had to go to menu Evaluation->Parallel Kernel \
Configuration and set the number manually.  Automatic launching of additional \
kernels is broken?  Note that the parallelization is based on the leading \
dimension of the table.
Verify parallel kernels are running:\
\>", "Text",ExpressionUUID->"88d0e5ea-1d3e-4d52-a580-cb9c96ec1520"],

Cell[BoxData[
 RowBox[{
  RowBox[{"<<", "\"\<mma-lib/groups.m\>\""}], ";", 
  RowBox[{"<<", "\"\<mma-lib/xml.m\>\""}], ";", 
  RowBox[{"Needs", "[", "\"\<ErrorBarPlots`\>\"", "]"}]}]], "Input",
 InitializationCell->
  True,ExpressionUUID->"b6e3936e-813f-4d67-89c4-91da0e5a71a9"],

Cell[BoxData[
 RowBox[{
  RowBox[{"<<", "\"\<mma-lib/lattice.m\>\""}], ";", 
  RowBox[{"<<", "\"\<mma-lib/linear-algebra.m\>\""}], ";", 
  RowBox[{"<<", "\"\<mma-lib/teper-results.m\>\""}], ";"}]], "Input",
 InitializationCell->
  True,ExpressionUUID->"64e681c2-1f5a-4f7f-8644-87139d41dc21"],

Cell["Lattice Saddle Point", \
"Text",ExpressionUUID->"a31d566d-47d5-4d92-ac0c-ff3905ce56b7"],

Cell[BoxData[
 RowBox[{
  RowBox[{"<<", "\"\<mma-lib/minres1.m\>\""}], ";", 
  RowBox[{"<<", "\"\<mma-lib/minresqlp0.m\>\""}], ";", 
  RowBox[{"<<", "\"\<mma-lib/minres.m\>\""}]}]], "Input",
 InitializationCell->
  True,ExpressionUUID->"13bc2c0e-f909-450a-b878-2d0e290395b5"],

Cell[BoxData[
 RowBox[{
  RowBox[{"<<", "\"\<mma-lib/saddle-point.m\>\""}], ";", 
  RowBox[{"<<", "\"\<mma-lib/saddle-point-single.m\>\""}]}]], "Input",
 InitializationCell->
  True,ExpressionUUID->"abff722b-7fa1-4fd9-b9dc-08080e9da613"]
}, Open  ]],

Cell[CellGroupData[{

Cell["Testing", \
"Title",ExpressionUUID->"7e0331a4-4eb2-41b3-94e5-86dcad678450"],

Cell[CellGroupData[{

Cell["matrixPower, SU(N)  generators", \
"Section",ExpressionUUID->"a915cf74-4c38-4d5c-b12e-f8ad7e845e5e"],

Cell[BoxData[
 RowBox[{"x", "=", 
  RowBox[{"centerSUMatrix", "[", 
   RowBox[{"1", ",", "7"}], 
   "]"}]}]], "Input",ExpressionUUID->"73ac614b-2c5d-40f5-be90-f396472d355b"],

Cell[BoxData[
 RowBox[{
  RowBox[{"x", "=", 
   RowBox[{"randomSUMatrix", "[", "7", "]"}]}], 
  ";"}]], "Input",ExpressionUUID->"fa216d9c-67db-4ba0-bdc4-b39dbdc320b7"],

Cell[BoxData[
 RowBox[{"x", "=", 
  RowBox[{"gaugeField", "[", 
   RowBox[{"[", 
    RowBox[{"3", ",", "15"}], "]"}], "]"}]}]], "Input",
 CellChangeTimes->{{3.766972462904788*^9, 3.766972464175539*^9}, {
  3.767356782678484*^9, 3.7673567833886337`*^9}, {3.767357017701527*^9, 
  3.767357038858267*^9}, {3.76735796456426*^9, 3.767357975954447*^9}, {
  3.7673907291441927`*^9, 
  3.7673907295357113`*^9}},ExpressionUUID->"1f64a583-69b2-42a8-9963-\
49ededbbcd90"],

Cell[BoxData[
 RowBox[{"SUMatrixQ", "[", "x", 
  "]"}]], "Input",ExpressionUUID->"34beec22-0d42-476b-af8f-7770315232a5"],

Cell["Take the root", \
"Text",ExpressionUUID->"f68269dd-a100-4778-9071-eed544479235"],

Cell[BoxData[
 RowBox[{
  RowBox[{"z", "=", 
   RowBox[{"SUPower", "[", 
    RowBox[{"x", ",", "0.2"}], "]"}]}], 
  ";"}]], "Input",ExpressionUUID->"0f55e86f-b06e-4721-8ecb-80d674dab003"],

Cell[BoxData[
 RowBox[{"SUMatrixQ", "[", "z", 
  "]"}]], "Input",ExpressionUUID->"519a82eb-219d-42d4-9d0e-1d7b01982e4b"],

Cell[BoxData[
 RowBox[{"Norm", "[", 
  RowBox[{
   RowBox[{
    RowBox[{"z", ".", "z", ".", "z", ".", "z", ".", "z"}], "-", 
    RowBox[{"SUPower", "[", 
     RowBox[{"x", ",", "1"}], "]"}]}], ",", "Infinity"}], 
  "]"}]], "Input",ExpressionUUID->"c728bb26-3493-42da-bcc3-8701efa55f4d"],

Cell[BoxData[
 RowBox[{"matrixEqual", "[", 
  RowBox[{
   RowBox[{"z", ".", "z", ".", "z", ".", "z", ".", "z"}], ",", "x"}], 
  "]"}]], "Input",ExpressionUUID->"ea8e2c02-53da-4841-83e3-be26d23b7dc0"],

Cell["Test normalization & orthogonality of the SU(N) generators", \
"Text",ExpressionUUID->"e86a9bf5-97ff-4d98-a7f3-4db728247d82"],

Cell[BoxData[
 RowBox[{"TableForm", "[", 
  RowBox[{"Block", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"x", "=", 
      RowBox[{"suGenerators", "[", "4", "]"}]}], "}"}], ",", 
    RowBox[{"Table", "[", 
     RowBox[{
      RowBox[{"Tr", "[", 
       RowBox[{
        RowBox[{"x", "[", 
         RowBox[{"[", "i", "]"}], "]"}], ".", 
        RowBox[{"x", "[", 
         RowBox[{"[", "j", "]"}], "]"}]}], "]"}], ",", 
      RowBox[{"{", 
       RowBox[{"i", ",", 
        RowBox[{"Length", "[", "x", "]"}]}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{"j", ",", 
        RowBox[{"Length", "[", "x", "]"}]}], "}"}]}], "]"}]}], "]"}], 
  "]"}]], "Input",ExpressionUUID->"72865217-4dc5-4f64-ac67-8a517bce3460"],

Cell["\<\
Test SUPower and SULog versus analogous Mathematica routines.  We see that \
they are often equal, but differ in cases where a different branch in the \
complex plane is chosen.\
\>", "Text",ExpressionUUID->"f366ac73-a1da-41d9-98bc-75493103f053"],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"Do", "[", 
  RowBox[{
   RowBox[{"Block", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"u", "=", 
        RowBox[{"randomSUMatrix", "[", "4", "]"}]}], ",", "ur"}], "}"}], ",", 
     
     RowBox[{
      RowBox[{"ur", "=", 
       RowBox[{"SUPower", "[", 
        RowBox[{"u", ",", "0.5", ",", 
         RowBox[{"\"\<debug\>\"", "\[Rule]", "True"}]}], "]"}]}], ";", 
      RowBox[{"matrixEqual", "[", 
       RowBox[{
        RowBox[{"ur", ".", "ur"}], ",", "u", ",", 
        RowBox[{"Tolerance", "\[Rule]", 
         RowBox[{"10", " ", "$MachineEpsilon"}]}], ",", 
        RowBox[{"\"\<prefix\>\"", "\[Rule]", "\"\<inverse:  \>\""}]}], "]"}], 
      ";", 
      RowBox[{"matrixEqual", "[", 
       RowBox[{
        RowBox[{"MatrixPower", "[", 
         RowBox[{"u", ",", "0.5"}], "]"}], ",", "ur", ",", 
        RowBox[{"Tolerance", "\[Rule]", 
         RowBox[{"10", " ", "$MachineEpsilon"}]}], ",", " ", 
        RowBox[{"\"\<prefix\>\"", "\[Rule]", "\"\<Mma\>\""}]}], "]"}]}]}], 
    "]"}], ",", "100"}], 
  "]"}]], "Input",ExpressionUUID->"63a94be4-0c55-48dc-a0f0-8980ea01b5a1"],

Cell[CellGroupData[{

Cell[BoxData[
 InterpretationBox[
  RowBox[{"\<\"Mma:  Matrices not equal, norm:  \"\>", "\[InvisibleSpace]", 
   "1.0031718914928034`"}],
  SequenceForm["Mma:  Matrices not equal, norm:  ", 1.0031718914928034`],
  Editable->
   False]], "Print",ExpressionUUID->"e9f8ec99-52cd-41d8-bfcf-8454682afd5b"],

Cell[BoxData[
 InterpretationBox[
  RowBox[{"\<\"Fixing phases \"\>", "\[InvisibleSpace]", 
   RowBox[{"{", 
    RowBox[{"2", ",", "1"}], "}"}]}],
  SequenceForm["Fixing phases ", {2, 1}],
  Editable->
   False]], "Print",ExpressionUUID->"d5f74d07-b053-4ad4-bba3-ecb0edf977a8"],

Cell[BoxData[
 InterpretationBox[
  RowBox[{"\<\"Fixing phases \"\>", "\[InvisibleSpace]", 
   RowBox[{"{", 
    RowBox[{"3", ",", "2"}], "}"}]}],
  SequenceForm["Fixing phases ", {3, 2}],
  Editable->
   False]], "Print",ExpressionUUID->"7278bb8e-3f7e-4318-8843-af931bb7f4f5"],

Cell[BoxData[
 InterpretationBox[
  RowBox[{"\<\"Mma:  Matrices not equal, norm:  \"\>", "\[InvisibleSpace]", 
   "0.8883957253383471`"}],
  SequenceForm["Mma:  Matrices not equal, norm:  ", 0.8883957253383471],
  Editable->
   False]], "Print",ExpressionUUID->"1f09a7bf-ef4b-4a11-93ed-0cb63e6cec24"],

Cell[BoxData[
 InterpretationBox[
  RowBox[{"\<\"Fixing phases \"\>", "\[InvisibleSpace]", 
   RowBox[{"{", 
    RowBox[{"2", ",", "1"}], "}"}]}],
  SequenceForm["Fixing phases ", {2, 1}],
  Editable->
   False]], "Print",ExpressionUUID->"e8dcae7a-e8a6-4473-8c75-e91fb1854ad2"],

Cell[BoxData[
 InterpretationBox[
  RowBox[{"\<\"Mma:  Matrices not equal, norm:  \"\>", "\[InvisibleSpace]", 
   "0.9656968952764244`"}],
  SequenceForm["Mma:  Matrices not equal, norm:  ", 0.9656968952764244],
  Editable->
   False]], "Print",ExpressionUUID->"8fa991d4-467c-492a-83ff-6655367ec7c8"],

Cell[BoxData[
 InterpretationBox[
  RowBox[{"\<\"Fixing phases \"\>", "\[InvisibleSpace]", 
   RowBox[{"{", 
    RowBox[{"2", ",", "1"}], "}"}]}],
  SequenceForm["Fixing phases ", {2, 1}],
  Editable->
   False]], "Print",ExpressionUUID->"26590319-676b-4b14-892e-8189470c7cd2"],

Cell[BoxData[
 InterpretationBox[
  RowBox[{"\<\"Fixing phases \"\>", "\[InvisibleSpace]", 
   RowBox[{"{", 
    RowBox[{"3", ",", "2"}], "}"}]}],
  SequenceForm["Fixing phases ", {3, 2}],
  Editable->
   False]], "Print",ExpressionUUID->"b30cd29b-54a4-4cbf-835b-30835c3a31ab"],

Cell[BoxData[
 InterpretationBox[
  RowBox[{"\<\"Mma:  Matrices not equal, norm:  \"\>", "\[InvisibleSpace]", 
   "1.6305184086699729`"}],
  SequenceForm["Mma:  Matrices not equal, norm:  ", 1.6305184086699729`],
  Editable->
   False]], "Print",ExpressionUUID->"101a57c4-f883-4d0e-831d-0bfc48f3c6e1"],

Cell[BoxData[
 InterpretationBox[
  RowBox[{"\<\"Fixing phases \"\>", "\[InvisibleSpace]", 
   RowBox[{"{", 
    RowBox[{"2", ",", "1"}], "}"}]}],
  SequenceForm["Fixing phases ", {2, 1}],
  Editable->
   False]], "Print",ExpressionUUID->"46d5009c-9d03-4975-8635-2945dd0de71b"],

Cell[BoxData[
 InterpretationBox[
  RowBox[{"\<\"Mma:  Matrices not equal, norm:  \"\>", "\[InvisibleSpace]", 
   "1.0311594915602602`"}],
  SequenceForm["Mma:  Matrices not equal, norm:  ", 1.0311594915602602`],
  Editable->
   False]], "Print",ExpressionUUID->"b419dfc1-5de1-40b2-883e-e8aa92ea27ff"]
}, Open  ]]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"Do", "[", 
  RowBox[{
   RowBox[{"Block", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"u", "=", 
        RowBox[{"randomSUMatrix", "[", "4", "]"}]}], ",", "ul"}], "}"}], ",", 
     
     RowBox[{
      RowBox[{"ul", "=", 
       RowBox[{"SULog", "[", 
        RowBox[{"u", ",", " ", 
         RowBox[{"\"\<debug\>\"", "\[Rule]", "True"}]}], "]"}]}], ";", 
      RowBox[{"matrixEqual", "[", 
       RowBox[{
        RowBox[{"MatrixExp", "[", "ul", "]"}], ",", "u", ",", 
        RowBox[{"Tolerance", "->", 
         RowBox[{"10", " ", "$MachineEpsilon"}]}], ",", " ", 
        RowBox[{"\"\<prefix\>\"", "\[Rule]", "\"\<inverse\>\""}]}], "]"}], 
      ";", 
      RowBox[{"matrixEqual", "[", 
       RowBox[{
        RowBox[{"MatrixLog", "[", "u", "]"}], ",", "ul", ",", 
        RowBox[{"Tolerance", "->", 
         RowBox[{"10", " ", "$MachineEpsilon"}]}], ",", " ", 
        RowBox[{"\"\<prefix\>\"", "\[Rule]", "\"\<mma\>\""}]}], "]"}]}]}], 
    "]"}], ",", "100"}], 
  "]"}]], "Input",ExpressionUUID->"085fb5fe-3c68-48f9-9b35-1573ef32edb2"],

Cell[CellGroupData[{

Cell[BoxData[
 InterpretationBox[
  RowBox[{"\<\"Fixing phases \"\>", "\[InvisibleSpace]", 
   RowBox[{"{", 
    RowBox[{"3", ",", "1"}], "}"}]}],
  SequenceForm["Fixing phases ", {3, 1}],
  Editable->
   False]], "Print",ExpressionUUID->"41bcc44a-f1c0-4f72-adfe-497097a5d882"],

Cell[BoxData[
 InterpretationBox[
  RowBox[{"\<\"mma:  Matrices not equal, norm:  \"\>", "\[InvisibleSpace]", 
   "2.21586617794657`"}],
  SequenceForm["mma:  Matrices not equal, norm:  ", 2.21586617794657],
  Editable->
   False]], "Print",ExpressionUUID->"b3bfd5f2-5b3f-4461-8a3d-425175aafab5"],

Cell[BoxData[
 InterpretationBox[
  RowBox[{"\<\"Fixing phases \"\>", "\[InvisibleSpace]", 
   RowBox[{"{", 
    RowBox[{"1", ",", "2"}], "}"}]}],
  SequenceForm["Fixing phases ", {1, 2}],
  Editable->
   False]], "Print",ExpressionUUID->"d127a5ab-0d94-48f2-a6d0-d78009feadb4"],

Cell[BoxData[
 InterpretationBox[
  RowBox[{"\<\"mma:  Matrices not equal, norm:  \"\>", "\[InvisibleSpace]", 
   "2.421328324848446`"}],
  SequenceForm["mma:  Matrices not equal, norm:  ", 2.421328324848446],
  Editable->
   False]], "Print",ExpressionUUID->"4d6cd030-3525-4b35-b12c-321235124771"],

Cell[BoxData[
 InterpretationBox[
  RowBox[{"\<\"Fixing phases \"\>", "\[InvisibleSpace]", 
   RowBox[{"{", 
    RowBox[{"1", ",", "3"}], "}"}]}],
  SequenceForm["Fixing phases ", {1, 3}],
  Editable->
   False]], "Print",ExpressionUUID->"882e81ca-96e1-4992-b160-ed1750d3469c"],

Cell[BoxData[
 InterpretationBox[
  RowBox[{"\<\"Fixing phases \"\>", "\[InvisibleSpace]", 
   RowBox[{"{", 
    RowBox[{"3", ",", "4"}], "}"}]}],
  SequenceForm["Fixing phases ", {3, 4}],
  Editable->
   False]], "Print",ExpressionUUID->"dcdb17e1-5987-4672-895b-9ad3daec8bf0"],

Cell[BoxData[
 InterpretationBox[
  RowBox[{"\<\"mma:  Matrices not equal, norm:  \"\>", "\[InvisibleSpace]", 
   "2.8281183205416722`"}],
  SequenceForm["mma:  Matrices not equal, norm:  ", 2.8281183205416722`],
  Editable->
   False]], "Print",ExpressionUUID->"fc4fc1b6-7afb-4737-ad0c-1f7780daa0d2"],

Cell[BoxData[
 InterpretationBox[
  RowBox[{"\<\"Fixing phases \"\>", "\[InvisibleSpace]", 
   RowBox[{"{", 
    RowBox[{"3", ",", "1"}], "}"}]}],
  SequenceForm["Fixing phases ", {3, 1}],
  Editable->
   False]], "Print",ExpressionUUID->"db0f5604-7b62-4861-97c0-99b7f857ac5e"],

Cell[BoxData[
 InterpretationBox[
  RowBox[{"\<\"mma:  Matrices not equal, norm:  \"\>", "\[InvisibleSpace]", 
   "3.1553181148134914`"}],
  SequenceForm["mma:  Matrices not equal, norm:  ", 3.1553181148134914`],
  Editable->
   False]], "Print",ExpressionUUID->"9e890899-c5fc-46f6-931e-bd9f17124cc0"],

Cell[BoxData[
 InterpretationBox[
  RowBox[{"\<\"Fixing phases \"\>", "\[InvisibleSpace]", 
   RowBox[{"{", 
    RowBox[{"1", ",", "2"}], "}"}]}],
  SequenceForm["Fixing phases ", {1, 2}],
  Editable->
   False]], "Print",ExpressionUUID->"e8965a7c-0f12-4d9c-adce-f705c573eba6"],

Cell[BoxData[
 InterpretationBox[
  RowBox[{"\<\"Fixing phases \"\>", "\[InvisibleSpace]", 
   RowBox[{"{", 
    RowBox[{"2", ",", "4"}], "}"}]}],
  SequenceForm["Fixing phases ", {2, 4}],
  Editable->
   False]], "Print",ExpressionUUID->"ed4b02b2-57e6-4939-903e-7309914a413c"],

Cell[BoxData[
 InterpretationBox[
  RowBox[{"\<\"mma:  Matrices not equal, norm:  \"\>", "\[InvisibleSpace]", 
   "4.199952579559469`"}],
  SequenceForm["mma:  Matrices not equal, norm:  ", 4.199952579559469],
  Editable->
   False]], "Print",ExpressionUUID->"76b18783-4dd7-4b65-8466-7c5d3fffe81b"],

Cell[BoxData[
 InterpretationBox[
  RowBox[{"\<\"Fixing phases \"\>", "\[InvisibleSpace]", 
   RowBox[{"{", 
    RowBox[{"2", ",", "1"}], "}"}]}],
  SequenceForm["Fixing phases ", {2, 1}],
  Editable->
   False]], "Print",ExpressionUUID->"6d1ecca6-f2e0-4624-96d9-d23e94234174"],

Cell[BoxData[
 InterpretationBox[
  RowBox[{"\<\"Fixing phases \"\>", "\[InvisibleSpace]", 
   RowBox[{"{", 
    RowBox[{"3", ",", "2"}], "}"}]}],
  SequenceForm["Fixing phases ", {3, 2}],
  Editable->
   False]], "Print",ExpressionUUID->"aa99ded3-9573-408b-bfc0-8f45985ac497"],

Cell[BoxData[
 InterpretationBox[
  RowBox[{"\<\"mma:  Matrices not equal, norm:  \"\>", "\[InvisibleSpace]", 
   "4.219378446557668`"}],
  SequenceForm["mma:  Matrices not equal, norm:  ", 4.219378446557668],
  Editable->
   False]], "Print",ExpressionUUID->"2a07b2be-230c-4c0b-8453-71a120b37455"],

Cell[BoxData[
 InterpretationBox[
  RowBox[{"\<\"Fixing phases \"\>", "\[InvisibleSpace]", 
   RowBox[{"{", 
    RowBox[{"1", ",", "2"}], "}"}]}],
  SequenceForm["Fixing phases ", {1, 2}],
  Editable->
   False]], "Print",ExpressionUUID->"17041c6d-d4a6-4ead-893d-292508f61abb"],

Cell[BoxData[
 InterpretationBox[
  RowBox[{"\<\"mma:  Matrices not equal, norm:  \"\>", "\[InvisibleSpace]", 
   "2.9963981655321`"}],
  SequenceForm["mma:  Matrices not equal, norm:  ", 2.9963981655321],
  Editable->
   False]], "Print",ExpressionUUID->"968f039a-f014-4fb0-98de-5c60cf2da113"],

Cell[BoxData[
 InterpretationBox[
  RowBox[{"\<\"Fixing phases \"\>", "\[InvisibleSpace]", 
   RowBox[{"{", 
    RowBox[{"2", ",", "1"}], "}"}]}],
  SequenceForm["Fixing phases ", {2, 1}],
  Editable->
   False]], "Print",ExpressionUUID->"49e05b10-0673-4556-b00c-b15367303fc3"],

Cell[BoxData[
 InterpretationBox[
  RowBox[{"\<\"mma:  Matrices not equal, norm:  \"\>", "\[InvisibleSpace]", 
   "3.845436076439081`"}],
  SequenceForm["mma:  Matrices not equal, norm:  ", 3.845436076439081],
  Editable->
   False]], "Print",ExpressionUUID->"765f42db-fafa-4c2b-8f19-c4dcce467c1e"]
}, Open  ]]
}, Open  ]],

Cell["Verify formula used in composeDeltaLink[]", \
"Text",ExpressionUUID->"c984a395-5877-48d1-ad20-0ca2a447dfc9"],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"Block", "[", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{
     RowBox[{"nc", "=", "6"}], ",", "w", ",", "u"}], "}"}], ",", 
   RowBox[{
    RowBox[{"u", "=", 
     RowBox[{"randomSUMatrix", "[", "]"}]}], ";", 
    RowBox[{"Print", "[", 
     RowBox[{"Chop", "[", 
      RowBox[{"Tr", "[", 
       RowBox[{"w", "=", 
        RowBox[{"SULog", "[", "u", "]"}]}], "]"}], "]"}], "]"}], ";", 
    RowBox[{"Chop", "[", 
     RowBox[{
      RowBox[{"MatrixExp", "[", 
       RowBox[{"I", 
        RowBox[{
         RowBox[{"(", 
          RowBox[{"2", " ", "*", 
           RowBox[{"Im", "[", 
            RowBox[{"Map", "[", 
             RowBox[{"Tr", ",", 
              RowBox[{
               RowBox[{"suGenerators", "[", "]"}], ".", "w"}]}], "]"}], 
            "]"}]}], ")"}], ".", 
         RowBox[{"suGenerators", "[", "]"}]}]}], "]"}], "-", "u"}], "]"}]}]}],
   "]"}]], "Input",ExpressionUUID->"2c002739-06e6-4e66-8511-b9f888d1600b"],

Cell[BoxData["0"], \
"Print",ExpressionUUID->"c2617fef-58e7-4ffd-ac8e-299000b6f639"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{"0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0"}], "}"}], 
   ",", 
   RowBox[{"{", 
    RowBox[{"0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0"}], "}"}], 
   ",", 
   RowBox[{"{", 
    RowBox[{"0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0"}], "}"}], 
   ",", 
   RowBox[{"{", 
    RowBox[{"0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0"}], "}"}], 
   ",", 
   RowBox[{"{", 
    RowBox[{"0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0"}], "}"}], 
   ",", 
   RowBox[{"{", 
    RowBox[{"0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0"}], "}"}]}], 
  "}"}]], "Output",ExpressionUUID->"53826861-890e-4fc3-abc6-ad9685b3a63e"]
}, Open  ]]
}, Closed]],

Cell[CellGroupData[{

Cell["Compare Mathematica mean plaquette against chroma value", \
"Section",ExpressionUUID->"abbb4ee1-c58a-48b8-8869-b9b2684ecef8"],

Cell["Compare with chroma output xml file.", \
"Text",ExpressionUUID->"2e5d09b1-cf60-47a2-a3eb-1904ca74a7ee"],

Cell["These should match plane_ij_plaq.", \
"Text",ExpressionUUID->"2724db57-2251-429a-8d81-1befbd209daf"],

Cell[BoxData[
 RowBox[{"InputForm", "[", 
  RowBox[{"Table", "[", 
   RowBox[{
    RowBox[{"If", "[", 
     RowBox[{
      RowBox[{"dir1", "<", "dir2"}], ",", 
      RowBox[{"Mean", "[", 
       RowBox[{"Table", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"plaquette", "[", 
           RowBox[{"dir1", ",", "dir2", ",", 
            RowBox[{"latticeCoordinates", "[", "i", "]"}]}], "]"}], "/", 
          "nc"}], ",", 
         RowBox[{"{", 
          RowBox[{"i", ",", 
           RowBox[{"latticeVolume", "[", "]"}]}], "}"}]}], "]"}], "]"}]}], 
     "]"}], ",", 
    RowBox[{"{", 
     RowBox[{"dir1", ",", "2"}], "}"}], ",", 
    RowBox[{"{", 
     RowBox[{"dir2", ",", 
      RowBox[{"dir1", "+", "1"}], ",", "3"}], "}"}]}], "]"}], 
  "]"}]], "Input",ExpressionUUID->"a8a9551f-5f15-4660-b650-fb1bf6b44171"],

Cell["This should match w_plaq", \
"Text",ExpressionUUID->"dbfc2abc-9dff-46d2-a9da-3541d7be0284"],

Cell[BoxData[
 RowBox[{"InputForm", "[", 
  RowBox[{"Mean", "[", 
   RowBox[{"Flatten", "[", "%", "]"}], "]"}], 
  "]"}]], "Input",ExpressionUUID->"219efdc6-9b19-4c09-b592-1fc878c6cd85"]
}, Closed]],

Cell[CellGroupData[{

Cell[TextData[{
 "Compare the mean plaquette against ",
 StyleBox["Teper\[CloseCurlyQuote]s",
  IgnoreSpellCheck->True],
 " results"
}], "Section",ExpressionUUID->"749b0427-f3f6-4123-953f-4dea85c49fc8"],

Cell["\"w_plaq\" is average of all plaquettes.", \
"Text",ExpressionUUID->"de356692-0883-4856-b03d-bdef43d93be1"],

Cell[BoxData[
 RowBox[{
  RowBox[{"expr", "=", 
   RowBox[{
   "Import", "[", "\"\<../data/3-4/periodic-16-28-out.xml\>\"", "]"}]}], 
  ";"}]], "Input",ExpressionUUID->"06e604df-e83f-4d14-9b1e-9a99bca1fa9e"],

Cell[BoxData[
 RowBox[{
  RowBox[{"expr", "=", 
   RowBox[{
   "Import", "[", "\"\<../data/3-4/periodic-16-33-out.xml\>\"", "]"}]}], 
  ";"}]], "Input",ExpressionUUID->"9ccd0e9f-b9cf-4b27-98de-1d9bfe31a58e"],

Cell[BoxData[
 RowBox[{
  RowBox[{"expr", "=", 
   RowBox[{
   "Import", "[", "\"\<../data/3-3/periodic-24-21-out.xml\>\"", "]"}]}], 
  ";"}]], "Input",ExpressionUUID->"3d4c948f-280e-4e8a-ad52-cb436a6edc5a"],

Cell["\<\
Pull out the average plaquette from the production lattice updates.\
\>", "Text",ExpressionUUID->"ce371329-b52e-4926-a1d1-933645646210"],

Cell[BoxData[
 RowBox[{"Length", "[", 
  RowBox[{"wp", "=", 
   RowBox[{"Flatten", "[", 
    RowBox[{"xmlFilter", "[", 
     RowBox[{
      RowBox[{"expr", "[", 
       RowBox[{"[", "2", "]"}], "]"}], ",", 
      RowBox[{"{", 
       RowBox[{
       "\"\<purgaug\>\"", ",", "\"\<doHB\>\"", ",", "\"\<MCUpdates\>\"", ",", 
        "\"\<elem\>\"", ",", "\"\<Update\>\"", ",", 
        "\"\<InlineObservables\>\"", ",", "\"\<elem\>\"", ",", 
        "\"\<Plaquette\>\"", ",", "\"\<w_plaq\>\""}], "}"}]}], "]"}], "]"}]}],
   "]"}]], "Input",ExpressionUUID->"6ea2e23f-d3e5-45b6-abb7-923d3f49d955"],

Cell["\<\
Mean and standard error, ignoring autocorrelations.  
For SU(4), 2+1 dimensions, L=16^3 lattice, beta=28 abd 33, the average \
plaquette values match Teper\[CloseCurlyQuote]s result.  See \
arXiv:hep-lat/0206027v1 24 Jun 2002.\
\>", "Text",ExpressionUUID->"befeff86-5379-41fd-b0a4-145970b5e663"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   RowBox[{"Mean", "[", "wp", "]"}], ",", 
   RowBox[{
    RowBox[{"StandardDeviation", "[", "wp", "]"}], "/", 
    RowBox[{"Sqrt", "[", 
     RowBox[{"Length", "[", "wp", "]"}], "]"}]}]}], 
  "}"}]], "Input",ExpressionUUID->"020c970c-7646-4b66-ab85-5211c6c4ada0"],

Cell["\<\
What is the effect of autocorrelations on the error estimate?  Using \
https://en.wikipedia.org/wiki/Unbiased_estimation_of_standard_deviation
Find a model for the autocorrelation function (ACF), fitting to an \
exponential:\
\>", "Text",ExpressionUUID->"b1734467-1350-4edb-a297-06f9bb6a53fa"],

Cell[BoxData[
 RowBox[{
  RowBox[{"data", "=", 
   RowBox[{"Block", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"cutoff", "=", "20"}], "}"}], ",", 
     RowBox[{"Transpose", "[", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"Table", "[", 
         RowBox[{"k", ",", 
          RowBox[{"{", 
           RowBox[{"k", ",", "0", ",", "cutoff"}], "}"}]}], "]"}], ",", 
        RowBox[{"Log", "[", 
         RowBox[{"CorrelationFunction", "[", 
          RowBox[{"wp", ",", 
           RowBox[{"{", "cutoff", "}"}]}], "]"}], "]"}]}], "}"}], "]"}]}], 
    "]"}]}], ";"}]], \
"Input",ExpressionUUID->"77b987bd-85ca-4981-9188-bd9e60cea850"],

Cell[BoxData[
 RowBox[{"ff", "=", 
  RowBox[{"Fit", "[", 
   RowBox[{
    RowBox[{"Take", "[", 
     RowBox[{"data", ",", "5"}], "]"}], ",", 
    RowBox[{"{", "x", "}"}], ",", "x"}], 
   "]"}]}]], "Input",ExpressionUUID->"95b5d40b-9031-43ed-99ee-b5d5d575e05b"],

Cell[BoxData[
 RowBox[{"Show", "[", 
  RowBox[{
   RowBox[{"ListPlot", "[", 
    RowBox[{"data", ",", 
     RowBox[{"PlotRange", "\[Rule]", "All"}]}], "]"}], ",", 
   RowBox[{"Plot", "[", 
    RowBox[{"ff", ",", 
     RowBox[{"{", 
      RowBox[{"x", ",", "0", ",", "20"}], "}"}]}], "]"}]}], 
  "]"}]], "Input",ExpressionUUID->"0ba7ecda-95f9-48fb-bfd5-6e404ed0e15c"],

Cell["\<\
From the Wikipedia article, the correction to the standard error is \
Sqrt[gamma2/gamma1], where :\
\>", "Text",ExpressionUUID->"2b8d6915-0d04-46fa-bc2a-4b1a6c114940"],

Cell[BoxData[
 RowBox[{
  RowBox[{"gamma1", "[", "n_", "]"}], ":=", 
  RowBox[{"1", "-", 
   RowBox[{
    RowBox[{"2", "/", 
     RowBox[{"(", 
      RowBox[{"n", "-", "1"}], ")"}]}], " ", 
    RowBox[{"Sum", "[", 
     RowBox[{
      RowBox[{
       RowBox[{"(", 
        RowBox[{"1", "-", 
         RowBox[{"x", "/", "n"}]}], ")"}], " ", 
       RowBox[{"Exp", "[", "ff", "]"}]}], ",", 
      RowBox[{"{", 
       RowBox[{"x", ",", "1", ",", 
        RowBox[{"n", "-", "1"}]}], "}"}]}], 
     "]"}]}]}]}]], \
"Input",ExpressionUUID->"02ad3d91-94f2-4d06-8edd-5adb96e7fdd7"],

Cell[BoxData[
 RowBox[{
  RowBox[{"gamma2", "[", "n_", "]"}], ":=", 
  RowBox[{"1", "+", 
   RowBox[{"2", " ", 
    RowBox[{"Sum", "[", 
     RowBox[{
      RowBox[{
       RowBox[{"(", 
        RowBox[{"1", "-", 
         RowBox[{"x", "/", "n"}]}], ")"}], " ", 
       RowBox[{"Exp", "[", "ff", "]"}]}], ",", 
      RowBox[{"{", 
       RowBox[{"x", ",", "1", ",", 
        RowBox[{"n", "-", "1"}]}], "}"}]}], 
     "]"}]}]}]}]], \
"Input",ExpressionUUID->"77d31ad2-afff-407c-a5f7-4b1c0e8a084f"],

Cell["Since n is large, look at leading order in n :", \
"Text",ExpressionUUID->"d0c378ca-7938-4740-a816-02f68eca733f"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   RowBox[{"gamma1", "[", "Infinity", "]"}], ",", 
   RowBox[{"gamma2", "[", "Infinity", "]"}]}], 
  "}"}]], "Input",ExpressionUUID->"ee283eb1-8124-4674-94ff-56b4647659d6"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"2", "/", 
    RowBox[{"(", 
     RowBox[{"1", "-", 
      RowBox[{"Exp", "[", "ff", "]"}]}], ")"}]}], "-", "1"}], "/.", 
  RowBox[{
  "x", "\[Rule]", 
   "1"}]}]], "Input",ExpressionUUID->"cc76ed0f-7235-4dc5-8b40-ef8d841b3614"],

Cell["\<\
There is a modest impact on the standard error, with the error estimate now \
matching Teper\[CloseCurlyQuote]s error estimate.  Good agreement for both \
SU(3) and SU(4).\
\>", "Text",ExpressionUUID->"fa4c2483-8f54-4eeb-a742-321251006d2e"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   RowBox[{"Mean", "[", "wp", "]"}], ",", 
   RowBox[{
    RowBox[{"StandardDeviation", "[", "wp", "]"}], " ", 
    RowBox[{"Sqrt", "[", 
     RowBox[{
      RowBox[{"gamma2", "[", "Infinity", "]"}], "/", 
      RowBox[{"Length", "[", "wp", "]"}]}], "]"}]}]}], 
  "}"}]], "Input",ExpressionUUID->"b8586d19-45df-4201-b15d-530856de76b9"]
}, Closed]],

Cell[CellGroupData[{

Cell["Polyakov loop", \
"Section",ExpressionUUID->"bfca384e-3450-4f6f-945c-733e2d635e7c"],

Cell["Test with trivial lattice.", \
"Text",ExpressionUUID->"ecf945c3-b3b4-4dc2-9382-4d28baf0ea32"],

Cell[BoxData[
 RowBox[{
  RowBox[{"nc", "=", "3"}], ";", 
  RowBox[{"nd", "=", "3"}], ";", 
  RowBox[{"latticeDimensions", "=", 
   RowBox[{"{", 
    RowBox[{"4", ",", "6", ",", "8"}], "}"}]}], ";", 
  RowBox[{
  "makeTrivialLattice", "[", 
   "]"}]}]], "Input",ExpressionUUID->"ba8cc77a-2929-4864-a0e7-43036a36fb2a"],

Cell["\<\
Lattice with constant link in one direction.  Smeared Polyakov loop should \
give the same result as the simple Polyakov loop.\
\>", "Text",ExpressionUUID->"4d7d87eb-fbe5-455b-a634-c45a0c778336"],

Cell[BoxData[
 RowBox[{
  RowBox[{"gaugeField", "=", 
   RowBox[{"Block", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"uu", "=", 
       RowBox[{"randomSUMatrix", "[", "]"}]}], "}"}], ",", 
     RowBox[{
      RowBox[{"Print", "[", 
       RowBox[{"\"\<Trace:  \>\"", ",", 
        RowBox[{"Tr", "[", "uu", "]"}]}], "]"}], ";", 
      RowBox[{"uu", "=", 
       RowBox[{"SUPower", "[", 
        RowBox[{"uu", ",", 
         RowBox[{"1", "/", 
          RowBox[{"latticeDimensions", "[", 
           RowBox[{"[", "1", "]"}], "]"}]}]}], "]"}]}], ";", 
      RowBox[{"Table", "[", 
       RowBox[{
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{"dir", "\[Equal]", "1"}], ",", "uu", ",", 
          RowBox[{"IdentityMatrix", "[", "nc", "]"}]}], "]"}], ",", 
        RowBox[{"{", 
         RowBox[{"dir", ",", "nd"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"latticeVolume", "[", "]"}], "}"}]}], "]"}]}]}], "]"}]}], 
  ";"}]], "Input",ExpressionUUID->"e48c5c7a-87c4-42d1-9e53-ca586dc49059"],

Cell[BoxData[
 RowBox[{"polyakovLoop", "[", 
  RowBox[{"1", ",", 
   RowBox[{"{", 
    RowBox[{"1", ",", "1", ",", "3"}], "}"}]}], 
  "]"}]], "Input",ExpressionUUID->"bff5b33d-e607-4469-a49b-f92256a07bfe"],

Cell[BoxData[
 RowBox[{"polyakovLoop", "[", 
  RowBox[{"1", ",", 
   RowBox[{"{", 
    RowBox[{"1", ",", "1", ",", "3"}], "}"}], ",", 
   RowBox[{"{", "2", "}"}], ",", 
   RowBox[{"{", "1", "}"}]}], 
  "]"}]], "Input",ExpressionUUID->"1567bf2b-c412-4ae4-ab8a-23bb535f8cce"],

Cell[BoxData[
 RowBox[{"loopThickness", "[", 
  "]"}]], "Input",ExpressionUUID->"8f264d2d-4f9f-4ce1-84d7-801e89a12a39"]
}, Closed]],

Cell[CellGroupData[{

Cell["Axial gauge", \
"Section",ExpressionUUID->"390bad32-1acb-49c3-85aa-9007e41649ee"],

Cell[BoxData[
 RowBox[{"<<", 
  "\"\<test-4.m\>\""}]], \
"Input",ExpressionUUID->"22c9696c-7de7-4ae7-b65c-fbe9c78c0256"],

Cell[BoxData[
 RowBox[{"averagePlaquette", "[", 
  "]"}]], "Input",ExpressionUUID->"f926c3ce-659f-4a49-9d2f-c404101369ab"],

Cell[BoxData[
 RowBox[{"setAxialGauge", "[", "3", 
  "]"}]], "Input",ExpressionUUID->"2a91e4ae-13cf-4a7c-ab4d-b222df8a6e3f"],

Cell[BoxData[
 RowBox[{"averagePlaquette", "[", 
  "]"}]], "Input",ExpressionUUID->"fdbf45d3-6296-4a22-839d-f320b1941cec"]
}, Closed]],

Cell[CellGroupData[{

Cell["staples", \
"Section",ExpressionUUID->"86c065e9-8bbc-45f0-924a-a3d53a13e870"],

Cell[BoxData[
 RowBox[{"<<", 
  "\"\<test-3-3-5.m\>\""}]], \
"Input",ExpressionUUID->"3373f6a1-fe4f-4d7f-8400-9941e7ffd180"],

Cell[BoxData[
 RowBox[{"xxx", "=", 
  RowBox[{
  "averagePlaquette", "[", 
   "]"}]}]], "Input",ExpressionUUID->"ae979c30-3ea4-4b94-be05-119ee3fac4fe"],

Cell["Set all links to the identity", \
"Text",ExpressionUUID->"da25be9e-0061-43aa-bcc2-44c291ecfaa7"],

Cell[BoxData[
 RowBox[{
  RowBox[{"gaugeField", "=", 
   RowBox[{"Array", "[", 
    RowBox[{
     RowBox[{
      RowBox[{"IdentityMatrix", "[", "nc", "]"}], "&"}], ",", 
     RowBox[{"{", 
      RowBox[{"nd", ",", 
       RowBox[{"latticeVolume", "[", "]"}]}], "}"}]}], "]"}]}], 
  ";"}]], "Input",ExpressionUUID->"5e6b0009-27d7-40a8-84fc-0e51d9a6fdb9"],

Cell[BoxData[
 RowBox[{"sumStaples", "[", 
  RowBox[{"1", ",", 
   RowBox[{"{", 
    RowBox[{"1", ",", "1", ",", "1"}], "}"}]}], 
  "]"}]], "Input",ExpressionUUID->"ead4ecb9-6735-44e0-b9f5-d5a3fd73820a"],

Cell[BoxData[
 RowBox[{"stapleTest", "[", 
  "]"}]], "Input",ExpressionUUID->"0c7d5c04-32d5-48b1-8b6c-48c2ff086bc5"]
}, Closed]],

Cell[CellGroupData[{

Cell["nearest stationary point for single  link and sum of staples", \
"Section",ExpressionUUID->"6798086d-fa2e-4ba6-9e82-7d6af60383a8"],

Cell["\<\
Test stationary point routine against an explicit calculation for a random \
staple and starting matrix.  To compare,  remove the damping factors in the \
function saddlePointStep[] by setting rescaleCutoff to a large number and \
dampingFactor to 1.\
\>", "Text",ExpressionUUID->"1d3cb94f-7ba5-44cd-98af-a83fb16475e8"],

Cell[BoxData[
 RowBox[{
  RowBox[{"nd", "=", "3"}], ";", 
  RowBox[{"nc", "=", "3"}], 
  ";"}]], "Input",ExpressionUUID->"a8a28067-3f69-440b-8508-7b7d70cd3ccc"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"makeRandomStaple", "[", "]"}], ":=", 
   RowBox[{"Sum", "[", 
    RowBox[{
     RowBox[{"randomSUMatrix", "[", "]"}], ",", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"2", " ", "nd"}], "-", "2"}], "}"}]}], "]"}]}], ";", 
  RowBox[{"Clear", "[", 
   RowBox[{"bb", ",", "bVector"}], "]"}], ";", 
  RowBox[{"bVector", "=", 
   RowBox[{
    RowBox[{"Table", "[", 
     RowBox[{
      RowBox[{"bb", "[", "i", "]"}], ",", 
      RowBox[{"{", 
       RowBox[{"i", ",", 
        RowBox[{
         RowBox[{"nc", "^", "2"}], "-", "1"}]}], "}"}]}], "]"}], ".", 
    RowBox[{
    "suGenerators", "[", 
     "]"}]}]}]}]], \
"Input",ExpressionUUID->"91a19e6a-2ac7-46fd-bc12-03dda9a4b9ce"],

Cell[CellGroupData[{

Cell["Run test", \
"Subsection",ExpressionUUID->"7995b3f0-9cde-46fc-9fe0-25405eb3ac24"],

Cell["Make random staple and starting link.", \
"Text",ExpressionUUID->"98726971-28ea-4f65-a6f0-347be3ee9c96"],

Cell[BoxData[
 RowBox[{
  RowBox[{"testStaple", "=", 
   RowBox[{"makeRandomStaple", "[", "]"}]}], ";", 
  RowBox[{"uu", "=", 
   RowBox[{"randomSUMatrix", "[", "]"}]}], ";", 
  RowBox[{"sqrtU", "=", 
   RowBox[{"SUPower", "[", 
    RowBox[{"uu", ",", "0.5"}], "]"}]}], 
  ";"}]], "Input",ExpressionUUID->"8c9fa76e-8afe-4136-91be-3a65fd3ea695"],

Cell["\<\
Explicitly find the second order expansion of the exponential.\
\>", "Text",ExpressionUUID->"3ec7fa5f-8386-4182-b929-57585b3563de"],

Cell[BoxData[
 RowBox[{"expr", "=", 
  RowBox[{
   RowBox[{"Re", "[", 
    RowBox[{"Expand", "[", 
     RowBox[{"Tr", "[", 
      RowBox[{"testStaple", ".", "sqrtU", ".", 
       RowBox[{"Simplify", "[", 
        RowBox[{
         RowBox[{"IdentityMatrix", "[", "nc", "]"}], "+", 
         RowBox[{"I", " ", "bVector"}], "-", 
         RowBox[{
          RowBox[{"bVector", ".", "bVector"}], "/", 
          RowBox[{"2", "!"}]}]}], "]"}], ".", "sqrtU"}], "]"}], "]"}], "]"}], 
   "//.", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{
      RowBox[{"Re", "[", 
       RowBox[{"a_", "+", "b_"}], "]"}], "\[Rule]", 
      RowBox[{
       RowBox[{"Re", "[", "a", "]"}], "+", 
       RowBox[{"Re", "[", "b", "]"}]}]}], ",", 
     RowBox[{
      RowBox[{"Re", "[", 
       RowBox[{"a_", " ", 
        RowBox[{"bb", "[", "i_", "]"}]}], "]"}], "\[Rule]", 
      RowBox[{
       RowBox[{"Re", "[", "a", "]"}], " ", 
       RowBox[{"bb", "[", "i", "]"}]}]}], ",", 
     RowBox[{
      RowBox[{"Re", "[", 
       RowBox[{"a_", " ", 
        RowBox[{
         RowBox[{"bb", "[", "i_", "]"}], "^", "n_"}]}], "]"}], "\[Rule]", 
      RowBox[{
       RowBox[{"Re", "[", "a", "]"}], " ", 
       RowBox[{
        RowBox[{"bb", "[", "i", "]"}], "^", "n"}]}]}]}], 
    "}"}]}]}]], \
"Input",ExpressionUUID->"ded0c36d-7fa0-4fb6-9480-2dfca41845a5"],

Cell["Find the stationary point, based on this :", \
"Text",ExpressionUUID->"634ef01a-48ac-4ab0-bc81-edec8040de95"],

Cell[BoxData[
 RowBox[{"sp", "=", 
  RowBox[{
   RowBox[{"Solve", "[", 
    RowBox[{
     RowBox[{"Table", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"D", "[", 
         RowBox[{"expr", ",", 
          RowBox[{"bb", "[", "i", "]"}]}], "]"}], "\[Equal]", "0"}], ",", 
       RowBox[{"{", 
        RowBox[{"i", ",", 
         RowBox[{
          RowBox[{"nc", "^", "2"}], "-", "1"}]}], "}"}]}], "]"}], ",", 
     RowBox[{"Table", "[", 
      RowBox[{
       RowBox[{"bb", "[", "i", "]"}], ",", 
       RowBox[{"{", 
        RowBox[{"i", ",", 
         RowBox[{
          RowBox[{"nc", "^", "2"}], "-", "1"}]}], "}"}]}], "]"}]}], "]"}], 
   "[", 
   RowBox[{"[", "1", "]"}], 
   "]"}]}]], "Input",ExpressionUUID->"4c2cfa2d-9841-425f-9a76-770226468312"],

Cell[BoxData[
 RowBox[{"v1", "=", 
  RowBox[{"sqrtU", ".", 
   RowBox[{"MatrixExp", "[", 
    RowBox[{
     RowBox[{"I", " ", "bVector"}], "/.", "sp"}], "]"}], ".", 
   "sqrtU"}]}]], \
"Input",ExpressionUUID->"d61d7994-b021-4229-9310-5ead7ca32823"],

Cell[BoxData[
 RowBox[{"centerPhases", "[", "v1", 
  "]"}]], "Input",ExpressionUUID->"2be1ed46-0052-42e1-a14e-caeeac30e74f"],

Cell["\<\
Now, compare this with the library routine (with damping factors removed) :\
\>", "Text",ExpressionUUID->"7dd62d34-e2e2-46c5-a65c-1f3b2ef25e72"],

Cell[BoxData[
 RowBox[{
  RowBox[{"{", 
   RowBox[{"u2", ",", "maxShift"}], "}"}], "=", 
  RowBox[{"linkSaddlePointStep", "[", 
   RowBox[{
    RowBox[{"sqrtU", ".", "testStaple"}], ",", "sqrtU", ",", 
    RowBox[{"rescaleCutoff", "\[Rule]", "Infinity"}], ",", 
    RowBox[{"dampingFactor", "\[Rule]", "1"}]}], 
   "]"}]}]], "Input",ExpressionUUID->"274b3611-bfd8-4538-95f4-b1860c9486ca"],

Cell[BoxData[
 RowBox[{"v2", "=", 
  RowBox[{
  "u2", ".", 
   "sqrtU"}]}]], \
"Input",ExpressionUUID->"e39c645a-2af9-49b6-8f03-3335f2e24b68"],

Cell[BoxData[
 RowBox[{"centerPhases", "[", "v2", 
  "]"}]], "Input",ExpressionUUID->"38985cff-17be-438e-a76c-fc60c38a360f"]
}, Open  ]]
}, Closed]],

Cell[CellGroupData[{

Cell["nearest stationary point for entire lattice", \
"Section",ExpressionUUID->"95cf531b-c774-4c9e-a701-2817af3c0b40"],

Cell["\<\
Test stationary point routine against an explicit calculation for a random \
lattice.  Tested for nd=3 and SU(2), SU(3) with multiple sites, and SU(4) \
with one site.\
\>", "Text",ExpressionUUID->"682f351b-bb5d-460b-9ca5-42443640777b"],

Cell["Create Random lattice :", \
"Text",ExpressionUUID->"4fd7990a-1a12-4fb8-b10a-e7f2a2023085"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"nd", "=", "3"}], ";", 
  RowBox[{"nc", "=", "2"}], ";", 
  RowBox[{"latticeDimensions", "=", 
   RowBox[{"{", 
    RowBox[{"2", ",", "2", ",", "1"}], "}"}]}], ";", 
  RowBox[{"gaugeField", "=", 
   RowBox[{"Table", "[", 
    RowBox[{
     RowBox[{"randomSUMatrix", "[", "]"}], ",", 
     RowBox[{"{", "nd", "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"latticeVolume", "[", "]"}], "}"}]}], "]"}]}], ";", 
  RowBox[{"Clear", "[", "linearSiteIndex", "]"}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"(*", " ", 
   RowBox[{
   "Switch", " ", "order", " ", "to", " ", "verify", " ", "we", " ", "are", 
    " ", "not", " ", "dependent", " ", "on", " ", 
    RowBox[{"latticeCoordinates", "[", "]"}], " ", 
    RowBox[{"indexing", "."}]}], " ", "*)"}], 
  RowBox[{
   RowBox[{"Do", "[", 
    RowBox[{
     RowBox[{
      RowBox[{"linearSiteIndex", "[", 
       RowBox[{"latticeCoordinates", "[", "i", "]"}], "]"}], "=", 
      RowBox[{"If", "[", 
       RowBox[{"True", ",", "i", ",", 
        RowBox[{
         RowBox[{"latticeVolume", "[", "]"}], "-", "i", "+", "1"}]}], "]"}]}],
      ",", 
     RowBox[{"{", 
      RowBox[{"i", ",", 
       RowBox[{"latticeVolume", "[", "]"}]}], "}"}]}], "]"}], ";", 
   RowBox[{
   "averagePlaquette", "[", 
    "]"}]}]}]}], \
"Input",ExpressionUUID->"1c3971d5-2ff0-4eb6-8bd2-e735288849a3"],

Cell[BoxData[
 RowBox[{
  RowBox[{"Clear", "[", 
   RowBox[{"bb", ",", "bVector"}], "]"}], ";", 
  RowBox[{
   RowBox[{"bVector", "[", 
    RowBox[{"dir_", ",", "site_"}], "]"}], ":=", 
   RowBox[{"(", 
    RowBox[{
     RowBox[{"Table", "[", 
      RowBox[{
       RowBox[{"bb", "[", 
        RowBox[{"dir", ",", "site", ",", "i"}], "]"}], ",", 
       RowBox[{"{", 
        RowBox[{"i", ",", 
         RowBox[{
          RowBox[{"nc", "^", "2"}], "-", "1"}]}], "}"}]}], "]"}], ".", 
     RowBox[{"suGenerators", "[", "]"}]}], 
    ")"}]}]}]], \
"Input",ExpressionUUID->"9b04eb0b-2c48-4bdb-9045-6c21ab7b90f0"],

Cell["\<\
Create links with second order perturbation.  Variables have same lattice \
index as links.\
\>", "Text",ExpressionUUID->"aa68c211-373b-4d0a-aa86-915f456015de"],

Cell[BoxData[
 RowBox[{
  RowBox[{"uu", "=", 
   RowBox[{"Table", "[", 
    RowBox[{
     RowBox[{"Simplify", "[", 
      RowBox[{
       RowBox[{"SUPower", "[", 
        RowBox[{
         RowBox[{"gaugeField", "[", 
          RowBox[{"[", 
           RowBox[{"dir", ",", "i"}], "]"}], "]"}], ",", "0.5"}], "]"}], ".", 
       
       RowBox[{"(", 
        RowBox[{
         RowBox[{"IdentityMatrix", "[", "nc", "]"}], "+", 
         RowBox[{"I", " ", 
          RowBox[{"bVector", "[", 
           RowBox[{"dir", ",", "i"}], "]"}]}], "-", 
         RowBox[{
          RowBox[{
           RowBox[{"bVector", "[", 
            RowBox[{"dir", ",", "i"}], "]"}], ".", 
           RowBox[{"bVector", "[", 
            RowBox[{"dir", ",", "i"}], "]"}]}], "/", 
          RowBox[{"2", "!"}]}]}], ")"}], ".", 
       RowBox[{"SUPower", "[", 
        RowBox[{
         RowBox[{"gaugeField", "[", 
          RowBox[{"[", 
           RowBox[{"dir", ",", "i"}], "]"}], "]"}], ",", "0.5"}], "]"}]}], 
      "]"}], ",", 
     RowBox[{"{", 
      RowBox[{"dir", ",", "nd"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"i", ",", 
       RowBox[{"latticeVolume", "[", "]"}]}], "}"}]}], "]"}]}], 
  ";"}]], "Input",ExpressionUUID->"dd43032c-3c2f-47d3-b9c4-6400e3d30e4d"],

Cell["Sum of plaquettes, not taking the real part yet:", \
"Text",ExpressionUUID->"189c55ea-c7a5-40be-9a11-d6f147a69c47"],

Cell[BoxData[
 RowBox[{
  RowBox[{"rp", "=", 
   RowBox[{"Sum", "[", 
    RowBox[{
     RowBox[{
      RowBox[{"Block", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"coords", "=", 
          RowBox[{"latticeCoordinates", "[", "i", "]"}]}], "}"}], ",", 
        RowBox[{"Tr", "[", 
         RowBox[{
          RowBox[{"uu", "[", 
           RowBox[{"[", 
            RowBox[{"k1", ",", 
             RowBox[{"linearSiteIndex", "[", "coords", "]"}]}], "]"}], "]"}], 
          ".", 
          RowBox[{"uu", "[", 
           RowBox[{"[", 
            RowBox[{"k2", ",", 
             RowBox[{"linearSiteIndex", "[", 
              RowBox[{"shift", "[", 
               RowBox[{"k1", ",", "coords"}], "]"}], "]"}]}], "]"}], "]"}], 
          ".", 
          RowBox[{"ConjugateTranspose", "[", 
           RowBox[{"uu", "[", 
            RowBox[{"[", 
             RowBox[{"k1", ",", 
              RowBox[{"linearSiteIndex", "[", 
               RowBox[{"shift", "[", 
                RowBox[{"k2", ",", "coords"}], "]"}], "]"}]}], "]"}], "]"}], 
           "]"}], ".", 
          RowBox[{"ConjugateTranspose", "[", 
           RowBox[{"uu", "[", 
            RowBox[{"[", 
             RowBox[{"k2", ",", 
              RowBox[{"linearSiteIndex", "[", "coords", "]"}]}], "]"}], "]"}],
            "]"}]}], "]"}]}], "]"}], "//.", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{
         RowBox[{"Conjugate", "[", 
          RowBox[{"a_", " ", "b_"}], "]"}], "\[Rule]", 
         RowBox[{
          RowBox[{"Conjugate", "[", "a", "]"}], 
          RowBox[{"Conjugate", "[", "b", "]"}]}]}], ",", 
        RowBox[{
         RowBox[{"Conjugate", "[", 
          RowBox[{"a_", "+", "b_"}], "]"}], "\[Rule]", 
         RowBox[{
          RowBox[{"Conjugate", "[", "a", "]"}], "+", 
          RowBox[{"Conjugate", "[", "b", "]"}]}]}], ",", 
        RowBox[{
         RowBox[{"Conjugate", "[", 
          RowBox[{"bb", "[", "a__", "]"}], "]"}], "\[Rule]", 
         RowBox[{"bb", "[", "a", "]"}]}]}], "}"}]}], ",", 
     RowBox[{"{", 
      RowBox[{"k1", ",", 
       RowBox[{"nd", "-", "1"}]}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"k2", ",", 
       RowBox[{"k1", "+", "1"}], ",", "nd"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"i", ",", 
       RowBox[{"latticeVolume", "[", "]"}]}], "}"}]}], "]"}]}], ";", 
  RowBox[{"(*", " ", 
   RowBox[{
   "Average", " ", "plaquette", " ", "should", " ", "be", " ", "same", " ", 
    "as", " ", 
    RowBox[{"above", "."}]}], " ", "*)"}], 
  RowBox[{
   RowBox[{"2", "/", 
    RowBox[{"(", 
     RowBox[{"nc", " ", "nd", " ", 
      RowBox[{"(", 
       RowBox[{"nd", "-", "1"}], ")"}], " ", 
      RowBox[{"latticeVolume", "[", "]"}]}], ")"}]}], " ", 
   RowBox[{"Re", "[", 
    RowBox[{"rp", "/.", 
     RowBox[{
      RowBox[{"bb", "[", "__", "]"}], "\[Rule]", "0"}]}], 
    "]"}]}]}]], \
"Input",ExpressionUUID->"8efba561-67ca-4fc4-a003-487fb888d051"],

Cell["Calculate gradient and Hessian at bb[dir,i,k] = 0.", \
"Text",ExpressionUUID->"2297dbed-7bbd-4a6c-931f-ef9aff9444fd"],

Cell[BoxData[
 RowBox[{"gradientA", "=", 
  RowBox[{"Flatten", "[", 
   RowBox[{"Table", "[", 
    RowBox[{
     RowBox[{"Re", "[", 
      RowBox[{
       RowBox[{"D", "[", 
        RowBox[{"rp", ",", 
         RowBox[{"bb", "[", 
          RowBox[{"dir", ",", "i", ",", "k"}], "]"}]}], "]"}], "/.", 
       RowBox[{
        RowBox[{"bb", "[", "__", "]"}], "\[Rule]", "0"}]}], "]"}], ",", 
     RowBox[{"{", 
      RowBox[{"dir", ",", "nd"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"i", ",", 
       RowBox[{"latticeVolume", "[", "]"}]}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"k", ",", 
       RowBox[{
        RowBox[{"nc", "^", "2"}], "-", "1"}]}], "}"}]}], "]"}], 
   "]"}]}]], "Input",ExpressionUUID->"5dac75e6-8325-4bca-bb34-883cdc84b378"],

Cell["\<\
For parallelization, I had to go to menu Evaluation->Parallel Kernel \
Configuration and set the number manually.  Automatic launching of additional \
kernels is broken?  Note that the parallelization is based on the leading \
dimension of the table.
Verify parallel kernels are running:\
\>", "Text",ExpressionUUID->"0a7c4866-70f9-494b-a85d-240479ff71e4"],

Cell[BoxData[
 RowBox[{"ParallelEvaluate", "[", "$ProcessID", 
  "]"}]], "Input",ExpressionUUID->"5c7453cd-b51a-4d4c-b5b6-46caa5f2f565"],

Cell[BoxData[
 RowBox[{"Dimensions", "[", 
  RowBox[{"hessA", "=", 
   RowBox[{"Flatten", "[", 
    RowBox[{
     RowBox[{"ParallelTable", "[", 
      RowBox[{
       RowBox[{"Re", "[", 
        RowBox[{
         RowBox[{"D", "[", 
          RowBox[{"rp", ",", 
           RowBox[{"bb", "[", 
            RowBox[{"dir1", ",", "i1", ",", "k1"}], "]"}], ",", 
           RowBox[{"bb", "[", 
            RowBox[{"dir2", ",", "i2", ",", "k2"}], "]"}]}], "]"}], "/.", 
         RowBox[{
          RowBox[{"bb", "[", "__", "]"}], "\[Rule]", "0"}]}], "]"}], ",", 
       RowBox[{"{", 
        RowBox[{"dir1", ",", "nd"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"i1", ",", 
         RowBox[{"latticeVolume", "[", "]"}]}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"k1", ",", 
         RowBox[{
          RowBox[{"nc", "^", "2"}], "-", "1"}]}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"dir2", ",", "nd"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"i2", ",", 
         RowBox[{"latticeVolume", "[", "]"}]}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"k2", ",", 
         RowBox[{
          RowBox[{"nc", "^", "2"}], "-", "1"}]}], "}"}]}], "]"}], ",", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"1", ",", "2", ",", "3"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"4", ",", "5", ",", "6"}], "}"}]}], "}"}]}], "]"}]}], 
  "]"}]], "Input",ExpressionUUID->"370de329-4edd-493e-96b8-a86ef4490981"],

Cell["Find the saddle point.", \
"Text",ExpressionUUID->"9ac86a7d-aec3-40c8-a515-961e6853ec19"],

Cell[BoxData[
 RowBox[{"deltaA", "=", 
  RowBox[{"-", 
   RowBox[{"LinearSolve", "[", 
    RowBox[{"hessA", ",", "gradientA"}], 
    "]"}]}]}]], \
"Input",ExpressionUUID->"1900977d-1223-43a1-9fa5-06e4b30693e5"],

Cell["Equivalently, find the saddle point using the eigensystem.", \
"Text",ExpressionUUID->"ae61937e-46a3-4391-8c12-f828b145290b"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"{", 
    RowBox[{"valsA", ",", "ooA"}], "}"}], "=", 
   RowBox[{"Eigensystem", "[", "hessA", "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{"deltaA", "=", 
  RowBox[{
   RowBox[{"(", 
    RowBox[{
     RowBox[{"-", 
      RowBox[{"ooA", ".", "gradientA"}]}], "/", "valsA"}], ")"}], ".", 
   "ooA"}]}]}], \
"Input",ExpressionUUID->"53e52cc9-a36b-446a-b93c-9794cc99a6e7"],

Cell["Substitute shift back into links :", \
"Text",ExpressionUUID->"a1f7a25b-b9ad-4b0c-8c5a-00b9d4137a8e"],

Cell[BoxData[
 RowBox[{
  RowBox[{"gaugeFieldA", "=", 
   RowBox[{"Table", "[", 
    RowBox[{
     RowBox[{
      RowBox[{"SUPower", "[", 
       RowBox[{
        RowBox[{"gaugeField", "[", 
         RowBox[{"[", 
          RowBox[{"dir", ",", "i"}], "]"}], "]"}], ",", "0.5"}], "]"}], ".", 
      RowBox[{"MatrixExp", "[", 
       RowBox[{"I", " ", 
        RowBox[{
         RowBox[{"Take", "[", 
          RowBox[{"deltaA", ",", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{"1", ",", 
              RowBox[{
               RowBox[{"nc", "^", "2"}], "-", "1"}]}], "}"}], "+", 
            RowBox[{
             RowBox[{"(", 
              RowBox[{
               RowBox[{"nc", "^", "2"}], "-", "1"}], ")"}], 
             RowBox[{"(", 
              RowBox[{
               RowBox[{"(", 
                RowBox[{"i", "-", "1"}], ")"}], "+", 
               RowBox[{
                RowBox[{"latticeVolume", "[", "]"}], 
                RowBox[{"(", 
                 RowBox[{"dir", "-", "1"}], ")"}]}]}], ")"}]}]}]}], "]"}], 
         ".", 
         RowBox[{"suGenerators", "[", "]"}]}]}], "]"}], ".", 
      RowBox[{"SUPower", "[", 
       RowBox[{
        RowBox[{"gaugeField", "[", 
         RowBox[{"[", 
          RowBox[{"dir", ",", "i"}], "]"}], "]"}], ",", "0.5"}], "]"}]}], ",", 
     RowBox[{"{", 
      RowBox[{"dir", ",", "nd"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"i", ",", 
       RowBox[{"latticeVolume", "[", "]"}]}], "}"}]}], "]"}]}], 
  ";"}]], "Input",ExpressionUUID->"918e4b88-9d04-4bc6-ae24-33c7702b0c59"],

Cell[BoxData[
 RowBox[{
  RowBox[{"Block", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"gaugeField", "=", "gaugeFieldA"}], "}"}], ",", 
    RowBox[{"Print", "[", 
     RowBox[{"averagePlaquette", "[", "]"}], "]"}]}], "]"}], 
  ";"}]], "Input",ExpressionUUID->"a084fa08-f8cd-4554-b1e0-5e8a50b44070"],

Cell["\<\
Now, compare this with the library routine (with damping factors removed) :\
\>", "Text",ExpressionUUID->"8c235b7f-b3be-45ee-b047-c0f9c6b72d5e"],

Cell[BoxData[
 RowBox[{
  RowBox[{"libGaugeField", "=", 
   RowBox[{"latticeSaddlePointStep", "[", 
    RowBox[{
     RowBox[{"storePairs", "\[Rule]", "True"}], ",", 
     RowBox[{"cutoffValue", "\[Rule]", "1"}], ",", 
     RowBox[{"allLinks", "\[Rule]", "True"}], ",", 
     RowBox[{"dampingFactor", "\[Rule]", "1"}], ",", 
     RowBox[{"rescaleCutoff", "\[Rule]", "Infinity"}]}], "]"}]}], 
  ";"}]], "Input",ExpressionUUID->"8b06b8b1-c61d-4172-9ae3-8d57f5095087"],

Cell[BoxData[
 RowBox[{"Tally", "[", 
  RowBox[{"Chop", "[", 
   RowBox[{
    RowBox[{"Flatten", "[", 
     RowBox[{"gaugeFieldA", "-", "libGaugeField"}], "]"}], ",", 
    RowBox[{"10", "^", 
     RowBox[{"-", "7"}]}]}], "]"}], 
  "]"}]], "Input",ExpressionUUID->"7e974aaa-70ad-44a3-8db6-6fbb591c8fa3"]
}, Closed]],

Cell[CellGroupData[{

Cell["\<\
nearest stationary point for entire lattice, one direction fixed\
\>", "Section",ExpressionUUID->"6afea612-4829-4b47-b988-53fc7c66a8ee"],

Cell["\<\
Test stationary point routine against an explicit calculation for a random \
lattice in Axial gauge\
\>", "Text",ExpressionUUID->"46628854-1f58-435b-a306-efb622183479"],

Cell["Create Random lattice :", \
"Text",ExpressionUUID->"cfb057c6-74fd-466a-bfff-ead6704c041b"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"nd", "=", "3"}], ";", 
  RowBox[{"nc", "=", "2"}], ";", 
  RowBox[{"fDir", "=", "1"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"latticeDimensions", "=", 
   RowBox[{"{", 
    RowBox[{"2", ",", "2", ",", "2"}], "}"}]}], ";", 
  RowBox[{"gaugeField", "=", 
   RowBox[{"Table", "[", 
    RowBox[{
     RowBox[{"randomSUMatrix", "[", "]"}], ",", 
     RowBox[{"{", "nd", "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"latticeVolume", "[", "]"}], "}"}]}], "]"}]}], ";", 
  RowBox[{"Clear", "[", "linearSiteIndex", "]"}], ";", 
  RowBox[{"Do", "[", 
   RowBox[{
    RowBox[{
     RowBox[{"linearSiteIndex", "[", 
      RowBox[{"latticeCoordinates", "[", "i", "]"}], "]"}], "=", "i"}], ",", 
    RowBox[{"{", 
     RowBox[{"i", ",", 
      RowBox[{"latticeVolume", "[", "]"}]}], "}"}]}], "]"}], ";", 
  RowBox[{"setAxialGauge", "[", "fDir", "]"}], ";", 
  RowBox[{
  "averagePlaquette", "[", 
   "]"}]}]}], "Input",ExpressionUUID->"f52bc08f-d446-4d2f-9c46-ab08017a8666"],

Cell["Create lattice with minimal non-trivial links.", \
"Text",ExpressionUUID->"10698ee7-9151-48df-9226-36cd3ca8bcbd"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"nd", "=", "3"}], ";", 
  RowBox[{"nc", "=", "2"}], ";", 
  RowBox[{"latticeDimensions", "=", 
   RowBox[{"{", 
    RowBox[{"2", ",", "1", ",", "1"}], "}"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"If", "[", 
   RowBox[{"True", ",", 
    RowBox[{
     RowBox[{"makeTrivialLattice", "[", 
      RowBox[{"randomGauge", "\[Rule]", "False"}], "]"}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"setLink", "[", 
      RowBox[{"1", ",", 
       RowBox[{"{", 
        RowBox[{"1", ",", "1", ",", "1"}], "}"}], ",", 
       RowBox[{"MatrixExp", "[", 
        RowBox[{"I", " ", "Pi", " ", ".3", " ", 
         RowBox[{
          RowBox[{"suGenerators", "[", "]"}], "[", 
          RowBox[{"[", "1", "]"}], "]"}]}], "]"}]}], "]"}], ";", 
     RowBox[{"setLink", "[", 
      RowBox[{"1", ",", 
       RowBox[{"{", 
        RowBox[{"1", ",", "1", ",", "1"}], "}"}], ",", 
       RowBox[{"MatrixExp", "[", 
        RowBox[{"I", " ", "Pi", " ", ".3", " ", 
         RowBox[{
          RowBox[{"suGenerators", "[", "]"}], "[", 
          RowBox[{"[", "2", "]"}], "]"}]}], "]"}]}], "]"}], ";", " ", 
     RowBox[{"setLink", "[", 
      RowBox[{"1", ",", 
       RowBox[{"{", 
        RowBox[{"2", ",", "1", ",", "1"}], "}"}], ",", 
       RowBox[{"MatrixExp", "[", 
        RowBox[{"I", " ", "Pi", " ", ".3", " ", 
         RowBox[{
          RowBox[{"suGenerators", "[", "]"}], "[", 
          RowBox[{"[", "1", "]"}], "]"}]}], "]"}]}], "]"}], ";", 
     RowBox[{"setLink", "[", 
      RowBox[{"1", ",", 
       RowBox[{"{", 
        RowBox[{"2", ",", "1", ",", "1"}], "}"}], ",", 
       RowBox[{"MatrixExp", "[", 
        RowBox[{"I", " ", "Pi", " ", ".3", " ", 
         RowBox[{
          RowBox[{"suGenerators", "[", "]"}], "[", 
          RowBox[{"[", "2", "]"}], "]"}]}], "]"}]}], "]"}], ";", " ", 
     RowBox[{"setLink", "[", 
      RowBox[{"3", ",", 
       RowBox[{"{", 
        RowBox[{"1", ",", "1", ",", "1"}], "}"}], ",", 
       RowBox[{"MatrixExp", "[", 
        RowBox[{"I", " ", "Pi", " ", ".1", " ", 
         RowBox[{
          RowBox[{"suGenerators", "[", "]"}], "[", 
          RowBox[{"[", "2", "]"}], "]"}]}], "]"}]}], "]"}], ";", 
     RowBox[{"setLink", "[", 
      RowBox[{"3", ",", 
       RowBox[{"{", 
        RowBox[{"2", ",", "1", ",", "1"}], "}"}], ",", 
       RowBox[{"MatrixExp", "[", 
        RowBox[{"I", " ", "Pi", " ", ".05", " ", 
         RowBox[{
          RowBox[{"suGenerators", "[", "]"}], "[", 
          RowBox[{"[", "3", "]"}], "]"}]}], "]"}]}], "]"}], ";", 
     RowBox[{"setLink", "[", 
      RowBox[{"2", ",", 
       RowBox[{"{", 
        RowBox[{"2", ",", "1", ",", "1"}], "}"}], ",", 
       RowBox[{"MatrixExp", "[", 
        RowBox[{"I", " ", "Pi", " ", ".01", " ", 
         RowBox[{
          RowBox[{"suGenerators", "[", "]"}], "[", 
          RowBox[{"[", "1", "]"}], "]"}]}], "]"}]}], "]"}], ";", 
     RowBox[{"setLink", "[", 
      RowBox[{"2", ",", 
       RowBox[{"{", 
        RowBox[{"1", ",", "1", ",", "1"}], "}"}], ",", 
       RowBox[{"MatrixExp", "[", 
        RowBox[{"I", " ", "Pi", " ", "0.001", " ", 
         RowBox[{
          RowBox[{"suGenerators", "[", "]"}], "[", 
          RowBox[{"[", "2", "]"}], "]"}]}], "]"}]}], "]"}]}], ",", 
    RowBox[{
     RowBox[{"gaugeField", "=", 
      RowBox[{"Table", "[", 
       RowBox[{
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{"dir", "\[Equal]", "1"}], ",", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{"0", ",", "1"}], "}"}], ",", 
            RowBox[{"{", 
             RowBox[{"1", ",", "0"}], "}"}]}], "}"}], ",", 
          RowBox[{"IdentityMatrix", "[", "nc", "]"}]}], "]"}], ",", 
        RowBox[{"{", 
         RowBox[{"dir", ",", "nd"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"latticeVolume", "[", "]"}], "}"}]}], "]"}]}], ";", 
     RowBox[{"Clear", "[", "linearSiteIndex", "]"}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"Do", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"linearSiteIndex", "[", 
         RowBox[{"latticeCoordinates", "[", "i", "]"}], "]"}], "=", "i"}], 
       ",", 
       RowBox[{"{", 
        RowBox[{"i", ",", 
         RowBox[{"latticeVolume", "[", "]"}]}], "}"}]}], "]"}]}]}], "]"}], 
  ";", 
  RowBox[{"(*", " ", 
   RowBox[{
    RowBox[{"setAxialGauge", "[", "fDir", "]"}], ";"}], "*)"}], 
  RowBox[{
  "averagePlaquette", "[", 
   "]"}]}]}], "Input",ExpressionUUID->"8767dbd3-6ebb-462b-9a49-e5ac21db02d0"],

Cell[CellGroupData[{

Cell["Analysis", \
"Subsection",ExpressionUUID->"07fee0bf-0aa1-4b9c-98ee-45b00ef5ba02"],

Cell[BoxData[
 RowBox[{
  RowBox[{"Clear", "[", 
   RowBox[{"bb", ",", "bVector"}], "]"}], ";", 
  RowBox[{
   RowBox[{"bVector", "[", 
    RowBox[{"dir_", ",", "site_"}], "]"}], ":=", 
   RowBox[{"(", 
    RowBox[{
     RowBox[{"Table", "[", 
      RowBox[{
       RowBox[{"bb", "[", 
        RowBox[{"dir", ",", "site", ",", "i"}], "]"}], ",", 
       RowBox[{"{", 
        RowBox[{"i", ",", 
         RowBox[{
          RowBox[{"nc", "^", "2"}], "-", "1"}]}], "}"}]}], "]"}], ".", 
     RowBox[{"suGenerators", "[", "]"}]}], 
    ")"}]}]}]], \
"Input",ExpressionUUID->"002ec141-0da2-4775-b9da-5bb60d049d8d"],

Cell["\<\
Constant links in one direction.  Create links with second order perturbation:\
\>", "Text",ExpressionUUID->"e2f4f19f-904d-459e-891d-1518fc4b5760"],

Cell[BoxData[
 RowBox[{
  RowBox[{"uu", "=", "gaugeField"}], ";", 
  RowBox[{"Table", "[", 
   RowBox[{
    RowBox[{"Block", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
        RowBox[{"coords", "=", 
         RowBox[{"latticeCoordinates", "[", "i", "]"}]}], ",", "c2"}], "}"}], 
      ",", 
      RowBox[{
       RowBox[{"c2", "=", "coords"}], ";", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"dir", "\[Equal]", "fDir"}], ",", 
         RowBox[{
          RowBox[{"c2", "[", 
           RowBox[{"[", "fDir", "]"}], "]"}], "=", "1"}]}], "]"}], ";", 
       RowBox[{
        RowBox[{"uu", "[", 
         RowBox[{"[", 
          RowBox[{"dir", ",", 
           RowBox[{"linearSiteIndex", "[", "coords", "]"}]}], "]"}], "]"}], 
        "=", 
        RowBox[{"Simplify", "[", 
         RowBox[{
          RowBox[{"SUPower", "[", 
           RowBox[{
            RowBox[{"getLink", "[", 
             RowBox[{"dir", ",", "coords"}], "]"}], ",", "0.5"}], "]"}], ".", 
          
          RowBox[{"(", 
           RowBox[{
            RowBox[{"IdentityMatrix", "[", "nc", "]"}], "+", 
            RowBox[{"I", " ", 
             RowBox[{"bVector", "[", 
              RowBox[{"dir", ",", "c2"}], "]"}]}], "-", 
            RowBox[{
             RowBox[{
              RowBox[{"bVector", "[", 
               RowBox[{"dir", ",", "c2"}], "]"}], ".", 
              RowBox[{"bVector", "[", 
               RowBox[{"dir", ",", "c2"}], "]"}]}], "/", 
             RowBox[{"2", "!"}]}]}], ")"}], ".", 
          RowBox[{"SUPower", "[", 
           RowBox[{
            RowBox[{"getLink", "[", 
             RowBox[{"dir", ",", "coords"}], "]"}], ",", "0.5"}], "]"}]}], 
         "]"}]}]}]}], "]"}], ",", 
    RowBox[{"{", 
     RowBox[{"dir", ",", "nd"}], "}"}], ",", 
    RowBox[{"{", 
     RowBox[{"i", ",", 
      RowBox[{"latticeVolume", "[", "]"}]}], "}"}]}], "]"}], 
  ";"}]], "Input",ExpressionUUID->"bcda7aa1-71be-4cae-b430-adce7f3357dc"],

Cell["Sum of plaquettes, not taking the real part:", \
"Text",ExpressionUUID->"6346d6bd-ef23-4df5-b127-4ca7d79668fa"],

Cell[BoxData[
 RowBox[{
  RowBox[{"rp", "=", 
   RowBox[{"Sum", "[", 
    RowBox[{
     RowBox[{
      RowBox[{"Block", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"coords", "=", 
          RowBox[{"latticeCoordinates", "[", "i", "]"}]}], "}"}], ",", 
        RowBox[{"Tr", "[", 
         RowBox[{
          RowBox[{"uu", "[", 
           RowBox[{"[", 
            RowBox[{"k1", ",", 
             RowBox[{"linearSiteIndex", "[", "coords", "]"}]}], "]"}], "]"}], 
          ".", 
          RowBox[{"uu", "[", 
           RowBox[{"[", 
            RowBox[{"k2", ",", 
             RowBox[{"linearSiteIndex", "[", 
              RowBox[{"shift", "[", 
               RowBox[{"k1", ",", "coords"}], "]"}], "]"}]}], "]"}], "]"}], 
          ".", 
          RowBox[{"ConjugateTranspose", "[", 
           RowBox[{"uu", "[", 
            RowBox[{"[", 
             RowBox[{"k1", ",", 
              RowBox[{"linearSiteIndex", "[", 
               RowBox[{"shift", "[", 
                RowBox[{"k2", ",", "coords"}], "]"}], "]"}]}], "]"}], "]"}], 
           "]"}], ".", 
          RowBox[{"ConjugateTranspose", "[", 
           RowBox[{"uu", "[", 
            RowBox[{"[", 
             RowBox[{"k2", ",", 
              RowBox[{"linearSiteIndex", "[", "coords", "]"}]}], "]"}], "]"}],
            "]"}]}], "]"}]}], "]"}], "//.", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{
         RowBox[{"Conjugate", "[", 
          RowBox[{"a_", " ", "b_"}], "]"}], "\[Rule]", 
         RowBox[{
          RowBox[{"Conjugate", "[", "a", "]"}], 
          RowBox[{"Conjugate", "[", "b", "]"}]}]}], ",", 
        RowBox[{
         RowBox[{"Conjugate", "[", 
          RowBox[{"a_", "+", "b_"}], "]"}], "\[Rule]", 
         RowBox[{
          RowBox[{"Conjugate", "[", "a", "]"}], "+", 
          RowBox[{"Conjugate", "[", "b", "]"}]}]}], ",", 
        RowBox[{
         RowBox[{"Conjugate", "[", 
          RowBox[{"bb", "[", "a__", "]"}], "]"}], "\[Rule]", 
         RowBox[{"bb", "[", "a", "]"}]}]}], "}"}]}], ",", 
     RowBox[{"{", 
      RowBox[{"k1", ",", 
       RowBox[{"nd", "-", "1"}]}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"k2", ",", 
       RowBox[{"k1", "+", "1"}], ",", "nd"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"i", ",", 
       RowBox[{"latticeVolume", "[", "]"}]}], "}"}]}], "]"}]}], ";", 
  RowBox[{"(*", " ", 
   RowBox[{
   "Average", " ", "plaquette", " ", "should", " ", "be", " ", "same", " ", 
    "as", " ", 
    RowBox[{"above", "."}]}], " ", "*)"}], 
  RowBox[{
   RowBox[{"2", "/", 
    RowBox[{"(", 
     RowBox[{"nc", " ", "nd", " ", 
      RowBox[{"(", 
       RowBox[{"nd", "-", "1"}], ")"}], " ", 
      RowBox[{"latticeVolume", "[", "]"}]}], ")"}]}], " ", 
   RowBox[{"Re", "[", 
    RowBox[{"rp", "/.", 
     RowBox[{
      RowBox[{"bb", "[", "__", "]"}], "\[Rule]", "0"}]}], 
    "]"}]}]}]], \
"Input",ExpressionUUID->"8623c371-9c30-49b9-b905-0c0fbeb5f177"],

Cell["Calculate gradient and Hessian at bb[dir,i,k] = 0.", \
"Text",ExpressionUUID->"5461a130-5a0c-4a0e-874b-0383d905a176"],

Cell[BoxData[
 RowBox[{
  RowBox[{"Clear", "[", "gradMap", "]"}], ";", 
  RowBox[{"Chop", "[", 
   RowBox[{"gradient1", "=", 
    RowBox[{"Block", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
        RowBox[{"dims0", "=", "latticeDimensions"}], ",", 
        RowBox[{"gi", "=", "1"}]}], "}"}], ",", 
      RowBox[{
       RowBox[{
        RowBox[{"dims0", "[", 
         RowBox[{"[", "fDir", "]"}], "]"}], "=", "1"}], ";", 
       RowBox[{"Flatten", "[", 
        RowBox[{"Table", "[", 
         RowBox[{
          RowBox[{"Block", "[", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{"coords", "=", 
              RowBox[{"latticeCoordinates", "[", 
               RowBox[{"i", ",", 
                RowBox[{"If", "[", 
                 RowBox[{
                  RowBox[{"dir", "\[Equal]", "fDir"}], ",", "dims0", ",", 
                  "latticeDimensions"}], "]"}]}], "]"}]}], "}"}], ",", 
            RowBox[{
             RowBox[{"If", "[", 
              RowBox[{
               RowBox[{"k", "\[Equal]", "1"}], ",", 
               RowBox[{
                RowBox[{"gradMap", "[", 
                 RowBox[{"dir", ",", "coords"}], "]"}], "=", "gi"}]}], "]"}], 
             ";", 
             RowBox[{"gi", "+=", "1"}], ";", 
             RowBox[{
              RowBox[{"Re", "[", 
               RowBox[{"D", "[", 
                RowBox[{"rp", ",", 
                 RowBox[{"bb", "[", 
                  RowBox[{"dir", ",", "coords", ",", "k"}], "]"}]}], "]"}], 
               "]"}], "/.", 
              RowBox[{
               RowBox[{"bb", "[", "__", "]"}], "\[Rule]", "0"}]}]}]}], "]"}], 
          ",", 
          RowBox[{"{", 
           RowBox[{"dir", ",", "nd"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"i", ",", 
            RowBox[{"latticeVolume", "[", 
             RowBox[{"If", "[", 
              RowBox[{
               RowBox[{"dir", "\[Equal]", "fDir"}], ",", "dims0", ",", 
               "latticeDimensions"}], "]"}], "]"}]}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"k", ",", 
            RowBox[{
             RowBox[{"nc", "^", "2"}], "-", "1"}]}], "}"}]}], "]"}], 
        "]"}]}]}], "]"}]}], 
   "]"}]}]], "Input",ExpressionUUID->"2a3c7375-3548-469a-b5d5-281e585f48a3"],

Cell[BoxData[
 RowBox[{"Dimensions", "[", 
  RowBox[{"hess1", "=", 
   RowBox[{"Block", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"dims", "=", "latticeDimensions"}], "}"}], ",", 
     RowBox[{
      RowBox[{
       RowBox[{"dims", "[", 
        RowBox[{"[", "fDir", "]"}], "]"}], "=", "1"}], ";", 
      RowBox[{"Flatten", "[", 
       RowBox[{
        RowBox[{"ParallelTable", "[", 
         RowBox[{
          RowBox[{"Re", "[", 
           RowBox[{
            RowBox[{"D", "[", 
             RowBox[{"rp", ",", 
              RowBox[{"bb", "[", 
               RowBox[{"dir1", ",", 
                RowBox[{"latticeCoordinates", "[", 
                 RowBox[{"i1", ",", 
                  RowBox[{"If", "[", 
                   RowBox[{
                    RowBox[{"dir1", "\[Equal]", "fDir"}], ",", "dims", ",", 
                    "latticeDimensions"}], "]"}]}], "]"}], ",", "k1"}], "]"}],
               ",", 
              RowBox[{"bb", "[", 
               RowBox[{"dir2", ",", 
                RowBox[{"latticeCoordinates", "[", 
                 RowBox[{"i2", ",", 
                  RowBox[{"If", "[", 
                   RowBox[{
                    RowBox[{"dir2", "\[Equal]", "fDir"}], ",", "dims", ",", 
                    "latticeDimensions"}], "]"}]}], "]"}], ",", "k2"}], 
               "]"}]}], "]"}], "/.", 
            RowBox[{
             RowBox[{"bb", "[", "__", "]"}], "\[Rule]", "0"}]}], "]"}], ",", 
          RowBox[{"{", 
           RowBox[{"dir1", ",", "nd"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"i1", ",", 
            RowBox[{"latticeVolume", "[", 
             RowBox[{"If", "[", 
              RowBox[{
               RowBox[{"dir1", "\[Equal]", "fDir"}], ",", "dims", ",", 
               "latticeDimensions"}], "]"}], "]"}]}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"k1", ",", 
            RowBox[{
             RowBox[{"nc", "^", "2"}], "-", "1"}]}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"dir2", ",", "nd"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"i2", ",", 
            RowBox[{"latticeVolume", "[", " ", 
             RowBox[{"If", "[", 
              RowBox[{
               RowBox[{"dir2", "\[Equal]", "fDir"}], ",", "dims", ",", 
               "latticeDimensions"}], "]"}], "]"}]}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"k2", ",", 
            RowBox[{
             RowBox[{"nc", "^", "2"}], "-", "1"}]}], "}"}]}], "]"}], ",", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"1", ",", "2", ",", "3"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"4", ",", "5", ",", "6"}], "}"}]}], "}"}]}], "]"}]}]}], 
    "]"}]}], "]"}]], \
"Input",ExpressionUUID->"18aa2ca9-6c1e-44c5-bdcb-608625c9422e"],

Cell["Shifts associated with the remaining gauge freedom.", \
"Text",ExpressionUUID->"ce655314-b12d-4061-81aa-5e13e825c9ec"],

Cell[BoxData[
 RowBox[{"Chop", "[", 
  RowBox[{"gtf", "=", 
   RowBox[{"gaugeTransformShifts", "[", 
    RowBox[{
     RowBox[{"makeRootLattice", "[", "]"}], ",", "fDir"}], "]"}]}], 
  "]"}]], "Input",ExpressionUUID->"02cb58a0-89a2-4f7f-9c83-5f4f69954120"],

Cell["The gradient is orthogonal to the gauge transform shifts :", \
"Text",ExpressionUUID->"4ab7eb36-03ff-48aa-9e64-9253a03f24b6"],

Cell[BoxData[
 RowBox[{"Chop", "[", 
  RowBox[{"gtf", ".", "gradient1"}], 
  "]"}]], "Input",ExpressionUUID->"23b665a4-4f5d-4222-ad1d-71acd6b803cc"],

Cell["But the Hessian is not, since it is a quadratic expansion :", \
"Text",ExpressionUUID->"f3db0435-e56c-4927-ba18-af4d04e783c9"],

Cell[BoxData[
 RowBox[{"MatrixPlot", "[", 
  RowBox[{"Chop", "[", 
   RowBox[{"gtf", ".", "hess1", ".", 
    RowBox[{"Transpose", "[", "gtf", "]"}]}], "]"}], 
  "]"}]], "Input",ExpressionUUID->"f2001b9a-e668-4423-9010-5f2b493d3a57"],

Cell[BoxData[
 RowBox[{"Dimensions", "[", 
  RowBox[{"proj1", "=", 
   RowBox[{"NullSpace", "[", "gtf", "]"}]}], 
  "]"}]], "Input",ExpressionUUID->"b4ce1e9e-4fe8-4239-b400-df4430184709"],

Cell["Find the saddle point.", \
"Text",ExpressionUUID->"77f08dcd-7394-4a58-b203-109753c95f4d"],

Cell[BoxData[
 RowBox[{"delta1", "=", 
  RowBox[{"-", 
   RowBox[{
    RowBox[{"LinearSolve", "[", 
     RowBox[{
      RowBox[{"proj1", ".", "hess1", ".", 
       RowBox[{"Transpose", "[", "proj1", "]"}]}], ",", 
      RowBox[{"proj1", ".", "gradient1"}]}], "]"}], ".", 
    "proj1"}]}]}]], \
"Input",ExpressionUUID->"64674df4-6fb1-44e5-8f07-e0f5ddb2f77e"],

Cell["Equivalently, find the saddle point using the eigensystem.", \
"Text",ExpressionUUID->"0acb2d87-7af1-47d1-a06f-0ae34816cb0b"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"{", 
    RowBox[{"vals1", ",", "oo1"}], "}"}], "=", 
   RowBox[{"Eigensystem", "[", 
    RowBox[{"proj1", ".", "hess1", ".", 
     RowBox[{"Transpose", "[", "proj1", "]"}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{"delta1", "=", 
  RowBox[{
   RowBox[{"(", 
    RowBox[{
     RowBox[{"-", 
      RowBox[{"oo1", ".", "proj1", ".", "gradient1"}]}], "/", "vals1"}], 
    ")"}], ".", "oo1", ".", 
   "proj1"}]}]}], \
"Input",ExpressionUUID->"55fb71d3-fdc1-491e-bd40-877904b0ea03"],

Cell["Substitute shift back into links :", \
"Text",ExpressionUUID->"a6d8526c-a2b4-4d74-9d9a-631926f20d04"],

Cell[BoxData[
 RowBox[{
  RowBox[{"newGaugeField", "=", "gaugeField"}], ";", 
  RowBox[{"Do", "[", 
   RowBox[{
    RowBox[{"Block", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
        RowBox[{"coords", "=", 
         RowBox[{"latticeCoordinates", "[", "i", "]"}]}], ",", 
        RowBox[{"dims", "=", "latticeDimensions"}], ",", "c2"}], "}"}], ",", 
      RowBox[{
       RowBox[{"c2", "=", "coords"}], ";", 
       RowBox[{
        RowBox[{"c2", "[", 
         RowBox[{"[", "fDir", "]"}], "]"}], "=", "1"}], ";", 
       RowBox[{
        RowBox[{"dims", "[", 
         RowBox[{"[", "fDir", "]"}], "]"}], "=", "1"}], ";", 
       RowBox[{
        RowBox[{"newGaugeField", "[", 
         RowBox[{"[", 
          RowBox[{"dir", ",", 
           RowBox[{"linearSiteIndex", "[", "coords", "]"}]}], "]"}], "]"}], 
        "=", 
        RowBox[{
         RowBox[{"SUPower", "[", 
          RowBox[{
           RowBox[{"getLink", "[", 
            RowBox[{"dir", ",", "coords"}], "]"}], ",", "0.5"}], "]"}], ".", 
         RowBox[{"MatrixExp", "[", 
          RowBox[{"I", " ", 
           RowBox[{
            RowBox[{"Take", "[", 
             RowBox[{"delta1", ",", 
              RowBox[{
               RowBox[{"{", 
                RowBox[{"1", ",", 
                 RowBox[{
                  RowBox[{"nc", "^", "2"}], "-", "1"}]}], "}"}], "-", "1", 
               "+", 
               RowBox[{"gradMap", "[", 
                RowBox[{"dir", ",", 
                 RowBox[{"If", "[", 
                  RowBox[{
                   RowBox[{"dir", "\[Equal]", "fDir"}], ",", "c2", ",", 
                   "coords"}], "]"}]}], "]"}]}]}], "]"}], ".", 
            RowBox[{"suGenerators", "[", "]"}]}]}], "]"}], ".", 
         RowBox[{"SUPower", "[", 
          RowBox[{
           RowBox[{"getLink", "[", 
            RowBox[{"dir", ",", "coords"}], "]"}], ",", "0.5"}], 
          "]"}]}]}]}]}], "]"}], ",", 
    RowBox[{"{", 
     RowBox[{"dir", ",", "nd"}], "}"}], ",", 
    RowBox[{"{", 
     RowBox[{"i", ",", 
      RowBox[{"latticeVolume", "[", "]"}]}], "}"}]}], "]"}], 
  ";"}]], "Input",ExpressionUUID->"dc3ccf11-2bff-4254-9dab-9892f8bc6a99"],

Cell[BoxData[
 RowBox[{
  RowBox[{"Block", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"gaugeField", "=", "newGaugeField"}], "}"}], ",", 
    RowBox[{"Print", "[", 
     RowBox[{"averagePlaquette", "[", "]"}], "]"}]}], "]"}], 
  ";"}]], "Input",ExpressionUUID->"f64fb766-7202-4259-9cb4-930b84dd83df"],

Cell["\<\
Now, compare this with the library routine (with damping factors removed) :\
\>", "Text",ExpressionUUID->"099be236-9a87-4bcd-b45f-9beda62961fe"],

Cell[BoxData[
 RowBox[{
  RowBox[{"libGaugeField", "=", 
   RowBox[{"latticeSaddlePointStep", "[", 
    RowBox[{
     RowBox[{"storePairs", "\[Rule]", "True"}], ",", 
     RowBox[{"fixedDir", "\[Rule]", "fDir"}], ",", 
     RowBox[{"dampingFactor", "\[Rule]", "1"}], ",", 
     RowBox[{"rescaleCutoff", "\[Rule]", "Infinity"}]}], "]"}]}], 
  ";"}]], "Input",ExpressionUUID->"78e5c275-ea68-45fb-a47c-2502ebd3aecd"],

Cell[BoxData[
 RowBox[{"Tally", "[", 
  RowBox[{"Chop", "[", 
   RowBox[{"grad0", "-", 
    RowBox[{"proj1", ".", "gradient1"}]}], "]"}], 
  "]"}]], "Input",ExpressionUUID->"d18ec19d-90fd-425a-9a61-3b2aa995dfee"],

Cell[BoxData[
 RowBox[{"Tally", "[", 
  RowBox[{"Flatten", "[", 
   RowBox[{"Chop", "[", 
    RowBox[{"hess0", "-", 
     RowBox[{"proj1", ".", "hess1", ".", 
      RowBox[{"Transpose", "[", "proj1", "]"}]}]}], "]"}], "]"}], 
  "]"}]], "Input",ExpressionUUID->"6b17fa14-dedb-48db-9049-4b1da8063c65"],

Cell[BoxData[
 RowBox[{"Tally", "[", 
  RowBox[{"Chop", "[", 
   RowBox[{"Flatten", "[", 
    RowBox[{"newGaugeField", "-", "libGaugeField"}], "]"}], "]"}], 
  "]"}]], "Input",ExpressionUUID->"b9ad7d9c-633a-47da-bb20-f0a193db953e"]
}, Open  ]]
}, Closed]],

Cell[CellGroupData[{

Cell["compare lattice and link stationary point", \
"Section",ExpressionUUID->"ced7fcf1-37a7-4a9a-b384-0a391f6b2b72"],

Cell["\<\
Test single-link stationary point against the lattice-wide stationary point \
by including only single-link gradients.
Find agreement for single site and multiple -site lattices for SU(2), SU(3), \
and SU(4).

The Hessian matrix is block-diagonal in the lattice links.  However, in the \
case of the full lattice derivative, the eigenvectors may not be, if there \
are degenerate eigenvalues.  In that case, the rescaled shifts may be \
different for the full lattice.  This issue goes away if we remove the \
rescaling. \
\>", "Text",ExpressionUUID->"e68ee23a-bc60-427d-84a6-f83d4942f773"],

Cell["Create random lattice :", \
"Text",ExpressionUUID->"10649e5d-861d-4089-a858-95547fc22240"],

Cell[BoxData[
 RowBox[{
  RowBox[{"nd", "=", "3"}], ";", 
  RowBox[{"nc", "=", "3"}], ";", 
  RowBox[{"latticeDimensions", "=", 
   RowBox[{"{", 
    RowBox[{"2", ",", "2", ",", "3"}], "}"}]}], ";", 
  RowBox[{"gaugeField", "=", 
   RowBox[{"Table", "[", 
    RowBox[{
     RowBox[{"randomSUMatrix", "[", "]"}], ",", 
     RowBox[{"{", "nd", "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"latticeVolume", "[", "]"}], "}"}]}], "]"}]}], ";", 
  RowBox[{"Clear", "[", "linearSiteIndex", "]"}], ";", 
  RowBox[{"Do", "[", 
   RowBox[{
    RowBox[{
     RowBox[{"linearSiteIndex", "[", 
      RowBox[{"latticeCoordinates", "[", "i", "]"}], "]"}], "=", "i"}], ",", 
    RowBox[{"{", 
     RowBox[{"i", ",", 
      RowBox[{"latticeVolume", "[", "]"}]}], "}"}]}], "]"}], 
  ";"}]], "Input",ExpressionUUID->"a1f37b4f-4a47-4c01-9986-c60edb08cc34"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"{", 
    RowBox[{"newGaugeField", ",", "stats"}], "}"}], "=", 
   RowBox[{"latticeSaddlePoint", "[", 
    RowBox[{
     RowBox[{"maxCount", "->", "1"}], ",", 
     RowBox[{"updateGaugeField", "\[Rule]", "False"}], ",", 
     RowBox[{"makeHess0", "\[Rule]", "True"}], ",", 
     RowBox[{"rescaleCutoff", "\[Rule]", "Infinity"}]}], "]"}]}], 
  ";"}]], "Input",ExpressionUUID->"3ad08985-1c9d-4fb8-9895-b164c496849b"],

Cell[BoxData[
 RowBox[{"Dimensions", "[", 
  RowBox[{"libGaugeField", "=", 
   RowBox[{"latticeSaddlePointStep", "[", 
    RowBox[{
     RowBox[{"allLinks", "\[Rule]", "False"}], ",", 
     RowBox[{"rescaleCutoff", "\[Rule]", "Infinity"}]}], "]"}]}], 
  "]"}]], "Input",ExpressionUUID->"ef934101-694c-480b-a73f-1e43c0b81dad"],

Cell[BoxData[
 RowBox[{"Tally", "[", 
  RowBox[{"Chop", "[", 
   RowBox[{"Flatten", "[", 
    RowBox[{"libGaugeField", "-", "newGaugeField"}], "]"}], "]"}], 
  "]"}]], "Input",ExpressionUUID->"bf2cf889-68e5-4c5d-906f-f7f8d7b90b22"]
}, Closed]],

Cell[CellGroupData[{

Cell["Small perturbations", \
"Section",ExpressionUUID->"d2d2ebf6-4680-400d-9036-1bdc077963c3"],

Cell["\<\
Verify that small perturbations from a trivial lattice go back to the saddle \
point.
We see that it doesn\[CloseCurlyQuote]t converge without \
rescaleCutoff<Infinity or dampingFactor<1.  A combination works best.\
\>", "Text",ExpressionUUID->"8b6ac6f7-a0c2-4db5-a4ab-44b27ade6250"],

Cell["Create Random lattice :", \
"Text",ExpressionUUID->"121a36d4-2575-465e-b601-c3d08d752766"],

Cell[BoxData[
 RowBox[{
  RowBox[{"nd", "=", "3"}], ";", 
  RowBox[{"nc", "=", "3"}], ";", 
  RowBox[{"latticeDimensions", "=", 
   RowBox[{"{", 
    RowBox[{"2", ",", "2", ",", "1"}], "}"}]}], ";", 
  RowBox[{"makeTrivialLattice", "[", 
   RowBox[{
    RowBox[{"randomPerturbation", "\[Rule]", "0.001"}], ",", 
    RowBox[{"randomGauge", "\[Rule]", "True"}]}], "]"}], ";", 
  RowBox[{"1", "-", 
   RowBox[{
   "averagePlaquette", "[", 
    "]"}]}]}]], \
"Input",ExpressionUUID->"cff751fb-1b04-49c9-98a0-9b8832bb5a86"],

Cell["Apply one saddle-point step :", \
"Text",ExpressionUUID->"284b0cf7-e389-4496-be88-f29c3ae71452"],

Cell[BoxData[
 RowBox[{"Do", "[", 
  RowBox[{
   RowBox[{
    RowBox[{"gaugeField", "=", 
     RowBox[{"latticeSaddlePointStep", "[", 
      RowBox[{
       RowBox[{"allLinks", "\[Rule]", "False"}], ",", 
       RowBox[{"dampingFactor", "\[Rule]", "0.5"}], ",", 
       RowBox[{"rescaleCutoff", "\[Rule]", "0.001"}]}], "]"}]}], ";", 
    "\[IndentingNewLine]", 
    RowBox[{"Print", "[", 
     RowBox[{"1", "-", 
      RowBox[{"averagePlaquette", "[", "]"}]}], "]"}]}], ",", 
   RowBox[{"{", "20", "}"}]}], 
  "]"}]], "Input",ExpressionUUID->"3aeb94ad-43e1-407d-a17e-32d3ebd86a91"]
}, Closed]],

Cell[CellGroupData[{

Cell["Test ersatzLanczos[]", \
"Section",ExpressionUUID->"fcdcc68a-11ff-41be-a66e-1fc6cddb9f7a"],

Cell["\<\
Test against dense calculation using gauge configuration.  Need to understand \
errors in calculating smallest eigenvalues.\
\>", "Text",ExpressionUUID->"1e8ffd7b-8b9e-4cb6-a2df-86ce0ad89f5b"],

Cell[BoxData[
 RowBox[{"<<", 
  "\"\<../data/3-3/periodic-4-7.5-3.m\>\""}]], \
"Input",ExpressionUUID->"42c83118-af2c-4711-8a04-2e9de5e6187a"],

Cell[BoxData[
 RowBox[{"<<", 
  "\"\<../data/3-3/periodic-6-8.175-3.m\>\""}]], \
"Input",ExpressionUUID->"02e79e96-7a6a-4967-8a6b-d30828bc0530"],

Cell[BoxData[
 RowBox[{
  RowBox[{"testCutoff", "=", "2"}], 
  ";"}]], "Input",ExpressionUUID->"de393837-9c53-4f65-811a-2a6725f851a4"],

Cell[CellGroupData[{

Cell["Project into dynamic (non-gauge-transform) subspace", \
"Subsection",ExpressionUUID->"8f8f4f06-bd6f-457c-bacd-5d4b1f5d34d4"],

Cell[BoxData[
 RowBox[{
  RowBox[{"Block", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
     "hess", ",", "grad", ",", "proj", ",", "shifts", ",", "delta", ",", 
      RowBox[{"rl", "=", 
       RowBox[{"makeRootLattice", "[", "]"}]}], ",", 
      RowBox[{"fDir", "=", "0"}]}], "}"}], ",", 
    RowBox[{
     RowBox[{
      RowBox[{"{", 
       RowBox[{"hess", ",", "grad"}], "}"}], "=", 
      RowBox[{"latticeHessian", "[", 
       RowBox[{
        RowBox[{"getLink", "[", "rl", "]"}], ",", 
        RowBox[{"fixedDir", "\[Rule]", "fDir"}]}], "]"}]}], ";", 
     RowBox[{"proj", "=", 
      RowBox[{"NullSpace", "[", 
       RowBox[{"gaugeTransformShifts", "[", 
        RowBox[{"rl", ",", "fDir"}], "]"}], "]"}]}], ";", 
     RowBox[{"projHess0", "=", 
      RowBox[{"proj", ".", "hess", ".", 
       RowBox[{"Transpose", "[", "proj", "]"}]}]}], ";", 
     RowBox[{"projGrad0", "=", 
      RowBox[{"proj", ".", "grad"}]}], ";", 
     RowBox[{"proj0", "=", "proj"}], ";", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"valuesd", ",", "ood"}], "}"}], "=", 
      RowBox[{"Map", "[", 
       RowBox[{"Reverse", ",", 
        RowBox[{"Eigensystem", "[", "projHess0", "]"}]}], "]"}]}], ";", 
     RowBox[{"applyCutoff3", "[", 
      RowBox[{"valuesd", ",", 
       RowBox[{"ood", ".", "projGrad0"}], ",", 
       RowBox[{"ood", ".", "proj0"}], ",", "testCutoff"}], "]"}]}]}], "]"}], 
  ";"}]], "Input",ExpressionUUID->"713ca18d-d44b-4325-9d09-a09e4e125171"],

Cell["\<\
Compare with Lanczos.  This case is not so interesting since we cannot \
perform this projection in a sparse-matrix approach.\
\>", "Text",ExpressionUUID->"f7c48adb-8594-4396-8825-c16a8ee96f50"],

Cell[BoxData[
 RowBox[{
  RowBox[{"slice", "=", 
   RowBox[{"Min", "[", 
    RowBox[{"6", ",", 
     RowBox[{"Length", "[", "projGrad0", "]"}]}], "]"}]}], ";", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{"valuese", ",", "ooe"}], "}"}], "=", 
   RowBox[{"Map", "[", 
    RowBox[{"Reverse", ",", 
     RowBox[{"ersatzLanczos", "[", 
      RowBox[{"projHess0", ",", 
       RowBox[{"eigenPairs", "\[Rule]", 
        RowBox[{"-", "slice"}]}], ",", 
       RowBox[{"maxIterations", "\[Rule]", "1800"}], ",", 
       RowBox[{"printDetails", "\[Rule]", "True"}]}], "]"}]}], "]"}]}], ";", 
  RowBox[{"applyCutoff3", "[", 
   RowBox[{"valuese", ",", 
    RowBox[{"ooe", ".", "projGrad0"}], ",", 
    RowBox[{"ooe", ".", "proj0"}], ",", "testCutoff"}], "]"}], 
  ";"}]], "Input",ExpressionUUID->"9c9085fa-9ed5-42b3-aa34-5d9540f3012b"],

Cell[BoxData[
 RowBox[{"Norm", "[", 
  RowBox[{
   RowBox[{"Abs", "[", 
    RowBox[{
     RowBox[{"Take", "[", 
      RowBox[{"ood", ",", "slice"}], "]"}], ".", 
     RowBox[{"Transpose", "[", 
      RowBox[{"Take", "[", 
       RowBox[{"ooe", ",", "slice"}], "]"}], "]"}]}], "]"}], "-", 
   RowBox[{"IdentityMatrix", "[", "slice", "]"}]}], 
  "]"}]], "Input",ExpressionUUID->"d824ef60-0bec-4d73-8a9e-daa866b172e2"],

Cell[BoxData[
 RowBox[{"Norm", "[", 
  RowBox[{
   RowBox[{"Take", "[", 
    RowBox[{"valuesd", ",", "slice"}], "]"}], "-", 
   RowBox[{"Take", "[", 
    RowBox[{"valuese", ",", "slice"}], "]"}]}], 
  "]"}]], "Input",ExpressionUUID->"df33284e-0565-4193-9308-5f4f4939c64c"],

Cell[BoxData[
 RowBox[{"Norm", "[", 
  RowBox[{
   RowBox[{"ooe", ".", 
    RowBox[{"Transpose", "[", "ooe", "]"}]}], "-", 
   RowBox[{"IdentityMatrix", "[", 
    RowBox[{"Length", "[", "valuese", "]"}], "]"}]}], 
  "]"}]], "Input",ExpressionUUID->"e44d4afc-0b23-429a-8548-c7ac91e83128"]
}, Open  ]],

Cell[CellGroupData[{

Cell["Use full space with projection operator.", \
"Subsection",ExpressionUUID->"58f2de4b-193a-436b-907c-e74092213992"],

Cell["\<\
In this case, the nullspace of the projection operator is included in the \
eigensystem.\
\>", "Text",ExpressionUUID->"29253b9a-63cc-40cc-9df8-6d8adb3e1a04"],

Cell[BoxData[
 RowBox[{
  RowBox[{"Block", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
     "hess", ",", "grad", ",", "proj", ",", "shifts", ",", "delta", ",", 
      RowBox[{"rl", "=", 
       RowBox[{"makeRootLattice", "[", "]"}]}], ",", 
      RowBox[{"fDir", "=", "0"}]}], "}"}], ",", 
    RowBox[{
     RowBox[{
      RowBox[{"{", 
       RowBox[{"hess", ",", "grad"}], "}"}], "=", 
      RowBox[{"latticeHessian", "[", 
       RowBox[{
        RowBox[{"getLink", "[", "rl", "]"}], ",", 
        RowBox[{"fixedDir", "\[Rule]", "fDir"}]}], "]"}]}], ";", 
     RowBox[{"proj", "=", 
      RowBox[{"NullSpace", "[", 
       RowBox[{"gaugeTransformShifts", "[", 
        RowBox[{"rl", ",", "fDir"}], "]"}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"proj", "=", 
      RowBox[{
       RowBox[{"Transpose", "[", "proj", "]"}], ".", "proj"}]}], ";", 
     RowBox[{"projHess00", "=", 
      RowBox[{"proj", ".", "hess", ".", "proj"}]}], ";", 
     RowBox[{"projGrad00", "=", 
      RowBox[{"proj", ".", "grad"}]}], ";", 
     RowBox[{"proj00", "=", "proj"}], ";", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"valuesdd", ",", "oodd"}], "}"}], "=", 
      RowBox[{"Map", "[", 
       RowBox[{"Reverse", ",", 
        RowBox[{"Eigensystem", "[", "projHess00", "]"}]}], "]"}]}], ";", 
     RowBox[{"applyCutoff3", "[", 
      RowBox[{"valuesdd", ",", 
       RowBox[{"oodd", ".", "projGrad00"}], ",", 
       RowBox[{"oodd", ".", "proj00"}], ",", "testCutoff"}], "]"}]}]}], "]"}],
   ";"}]], "Input",ExpressionUUID->"46c08f3c-a26f-4a6d-8b8d-25f66411f89d"],

Cell["\<\
With the Krylov method, we never access the nullspace of the projection \
operator.  Without explicitly projecting out the nullspace, it looks like \
Lanczos will wander into the nullspace.  Perhaps the stopping criteria needs \
to be tuned?\
\>", "Text",ExpressionUUID->"9463f2c3-e538-4fcd-bbe8-6bf58ad94f59"],

Cell[BoxData[
 RowBox[{
  RowBox[{"slicee", "=", 
   RowBox[{"Min", "[", 
    RowBox[{"6", ",", 
     RowBox[{"Length", "[", "projGrad00", "]"}]}], "]"}]}], ";", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{"valuesee", ",", "ooee"}], "}"}], "=", 
   RowBox[{"Map", "[", 
    RowBox[{"Reverse", ",", 
     RowBox[{"ersatzLanczos", "[", 
      RowBox[{"projHess00", ",", 
       RowBox[{"eigenPairs", "\[Rule]", 
        RowBox[{"-", "slicee"}]}], ",", 
       RowBox[{"maxIterations", "\[Rule]", "3000"}], ",", 
       RowBox[{"printDetails", "\[Rule]", "True"}], ",", 
       RowBox[{"initialVector", "\[Rule]", "projGrad00"}], ",", 
       RowBox[{"orthoSubspace", " ", "\[Rule]", " ", 
        RowBox[{"(", 
         RowBox[{
          RowBox[{"(", 
           RowBox[{"proj00", ".", "#"}], ")"}], "&"}], ")"}]}]}], "]"}]}], 
    "]"}]}], ";", 
  RowBox[{"applyCutoff3", "[", 
   RowBox[{"valuesee", ",", 
    RowBox[{"ooee", ".", "projGrad00"}], ",", 
    RowBox[{"ooee", ".", "proj00"}], ",", "testCutoff"}], "]"}], 
  ";"}]], "Input",ExpressionUUID->"4a27c6db-8f03-4367-8a79-4becb69b9bc8"],

Cell[BoxData[
 RowBox[{"Norm", "[", 
  RowBox[{
   RowBox[{"Abs", "[", 
    RowBox[{
     RowBox[{"Take", "[", 
      RowBox[{
       RowBox[{"ood", ".", "proj0"}], ",", "slicee"}], "]"}], ".", 
     RowBox[{"Transpose", "[", 
      RowBox[{"Take", "[", 
       RowBox[{"ooee", ",", "slicee"}], "]"}], "]"}]}], "]"}], "-", 
   RowBox[{"IdentityMatrix", "[", "slicee", "]"}]}], 
  "]"}]], "Input",ExpressionUUID->"eced5048-14b7-49d0-994c-aa11673a0efb"],

Cell[BoxData[
 RowBox[{"Norm", "[", 
  RowBox[{
   RowBox[{"Take", "[", 
    RowBox[{"valuesd", ",", "slicee"}], "]"}], "-", 
   RowBox[{"Take", "[", 
    RowBox[{"valuesee", ",", "slicee"}], "]"}]}], 
  "]"}]], "Input",ExpressionUUID->"8313f522-e19d-446c-aa25-954274ab37f9"],

Cell[BoxData[
 RowBox[{"Norm", "[", 
  RowBox[{
   RowBox[{"ooee", ".", 
    RowBox[{"Transpose", "[", "ooee", "]"}]}], "-", 
   RowBox[{"IdentityMatrix", "[", 
    RowBox[{"Length", "[", "valuesee", "]"}], "]"}]}], 
  "]"}]], "Input",ExpressionUUID->"be850030-f405-42dc-b183-42bd2b9e5c0e"]
}, Open  ]]
}, Closed]],

Cell[CellGroupData[{

Cell["Compare MINRES/MINRES-QLP versus dense, no cutoff.", \
"Section",ExpressionUUID->"25560db5-08ba-4d34-aeef-0960426da3ce"],

Cell[BoxData[
 RowBox[{"<<", 
  "\"\<../data/3-3/periodic-4-7.5-3.m\>\""}]], \
"Input",ExpressionUUID->"5b561796-b3a3-49b1-a7dd-d4f6a59fa732"],

Cell[" Choose method:", \
"Text",ExpressionUUID->"cf4bc892-1a73-4fb9-b62f-6918231f7993"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"Print", "[", 
   RowBox[{"Keys", "[", "minresLabels", "]"}], "]"}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{"minresMethod", "=", 
  RowBox[{
   RowBox[{"Keys", "[", "minresLabels", "]"}], "[", 
   RowBox[{"[", "1", "]"}], 
   "]"}]}]}], "Input",ExpressionUUID->"cfff3048-0ad8-4d05-abcb-564d85ef344a"],

Cell[CellGroupData[{

Cell["Dynamic/All", \
"Subsection",ExpressionUUID->"80597020-d0fe-4d53-a1b6-14a999f4b157"],

Cell[BoxData[
 RowBox[{
  RowBox[{"gaugeFieldAllDense", "=", 
   RowBox[{"latticeSaddlePointStep", "[", 
    RowBox[{
     RowBox[{"storePairs", "\[Rule]", "True"}], ",", 
     RowBox[{"rescaleCutoff", "\[Rule]", "Infinity"}], ",", 
     RowBox[{"fixedDir", "\[Rule]", 
      RowBox[{"-", "1"}]}]}], "]"}]}], 
  ";"}]], "Input",ExpressionUUID->"6b957c4f-5b3a-4f48-b0dd-965728963678"],

Cell[BoxData[
 RowBox[{
  RowBox[{"gaugeFieldDynamicDense", "=", 
   RowBox[{"latticeSaddlePointStep", "[", 
    RowBox[{
     RowBox[{"storePairs", "\[Rule]", "True"}], ",", 
     RowBox[{"rescaleCutoff", "\[Rule]", "Infinity"}], ",", 
     RowBox[{"fixedDir", "\[Rule]", "0"}]}], "]"}]}], 
  ";"}]], "Input",ExpressionUUID->"30928d76-8453-4ae7-8a53-b6a6326c9514"],

Cell["\<\
For projecting out the gauge transforms on a Nc=3, 4^3 lattice:
247 seconds for solving squared system using conjugate gradients.
67 seconds for default (dense?) LeastSquares
83 seconds for  LeastSquares Krylov method (tol=Automatic).
515 seconds for LeastSquares Krylov, tolerance=0.01
365 seconds for LeastSquares Krylov, tolerance=100\
\>", "Text",ExpressionUUID->"ee14b917-d38b-4055-afba-f99d19388eac"],

Cell[BoxData[
 RowBox[{
  RowBox[{"gaugeFieldAllMinres", "=", 
   RowBox[{"latticeSaddlePointStep", "[", 
    RowBox[{
     RowBox[{"storePairs", "\[Rule]", "True"}], ",", 
     RowBox[{"rescaleCutoff", "\[Rule]", "Infinity"}], ",", 
     RowBox[{"fixedDir", "\[Rule]", 
      RowBox[{"-", "1"}]}], ",", 
     RowBox[{"Method", "\[Rule]", 
      RowBox[{"{", 
       RowBox[{"minresMethod", ",", 
        RowBox[{"printDetails", "\[Rule]", "False"}]}], "}"}]}]}], "]"}]}], 
  ";"}]], "Input",ExpressionUUID->"694c320b-dc84-4144-ab9e-09d1ea7decf6"],

Cell[BoxData[
 RowBox[{
  RowBox[{"gaugeFieldDynamicMinres", "=", 
   RowBox[{"latticeSaddlePointStep", "[", 
    RowBox[{
     RowBox[{"storePairs", "\[Rule]", "True"}], ",", 
     RowBox[{"rescaleCutoff", "\[Rule]", "Infinity"}], ",", 
     RowBox[{"fixedDir", "\[Rule]", "0"}], ",", 
     RowBox[{"dynamicPartMethod", "\[Rule]", 
      RowBox[{"{", 
       RowBox[{"\"\<MINRES\>\"", ",", 
        RowBox[{"rTolerance", "\[Rule]", 
         RowBox[{"10", "^", 
          RowBox[{"-", "13"}]}]}]}], "}"}]}], ",", 
     RowBox[{"Method", "\[Rule]", 
      RowBox[{"{", 
       RowBox[{"minresMethod", ",", 
        RowBox[{"printDetails", "\[Rule]", "False"}]}], "}"}]}]}], "]"}]}], 
  ";"}]], "Input",ExpressionUUID->"58fde015-7816-4ca8-9c3f-55150f46891e"],

Cell[BoxData[
 RowBox[{"Tally", "[", 
  RowBox[{"Chop", "[", 
   RowBox[{
    RowBox[{"Flatten", "[", 
     RowBox[{"gaugeFieldAllDense", "-", "gaugeFieldAllMinres"}], "]"}], ",", 
    RowBox[{"10", "^", 
     RowBox[{"-", "8"}]}]}], "]"}], 
  "]"}]], "Input",ExpressionUUID->"c32d2981-d314-4ea6-8eba-66044580ec02"],

Cell[BoxData[
 RowBox[{"Tally", "[", 
  RowBox[{"Chop", "[", 
   RowBox[{
    RowBox[{"Flatten", "[", 
     RowBox[{"gaugeFieldDynamicDense", "-", "gaugeFieldDynamicMinres"}], 
     "]"}], ",", 
    RowBox[{"5", " ", 
     RowBox[{"10", "^", 
      RowBox[{"-", "7"}]}]}]}], "]"}], 
  "]"}]], "Input",ExpressionUUID->"4d0fcbf4-c322-4d6e-8ce7-14b70baa94ff"]
}, Closed]],

Cell[CellGroupData[{

Cell["Axial", \
"Subsection",ExpressionUUID->"32dec57f-e017-4c52-bdc7-5dcd64d3eadc"],

Cell["Compare for the Axial-constant shifts", \
"Text",ExpressionUUID->"f3fc5478-c0c9-4ff3-88de-e5077ce3395d"],

Cell[BoxData[
 RowBox[{
  RowBox[{"axialDirection", "=", "2"}], ";", 
  RowBox[{"setAxialGauge", "[", "axialDirection", "]"}], ";", 
  RowBox[{"gaugeFieldAxialDense1", "=", 
   RowBox[{"latticeSaddlePointStep", "[", 
    RowBox[{
     RowBox[{"storePairs", "\[Rule]", "True"}], ",", 
     RowBox[{"rescaleCutoff", "\[Rule]", "Infinity"}], ",", 
     RowBox[{"fixedDir", "\[Rule]", "axialDirection"}]}], "]"}]}], 
  ";"}]], "Input",ExpressionUUID->"f2b1f822-1b31-4cc7-a1ae-c2d256652ac8"],

Cell[BoxData[
 RowBox[{
  RowBox[{"gaugeFieldAxialMinres1", "=", 
   RowBox[{"latticeSaddlePointStep", "[", 
    RowBox[{
     RowBox[{"storePairs", "\[Rule]", "True"}], ",", 
     RowBox[{"rescaleCutoff", "\[Rule]", "Infinity"}], ",", 
     RowBox[{"fixedDir", "\[Rule]", "axialDirection"}], ",", 
     RowBox[{"Method", "\[Rule]", "minresMethod"}], ",", 
     RowBox[{"dynamicPartMethod", "\[Rule]", 
      RowBox[{"{", 
       RowBox[{"\"\<MINRES\>\"", ",", 
        RowBox[{"rTolerance", "\[Rule]", 
         RowBox[{"10", "^", 
          RowBox[{"-", "13"}]}]}]}], "}"}]}]}], "]"}]}], 
  ";"}]], "Input",ExpressionUUID->"956cf06d-1e62-4d8f-9187-46aa5cbe7e7e"],

Cell[BoxData[
 RowBox[{"Tally", "[", 
  RowBox[{"Chop", "[", 
   RowBox[{
    RowBox[{"Flatten", "[", 
     RowBox[{"gaugeFieldAxialDense1", "-", "gaugeFieldAxialMinres1"}], "]"}], 
    ",", 
    RowBox[{"10", "^", 
     RowBox[{"-", "7"}]}]}], "]"}], 
  "]"}]], "Input",ExpressionUUID->"97eefe67-1b34-48cb-b39d-50517408c971"]
}, Closed]]
}, Closed]],

Cell[CellGroupData[{

Cell["Compare MINRES/MINRES-QLP versus dense", \
"Section",ExpressionUUID->"7f154c8b-cbe7-44d7-af10-ff3bf3798fa1"],

Cell["\<\
MINRES/MINRES-QLP with special handling of large shift eigenvalues, compared \
to dense calculation.\
\>", "Text",ExpressionUUID->"f5649d56-9f91-4dbe-8f11-6bba4f25a082"],

Cell[BoxData[
 RowBox[{"<<", 
  "\"\<../data/3-3/periodic-4-7.5-3.m\>\""}]], \
"Input",ExpressionUUID->"dc4b39c9-5ae3-4f1e-a16f-c9ab54be90fd"],

Cell[BoxData[
 RowBox[{"<<", 
  "\"\<../data/3-3/periodic-6-8.175-3.m\>\""}]], \
"Input",ExpressionUUID->"d981ba60-d35e-4254-901a-4955628570dd"],

Cell[BoxData[
 RowBox[{"<<", 
  "\"\<../data/3-3/periodic-8-9-3.m\>\""}]], \
"Input",ExpressionUUID->"8d7171c1-6809-40ee-840b-21d5ca1aaf6e"],

Cell["Create random lattice :", \
"Text",ExpressionUUID->"9423ff30-cb04-4ae2-a15a-53b919221844"],

Cell[BoxData[
 RowBox[{
  RowBox[{"nd", "=", "3"}], ";", 
  RowBox[{"nc", "=", "2"}], ";", 
  RowBox[{"latticeDimensions", "=", 
   RowBox[{"{", 
    RowBox[{"2", ",", "2", ",", "5"}], "}"}]}], ";", 
  RowBox[{"gaugeField", "=", 
   RowBox[{"Table", "[", 
    RowBox[{
     RowBox[{"randomSUMatrix", "[", "]"}], ",", 
     RowBox[{"{", "nd", "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"latticeVolume", "[", "]"}], "}"}]}], "]"}]}], ";", 
  RowBox[{"Clear", "[", "linearSiteIndex", "]"}], ";", 
  RowBox[{"Do", "[", 
   RowBox[{
    RowBox[{
     RowBox[{"linearSiteIndex", "[", 
      RowBox[{"latticeCoordinates", "[", "i", "]"}], "]"}], "=", "i"}], ",", 
    RowBox[{"{", 
     RowBox[{"i", ",", 
      RowBox[{"latticeVolume", "[", "]"}]}], "}"}]}], "]"}], ";", 
  RowBox[{
  "averagePlaquette", "[", 
   "]"}]}]], "Input",ExpressionUUID->"3567b284-0a38-49b4-985c-4c06a4bfd03d"],

Cell[CellGroupData[{

Cell["Dynamic", \
"Subsection",ExpressionUUID->"0157dcfb-63cf-4b2e-bde1-4c021871fcb5"],

Cell["\<\
nd=3, nc=3, 12^3 crashes kernel, but nc=3, 8^3 works.

8^3 lattice 48 large shifts, need 127 N=8192, dense is 7 minutes.
trnlaso is 25 minutes.  Error is 4*10^-5.\
\>", "Text",ExpressionUUID->"e368b91a-a8b2-4807-ab42-1938cb220188"],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"{", 
    RowBox[{"gaugeFieldDynamicDense", ",", "shiftsDynamicDense"}], "}"}], "=", 
   RowBox[{"Take", "[", 
    RowBox[{
     RowBox[{"latticeSaddlePointStep", "[", 
      RowBox[{
       RowBox[{"fullMatrix", "\[Rule]", "True"}], ",", " ", 
       RowBox[{"returnShifts", "\[Rule]", "True"}]}], "]"}], ",", "2"}], 
    "]"}]}], ";"}]], \
"Input",ExpressionUUID->"536f9c31-c58c-453e-97fa-7a674202e049"],

Cell[CellGroupData[{

Cell[BoxData["\<\"Constructed hess, grad\"\>"], \
"Print",ExpressionUUID->"fbc0794f-f1b5-4305-a11e-8469361b3eb3"],

Cell[BoxData["\<\"Constructed gauge\"\>"], \
"Print",ExpressionUUID->"93e3762c-62af-4937-baf8-967db5ed38da"],

Cell[BoxData[
 InterpretationBox[
  RowBox[{"\<\"applyCutoff3:  \"\>", "\[InvisibleSpace]", "14", 
   "\[InvisibleSpace]", "\<\" of \"\>", "\[InvisibleSpace]", "1024", 
   "\[InvisibleSpace]", "\<\" zeros, between \"\>", "\[InvisibleSpace]", 
   RowBox[{"{", 
    RowBox[{"994", ",", "1024"}], "}"}]}],
  SequenceForm[
  "applyCutoff3:  ", 14, " of ", 1024, " zeros, between ", {994, 1024}],
  Editable->
   False]], "Print",ExpressionUUID->"229932b1-8705-46f4-83e8-4fc47401b37a"],

Cell[BoxData[
 InterpretationBox[
  RowBox[{"\<\"shifts norms and rescale:  \"\>", "\[InvisibleSpace]", 
   RowBox[{"{", 
    RowBox[{
    "8.32015188792758`", ",", "58.559023610526275`", ",", 
     "0.9999999999997425`"}], "}"}]}],
  SequenceForm[
  "shifts norms and rescale:  ", {8.32015188792758, 58.559023610526275`, 
   0.9999999999997425}],
  Editable->
   False]], "Print",ExpressionUUID->"47066b3f-1a70-4f71-97e3-750aecbeb34d"],

Cell[BoxData[
 InterpretationBox[
  RowBox[{"\<\"applyCutoff2: rescale maxNorm \"\>", "\[InvisibleSpace]", 
   "8.32015188792758`", "\[InvisibleSpace]", "\<\" to \"\>", 
   "\[InvisibleSpace]", "2"}],
  SequenceForm["applyCutoff2: rescale maxNorm ", 8.32015188792758, " to ", 2],
  
  Editable->
   False]], "Print",ExpressionUUID->"18d274a4-0146-4a18-9207-9f5e3c455840"],

Cell[BoxData[
 InterpretationBox[
  RowBox[{"\<\"latticeSaddlePointStep times:\\n    matrices=\"\>", 
   "\[InvisibleSpace]", "1.443618`6.3099672863288685", 
   "\[InvisibleSpace]", "\<\" s, findDelta=\"\>", "\[InvisibleSpace]", 
   "1.019141`6.15874927142206", 
   "\[InvisibleSpace]", "\<\" s, applyDelta=\"\>", "\[InvisibleSpace]", 
   "0.016481`4.367498557214083", "\[InvisibleSpace]", "\<\" s\"\>"}],
  SequenceForm[
  "latticeSaddlePointStep times:\n    matrices=", 1.443618`6.3099672863288685,
    " s, findDelta=", 1.019141`6.15874927142206, " s, applyDelta=", 
   0.016481`4.367498557214083, " s"],
  Editable->
   False]], "Print",ExpressionUUID->"472ec05e-1cd0-4c14-8fe5-a8911c75d983"]
}, Open  ]]
}, Open  ]],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"{", 
    RowBox[{"gaugeFieldDynamicMinres1", ",", "shiftsDynamicMinres1"}], "}"}], 
   "=", 
   RowBox[{"Take", "[", 
    RowBox[{
     RowBox[{"latticeSaddlePointStep", "[", 
      RowBox[{
       RowBox[{"fullMatrix", "\[Rule]", "True"}], ",", 
       RowBox[{"dynamicPartMethod", "\[Rule]", 
        RowBox[{"{", 
         RowBox[{"\"\<MINRES\>\"", ",", 
          RowBox[{"rTolerance", "\[Rule]", 
           RowBox[{"10.0", "^", 
            RowBox[{"-", "10"}]}]}], ",", 
          RowBox[{"printDetails", "\[Rule]", "False"}]}], "}"}]}], ",", 
       RowBox[{"largeShiftOptions", "\[Rule]", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"eigenPairs", "\[Rule]", 
           RowBox[{"-", "130"}]}], ",", 
          RowBox[{"maxIterations", "\[Rule]", "5000"}], ",", 
          RowBox[{"innerInterval", "\[Rule]", "10"}], ",", 
          RowBox[{"rTolerance", "\[Rule]", 
           RowBox[{"10.0", "^", 
            RowBox[{"-", "7"}]}]}], ",", 
          RowBox[{"printDetails", "\[Rule]", "1"}], ",", " ", 
          RowBox[{"printsPerDecade", " ", "\[Rule]", " ", "10"}], ",", 
          RowBox[{"restartLanczos", "\[Rule]", "False"}]}], "}"}]}], ",", 
       RowBox[{"Method", "\[Rule]", "\"\<MINRES\>\""}], ",", " ", 
       RowBox[{"returnShifts", "\[Rule]", "True"}]}], "]"}], ",", "2"}], 
    "]"}]}], ";"}]], \
"Input",ExpressionUUID->"51486604-b351-4829-8733-5524265d7cc1"],

Cell[BoxData[
 RowBox[{"compareVectors", "[", 
  RowBox[{"shiftsDynamicDense", ",", "shiftsDynamicMinres1"}], 
  "]"}]], "Input",ExpressionUUID->"df89957d-d859-40c2-8af5-4495bb1f1ffb"],

Cell[BoxData[
 RowBox[{
  RowBox[{"Norm", "[", 
   RowBox[{"Flatten", "[", 
    RowBox[{"gaugeFieldDynamicDense", "-", "gaugeFieldDynamicMinres1"}], 
    "]"}], "]"}], "/", 
  RowBox[{"Norm", "[", 
   RowBox[{"Flatten", "[", "gaugeFieldDynamicDense", "]"}], 
   "]"}]}]], "Input",ExpressionUUID->"b14e750e-ca64-4747-8fa4-d15d8a90e9d2"],

Cell["For small systems, strategy = 3 or 4 is better.", \
"Text",ExpressionUUID->"cf331d89-2a60-4e76-9311-abdc1e01fa9a"],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"{", 
    RowBox[{"gaugeFieldDynamicMinres2", ",", "shiftsDynamicMinres2"}], "}"}], 
   "=", 
   RowBox[{"Take", "[", 
    RowBox[{
     RowBox[{"latticeSaddlePointStep", "[", 
      RowBox[{
       RowBox[{"dynamicPartMethod", "\[Rule]", 
        RowBox[{"{", 
         RowBox[{"Automatic", ",", 
          RowBox[{"maxLanczosVecs", "\[Rule]", "1200"}], ",", 
          RowBox[{"maxIterations", "\[Rule]", 
           RowBox[{"400", "*", "1000"}]}], ",", 
          RowBox[{"rTolerance", "\[Rule]", 
           RowBox[{"10.0", "^", 
            RowBox[{"-", "9"}]}]}], ",", 
          RowBox[{"printDetails", "\[Rule]", "1"}]}], "}"}]}], ",", 
       RowBox[{"largeShiftOptions", "\[Rule]", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"eigenPairs", "\[Rule]", 
           RowBox[{"-", "40"}]}], ",", 
          RowBox[{"maxIterations", "\[Rule]", 
           RowBox[{"100", "*", "1000"}]}], ",", 
          RowBox[{"maxLanczosVecs", "\[Rule]", "1200"}], ",", 
          RowBox[{"restartStrategy", "\[Rule]", "7"}], ",", 
          RowBox[{"rTolerance", "\[Rule]", 
           RowBox[{"10.0", "^", 
            RowBox[{"-", "8"}]}]}], ",", 
          RowBox[{"printDetails", "\[Rule]", "1"}]}], "}"}]}], ",", 
       RowBox[{"Method", "\[Rule]", 
        RowBox[{"{", 
         RowBox[{"\"\<External\>\"", ",", 
          RowBox[{"printDetails", "\[Rule]", "1"}], ",", " ", 
          RowBox[{"rTolerance", " ", "\[Rule]", " ", 
           RowBox[{"10.0", "^", 
            RowBox[{"-", "9"}]}]}], ",", 
          RowBox[{"maxLanczosVecs", "\[Rule]", "1200"}]}], "}"}]}], ",", 
       RowBox[{"externalAction", "\[Rule]", "\"\<remote\>\""}], ",", 
       RowBox[{"remoteHost", "\[Rule]", "\"\<localhost\>\""}], ",", 
       RowBox[{"printDetails", "\[Rule]", "2"}], ",", " ", 
       RowBox[{"processes", "\[Rule]", "2"}], ",", 
       RowBox[{"threads", "\[Rule]", "2"}], ",", 
       RowBox[{"returnShifts", "\[Rule]", "True"}]}], "]"}], ",", "2"}], 
    "]"}]}], ";"}]], \
"Input",ExpressionUUID->"59dbc176-9bfa-437d-861f-c9020524c00e"],

Cell[CellGroupData[{

Cell[BoxData[
 StyleBox["\<\"MAXLAN:      1200, Restart:         4,   NED: -       1,      \
NEC:         1\\nMATVEC:       128,  Reorth:       128, Nloop:         1,  \
Nlocked:         0\\nTtotal:  0.045307,    T_op:  0.018685, Torth:  0.004136, \
  Tstart:  0.001299\\nGauge matrix extreme eigenvalues found:\\n  \
1.130975e+00\\nMAXLAN:      1200, Restart:         7,   NED: -      40,      \
NEC:        40\\nMATVEC:      2281,  Reorth:      2281, Nloop:        40,  \
Nlocked:        10\\nTtotal: 39.451176,    T_op: 33.321293, Torth:  4.786484, \
  Tstart:  1.139117\\nlargeShifts: ops=2281, sumNcol=2281, \
maxNcol=1\\nlargeShifts: 2281 matrix-vector ops, 2281 reorthogonalizations in \
13.32 s\\ncutoffNullSpace:  14 of 40 zeros between [0, 30]\\nlinearSolve:  \
460 iterations, 460 reorthogonalizations in 1.48 s\\ndynamicProject:  7767 \
calls (7122 usertol), 146149 matrix-vector ops, max itn 29\\n                 \
in 13.25 s\\nMatrix hessian ops=5026, localTime=0.58 s, mpiTime=0.12 s\\n    \
global 2.8 GFLOP/s, stream=12.7 GB/s\\nMatrix gauge ops=185112, \
localTime=4.01 s, mpiTime=1.60 s\\n    global 2.3 GFLOP/s, stream=10.5 \
GB/s\\nMatrix gaugeT ops=185112, localTime=3.86 s, mpiTime=0.67 s\\n    \
global 2.4 GFLOP/s, stream=11.3 GB/s\\nshifts.c:  init and i/o 0.13 s, \
calculation 14.83 s\\n\"\>",
  StripOnInput->False,
  FontColor->RGBColor[
   0, 0, 1]]], "Print",ExpressionUUID->"16c42475-4921-4e0d-8f70-848f4f9baefd"],

Cell[BoxData[
 StyleBox["\<\"[jepthah:28273] MCW rank 0 is not bound (or bound to all \
available processors)\\n[jepthah:28273] MCW rank 1 is not bound (or bound to \
all available processors)\\n\"\>",
  StripOnInput->False,
  FontColor->RGBColor[
   1, 0, 0]]], "Print",ExpressionUUID->"adb2b551-4574-4bf3-a748-e0de50f6addb"],

Cell[BoxData[
 InterpretationBox[
  RowBox[{"\<\"applyCutoff2: rescale maxNorm \"\>", "\[InvisibleSpace]", 
   "8.32014855106824910328200089861124072808`17.07986503970809", 
   "\[InvisibleSpace]", "\<\" to \"\>", "\[InvisibleSpace]", "2"}],
  SequenceForm[
  "applyCutoff2: rescale maxNorm ", 
   8.32014855106824910328200089861124072808`17.07986503970809, " to ", 2],
  Editable->
   False]], "Print",ExpressionUUID->"9597ba4b-c3b9-4d91-8c2c-b6856e3f6973"],

Cell[BoxData[
 InterpretationBox[
  RowBox[{"\<\"latticeSaddlePointStep times:\\n    matrices=\"\>", 
   "\[InvisibleSpace]", "0.970455`6.1374903997874", 
   "\[InvisibleSpace]", "\<\" s, findDelta=\"\>", "\[InvisibleSpace]", 
   "16.916106`7.378815395699079", 
   "\[InvisibleSpace]", "\<\" s, applyDelta=\"\>", "\[InvisibleSpace]", 
   "0.126744`5.253442407032093", "\[InvisibleSpace]", "\<\" s\"\>"}],
  SequenceForm[
  "latticeSaddlePointStep times:\n    matrices=", 0.970455`6.1374903997874, 
   " s, findDelta=", 16.916106`7.378815395699079, " s, applyDelta=", 
   0.126744`5.253442407032093, " s"],
  Editable->
   False]], "Print",ExpressionUUID->"eb996327-bdb8-411f-8482-a876b05afbe3"]
}, Open  ]]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"compareVectors", "[", 
  RowBox[{"shiftsDynamicDense", ",", "shiftsDynamicMinres2"}], 
  "]"}]], "Input",ExpressionUUID->"2df85535-385f-4fa1-93b1-a3903424b227"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{"8.320150219497915`", ",", 
     RowBox[{"-", "4.01057662635651`*^-7"}]}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"58.559023911833734`", ",", "1.029072682623422`*^-8"}], "}"}], 
   ",", 
   RowBox[{"{", 
    RowBox[{"0.9999999999996496`", ",", "8.371217194310968`*^-7"}], "}"}]}], 
  "}"}]], "Output",ExpressionUUID->"5c58afc7-68f2-41d9-9302-8dc4dfa4fcf1"]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{
  RowBox[{"Norm", "[", 
   RowBox[{"Flatten", "[", 
    RowBox[{"gaugeFieldDynamicDense", "-", "gaugeFieldDynamicMinres2"}], 
    "]"}], "]"}], "/", 
  RowBox[{"Norm", "[", 
   RowBox[{"Flatten", "[", "gaugeFieldDynamicDense", "]"}], 
   "]"}]}]], "Input",ExpressionUUID->"8d94fb95-f783-4054-b203-691917ab9a82"],

Cell[BoxData["3.816325402357627`*^-7"], \
"Output",ExpressionUUID->"04bdc6db-e927-461f-9198-01b84933d838"]
}, Open  ]]
}, Open  ]],

Cell[CellGroupData[{

Cell["Axial", \
"Subsection",ExpressionUUID->"b590c957-6eec-4a4d-aef2-abd87409c9b1"],

Cell[BoxData[
 RowBox[{
  RowBox[{"axialDirection", "=", "2"}], ";", 
  RowBox[{"setAxialGauge", "[", "axialDirection", "]"}], ";", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{"gaugeFieldAxialDense", ",", "shiftsAxialDense"}], "}"}], "=", 
   RowBox[{"latticeSaddlePointStep", "[", 
    RowBox[{
     RowBox[{"storePairs", "\[Rule]", "True"}], ",", 
     RowBox[{"fixedDir", "\[Rule]", "axialDirection"}], ",", 
     RowBox[{"returnShifts", "\[Rule]", "True"}]}], "]"}]}], 
  ";"}]], "Input",ExpressionUUID->"27031bc6-d002-4f25-97cb-dc127f58d7b9"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"{", 
    RowBox[{"gaugeFieldAxialMinres1", ",", "shiftsAxialMinres1"}], "}"}], "=", 
   RowBox[{"latticeSaddlePointStep", "[", 
    RowBox[{
     RowBox[{"storePairs", "\[Rule]", "True"}], ",", 
     RowBox[{"fixedDir", "\[Rule]", "axialDirection"}], ",", 
     RowBox[{"Method", "\[Rule]", "\"\<MINRES\>\""}], ",", 
     RowBox[{"largeShiftOptions", "\[Rule]", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"eigenPairs", "\[Rule]", 
         RowBox[{"-", "100"}]}], ",", 
        RowBox[{"maxIterations", "\[Rule]", "5000"}], ",", 
        RowBox[{"innerInterval", "\[Rule]", "10"}], ",", 
        RowBox[{"printDetails", "\[Rule]", "True"}]}], "}"}]}], ",", 
     RowBox[{"dynamicPartMethod", "\[Rule]", 
      RowBox[{"{", 
       RowBox[{"\"\<MINRES\>\"", ",", 
        RowBox[{"rTolerance", "\[Rule]", 
         RowBox[{"10.0", "^", 
          RowBox[{"-", "7"}]}]}], ",", 
        RowBox[{"printDetails", "\[Rule]", "False"}]}], "}"}]}], ",", 
     RowBox[{"debugProj", "\[Rule]", "False"}], ",", 
     RowBox[{"returnShifts", "\[Rule]", "True"}]}], "]"}]}], 
  ";"}]], "Input",ExpressionUUID->"e1c1e35e-adf6-450a-ba7c-246e4d956c9f"],

Cell[BoxData[
 RowBox[{"compareVectors", "[", 
  RowBox[{"shiftsAxialDense", ",", "shiftsAxialMinres1"}], 
  "]"}]], "Input",ExpressionUUID->"62d31c02-62c7-436d-bc9d-3755c64e0057"],

Cell[BoxData[
 RowBox[{"Norm", "[", 
  RowBox[{"Flatten", "[", 
   RowBox[{"gaugeFieldAxialDense", "-", "gaugeFieldAxialMinres1"}], "]"}], 
  "]"}]], "Input",ExpressionUUID->"1e463af5-48f3-4f10-b4cc-49f803f86f7c"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"{", 
    RowBox[{"gaugeFieldAxialMinres2", ",", "shiftsAxialMinres2"}], "}"}], "=", 
   RowBox[{"latticeSaddlePointStep", "[", 
    RowBox[{
     RowBox[{"storePairs", "\[Rule]", "True"}], ",", 
     RowBox[{"fixedDir", "\[Rule]", "axialDirection"}], ",", 
     RowBox[{"dynamicPartMethod", "\[Rule]", 
      RowBox[{"{", 
       RowBox[{"Automatic", ",", 
        RowBox[{"maxLanczosVecs", "\[Rule]", "1000"}], ",", 
        RowBox[{"maxIterations", "\[Rule]", 
         RowBox[{"400", "*", "1000"}]}], ",", 
        RowBox[{"rTolerance", "\[Rule]", 
         RowBox[{"10.0", "^", 
          RowBox[{"-", "9"}]}]}], ",", 
        RowBox[{"printDetails", "\[Rule]", "2"}]}], "}"}]}], ",", 
     RowBox[{"largeShiftOptions", "\[Rule]", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"eigenPairs", "\[Rule]", 
         RowBox[{"-", "100"}]}], ",", 
        RowBox[{"maxIterations", "\[Rule]", 
         RowBox[{"400", "*", "1000"}]}], ",", 
        RowBox[{"maxLanczosVecs", "\[Rule]", "720"}], ",", 
        RowBox[{"restartStrategy", "\[Rule]", "4"}], ",", 
        RowBox[{"rTolerance", "\[Rule]", 
         RowBox[{"10.0", "^", 
          RowBox[{"-", "7"}]}]}], ",", 
        RowBox[{"printDetails", "\[Rule]", "2"}]}], "}"}]}], ",", 
     RowBox[{"Method", "\[Rule]", 
      RowBox[{"{", 
       RowBox[{"\"\<External\>\"", ",", 
        RowBox[{"printDetails", "\[Rule]", "1"}], ",", " ", 
        RowBox[{"rTolerance", " ", "\[Rule]", " ", 
         RowBox[{"10.0", "^", 
          RowBox[{"-", "9"}]}]}]}], "}"}]}], ",", 
     RowBox[{"fullMatrix", "\[Rule]", "False"}], ",", 
     RowBox[{"returnShifts", "\[Rule]", "True"}]}], "]"}]}], 
  ";"}]], "Input",ExpressionUUID->"4fc05328-fcbb-484d-9e04-57c21a581db6"],

Cell[BoxData[
 RowBox[{"compareVectors", "[", 
  RowBox[{"shiftsAxialDense", ",", "shiftsAxialMinres2"}], 
  "]"}]], "Input",ExpressionUUID->"8b03f22b-81e7-4a05-8331-0de071cd8f0e"],

Cell[BoxData[
 RowBox[{"Norm", "[", 
  RowBox[{"Flatten", "[", 
   RowBox[{"gaugeFieldAxialDense", "-", "gaugeFieldAxialMinres2"}], "]"}], 
  "]"}]], "Input",ExpressionUUID->"00e041bc-f0b3-452a-ab5b-58a4aeac7cd0"]
}, Closed]],

Cell[CellGroupData[{

Cell["Compare dynamic and axial", \
"Subsection",ExpressionUUID->"a4dc8a29-6322-47fb-876c-68c85c089c5b"],

Cell[BoxData[
 RowBox[{" ", 
  RowBox[{
   RowBox[{"comparePlaquettes", "[", 
    RowBox[{"gf1_", ",", "gf2_"}], "]"}], ":=", 
   RowBox[{"Block", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"p1", ",", "p2"}], "}"}], ",", 
     RowBox[{
      RowBox[{"Block", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"gaugeField", "=", "gf1"}], "}"}], ",", 
        RowBox[{"p1", "=", 
         RowBox[{"Flatten", "[", 
          RowBox[{"Table", "[", 
           RowBox[{
            RowBox[{"Re", "[", 
             RowBox[{"plaquette", "[", 
              RowBox[{"dir1", ",", "dir2", ",", 
               RowBox[{"latticeCoordinates", "[", "k", "]"}]}], "]"}], "]"}], 
            ",", 
            RowBox[{"{", 
             RowBox[{"k", ",", 
              RowBox[{"latticeVolume", "[", "]"}]}], "}"}], ",", 
            RowBox[{"{", 
             RowBox[{"dir1", ",", "2", ",", "nd"}], "}"}], ",", 
            RowBox[{"{", 
             RowBox[{"dir2", ",", 
              RowBox[{"dir1", "-", "1"}]}], "}"}]}], "]"}], "]"}]}]}], "]"}], 
      ";", 
      RowBox[{"Block", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"gaugeField", "=", "gf2"}], "}"}], ",", 
        RowBox[{"p2", "=", 
         RowBox[{"Flatten", "[", 
          RowBox[{"Table", "[", 
           RowBox[{
            RowBox[{"Re", "[", 
             RowBox[{"plaquette", "[", 
              RowBox[{"dir1", ",", "dir2", ",", 
               RowBox[{"latticeCoordinates", "[", "k", "]"}]}], "]"}], "]"}], 
            ",", 
            RowBox[{"{", 
             RowBox[{"k", ",", 
              RowBox[{"latticeVolume", "[", "]"}]}], "}"}], ",", 
            RowBox[{"{", 
             RowBox[{"dir1", ",", "2", ",", "nd"}], "}"}], ",", 
            RowBox[{"{", 
             RowBox[{"dir2", ",", 
              RowBox[{"dir1", "-", "1"}]}], "}"}]}], "]"}], "]"}]}]}], "]"}], 
      ";", 
      RowBox[{
       RowBox[{"Norm", "[", 
        RowBox[{"p1", "-", "p2"}], "]"}], "/", 
       RowBox[{"Norm", "[", "p1", "]"}]}]}]}], "]"}]}]}]], "Input",
 InitializationCell->
  True,ExpressionUUID->"d2a113bc-a18a-4773-88a1-7c6ebb3fd3fe"],

Cell[BoxData[
 RowBox[{"comparePlaquettes", "[", 
  RowBox[{"gaugeFieldAxialDense", ",", "gaugeFieldDynamicDense"}], 
  "]"}]], "Input",ExpressionUUID->"88b547ae-762a-4d99-999e-54b090f4bd73"]
}, Closed]]
}, Open  ]]
}, Open  ]],

Cell[CellGroupData[{

Cell["Analysis", \
"Title",ExpressionUUID->"f174178b-2d0b-483f-87a2-8e4a9836b814"],

Cell[CellGroupData[{

Cell["Quadratic approximation errors", \
"Section",ExpressionUUID->"ce1a504e-4046-463f-a1c6-5465d81081e9"],

Cell["\<\
The shifts are approximated as a quadratic.  Use the 2-norm vs. shift \
magnitude to characterize this error.  The error is approximated by \
Norm[shift,2]^2/48, but decreases with nc as 1/nc.
Note that the 2-norm of any SU(N) matrix is 1.\
\>", "Text",ExpressionUUID->"d2626c8b-76a9-4b16-9ee5-1bca8257e6de"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"nc", "=", "4"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"randomDirection", "[", "]"}], ":=", 
   RowBox[{
    RowBox[{"RandomVariate", "[", 
     RowBox[{"CircularRealMatrixDistribution", "[", 
      RowBox[{
       RowBox[{"nc", "^", "2"}], "-", "1"}], "]"}], "]"}], "[", 
    RowBox[{"[", "1", "]"}], "]"}]}], 
  ";"}]}], "Input",ExpressionUUID->"cab5ffe4-a284-4099-863f-4fec92fd090c"],

Cell["\<\
For a single generator of the group, we can calculate explicitly. We get the \
same thing for all matrix norms.\
\>", "Text",ExpressionUUID->"54e08293-9c1e-4ef1-82cc-6f311b2b0c77"],

Cell[BoxData[
 RowBox[{"expr", "=", 
  RowBox[{
   RowBox[{"Block", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"shift", "=", 
       RowBox[{"x", " ", 
        RowBox[{
         RowBox[{"suGenerators", "[", "nc", "]"}], "[", 
         RowBox[{"[", "1", "]"}], "]"}]}]}], "}"}], ",", 
     RowBox[{"Norm", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"IdentityMatrix", "[", "nc", "]"}], "+", 
        RowBox[{"I", " ", "shift"}], "-", 
        RowBox[{
         RowBox[{"shift", ".", "shift"}], "/", 
         RowBox[{"2", "!"}]}], "-", 
        RowBox[{"MatrixExp", "[", 
         RowBox[{"I", " ", "shift"}], "]"}]}], ",", "2"}], "]"}]}], "]"}], "/.", 
   RowBox[{
    RowBox[{"Conjugate", "[", "x", "]"}], "\[Rule]", 
    "x"}]}]}]], \
"Input",ExpressionUUID->"0cc2495e-8286-4dea-8bc8-47a05960d15d"],

Cell[BoxData[
 RowBox[{
  RowBox[{"Simplify", "[", 
   RowBox[{"expr", "/.", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{
       RowBox[{"Cos", "[", "xx_", "]"}], "\[Rule]", 
       RowBox[{"(", 
        RowBox[{
         RowBox[{"Normal", "[", 
          RowBox[{"Series", "[", 
           RowBox[{
            RowBox[{"Cos", "[", "yy", "]"}], ",", 
            RowBox[{"{", 
             RowBox[{"yy", ",", "0", ",", "3"}], "}"}]}], "]"}], "]"}], "/.", 
         
         RowBox[{"yy", "\[Rule]", "xx"}]}], ")"}]}], ",", 
      RowBox[{
       RowBox[{"Sin", "[", "xx_", "]"}], "\[Rule]", 
       RowBox[{"(", 
        RowBox[{
         RowBox[{"Normal", "[", 
          RowBox[{"Series", "[", 
           RowBox[{
            RowBox[{"Sin", "[", "yy", "]"}], ",", 
            RowBox[{"{", 
             RowBox[{"yy", ",", "0", ",", "3"}], "}"}]}], "]"}], "]"}], "/.", 
         
         RowBox[{"yy", "\[Rule]", "xx"}]}], ")"}]}]}], "}"}]}], "]"}], "/.", 
  RowBox[{
   RowBox[{"Abs", "[", "x", "]"}], "\[Rule]", 
   "x"}]}]], "Input",ExpressionUUID->"6cd07246-c803-4be9-a726-978599e0a142"],

Cell[BoxData[
 RowBox[{"Series", "[", 
  RowBox[{"expr", ",", 
   RowBox[{"{", 
    RowBox[{"x", ",", "0", ",", "4"}], "}"}]}], 
  "]"}]], "Input",ExpressionUUID->"50776728-51a3-41da-bff7-dbe90f754129"],

Cell[BoxData[
 RowBox[{"1", "/", 
  "48."}]], "Input",ExpressionUUID->"bd741b8a-d16e-4c76-aa5d-07ab81e8910d"],

Cell["\<\
For (SU(2), Norm[shift]^3/48 is an exact solution.  We see that, for SU(3) \
and SU(4), there is a narrow distribution peaked near 1/48.  For SU(5) and \
above, the peak moves downward.\
\>", "Text",ExpressionUUID->"4313215d-e17f-42c0-b295-a4964cf25227"],

Cell[BoxData[
 RowBox[{"hh1", "=", 
  RowBox[{"Histogram", "[", 
   RowBox[{
    RowBox[{"hdata", "=", 
     RowBox[{"ParallelTable", "[", 
      RowBox[{
       RowBox[{"Block", "[", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{
           RowBox[{"rd", "=", 
            RowBox[{"randomDirection", "[", "]"}]}], ",", 
           RowBox[{"x", "=", "0.01"}]}], "}"}], ",", 
         RowBox[{"Block", "[", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"shift", "=", 
             RowBox[{"x", " ", 
              RowBox[{"rd", ".", 
               RowBox[{"suGenerators", "[", "nc", "]"}]}]}]}], "}"}], ",", 
           RowBox[{
            RowBox[{"Norm", "[", 
             RowBox[{
              RowBox[{
               RowBox[{"IdentityMatrix", "[", "nc", "]"}], "+", 
               RowBox[{"I", " ", "shift"}], "-", 
               RowBox[{
                RowBox[{"shift", ".", "shift"}], "/", 
                RowBox[{"2", "!"}]}], "-", 
               RowBox[{"MatrixExp", "[", 
                RowBox[{"I", " ", "shift"}], "]"}]}], ",", "2"}], "]"}], "/", 
            
            RowBox[{
             RowBox[{"Norm", "[", 
              RowBox[{
               RowBox[{"x", " ", "rd"}], ",", "2"}], "]"}], "^", "3"}]}]}], 
          "]"}]}], "]"}], ",", 
       RowBox[{"{", "10000", "}"}]}], "]"}]}], ",", "30", ",", 
    RowBox[{"Axes", "\[Rule]", "False"}], ",", 
    RowBox[{"Frame", "\[Rule]", "True"}]}], 
   "]"}]}]], "Input",ExpressionUUID->"9d1edcc2-6197-4992-9ce6-0ea222664d79"],

Cell[BoxData[
 RowBox[{"Mean", "[", "hdata", 
  "]"}]], "Input",ExpressionUUID->"ef1bc6cb-849c-4533-9bfb-ccd9f64a837d"],

Cell["Mean of the distribution for various 1/nc:", \
"Text",ExpressionUUID->"891d4f13-ef53-401f-b90c-6ea78274bbab"],

Cell[BoxData[
 RowBox[{
  RowBox[{"cd", "=", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"1", "/", "20"}], ",", "0.003987207811923104`"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"1", "/", "16"}], ",", "0.005309460586922509`"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"1", "/", "12"}], ",", "0.007542180302737262`"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"1", "/", "8"}], ",", "0.01195670498036167`"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"1", "/", "6"}], ",", "0.01602903272904034`"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"1", "/", "4"}], ",", "0.022300330376689107`"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"1", "/", "3"}], ",", "0.02572546202970247`"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"1", "/", "2"}], ",", 
       RowBox[{"1", "/", "48"}]}], "}"}]}], "}"}]}], 
  ";"}]], "Input",ExpressionUUID->"53bef80c-9f97-4ec5-b1b9-939ece8875c1"],

Cell[BoxData[
 RowBox[{"ffcd", "=", 
  RowBox[{"Fit", "[", 
   RowBox[{"cd", ",", 
    RowBox[{"{", 
     RowBox[{"x", ",", 
      RowBox[{"x", "^", "2"}], ",", 
      RowBox[{"x", "^", "3"}]}], "}"}], ",", "x"}], 
   "]"}]}]], "Input",ExpressionUUID->"31815b19-b53e-40a4-a42f-6241f30d7abb"],

Cell[BoxData[
 RowBox[{
  RowBox[{"Apply", "[", 
   RowBox[{"List", ",", "ffcd"}], "]"}], "/.", 
  RowBox[{"x", "\[Rule]", 
   RowBox[{
   "1", "/", 
    "3"}]}]}]], \
"Input",ExpressionUUID->"2aaace19-6f5b-4ac9-b70c-34eeb8363fa2"],

Cell[BoxData[
 RowBox[{"Show", "[", 
  RowBox[{
   RowBox[{"ListPlot", "[", 
    RowBox[{"cd", ",", 
     RowBox[{"Axes", "\[Rule]", "False"}], ",", 
     RowBox[{"Frame", "\[Rule]", "True"}], ",", 
     RowBox[{"PlotRange", "\[Rule]", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"0", ",", "0.55"}], "}"}], ",", "Automatic"}], "}"}]}], ",", 
     
     RowBox[{"FrameLabel", "\[Rule]", 
      RowBox[{"{", 
       RowBox[{
       "\"\<1/Nc\>\"", ",", "\"\<Mean coefficient of cubic in shift\>\""}], 
       "}"}]}]}], "]"}], ",", 
   RowBox[{"Plot", "[", 
    RowBox[{"ffcd", ",", 
     RowBox[{"{", 
      RowBox[{"x", ",", "0", ",", ".55"}], "}"}]}], "]"}]}], 
  "]"}]], "Input",ExpressionUUID->"37f4024b-3fa9-43d2-91fc-2faf596a7b8c"],

Cell["\<\
Plot error as a function of shift in some random shift direction\
\>", "Text",ExpressionUUID->"a9841638-1cc0-4c9d-837f-80708cb033f9"],

Cell[BoxData[
 RowBox[{
  RowBox[{"maxData", "=", 
   RowBox[{"2", "Pi"}]}], ";", 
  RowBox[{"data", "=", 
   RowBox[{"Block", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"rd", "=", 
       RowBox[{"randomDirection", "[", "]"}]}], "}"}], ",", 
     RowBox[{"Table", "[", 
      RowBox[{
       RowBox[{"Block", "[", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{
           RowBox[{"shift", "=", 
            RowBox[{"x", " ", 
             RowBox[{"If", "[", 
              RowBox[{"False", ",", 
               RowBox[{
                RowBox[{"IdentityMatrix", "[", 
                 RowBox[{
                  RowBox[{"nc", "^", "2"}], "-", "1"}], "]"}], "[", 
                RowBox[{"[", "1", "]"}], "]"}], ",", "rd"}], "]"}]}]}], ",", 
           "sg"}], "}"}], ",", 
         RowBox[{
          RowBox[{"sg", "=", 
           RowBox[{"shift", ".", 
            RowBox[{"suGenerators", "[", "nc", "]"}]}]}], ";", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"Norm", "[", 
             RowBox[{"shift", ",", "2"}], "]"}], ",", 
            RowBox[{"Norm", "[", 
             RowBox[{
              RowBox[{
               RowBox[{"IdentityMatrix", "[", "nc", "]"}], "+", 
               RowBox[{"I", " ", "sg"}], "-", 
               RowBox[{
                RowBox[{"sg", ".", "sg"}], "/", 
                RowBox[{"2", "!"}]}], "-", 
               RowBox[{"MatrixExp", "[", 
                RowBox[{"I", " ", "sg"}], "]"}]}], ",", "2"}], "]"}]}], 
           "}"}]}]}], "]"}], ",", 
       RowBox[{"{", 
        RowBox[{"x", ",", "0", ",", "maxData", ",", " ", 
         RowBox[{"maxData", "/", "20"}]}], "}"}]}], "]"}]}], "]"}]}], 
  ";"}]], "Input",ExpressionUUID->"3358cdbf-4cb3-41c7-94c6-efb75b622f72"],

Cell[BoxData[
 RowBox[{"ff", "=", 
  RowBox[{"Fit", "[", 
   RowBox[{"data", ",", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"x", "^", "3"}], ",", 
      RowBox[{"x", "^", "4"}], ",", 
      RowBox[{"x", "^", "5"}]}], "}"}], ",", "x"}], 
   "]"}]}]], "Input",ExpressionUUID->"9c910dbe-cd14-4560-90d3-2c60c6db4cf7"],

Cell[BoxData[
 RowBox[{
  RowBox[{"Apply", "[", 
   RowBox[{"List", ",", "ff"}], "]"}], "/.", 
  RowBox[{
  "x", "\[Rule]", 
   "maxData"}]}]], \
"Input",ExpressionUUID->"03b5c051-ac29-4815-80fb-e7a067dd7220"],

Cell[BoxData[
 RowBox[{"Show", "[", 
  RowBox[{
   RowBox[{"ListPlot", "[", "data", "]"}], ",", 
   RowBox[{"Plot", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"ff", ",", 
       RowBox[{
        RowBox[{"x", "^", "3"}], "/", "48"}]}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"x", ",", "0", ",", "maxData"}], "}"}]}], "]"}]}], 
  "]"}]], "Input",ExpressionUUID->"4b8f05ff-2539-4241-a91e-bd960a53670a"]
}, Closed]],

Cell[CellGroupData[{

Cell["Identity staple example, SU(3)", \
"Section",ExpressionUUID->"8f8d2d8e-b492-48b0-805d-82e8841dd8d0"],

Cell["\<\
Special case where the sum of staples is proportional to the identity matrix.\
\
\>", "Text",ExpressionUUID->"28d2b89d-a643-4759-87d0-909427ce7344"],

Cell[BoxData[
 RowBox[{"diagValue", "=", 
  RowBox[{
   RowBox[{"Cos", "[", "x1", "]"}], "+", 
   RowBox[{"Cos", "[", "x2", "]"}], "+", 
   RowBox[{"Cos", "[", 
    RowBox[{
     RowBox[{"-", "x1"}], "-", "x2"}], 
    "]"}]}]}]], \
"Input",ExpressionUUID->"0e9686d1-84ff-4098-858f-2537d91bf07c"],

Cell["Saddle Points", \
"Text",ExpressionUUID->"6a7026be-e39f-4078-b776-62a0cfb31cf9"],

Cell[BoxData[
 RowBox[{"Solve", "[", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{
     RowBox[{
      RowBox[{"D", "[", 
       RowBox[{"diagValue", ",", "x1"}], "]"}], "\[Equal]", "0"}], ",", 
     RowBox[{
      RowBox[{"D", "[", 
       RowBox[{"diagValue", ",", "x2"}], "]"}], "\[Equal]", "0"}]}], "}"}], 
   ",", 
   RowBox[{"{", 
    RowBox[{"x1", ",", "x2"}], "}"}]}], 
  "]"}]], "Input",ExpressionUUID->"6aef7fbc-166e-41a0-9cec-b12e6d47d511"],

Cell["Hessian", "Text",ExpressionUUID->"57b5fe8f-a9cc-4940-a0c1-899f3f89a168"],

Cell[BoxData[
 RowBox[{"hess", "=", 
  RowBox[{"Outer", "[", 
   RowBox[{
    RowBox[{
     RowBox[{"D", "[", 
      RowBox[{"diagValue", ",", "#1", ",", "#2"}], "]"}], "&"}], ",", 
    RowBox[{"{", 
     RowBox[{"x1", ",", "x2"}], "}"}], ",", 
    RowBox[{"{", 
     RowBox[{"x1", ",", "x2"}], "}"}]}], 
   "]"}]}]], "Input",ExpressionUUID->"6a5db463-290f-4dc0-9eef-53f5c7cd62a9"],

Cell[BoxData[
 RowBox[{"dh", "=", 
  RowBox[{
  "Det", "[", "hess", 
   "]"}]}]], "Input",ExpressionUUID->"b36fdec5-b58e-46cc-b7f5-fa8d24318e5a"],

Cell[BoxData[
 RowBox[{"Block", "[", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{"limit", "=", 
     RowBox[{"Pi", " ", 
      RowBox[{"4", "/", "3"}]}]}], "}"}], ",", 
   RowBox[{"Show", "[", 
    RowBox[{
     RowBox[{"Plot3D", "[", 
      RowBox[{"diagValue", ",", 
       RowBox[{"{", 
        RowBox[{"x1", ",", 
         RowBox[{"-", "limit"}], ",", "limit"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"x2", ",", 
         RowBox[{"-", " ", "limit"}], ",", " ", "limit"}], "}"}], ",", 
       RowBox[{"RegionFunction", "\[Rule]", 
        RowBox[{"Function", "[", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"x1", ",", "x2"}], "}"}], ",", 
          RowBox[{"Block", "[", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{"x3", "=", 
              RowBox[{
               RowBox[{"-", "x1"}], "-", "x2"}]}], "}"}], ",", 
            RowBox[{
             RowBox[{
              RowBox[{"Abs", "[", 
               RowBox[{"x1", "-", "x2"}], "]"}], "<", 
              RowBox[{"2", " ", "Pi"}]}], "&&", 
             RowBox[{
              RowBox[{"Abs", "[", 
               RowBox[{"x1", "-", "x3"}], "]"}], "<", 
              RowBox[{"2", "Pi"}]}], "&&", 
             RowBox[{
              RowBox[{"Abs", "[", 
               RowBox[{"x2", "-", "x3"}], "]"}], "<", 
              RowBox[{"2", " ", "Pi"}]}]}]}], "]"}]}], "]"}]}]}], "]"}], ",", 
     
     RowBox[{"Graphics3D", "[", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"PointSize", "[", "0.02", "]"}], ",", 
        RowBox[{"Table", "[", 
         RowBox[{
          RowBox[{"Point", "[", 
           RowBox[{"{", 
            RowBox[{"x1", ",", "x2", ",", "diagValue"}], "}"}], "]"}], ",", 
          RowBox[{"{", 
           RowBox[{"x1", ",", 
            RowBox[{
             RowBox[{
              RowBox[{"-", "4"}], "/", "3"}], " ", "Pi"}], ",", 
            RowBox[{"2", " ", "Pi"}], ",", 
            RowBox[{"2", " ", "Pi"}]}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"x2", ",", 
            RowBox[{
             RowBox[{
              RowBox[{"-", "4"}], "/", "3"}], " ", "Pi"}], ",", 
            RowBox[{"2", " ", "Pi"}], ",", 
            RowBox[{"2", " ", "Pi"}]}], "}"}]}], "]"}], ",", 
        RowBox[{"Table", "[", 
         RowBox[{
          RowBox[{"Point", "[", 
           RowBox[{"{", 
            RowBox[{"x1", ",", "x2", ",", "diagValue"}], "}"}], "]"}], ",", 
          RowBox[{"{", 
           RowBox[{"x1", ",", 
            RowBox[{
             RowBox[{
              RowBox[{"-", "2"}], "/", "3"}], " ", "Pi"}], ",", 
            RowBox[{"2", " ", "Pi"}], ",", 
            RowBox[{"2", " ", "Pi"}]}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"x2", ",", 
            RowBox[{
             RowBox[{
              RowBox[{"-", "2"}], "/", "3"}], " ", "Pi"}], ",", 
            RowBox[{"2", " ", "Pi"}], ",", 
            RowBox[{"2", " ", "Pi"}]}], "}"}]}], "]"}], ",", 
        RowBox[{"Table", "[", 
         RowBox[{
          RowBox[{"Point", "[", 
           RowBox[{"{", 
            RowBox[{"x1", ",", "x2", ",", "diagValue"}], "}"}], "]"}], ",", 
          RowBox[{"{", 
           RowBox[{"x1", ",", 
            RowBox[{"-", "Pi"}], ",", "Pi", ",", "Pi"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"x2", ",", 
            RowBox[{"-", "Pi"}], ",", "Pi", ",", "Pi"}], "}"}]}], "]"}]}], 
       "}"}], "]"}]}], "]"}]}], 
  "]"}]], "Input",ExpressionUUID->"2de64670-829e-4921-8a2c-468d0e0b6cea"],

Cell[CellGroupData[{

Cell["Test saddle point routine", \
"Subsection",ExpressionUUID->"c708c257-8f21-4f83-9645-19f4be4c3713"],

Cell["Run this as a group", \
"Text",ExpressionUUID->"2524376c-66ab-4e92-bcac-a1757dc76aaf"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"sqrtU1", "=", 
   RowBox[{"SUPower", "[", 
    RowBox[{
     RowBox[{"u1", "=", 
      RowBox[{"randomSUMatrix", "[", "3", "]"}]}], ",", "0.25"}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{"phi1", "=", 
  RowBox[{
  "centerPhases", "[", "u1", 
   "]"}]}]}], "Input",ExpressionUUID->"a20f91db-d8c3-4ce1-b377-8e55df211da4"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"{", 
    RowBox[{"sqrtU2", ",", "maxShift"}], "}"}], "=", 
   RowBox[{"linkSaddlePointStep", "[", 
    RowBox[{"sqrtU1", ",", "sqrtU1"}], "]"}]}], ";", 
  "maxShift"}]], \
"Input",ExpressionUUID->"9636bb9c-bb6c-453a-abd0-06c6a79bc505"],

Cell[BoxData[
 RowBox[{"phi2", "=", 
  RowBox[{"centerPhases", "[", 
   RowBox[{"sqrtU2", ".", "sqrtU1"}], 
   "]"}]}]], "Input",ExpressionUUID->"f87007aa-68f4-4c9b-9e2b-2288cd031858"],

Cell[BoxData[
 RowBox[{"Block", "[", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{"limit", "=", 
     RowBox[{"3", 
      RowBox[{"Pi", "/", "2"}]}]}], "}"}], ",", 
   RowBox[{"Show", "[", 
    RowBox[{
     RowBox[{"DensityPlot", "[", 
      RowBox[{"diagValue", ",", 
       RowBox[{"{", 
        RowBox[{"x1", ",", 
         RowBox[{"-", "limit"}], ",", "limit"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"x2", ",", 
         RowBox[{"-", "limit"}], ",", "limit"}], "}"}], ",", 
       RowBox[{"Epilog", "\[Rule]", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"Thickness", "[", "0.02", "]"}], ",", 
          RowBox[{"Line", "[", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"Take", "[", 
              RowBox[{"phi1", ",", "2"}], "]"}], ",", 
             RowBox[{"Take", "[", 
              RowBox[{"phi2", ",", "2"}], "]"}]}], "}"}], "]"}], ",", 
          RowBox[{"PointSize", "[", "0.02", "]"}], ",", 
          RowBox[{"Table", "[", 
           RowBox[{
            RowBox[{"Point", "[", 
             RowBox[{"{", 
              RowBox[{"y1", ",", "y2"}], "}"}], "]"}], ",", 
            RowBox[{"{", 
             RowBox[{"y1", ",", 
              RowBox[{
               RowBox[{
                RowBox[{"-", "4"}], "/", "3"}], " ", "Pi"}], ",", 
              RowBox[{"2", " ", "Pi"}], ",", 
              RowBox[{"2", " ", "Pi"}]}], "}"}], ",", 
            RowBox[{"{", 
             RowBox[{"y2", ",", 
              RowBox[{
               RowBox[{
                RowBox[{"-", "4"}], "/", "3"}], " ", "Pi"}], ",", 
              RowBox[{"2", " ", "Pi"}], ",", 
              RowBox[{"2", " ", "Pi"}]}], "}"}]}], "]"}], ",", 
          RowBox[{"Table", "[", 
           RowBox[{
            RowBox[{"Point", "[", 
             RowBox[{"{", 
              RowBox[{"y1", ",", "y2"}], "}"}], "]"}], ",", 
            RowBox[{"{", 
             RowBox[{"y1", ",", 
              RowBox[{
               RowBox[{
                RowBox[{"-", "2"}], "/", "3"}], " ", "Pi"}], ",", 
              RowBox[{"2", " ", "Pi"}], ",", 
              RowBox[{"2", " ", "Pi"}]}], "}"}], ",", 
            RowBox[{"{", 
             RowBox[{"y2", ",", 
              RowBox[{
               RowBox[{
                RowBox[{"-", "2"}], "/", "3"}], " ", "Pi"}], ",", 
              RowBox[{"2", " ", "Pi"}], ",", 
              RowBox[{"2", " ", "Pi"}]}], "}"}]}], "]"}], ",", 
          RowBox[{"Table", "[", 
           RowBox[{
            RowBox[{"Point", "[", 
             RowBox[{"{", 
              RowBox[{"y1", ",", "y2"}], "}"}], "]"}], ",", 
            RowBox[{"{", 
             RowBox[{"y1", ",", 
              RowBox[{"-", "Pi"}], ",", "Pi", ",", "Pi"}], "}"}], ",", 
            RowBox[{"{", 
             RowBox[{"y2", ",", 
              RowBox[{"-", "Pi"}], ",", "Pi", ",", "Pi"}], "}"}]}], "]"}]}], 
         "}"}]}]}], "]"}], ",", 
     RowBox[{"DensityPlot", "[", 
      RowBox[{"dh", ",", 
       RowBox[{"{", 
        RowBox[{"x1", ",", 
         RowBox[{"-", "limit"}], ",", "limit"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"x2", ",", 
         RowBox[{"-", "limit"}], ",", "limit"}], "}"}], ",", 
       RowBox[{"PlotRange", "\[Rule]", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"-", "0.1"}], ",", "0.1"}], "}"}]}]}], "]"}]}], "]"}]}], 
  "]"}]], "Input",ExpressionUUID->"ff5c7a42-33f1-42a5-9a90-835037adbb53"]
}, Closed]]
}, Closed]],

Cell[CellGroupData[{

Cell["Input gauge configurations", \
"Section",ExpressionUUID->"86bfae6c-4d6d-4a25-b7b0-864c8f4e6d20"],

Cell[BoxData[
 RowBox[{"<<", 
  "\"\<../data/3-3/periodic-4-7.5-3.m\>\""}]], \
"Input",ExpressionUUID->"2e729cea-afdc-4de4-a9d0-e45f71386f6b"],

Cell[BoxData[
 RowBox[{"<<", 
  "\"\<../data/3-3/periodic-6-8.175-3.m\>\""}]], \
"Input",ExpressionUUID->"9e9f081b-abbd-4cff-9d20-c688455c675e"],

Cell[BoxData[
 RowBox[{"<<", 
  "\"\<../data/3-3/periodic-8-9-3.m\>\""}]], \
"Input",ExpressionUUID->"7587afb3-761a-413d-8e5e-579daa0d3740"],

Cell[BoxData[
 RowBox[{"<<", 
  "\"\<../data/3-3/periodic-12-11-3.m\>\""}]], \
"Input",ExpressionUUID->"3e61768b-0f4f-464b-8449-8fad3e6c7798"],

Cell[BoxData[
 RowBox[{"<<", 
  "\"\<../data/3-3/periodic-16-15-3.m\>\""}]], \
"Input",ExpressionUUID->"e986ad07-c948-4c03-8cda-e575a71c2b40"],

Cell[BoxData[
 RowBox[{"<<", 
  "\"\<../data/3-3/periodic-16-28-5.m\>\""}]], \
"Input",ExpressionUUID->"5c9001a9-2e55-4c31-864a-6c52d057395d"],

Cell[BoxData[
 RowBox[{"<<", 
  "\"\<../data/3-3/periodic-16-31-4.m\>\""}]], \
"Input",ExpressionUUID->"ed100dac-92d1-424c-a101-6924d283c5db"],

Cell[BoxData[
 RowBox[{"<<", 
  "\"\<../data/3-3/periodic-22-42-1.m\>\""}]], \
"Input",ExpressionUUID->"53db7ba8-c629-4d00-bb4a-7a9f18d8901c"],

Cell[BoxData[
 RowBox[{
  RowBox[{"<<", "\"\<../data/3-3/periodic-22-42-1-cool.m\>\""}], 
  ";"}]], "Input",ExpressionUUID->"88d740d1-0a07-419a-a8d4-ef7fbfaf5fd8"],

Cell[BoxData[
 RowBox[{"<<", 
  "\"\<../data/3-3/periodic-22-42-5.m\>\""}]], \
"Input",ExpressionUUID->"dcc2d627-4ef7-4a60-8951-5b495967f3c9"],

Cell[BoxData[
 RowBox[{"<<", 
  "\"\<../data/3-3/periodic-22-80-5.m\>\""}]], \
"Input",ExpressionUUID->"60d71144-9c29-458f-8c63-11f9a13446f3"],

Cell[BoxData[
 RowBox[{"<<", 
  "\"\<../data/3-4/periodic-16-28-1.m\>\""}]], \
"Input",ExpressionUUID->"f3047582-2299-4c99-96b3-92a00ca8e127"],

Cell[BoxData[
 RowBox[{"<<", 
  "\"\<../data/3-4/periodic-16-33-4.m\>\""}]], \
"Input",ExpressionUUID->"35588511-034f-4f59-b7b1-a1cbbf30db9e"],

Cell[BoxData[
 RowBox[{"<<", 
  "\"\<../data/3-4/periodic-16-37-5.m\>\""}]], \
"Input",ExpressionUUID->"6a9e6fd4-9dd9-4daa-9569-d4cc39ca2f91"],

Cell[BoxData[
 RowBox[{"<<", 
  "\"\<../data/3-4/periodic-20-150-5.m\>\""}]], \
"Input",ExpressionUUID->"ca7283e7-df2f-49ce-ad42-0a6fc8bf4636"],

Cell[BoxData[
 RowBox[{"<<", 
  "\"\<../data/3-3/winding-20-80-0-5.m\>\""}]], \
"Input",ExpressionUUID->"f09dcb5b-d116-4917-aff2-0184028aff50"],

Cell[BoxData[
 RowBox[{"<<", 
  "\"\<../data/3-3/winding-20-80-1-5.m\>\""}]], \
"Input",ExpressionUUID->"b86f3c7d-603b-4ba0-b40c-c9038a7046a6"],

Cell[BoxData[
 RowBox[{"<<", 
  "\"\<../data/3-4/winding-20-60-0-4.m\>\""}]], \
"Input",ExpressionUUID->"8267aa6e-e250-4049-b04f-87653efe314d"],

Cell[BoxData[
 RowBox[{"<<", 
  "\"\<../data/3-4/winding-20-60-1-4.m\>\""}]], \
"Input",ExpressionUUID->"8f77c9e2-3f22-464d-b28f-251096700d6d"],

Cell[BoxData[
 RowBox[{"<<", 
  "\"\<../data/3-6/periodic-18-90-1.m\>\""}]], \
"Input",ExpressionUUID->"f5cec4a6-0c14-48b6-a315-a3e91cb85b6e"],

Cell[BoxData[
 RowBox[{"<<", 
  "\"\<../data/3-6/periodic-18-170-1.m\>\""}]], \
"Input",ExpressionUUID->"12395adf-36e9-42f0-8751-29da7027243f"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{"nd", ",", "nc", ",", "beta", ",", "latticeDimensions", ",", 
   RowBox[{"Dimensions", "[", "gaugeField", "]"}]}], 
  "}"}]], "Input",ExpressionUUID->"f90fbc19-e691-424e-a185-652c594a8b4a"],

Cell["Test that links are approximately SU (N)", \
"Text",ExpressionUUID->"f722cea1-30c4-4900-af00-df89fbcc4a0b"],

Cell[BoxData[
 RowBox[{"Length", "[", 
  RowBox[{"badMatrices", "=", 
   RowBox[{"Select", "[", 
    RowBox[{
     RowBox[{"Flatten", "[", 
      RowBox[{"gaugeField", ",", "1"}], "]"}], ",", 
     RowBox[{
      RowBox[{"Not", "[", 
       RowBox[{"SUMatrixQ", "[", 
        RowBox[{"#", ",", 
         RowBox[{"1.0", " ", 
          RowBox[{"10", "^", 
           RowBox[{"-", "10"}]}]}]}], "]"}], "]"}], "&"}]}], "]"}]}], 
  "]"}]], "Input",ExpressionUUID->"b997761f-f834-41b4-862e-6474cf8fce81"]
}, Open  ]],

Cell[CellGroupData[{

Cell["Plaquette distribution", \
"Section",ExpressionUUID->"ad50c69b-52fa-49f1-b2f9-aa294300b000"],

Cell["\<\
The plaquette values, if rescaled to the [0,1] interval, generally fit a Beta \
distribution, but we can equivalently use a Gamma distribution for small \
lattice spacings.\
\>", "Text",ExpressionUUID->"054aa60d-5f2e-438f-a8bb-ab5bc7ba93ee"],

Cell[BoxData[
 RowBox[{
  RowBox[{"useGammaDistribution", "=", "True"}], 
  ";"}]], "Input",ExpressionUUID->"eed81ada-37f9-434b-b9a6-dc26045be2e0"],

Cell[BoxData[
 RowBox[{"Histogram", "[", 
  RowBox[{"data", "=", 
   RowBox[{"Flatten", "[", 
    RowBox[{"Table", "[", 
     RowBox[{
      RowBox[{"Table", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"(", 
          RowBox[{"1", "-", 
           RowBox[{
            RowBox[{"plaquette", "[", 
             RowBox[{"dir1", ",", "dir2", ",", 
              RowBox[{"latticeCoordinates", "[", "i", "]"}]}], "]"}], "/", 
            "nc"}]}], ")"}], "/", 
         RowBox[{"If", "[", 
          RowBox[{"useGammaDistribution", ",", "1", ",", "2"}], "]"}]}], ",", 
        
        RowBox[{"{", 
         RowBox[{"i", ",", 
          RowBox[{"latticeVolume", "[", "]"}]}], "}"}]}], "]"}], ",", 
      RowBox[{"{", 
       RowBox[{"dir1", ",", "2"}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{"dir2", ",", 
        RowBox[{"dir1", "+", "1"}], ",", "nd"}], "}"}]}], "]"}], "]"}]}], 
  "]"}]], "Input",ExpressionUUID->"b4aa5855-d2b2-4cdf-9d39-80174424a9e1"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   RowBox[{"Mean", "[", "data", "]"}], ",", 
   RowBox[{"dist", "=", 
    RowBox[{"FindDistribution", "[", 
     RowBox[{"data", ",", 
      RowBox[{"TargetFunctions", "\[Rule]", 
       RowBox[{"Which", "[", 
        RowBox[{"useGammaDistribution", ",", 
         RowBox[{"{", "GammaDistribution", "}"}], ",", "True", ",", 
         RowBox[{"{", "BetaDistribution", "}"}], ",", "True", ",", "All"}], 
        "]"}]}]}], "]"}]}]}], 
  "}"}]], "Input",ExpressionUUID->"80a41af7-56c8-4cde-87d9-3025ff76706a"],

Cell["Distribution for 1 - Tr(plaquette)/nc", \
"Text",ExpressionUUID->"5027c05e-179e-4daf-82a1-11b8eea98e34"],

Cell[BoxData[
 RowBox[{"TableForm", "[", 
  RowBox[{"dm", "=", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "\"\<nd\>\"", ",", "\"\<nc\>\"", ",", "\"\<beta\>\"", ",", 
       "\"\<mean\>\"", ",", "\"\<alpha\>\"", ",", "\"\<beta\>\""}], "}"}], 
     ",", 
     RowBox[{"{", 
      RowBox[{
      "3", ",", "3", ",", "42.", ",", "0.0650492058072443`", ",", 
       "4.0372454261752875`", ",", "0.016112274320900954`"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{
      "3", ",", "3", ",", "80.", ",", "0.03371067322265413`", ",", 
       "4.011655372432331`", ",", "0.008403182749520672`"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{
      "3", ",", "4", ",", "28.", ",", "0.1923250246554901`", ",", 
       "7.7282971359028245`", ",", "0.02488582171194133`"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{
      "3", ",", "4", ",", "33.", ",", "0.1604205616819077`", ",", 
       "7.670953223240458`", ",", "0.02091272844591148`"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{
      "3", ",", "4", ",", "150.", ",", "0.03380841583718067`", ",", 
       "7.620434296041462`", ",", "0.004436547121053944`"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{
      "3", ",", "6", ",", "90.", ",", "0.13525994258717414`", ",", 
       "18.387360829900825`", ",", "0.007356136850654697`"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{
      "3", ",", "6", ",", "170.", ",", "0.07017369456939337`", ",", 
       "18.102497926494276`", ",", "0.0038764647207436133`"}], "}"}]}], 
    "}"}]}], "]"}]], \
"Input",ExpressionUUID->"2c71e24c-1758-4d56-9b36-3a519ff2564c"],

Cell[BoxData[
 RowBox[{"Fit", "[", 
  RowBox[{
   RowBox[{"Log", "[", 
    RowBox[{"Map", "[", 
     RowBox[{
      RowBox[{
       RowBox[{"#", "[", 
        RowBox[{"[", 
         RowBox[{"{", 
          RowBox[{"2", ",", "3", ",", "5"}], "}"}], "]"}], "]"}], "&"}], ",", 
      
      RowBox[{"Rest", "[", "dm", "]"}]}], "]"}], "]"}], ",", 
   RowBox[{"{", 
    RowBox[{"1", ",", "x", ",", "y"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"x", ",", "y"}], "}"}]}], 
  "]"}]], "Input",ExpressionUUID->"a4fba744-c5aa-4242-9186-c7e12b7c32ba"],

Cell[BoxData[
 RowBox[{"alphaf", "=", 
  RowBox[{"Fit", "[", 
   RowBox[{
    RowBox[{"Map", "[", 
     RowBox[{
      RowBox[{
       RowBox[{"#", "[", 
        RowBox[{"[", 
         RowBox[{"{", 
          RowBox[{"2", ",", "3", ",", "5"}], "}"}], "]"}], "]"}], "&"}], ",", 
      
      RowBox[{"Rest", "[", "dm", "]"}]}], "]"}], ",", 
    RowBox[{"{", 
     RowBox[{"x", ",", 
      RowBox[{"x", "^", "2"}], ",", 
      RowBox[{
       RowBox[{"x", "^", "2"}], "/", "y"}]}], "}"}], ",", 
    RowBox[{"{", 
     RowBox[{"x", ",", "y"}], "}"}]}], 
   "]"}]}]], "Input",ExpressionUUID->"d9f862ab-59ea-445a-84c5-13a6cd93b8a9"],

Cell[BoxData[
 RowBox[{"Fit", "[", 
  RowBox[{
   RowBox[{"Log", "[", 
    RowBox[{"Map", "[", 
     RowBox[{
      RowBox[{
       RowBox[{"#", "[", 
        RowBox[{"[", 
         RowBox[{"{", 
          RowBox[{"2", ",", "3", ",", "6"}], "}"}], "]"}], "]"}], "&"}], ",", 
      
      RowBox[{"Rest", "[", "dm", "]"}]}], "]"}], "]"}], ",", 
   RowBox[{"{", 
    RowBox[{"1", ",", "x", ",", "y"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"x", ",", "y"}], "}"}]}], 
  "]"}]], "Input",ExpressionUUID->"b5fb148f-099f-478f-bd4e-150218d52e40"],

Cell[BoxData[
 RowBox[{"betaf", "=", 
  RowBox[{"Fit", "[", 
   RowBox[{
    RowBox[{"Map", "[", 
     RowBox[{
      RowBox[{
       RowBox[{"#", "[", 
        RowBox[{"[", 
         RowBox[{"{", 
          RowBox[{"2", ",", "3", ",", "6"}], "}"}], "]"}], "]"}], "&"}], ",", 
      
      RowBox[{"Rest", "[", "dm", "]"}]}], "]"}], ",", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"1", "/", "y"}], ",", 
      RowBox[{"1", "/", 
       RowBox[{"(", 
        RowBox[{"x", " ", "y"}], ")"}]}], ",", 
      RowBox[{"1", "/", 
       RowBox[{"y", "^", "2"}]}]}], "}"}], ",", 
    RowBox[{"{", 
     RowBox[{"x", ",", "y"}], "}"}]}], 
   "]"}]}]], "Input",ExpressionUUID->"d6598be3-4d8f-46ab-98a7-3bb7a785b1f1"],

Cell[BoxData[
 RowBox[{"Series", "[", 
  RowBox[{
   RowBox[{"alphaf", " ", "betaf"}], ",", 
   RowBox[{"{", 
    RowBox[{"y", ",", "Infinity", ",", "2"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"x", ",", "Infinity", ",", 
     RowBox[{"-", "1"}]}], "}"}]}], 
  "]"}]], "Input",ExpressionUUID->"3512c207-94b1-4353-9383-7b66e725d596"],

Cell[BoxData[
 RowBox[{"dist", "=", 
  RowBox[{"GammaDistribution", "[", 
   RowBox[{
    RowBox[{
     RowBox[{"nc", "^", "2"}], "/", "2"}], ",", 
    RowBox[{"2", "/", 
     RowBox[{"(", 
      RowBox[{"3", " ", "beta"}], ")"}]}]}], 
   "]"}]}]], "Input",ExpressionUUID->"73f0688f-3bc6-4d5e-987a-d2ecfe0eba1a"],

Cell[BoxData[
 RowBox[{"Mean", "[", 
  RowBox[{"GammaDistribution", "[", 
   RowBox[{"a1", ",", "b1"}], "]"}], 
  "]"}]], "Input",ExpressionUUID->"4f9e72ca-8e2c-461f-a480-11be1383abb2"],

Cell[BoxData[
 RowBox[{"TableForm", "[", 
  RowBox[{"Map", "[", 
   RowBox[{
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"#", "[", 
        RowBox[{"[", "2", "]"}], "]"}], ",", 
       RowBox[{"#", "[", 
        RowBox[{"[", "3", "]"}], "]"}], ",", 
       RowBox[{"#", "[", 
        RowBox[{"[", "4", "]"}], "]"}], ",", 
       RowBox[{
        RowBox[{
         RowBox[{"#", "[", 
          RowBox[{"[", "2", "]"}], "]"}], "^", "2"}], "/", 
        RowBox[{"(", 
         RowBox[{"3", " ", 
          RowBox[{"#", "[", 
           RowBox[{"[", "3", "]"}], "]"}]}], ")"}]}], ",", 
       RowBox[{
        RowBox[{
         RowBox[{"#", "[", 
          RowBox[{"[", "2", "]"}], "]"}], "^", "4"}], "/", 
        RowBox[{"(", 
         RowBox[{
          RowBox[{
           RowBox[{"#", "[", 
            RowBox[{"[", "3", "]"}], "]"}], "^", "2"}], " ", "2", " ", "Pi"}],
          ")"}]}]}], "}"}], "&"}], ",", "dm"}], "]"}], 
  "]"}]], "Input",ExpressionUUID->"4123b4ad-1aee-4ba2-af38-fbae132fc1fc"],

Cell[BoxData[
 RowBox[{"Block", "[", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{"width", "=", "0.0025"}], "}"}], ",", 
   RowBox[{"Show", "[", 
    RowBox[{
     RowBox[{"Histogram", "[", 
      RowBox[{"data", ",", 
       RowBox[{"{", "width", "}"}], ",", 
       RowBox[{"Axes", "\[Rule]", "False"}], ",", 
       RowBox[{"Frame", "\[Rule]", "True"}]}], "]"}], ",", 
     RowBox[{"Plot", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"Length", "[", "data", "]"}], " ", "width", " ", 
        RowBox[{
         RowBox[{"PDF", "[", "dist", "]"}], "[", "x", "]"}]}], ",", 
       RowBox[{"{", 
        RowBox[{"x", ",", "0", ",", 
         RowBox[{"3", " ", 
          RowBox[{"Mean", "[", "data", "]"}]}]}], "}"}]}], "]"}]}], "]"}]}], 
  "]"}]], "Input",ExpressionUUID->"ddde5321-7bd9-49df-ae4a-3c5cddcb8338"]
}, Closed]],

Cell[CellGroupData[{

Cell["Gauge Invariant Shifts", \
"Section",ExpressionUUID->"81386b1e-2c78-489b-af5a-f2aceecfa768"],

Cell["\<\
The gauge transforms should leave the action invariant.  Thus any small shift \
in the direction of a gauge transform should have zero gradient and zero \
second derivative.

Orthogonalizing the associated matrix creates a matrix that is roughly 50% \
dense.  This seems to be independent of the basis ordering.  For instance, \
going to checkerboard (linearSiteIndex[]) just changes the sparsity pattern. \
\
\>", "Text",ExpressionUUID->"7be3d2d0-2681-4d65-8319-b3a6d628e18f"],

Cell[BoxData[
 RowBox[{"<<", 
  "\"\<../data/3-3/periodic-4-7.5-3.m\>\""}]], \
"Input",ExpressionUUID->"08304c9f-fc06-44f7-8f6e-52e13e4e144a"],

Cell[BoxData[
 RowBox[{"<<", 
  "\"\<../data/3-3/periodic-6-8.175-3.m\>\""}]], \
"Input",ExpressionUUID->"25509c63-5aca-4a64-8df2-b3214f5a2980"],

Cell[BoxData[
 RowBox[{"<<", 
  "\"\<../data/3-3/periodic-22-42-1.m\>\""}]], \
"Input",ExpressionUUID->"aed7d32e-99c3-4103-b2ea-8835d046f9fd"],

Cell["Create trivial lattice with one non-trivial link.", \
"Text",ExpressionUUID->"2e3e6350-ee8a-4237-b197-11dd2f407ac2"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"nd", "=", "3"}], ";", 
  RowBox[{"nc", "=", "2"}], ";", 
  RowBox[{"latticeDimensions", "=", 
   RowBox[{"{", 
    RowBox[{"2", ",", "1", ",", "1"}], "}"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"If", "[", 
   RowBox[{"True", ",", 
    RowBox[{
     RowBox[{"makeTrivialLattice", "[", 
      RowBox[{"randomGauge", "\[Rule]", "False"}], "]"}], ";", 
     RowBox[{"setLink", "[", 
      RowBox[{"2", ",", 
       RowBox[{"{", 
        RowBox[{"1", ",", "1", ",", "1"}], "}"}], ",", 
       RowBox[{"MatrixExp", "[", 
        RowBox[{"I", " ", "Pi", " ", 
         RowBox[{"RandomReal", "[", "]"}], " ", 
         RowBox[{
          RowBox[{"suGenerators", "[", "]"}], "[", 
          RowBox[{"[", "1", "]"}], "]"}]}], "]"}]}], "]"}]}], ",", 
    RowBox[{
     RowBox[{"gaugeField", "=", 
      RowBox[{"Table", "[", 
       RowBox[{
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{"dir", "\[Equal]", "1"}], ",", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{"0", ",", "1"}], "}"}], ",", 
            RowBox[{"{", 
             RowBox[{"1", ",", "0"}], "}"}]}], "}"}], ",", 
          RowBox[{"IdentityMatrix", "[", "nc", "]"}]}], "]"}], ",", 
        RowBox[{"{", 
         RowBox[{"dir", ",", "nd"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"latticeVolume", "[", "]"}], "}"}]}], "]"}]}], ";", 
     RowBox[{"Clear", "[", "linearSiteIndex", "]"}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"Do", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"linearSiteIndex", "[", 
         RowBox[{"latticeCoordinates", "[", "i", "]"}], "]"}], "=", "i"}], 
       ",", 
       RowBox[{"{", 
        RowBox[{"i", ",", 
         RowBox[{"latticeVolume", "[", "]"}]}], "}"}]}], "]"}]}]}], "]"}], 
  ";", 
  RowBox[{
  "averagePlaquette", "[", 
   "]"}]}]}], "Input",ExpressionUUID->"39440a9d-8ba5-4dde-bd8a-99baa4176b07"],

Cell["Create random lattice :", \
"Text",ExpressionUUID->"2dc2c384-2848-43ef-8fb2-ee1a4dac66bf"],

Cell[BoxData[
 RowBox[{
  RowBox[{"nd", "=", "3"}], ";", 
  RowBox[{"nc", "=", "2"}], ";", 
  RowBox[{"latticeDimensions", "=", 
   RowBox[{"{", 
    RowBox[{"2", ",", "2", ",", "2"}], "}"}]}], ";", 
  RowBox[{"gaugeField", "=", 
   RowBox[{"Table", "[", 
    RowBox[{
     RowBox[{"randomSUMatrix", "[", "]"}], ",", 
     RowBox[{"{", "nd", "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"latticeVolume", "[", "]"}], "}"}]}], "]"}]}], ";", 
  RowBox[{"Clear", "[", "linearSiteIndex", "]"}], ";", 
  RowBox[{"Do", "[", 
   RowBox[{
    RowBox[{
     RowBox[{"linearSiteIndex", "[", 
      RowBox[{"latticeCoordinates", "[", "i", "]"}], "]"}], "=", "i"}], ",", 
    RowBox[{"{", 
     RowBox[{"i", ",", 
      RowBox[{"latticeVolume", "[", "]"}]}], "}"}]}], "]"}], ";", 
  RowBox[{
  "averagePlaquette", "[", 
   "]"}]}]], "Input",ExpressionUUID->"52da041f-8b8d-434a-8725-70be19a39e43"],

Cell["\<\
Timing, matrix size, density, and memory use:
See https://mathematica.stackexchange.com/questions/83721/what-are-\
sparsearray-properties-how-and-when-should-they-be-used\
\>", "Text",ExpressionUUID->"0ecd030a-d3cb-455b-87fa-30fce89ac99d"],

Cell[BoxData[
 RowBox[{"Timing", "[", 
  RowBox[{
   RowBox[{"rl", "=", 
    RowBox[{"Chop", "[", 
     RowBox[{"makeRootLattice", "[", "]"}], "]"}]}], ";", 
   "\[IndentingNewLine]", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"Dimensions", "[", 
      RowBox[{"sh", "=", 
       RowBox[{"Chop", "[", 
        RowBox[{"gaugeTransformShifts", "[", "rl", "]"}], "]"}]}], "]"}], ",", 
     RowBox[{"sh", "[", "Density", "]"}], ",", 
     RowBox[{"printMemory", "[", "sh", "]"}]}], "}"}]}], 
  "]"}]], "Input",ExpressionUUID->"76eb98b1-84a2-4e60-a9e6-6ecf06894d8a"],

Cell[CellGroupData[{

Cell["\<\
Look at sh.Transpose[sh] and distribution of right hand sides\
\>", "Subsection",ExpressionUUID->"0719dd29-b183-42ba-83a5-3cd1ab61dc20"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"{", 
    RowBox[{"vals", ",", "oo"}], "}"}], "=", 
   RowBox[{"Eigensystem", "[", 
    RowBox[{"Normal", "[", 
     RowBox[{"sh", ".", 
      RowBox[{"Transpose", "[", "sh", "]"}]}], "]"}], "]"}]}], ";", 
  RowBox[{
  "Dimensions", "[", "oo", 
   "]"}]}]], "Input",ExpressionUUID->"55cb4a2d-4c92-454c-a4df-05dc26e9b6b6"],

Cell["\<\
The matrix is fairly well-conditioned.
get 10.5 for data/3-3/periodic-6-8.175-3.m
get 24 for 3-4/periodic-16-33-4.m\
\>", "Text",ExpressionUUID->"debffc29-ae66-4e34-83ce-f513d75ec61c"],

Cell[BoxData[
 RowBox[{"condition", "[", 
  RowBox[{"sh", ".", 
   RowBox[{"Transpose", "[", "sh", "]"}]}], 
  "]"}]], "Input",ExpressionUUID->"6640c4aa-bdbe-4619-a67b-62bc39ca21fb"],

Cell["\<\
Convergence of conjugate gradients for this matrix is this to the number of \
steps:
get 0.52 for data/3-3/periodic-6-8.175-3.m
and 0.66 for second case\
\>", "Text",ExpressionUUID->"d1fb0cf0-7a57-4d56-b53d-73ab552d9ef1"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(", 
   RowBox[{
    RowBox[{"Sqrt", "[", "%", "]"}], "-", "1"}], ")"}], "/", 
  RowBox[{"(", 
   RowBox[{
    RowBox[{"Sqrt", "[", "%", "]"}], "+", "1"}], 
   ")"}]}]], "Input",ExpressionUUID->"fa98e71c-e7ea-4256-855e-f90255889c2a"],

Cell["Generate and store values of shifts, using flag \
\[OpenCurlyDoubleQuote]storeBB\[CloseCurlyDoubleQuote]", \
"Text",ExpressionUUID->"8094b9a4-339e-4398-ac36-b388df765fb9"],

Cell[BoxData[
 RowBox[{" ", 
  RowBox[{
   RowBox[{"latticeSaddlePointStep", "[", 
    RowBox[{
     RowBox[{"storePairs", "\[Rule]", "True"}], ",", 
     RowBox[{"fixedDir", "\[Rule]", "0"}], ",", 
     RowBox[{"Method", "\[Rule]", "\"\<MINRES\>\""}], ",", 
     RowBox[{"largeShiftSearch", "\[Rule]", "300"}], ",", 
     RowBox[{"storeBB", "\[Rule]", "True"}]}], "]"}], ";", 
   RowBox[{
   "Dimensions", "[", "bb0", 
    "]"}]}]}]], \
"Input",ExpressionUUID->"3a08d05f-2d18-4b59-87cc-74b18de4e037"],

Cell["\<\
Average overlap of b-vectors with each eigenvector of sh.Transpose[sh], \
eigenvectors are sorted by decreasing eigenvalue.\
\>", "Text",ExpressionUUID->"81266947-091b-497d-8d2e-53bb77c43c04"],

Cell[BoxData[
 RowBox[{"ListPlot", "[", 
  RowBox[{
   RowBox[{"Map", "[", 
    RowBox[{
     RowBox[{
      RowBox[{"Norm", "[", 
       RowBox[{"#", ",", "1"}], "]"}], "&"}], ",", 
     RowBox[{"oo", ".", "sh", ".", 
      RowBox[{"Transpose", "[", 
       RowBox[{"Drop", "[", 
        RowBox[{
         RowBox[{"bb0", "/", 
          RowBox[{"Map", "[", 
           RowBox[{"Norm", ",", "bb0"}], "]"}]}], ",", "600"}], "]"}], 
       "]"}]}]}], "]"}], ",", 
   RowBox[{"PlotRange", "\[Rule]", "All"}]}], 
  "]"}]], "Input",ExpressionUUID->"2f8acc2b-0119-484a-8bda-ab75f24ce9ed"],

Cell[BoxData[
 RowBox[{"ListPlot", "[", 
  RowBox[{
   RowBox[{"Map", "[", 
    RowBox[{
     RowBox[{
      RowBox[{"Norm", "[", 
       RowBox[{"#", ",", "1"}], "]"}], "&"}], ",", 
     RowBox[{"oo", ".", "sh", ".", 
      RowBox[{"Transpose", "[", 
       RowBox[{"Orthogonalize", "[", 
        RowBox[{"Drop", "[", 
         RowBox[{"bb0", ",", "600"}], "]"}], "]"}], "]"}]}]}], "]"}], ",", 
   RowBox[{"PlotRange", "\[Rule]", "All"}]}], 
  "]"}]], "Input",ExpressionUUID->"2c1ad669-a47c-4048-b845-0ca12c917d6e"],

Cell["\<\
Overlap of b-vectors with subspace remains large over iterations.\
\>", "Text",ExpressionUUID->"45b28f06-9777-4720-86d8-9176d335ddc8"],

Cell[BoxData[
 RowBox[{"ListPlot", "[", 
  RowBox[{"Map", "[", 
   RowBox[{"Norm", ",", 
    RowBox[{"bb0", ".", 
     RowBox[{"Transpose", "[", "sh", "]"}]}]}], "]"}], 
  "]"}]], "Input",ExpressionUUID->"9cc9bb49-f57e-4506-bc42-cad1b158ad4d"],

Cell["\<\
Fraction of independence of each b-vector from all previous b-vectors after \
transforming into the gauge transform space.  We see that the vectors are \
nearly orthogonal, to start with.  Note that the first iterations are for the \
calculation that locates the large shift eigenvectors of the Hessian.  Then \
comes the iterations associated with finding  the actual shifts.\
\>", "Text",ExpressionUUID->"d11405b7-05aa-40ff-be60-b3b3cfe9cd72"],

Cell[BoxData[
 RowBox[{
  RowBox[{"gbb0", "=", 
   RowBox[{
    RowBox[{"Take", "[", 
     RowBox[{"bb0", ",", "600"}], "]"}], ".", 
    RowBox[{"Transpose", "[", "sh", "]"}]}]}], 
  ";"}]], "Input",ExpressionUUID->"0ba10202-a15b-4ad7-8f55-1c0a7d40f764"],

Cell[BoxData[
 RowBox[{
  RowBox[{"overlaps", "=", 
   RowBox[{"Chop", "[", 
    RowBox[{
     RowBox[{"Block", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"obb", "=", 
         RowBox[{"If", "[", 
          RowBox[{"False", ",", 
           RowBox[{"gbb0", "/", 
            RowBox[{"Map", "[", 
             RowBox[{"Norm", ",", "gbb0"}], "]"}]}], ",", 
           RowBox[{"Orthogonalize", "[", "gbb0", "]"}]}], "]"}]}], "}"}], ",", 
       RowBox[{"Table", "[", 
        RowBox[{
         RowBox[{"Block", "[", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"b", "=", 
             RowBox[{"gbb0", "[", 
              RowBox[{"[", "i", "]"}], "]"}]}], "}"}], ",", 
           RowBox[{
            RowBox[{"b", "=", 
             RowBox[{"b", "/", 
              RowBox[{"Norm", "[", "b", "]"}]}]}], ";", 
            RowBox[{"Do", "[", 
             RowBox[{
              RowBox[{"Block", "[", 
               RowBox[{
                RowBox[{"{", 
                 RowBox[{"ob", "=", 
                  RowBox[{"obb", "[", 
                   RowBox[{"[", "j", "]"}], "]"}]}], "}"}], ",", 
                RowBox[{"b", "=", 
                 RowBox[{"b", "-", 
                  RowBox[{
                   RowBox[{"(", 
                    RowBox[{"ob", ".", "b"}], ")"}], " ", "ob"}]}]}]}], "]"}],
               ",", 
              RowBox[{"{", 
               RowBox[{"j", ",", 
                RowBox[{"i", "-", "1"}]}], "}"}]}], "]"}], ";", 
            RowBox[{"Norm", "[", "b", "]"}]}]}], "]"}], ",", 
         RowBox[{"{", 
          RowBox[{"i", ",", 
           RowBox[{"Length", "[", "gbb0", "]"}]}], "}"}]}], "]"}]}], "]"}], 
     ",", 
     RowBox[{"10", "^", 
      RowBox[{"-", "7"}]}]}], "]"}]}], 
  ";"}]], "Input",ExpressionUUID->"c1eac17e-4019-43e4-9ecc-03d9e5d90cd1"],

Cell[BoxData[
 RowBox[{"ListPlot", "[", "overlaps", 
  "]"}]], "Input",ExpressionUUID->"d722a4e7-d4c2-44b0-83c3-0365d62da9c6"]
}, Closed]],

Cell[CellGroupData[{

Cell["Compare different dynamicPart[ ] methods.", \
"Subsection",ExpressionUUID->"7ec696dc-7108-4ca9-b3b5-f2021e836e11"],

Cell["\<\
Verify that this is equal to the NullSpace[ ] used in the dense calculation.\
\>", "Text",ExpressionUUID->"dc98b006-9e03-4553-ae20-cd9fb7c97fbf"],

Cell[BoxData[
 RowBox[{"Block", "[", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{
     RowBox[{"nsh", "=", 
      RowBox[{"NullSpace", "[", "sh", "]"}]}], ",", 
     RowBox[{"tvec", "=", 
      RowBox[{"RandomReal", "[", 
       RowBox[{"1", ",", 
        RowBox[{"Length", "[", 
         RowBox[{"First", "[", "sh", "]"}], "]"}]}], "]"}]}]}], "}"}], ",", 
   RowBox[{"Norm", "[", 
    RowBox[{
     RowBox[{
      RowBox[{"dynamicPart", "[", "sh", "]"}], "[", "tvec", "]"}], "-", 
     RowBox[{
      RowBox[{"Transpose", "[", "nsh", "]"}], ".", "nsh", ".", "tvec"}]}], 
    "]"}]}], 
  "]"}]], "Input",ExpressionUUID->"fad809e6-63a1-4724-8739-e8157db94d1c"],

Cell[BoxData[
 RowBox[{
  RowBox[{"testProjection", "[", "f_", "]"}], ":=", 
  RowBox[{"Block", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
      RowBox[{"r1", "=", 
       RowBox[{"RandomReal", "[", 
        RowBox[{"1", ",", 
         RowBox[{"{", 
          RowBox[{"Length", "[", 
           RowBox[{"First", "[", "sh", "]"}], "]"}], "}"}]}], "]"}]}], ",", 
      "r2", ",", 
      RowBox[{"t1", "=", 
       RowBox[{"SessionTime", "[", "]"}]}]}], "}"}], ",", 
    RowBox[{
     RowBox[{"r2", "=", 
      RowBox[{"f", "[", "r1", "]"}]}], ";", 
     RowBox[{"Print", "[", 
      RowBox[{"\"\<timing:  \>\"", ",", 
       RowBox[{
        RowBox[{"SessionTime", "[", "]"}], "-", "t1"}], ",", " ", 
       "\"\< s\>\""}], "]"}], ";", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"Norm", "[", 
        RowBox[{"r2", "-", 
         RowBox[{"f", "[", "r2", "]"}]}], "]"}], ",", 
       RowBox[{"Norm", "[", 
        RowBox[{"sh", ".", "r2"}], "]"}]}], "}"}]}]}], "]"}]}]], "Input",
 InitializationCell->
  True,ExpressionUUID->"277005b6-0fa5-467a-89b2-47d426ba8194"],

Cell[BoxData[
 RowBox[{"Timing", "[", 
  RowBox[{
   RowBox[{"(", 
    RowBox[{"dpOrtho", "=", 
     RowBox[{"dynamicPart", "[", "sh", "]"}]}], ")"}], ";"}], 
  "]"}]], "Input",ExpressionUUID->"fc9a90c6-459c-494f-905b-32ab18544655"],

Cell[BoxData[
 RowBox[{"testProjection", "[", "dpOrtho", 
  "]"}]], "Input",ExpressionUUID->"7d44c94a-06c8-4637-9dc7-489ea855785f"],

Cell[BoxData[
 RowBox[{"Timing", "[", 
  RowBox[{
   RowBox[{"(", 
    RowBox[{"dpLeast", "=", 
     RowBox[{"dynamicPart", "[", 
      RowBox[{"sh", ",", 
       RowBox[{"Method", "\[Rule]", "\"\<LeastSquares\>\""}]}], "]"}]}], 
    ")"}], ";"}], 
  "]"}]], "Input",ExpressionUUID->"f5ce9c6e-51a9-4fdd-8b48-46cdca20ba92"],

Cell[BoxData[
 RowBox[{"testProjection", "[", "dpLeast", 
  "]"}]], "Input",ExpressionUUID->"cda52ce3-5135-4684-8ba4-6058e5a9a9e2"],

Cell[BoxData[
 RowBox[{"Timing", "[", 
  RowBox[{
   RowBox[{"(", 
    RowBox[{"dpLinear", "=", 
     RowBox[{"dynamicPart", "[", 
      RowBox[{"sh", ",", 
       RowBox[{"Method", "\[Rule]", "\"\<LinearSolve\>\""}]}], "]"}]}], ")"}],
    ";"}], "]"}]], \
"Input",ExpressionUUID->"463f2d4e-a959-409a-a065-8c7465000bb2"],

Cell["\<\
For 3-3/periodic-22, 182s, 77MB memory, gaugeTransformShifts 132MB, trouble \
converging.  Looks like the Krylov method just stores the matrix until \
solving.\
\>", "Text",ExpressionUUID->"39d4ce56-eabc-400a-ad0d-f08908b56230"],

Cell[BoxData[
 RowBox[{"Timing", "[", 
  RowBox[{
   RowBox[{"(", 
    RowBox[{"dpLinear", "=", 
     RowBox[{"dynamicPart", "[", 
      RowBox[{"sh", ",", 
       RowBox[{"Method", "\[Rule]", 
        RowBox[{"{", 
         RowBox[{"\"\<LinearSolve\>\"", ",", 
          RowBox[{"Method", "\[Rule]", 
           RowBox[{"{", 
            RowBox[{"\"\<Krylov\>\"", ",", 
             RowBox[{
             "\"\<Method\>\"", "\[Rule]", "\"\<ConjugateGradient\>\""}], ",", 
             
             RowBox[{"\"\<Tolerance\>\"", "\[Rule]", 
              RowBox[{"10", "^", 
               RowBox[{"-", "9"}]}]}]}], "}"}]}]}], "}"}]}]}], "]"}]}], ")"}],
    ";"}], "]"}]], \
"Input",ExpressionUUID->"8b3e902f-7dde-4eb9-bfb7-7ddb75b9018c"],

Cell[BoxData[
 RowBox[{"testProjection", "[", "dpLinear", 
  "]"}]], "Input",ExpressionUUID->"69da07cc-cdb9-4142-833f-e650c90205e7"],

Cell[BoxData[
 RowBox[{"Timing", "[", 
  RowBox[{
   RowBox[{"dpzLinear", "=", 
    RowBox[{"dynamicPart", "[", 
     RowBox[{"sh", ",", 
      RowBox[{"Method", "\[Rule]", 
       RowBox[{"{", 
        RowBox[{"\"\<MINRES\>\"", ",", 
         RowBox[{"printDetails", "\[Rule]", "1"}], ",", 
         RowBox[{"rTolerance", "\[Rule]", 
          RowBox[{"10", "^", 
           RowBox[{"-", "10"}]}]}]}], "}"}]}]}], "]"}]}], ";"}], 
  "]"}]], "Input",ExpressionUUID->"65d12926-d2c3-4165-a44e-15de6aeba532"],

Cell["\<\
Faster than built-in Conjugate gradients, perhaps because we don\
\[CloseCurlyQuote]t explicitly construct the matrix.\
\>", "Text",ExpressionUUID->"4fca43ce-11f0-43d2-a39a-5f6a91c01b52"],

Cell[BoxData[
 RowBox[{"testProjection", "[", "dpzLinear", 
  "]"}]], "Input",ExpressionUUID->"f6da0bd4-c5ea-48b8-b584-5b3c83862554"]
}, Closed]],

Cell[CellGroupData[{

Cell["Improve sparsity of gauge invariant shift matrix", \
"Subsection",ExpressionUUID->"95ec3cb4-995e-4832-baab-242e92a90d93"],

Cell[BoxData[
 RowBox[{"MatrixPlot", "[", "sh", 
  "]"}]], "Input",ExpressionUUID->"70061512-c3c4-4932-9a7f-4cc7ac539b76"],

Cell["\<\
Orthonormal basis of gauge transforms.  We see that we get roughly 50% \
sparsity.\
\>", "Text",ExpressionUUID->"7a750240-d253-450c-8b0e-877cf2788fdd"],

Cell[BoxData[
 RowBox[{"MatrixPlot", "[", 
  RowBox[{"osh", "=", 
   RowBox[{"SparseArray", "[", 
    RowBox[{"Chop", "[", 
     RowBox[{"Orthogonalize", "[", "sh", "]"}], "]"}], "]"}]}], 
  "]"}]], "Input",ExpressionUUID->"6fe32da2-4f96-4c29-9b98-f8b8841583c2"],

Cell[BoxData[
 RowBox[{"osh", "[", "Density", 
  "]"}]], "Input",ExpressionUUID->"dc9a797a-d1ab-41d1-b2cb-b43a18b4a147"],

Cell[BoxData[
 RowBox[{
  RowBox[{"lastZero", "[", "x_", "]"}], ":=", 
  RowBox[{"Block", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"j", "=", "None"}], "}"}], ",", 
    RowBox[{
     RowBox[{"Do", "[", 
      RowBox[{
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"x", "[", 
           RowBox[{"[", "i", "]"}], "]"}], "\[Equal]", "0"}], ",", 
         RowBox[{"j", "=", "i"}]}], "]"}], ",", 
       RowBox[{"{", 
        RowBox[{"i", ",", 
         RowBox[{"Length", "[", "x", "]"}]}], "}"}]}], "]"}], ";", "j"}]}], 
   "]"}]}]], "Input",
 InitializationCell->
  True,ExpressionUUID->"820ec01d-6689-42c3-b971-3f5fddd84a93"],

Cell["\<\
Try to sort rows so that Orthogonalize[..] is more sparse.  This essentially \
didn\[CloseCurlyQuote]t work. \
\>", "Text",ExpressionUUID->"a5ee9a4a-17f3-4003-9ab0-be29b294885b"],

Cell["Octahedral plus tetrahedral tessellation of the lattice.", \
"Text",ExpressionUUID->"f2a84d21-108c-4fd4-a849-387c6becb6ba"],

Cell[BoxData[
 RowBox[{
  RowBox[{"Clear", "[", "allPlanes", "]"}], ";", 
  RowBox[{
   RowBox[{"allPlanes", "[", "]"}], ":=", 
   RowBox[{"allPlanes", "[", "nd", "]"}]}], ";", 
  RowBox[{
   RowBox[{"allPlanes", "[", "nd_", "]"}], ":=", 
   RowBox[{
    RowBox[{"allPlanes", "[", "nd", "]"}], "=", 
    RowBox[{"Table", "[", 
     RowBox[{
      RowBox[{
       RowBox[{"2", "*", 
        RowBox[{"BitAnd", "[", 
         RowBox[{"1", ",", 
          RowBox[{"BitShiftRight", "[", 
           RowBox[{
            RowBox[{"i", "-", "1"}], ",", 
            RowBox[{"j", "-", "1"}]}], "]"}]}], "]"}]}], "-", "1"}], ",", 
      RowBox[{"{", 
       RowBox[{"i", ",", 
        RowBox[{"2", "^", 
         RowBox[{"(", 
          RowBox[{"nd", "-", "1"}], ")"}]}]}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{"j", ",", "nd"}], "}"}]}], 
     "]"}]}]}]}]], \
"Input",ExpressionUUID->"788ee36e-7285-481a-b584-1c6bde19ab0b"],

Cell["Cubic tessellation of the lattice", \
"Text",ExpressionUUID->"899765d0-c57a-4e06-9b66-1e954b35164d"],

Cell[BoxData[
 RowBox[{
  RowBox[{"Clear", "[", "allPlanes", "]"}], ";", 
  RowBox[{
   RowBox[{"allPlanes", "[", "]"}], ":=", 
   RowBox[{"allPlanes", "[", "nd", "]"}]}], ";", 
  RowBox[{
   RowBox[{"allPlanes", "[", "nd_", "]"}], ":=", 
   RowBox[{
    RowBox[{"allPlanes", "[", "nd", "]"}], "=", 
    RowBox[{
    "IdentityMatrix", "[", "nd", 
     "]"}]}]}]}]], \
"Input",ExpressionUUID->"e581cc7d-dc42-4af9-b3f0-c23e8e3c7906"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"coordRank", "[", "coords_", "]"}], ":=", 
   RowBox[{"coordRank", "[", 
    RowBox[{"coords", ",", 
     RowBox[{"Total", "[", "latticeDimensions", "]"}]}], "]"}]}], ";", 
  RowBox[{
   RowBox[{"coordRank", "[", 
    RowBox[{"coords_", ",", "top_"}], "]"}], ":=", 
   RowBox[{"Block", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"cc", "=", 
        RowBox[{
         RowBox[{"allPlanes", "[", "]"}], ".", "coords"}]}], ",", 
       RowBox[{"i", "=", "1"}]}], "}"}], ",", 
     RowBox[{
      RowBox[{"While", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"AnyTrue", "[", 
          RowBox[{
           RowBox[{"Mod", "[", 
            RowBox[{"cc", ",", 
             RowBox[{"2", "^", "i"}]}], "]"}], ",", 
           RowBox[{
            RowBox[{"#", "==", "0"}], "&"}]}], "]"}], "&&", 
         RowBox[{
          RowBox[{"2", "^", "i"}], "<", "top"}]}], ",", 
        RowBox[{"i", "+=", "1"}]}], "]"}], ";", 
      RowBox[{"If", "[", 
       RowBox[{"True", " ", 
        RowBox[{"(*", " ", 
         RowBox[{"For", " ", "debugging"}], " ", "*)"}], ",", 
        RowBox[{
         RowBox[{
          RowBox[{"(", 
           RowBox[{"i", "-", "1"}], ")"}], "*", 
          RowBox[{"Length", "[", "cc", "]"}]}], "+", 
         RowBox[{"lastZero", "[", 
          RowBox[{"Mod", "[", 
           RowBox[{"cc", ",", 
            RowBox[{"2", "^", 
             RowBox[{"(", 
              RowBox[{"i", "-", "1"}], ")"}]}]}], "]"}], "]"}]}], ",", 
        RowBox[{"{", 
         RowBox[{"i", ",", 
          RowBox[{"Mod", "[", 
           RowBox[{"cc", ",", 
            RowBox[{"2", "^", 
             RowBox[{"(", 
              RowBox[{"i", "-", "1"}], ")"}]}]}], "]"}]}], "}"}]}], "]"}]}]}],
     "]"}]}]}]], \
"Input",ExpressionUUID->"cd8419d7-5396-4b69-ab57-e7436a8cfc18"],

Cell[BoxData[
 RowBox[{"TableForm", "[", 
  RowBox[{
   RowBox[{"Table", "[", 
    RowBox[{
     RowBox[{"coordRank", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"4", ",", "i", ",", "j"}], "}"}], ",", 
       RowBox[{"3", "*", "16"}]}], "]"}], ",", 
     RowBox[{"{", 
      RowBox[{"i", ",", "16"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"j", ",", "16"}], "}"}]}], "]"}], ",", 
   RowBox[{"TableDepth", "\[Rule]", "2"}]}], 
  "]"}]], "Input",ExpressionUUID->"999f503e-92c8-48d9-a91e-0e1982afc6ca"],

Cell[BoxData[
 RowBox[{
  RowBox[{"checkerboardRank", "[", "]"}], ":=", 
  RowBox[{"Block", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
      RowBox[{"y", "=", 
       RowBox[{"Array", "[", 
        RowBox[{
         RowBox[{"Null", "&"}], ",", 
         RowBox[{"{", 
          RowBox[{"nGauge", "[", "0", "]"}], "}"}]}], "]"}]}], ",", 
      "gindex"}], "}"}], ",", 
    RowBox[{
     RowBox[{"Do", "[", 
      RowBox[{
       RowBox[{"Block", "[", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"coords", "=", 
           RowBox[{"latticeCoordinates", "[", "i", "]"}]}], "}"}], ",", 
         RowBox[{
          RowBox[{"gindex", "=", 
           RowBox[{
            RowBox[{"coords2gauge", "[", "0", "]"}], "[", 
            RowBox[{"coords", ",", "ca"}], "]"}]}], ";", 
          RowBox[{
           RowBox[{"y", "[", 
            RowBox[{"[", "gindex", "]"}], "]"}], "=", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"ca", "+", 
              RowBox[{
               RowBox[{"(", 
                RowBox[{
                 RowBox[{"nc", "^", "2"}], "-", "1"}], ")"}], 
               RowBox[{"coordRank", "[", "coords", "]"}]}]}], ",", "gindex"}],
             "}"}]}]}]}], "]"}], ",", 
       RowBox[{"{", 
        RowBox[{"i", ",", 
         RowBox[{"latticeVolume", "[", "]"}]}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"ca", ",", 
         RowBox[{
          RowBox[{"nc", "^", "2"}], "-", "1"}]}], "}"}]}], "]"}], ";", 
     RowBox[{"Map", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"#", "[", 
         RowBox[{"[", "2", "]"}], "]"}], "&"}], ",", 
       RowBox[{"Sort", "[", "y", "]"}]}], "]"}]}]}], 
   "]"}]}]], "Input",ExpressionUUID->"59f3bfa4-f1af-40db-a051-9cdbd8aa7197"],

Cell[BoxData[
 RowBox[{"osh2", "=", 
  RowBox[{"SparseArray", "[", 
   RowBox[{"Chop", "[", 
    RowBox[{"Orthogonalize", "[", 
     RowBox[{"sh", "[", 
      RowBox[{"[", 
       RowBox[{"checkerboardRank", "[", "]"}], "]"}], "]"}], "]"}], "]"}], 
   "]"}]}]], "Input",ExpressionUUID->"4f16507b-f89f-4c78-abf3-c1cc071cd5b2"],

Cell[BoxData[
 RowBox[{"MatrixPlot", "[", "osh2", 
  "]"}]], "Input",ExpressionUUID->"9d35c5c2-d0b1-4172-ace3-4f11f848e40c"],

Cell[BoxData[
 RowBox[{"osh2", "[", "Density", 
  "]"}]], "Input",ExpressionUUID->"7821b034-b595-4804-a30c-b82b97ace6b9"],

Cell[BoxData[
 RowBox[{"MatrixPlot", "[", 
  RowBox[{"sshh", "=", 
   RowBox[{"Chop", "[", 
    RowBox[{"sh", ".", 
     RowBox[{"Transpose", "[", "sh", "]"}]}], "]"}]}], 
  "]"}]], "Input",ExpressionUUID->"6e48f94b-14e9-415a-b0b3-5cfb3db20060"],

Cell[BoxData[
 RowBox[{"sshh", "[", "Density", 
  "]"}]], "Input",ExpressionUUID->"99bab5d8-7e49-4ef9-99e7-ab60a603ae3f"]
}, Closed]],

Cell[CellGroupData[{

Cell["Dynamic space projection properties", \
"Subsection",ExpressionUUID->"84945386-0274-4dda-ab03-98533f727960"],

Cell["\<\
Transpose[sh].sh is symmetric positive semi-definite.  The null space \
corresponds to non-gauge shifts.  Note that Transpose[sh].sh is still quite \
sparse.\
\>", "Text",ExpressionUUID->"84e021f8-8f1d-420c-a6f4-1f0df56b234a"],

Cell[BoxData[
 RowBox[{"ListPlot", "[", 
  RowBox[{"Sort", "[", 
   RowBox[{"Eigenvalues", "[", 
    RowBox[{"Normal", "[", 
     RowBox[{
      RowBox[{"Transpose", "[", "sh", "]"}], ".", "sh"}], "]"}], "]"}], "]"}],
   "]"}]], "Input",ExpressionUUID->"dfbe4a57-40b5-4515-b563-a5f395e8a110"],

Cell["\<\
Test that the gradients are orthogonal to all gauge transforms.\
\>", "Text",ExpressionUUID->"35a8f3a8-a887-49c3-8acc-3ee9001c32a4"],

Cell[BoxData[
 RowBox[{"Tally", "[", 
  RowBox[{"Chop", "[", 
   RowBox[{"sh", ".", "grad0"}], "]"}], 
  "]"}]], "Input",ExpressionUUID->"7db26175-9b80-494b-8888-3409aceedff4"],

Cell["\<\
However, since the Hessian is quadratic in the shifts, it is not necessarily \
in the direction of two infinitesimal gauge transforms.\
\>", "Text",ExpressionUUID->"d9f29dfa-1e72-4448-9502-e04444a962b3"],

Cell[BoxData[
 RowBox[{"MatrixPlot", "[", 
  RowBox[{"Chop", "[", 
   RowBox[{"sh", ".", "hess0", ".", 
    RowBox[{"Transpose", "[", "sh", "]"}]}], "]"}], 
  "]"}]], "Input",ExpressionUUID->"e9d4c17e-10fa-402a-9cd0-41d585ebd3dc"],

Cell["\<\
Project onto subspace of physical degrees of freedom, this results in a dense \
matrix.\
\>", "Text",ExpressionUUID->"41e877bd-9b8d-40b2-b53d-6e2d5b129db0"],

Cell[BoxData[
 RowBox[{"MatrixPlot", "[", 
  RowBox[{"Chop", "[", 
   RowBox[{"proj", "=", 
    RowBox[{"NullSpace", "[", "sh", "]"}]}], "]"}], 
  "]"}]], "Input",ExpressionUUID->"77278033-ba93-4097-a567-46cc8fc2199b"]
}, Closed]],

Cell[CellGroupData[{

Cell["Adjoint trace identity", \
"Subsection",ExpressionUUID->"35821692-ae2e-4be9-8b36-81e36ad24ba8"],

Cell["\<\
Verify unitarity of the adjoint color matrix for some random element of \
SU(nc):  
        2 Tr[u.suGenerator[a].ConjugateTranspose[u].suGenerator[b]].  
Also, this matrix should be real-valued.  This matrix comes up in the \
analytic calculations.\
\>", "Text",ExpressionUUID->"ad643e66-0715-413a-b3f1-3f02225a0d27"],

Cell[BoxData[
 RowBox[{"Block", "[", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{
     RowBox[{"nc", "=", "3"}], ",", "u"}], "}"}], ",", 
   RowBox[{
    RowBox[{"u", "=", 
     RowBox[{"randomSUMatrix", "[", "]"}]}], ";", 
    RowBox[{"ff", "=", 
     RowBox[{"Chop", "[", 
      RowBox[{"Outer", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"2", " ", 
          RowBox[{"Tr", "[", 
           RowBox[{"u", ".", "#1", ".", 
            RowBox[{"ConjugateTranspose", "[", "u", "]"}], ".", "#2"}], 
           "]"}]}], "&"}], ",", 
        RowBox[{"suGenerators", "[", "]"}], ",", 
        RowBox[{"suGenerators", "[", "]"}], ",", "1"}], "]"}], "]"}]}], ";", 
    RowBox[{"ff2", "=", 
     RowBox[{"Chop", "[", 
      RowBox[{"Outer", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"2", " ", 
          RowBox[{"Tr", "[", 
           RowBox[{"u", ".", "u", ".", "#1", ".", 
            RowBox[{"ConjugateTranspose", "[", 
             RowBox[{"u", ".", "u"}], "]"}], ".", "#2"}], "]"}]}], "&"}], ",", 
        RowBox[{"suGenerators", "[", "]"}], ",", 
        RowBox[{"suGenerators", "[", "]"}], ",", "1"}], "]"}], "]"}]}], 
    ";"}]}], "]"}]], \
"Input",ExpressionUUID->"c854da1d-f86e-42fb-b758-43d172c442bf"],

Cell[BoxData[
 RowBox[{"Chop", "[", 
  RowBox[{"ff", ".", 
   RowBox[{"ConjugateTranspose", "[", "ff", "]"}]}], 
  "]"}]], "Input",ExpressionUUID->"218317ee-6919-443e-9bcd-259eb72b11f8"],

Cell[BoxData[
 RowBox[{"Tally", "[", 
  RowBox[{"Flatten", "[", 
   RowBox[{"Chop", "[", 
    RowBox[{
     RowBox[{"ff", ".", "ff"}], "-", "ff2"}], "]"}], "]"}], 
  "]"}]], "Input",ExpressionUUID->"cceea3f8-51ac-42d0-a2ed-7fb44da35128"]
}, Closed]]
}, Closed]],

Cell[CellGroupData[{

Cell["String tension", \
"Section",ExpressionUUID->"b3691e17-548f-480b-94c5-a99587fee159"],

Cell["\<\
First, load base lattice configuration so lattice parameters (nc, nd, et \
cetera) are defined.\
\>", "Text",ExpressionUUID->"8f4ae613-3a2d-4efc-a07c-167a7422d02a"],

Cell["\<\
When looking at the saddle point, we need to store the original \
averagePlaquette[]\
\>", "Text",ExpressionUUID->"e8458b32-b95e-483f-bab3-8d18bfaf56f6"],

Cell[BoxData[
 RowBox[{
  RowBox[{"<<", "\"\<../data/3-3/periodic-16-28-5.m\>\""}], ";", 
  RowBox[{"avgP", "=", 
   RowBox[{
   "averagePlaquette", "[", 
    "]"}]}]}]], \
"Input",ExpressionUUID->"52d38b35-9310-4834-a96c-f99622483942"],

Cell[BoxData[
 RowBox[{
  RowBox[{"<<", "\"\<../data/3-3/step-16-28-5-a-1.m\>\""}], ";", 
  RowBox[{"gaugeField", "=", "gaugeField0"}], ";", 
  RowBox[{
  "averagePlaquette", "[", 
   "]"}]}]], "Input",ExpressionUUID->"e0d4d9d4-d6ed-4fd1-a6ec-5c43cbf3cd93"],

Cell[BoxData[
 RowBox[{
  RowBox[{"<<", "\"\<../data/3-3/step-16-28-5-b-1.m\>\""}], ";", 
  RowBox[{"gaugeField", "=", "gaugeField0"}], ";", 
  RowBox[{
  "averagePlaquette", "[", 
   "]"}]}]], "Input",ExpressionUUID->"8c255860-3eb5-40f6-be00-2a04d8dd084b"],

Cell[BoxData[
 RowBox[{
  RowBox[{"<<", "\"\<../data/3-3/step-16-28-5-e-4.m\>\""}], ";", 
  RowBox[{"gaugeField", "=", "gaugeField0"}], ";", 
  RowBox[{
  "averagePlaquette", "[", 
   "]"}]}]], "Input",ExpressionUUID->"69b3dce7-7fe8-4e0b-9a9e-4fe526ccba22"],

Cell[BoxData[
 RowBox[{
  RowBox[{"<<", "\"\<../data/3-3/step-16-28-5-f-4.m\>\""}], ";", 
  RowBox[{"gaugeField", "=", "gaugeField0"}], ";", 
  RowBox[{
  "averagePlaquette", "[", 
   "]"}]}]], "Input",ExpressionUUID->"e4a67824-559f-4149-94cd-1392b84430f0"],

Cell[BoxData[
 RowBox[{
  RowBox[{"<<", "\"\<../data/3-3/periodic-22-42-1.m\>\""}], 
  ";"}]], "Input",ExpressionUUID->"52269dbd-6fff-44cb-ac17-880b9fc6a34a"],

Cell[BoxData[
 RowBox[{
  RowBox[{"<<", "\"\<../data/3-3/step-22-42-1-a-1.m\>\""}], ";", 
  RowBox[{"gaugeField", "=", "gaugeField0"}], 
  ";"}]], "Input",ExpressionUUID->"7518c34a-fb9f-48c3-8817-55b2d5bc2ad2"],

Cell[BoxData[
 RowBox[{
  RowBox[{"<<", "\"\<../data/3-3/step-22-42-1-b-1.m\>\""}], ";", 
  RowBox[{"gaugeField", "=", "gaugeField0"}], 
  ";"}]], "Input",ExpressionUUID->"5309242a-4c34-4e3d-85e6-fdcd4562c7c4"],

Cell[BoxData[
 RowBox[{
  RowBox[{"<<", "\"\<../data/3-3/step-22-42-1-c-1.m\>\""}], ";", 
  RowBox[{"gaugeField", "=", "gaugeField0"}], 
  ";"}]], "Input",ExpressionUUID->"56507e3f-d2e6-484f-a4aa-066e88affd15"],

Cell[BoxData[
 RowBox[{
  RowBox[{"<<", "\"\<../data/3-4/periodic-16-37-5.m\>\""}], ";", 
  RowBox[{"avgP", "=", 
   RowBox[{
   "averagePlaquette", "[", 
    "]"}]}]}]], \
"Input",ExpressionUUID->"47a986a2-8578-451b-a63d-337548ecc17c"],

Cell[BoxData[
 RowBox[{
  RowBox[{"<<", "\"\<../data/3-4/step-16-37-5-b-1.m\>\""}], ";", 
  RowBox[{"gaugeField", "=", "gaugeField0"}], ";", 
  RowBox[{
  "averagePlaquette", "[", 
   "]"}]}]], "Input",ExpressionUUID->"51afa43f-e2eb-44c2-a014-7048c71c91fb"],

Cell[BoxData[
 RowBox[{
  RowBox[{"<<", "\"\<../data/3-4/periodic-16-48-5.m\>\""}], ";", 
  RowBox[{"avgP", "=", 
   RowBox[{
   "averagePlaquette", "[", 
    "]"}]}]}]], \
"Input",ExpressionUUID->"bcb3e3c0-0ef1-493d-9373-ee2ccba35661"],

Cell[BoxData[
 RowBox[{
  RowBox[{"<<", "\"\<../data/3-4/step-16-48-5-a-1.m\>\""}], ";", 
  RowBox[{"gaugeField", "=", "gaugeField0"}], ";", 
  RowBox[{
  "averagePlaquette", "[", 
   "]"}]}]], "Input",ExpressionUUID->"f5c6f9f4-21a1-41a1-9e39-cc3caf27ffc1"],

Cell[BoxData[
 RowBox[{"loopThickness", "[", 
  "]"}]], "Input",ExpressionUUID->"1678686a-bc4a-46ff-9c10-bb2c37a9bcfe"],

Cell["\<\
Generally, smeared results are closer to the Teper published values.\
\>", "Text",ExpressionUUID->"67bd5de3-adab-4f0e-9044-48870319d7f5"],

Cell[BoxData[
 RowBox[{"tallyData", "=", 
  RowBox[{"talliesToAverageErrors", "[", 
   RowBox[{"polyakovLoopTallies", "[", "\"\<simple\>\"", "]"}], 
   "]"}]}]], "Input",ExpressionUUID->"25a9b774-f852-46f2-aef7-58df4dbc94ed"],

Cell[BoxData[
 RowBox[{"tallyData", "=", 
  RowBox[{"talliesToAverageErrors", "[", 
   RowBox[{"polyakovLoopTallies", "[", "\"\<smeared\>\"", "]"}], 
   "]"}]}]], "Input",ExpressionUUID->"8b48f09a-6d70-4b26-8e48-468d239f8271"],

Cell["Teper's published string tension squared.", \
"Text",ExpressionUUID->"bb05cf4f-f2da-43b1-b9fe-e58144e6103d"],

Cell[BoxData[
 RowBox[{"squareValue", "[", 
  RowBox[{"teperTension", "[", 
   RowBox[{"nd", ",", "nc", ",", "beta", ",", "avgP"}], "]"}], 
  "]"}]], "Input",ExpressionUUID->"93d29836-d8f8-421b-a97c-8f03be6062d9"],

Cell[BoxData[
 RowBox[{"squareValue", "[", 
  RowBox[{"teperTension", "[", 
   RowBox[{"3", ",", "4", ",", "48", ",", "0.89"}], "]"}], 
  "]"}]], "Input",ExpressionUUID->"23b299b7-3bd0-49d0-ba73-8c57160bf5d3"],

Cell[BoxData[
 RowBox[{
  RowBox[{"ff", "=", 
   RowBox[{"exponentialModel", "[", 
    RowBox[{"tallyData", ",", 
     RowBox[{"printResult", "\[Rule]", "True"}]}], "]"}]}], 
  ";"}]], "Input",ExpressionUUID->"aa6430b1-dfc2-4a6e-9514-05ee903ee29a"],

Cell[BoxData[
 RowBox[{"Inner", "[", 
  RowBox[{
   RowBox[{
    RowBox[{"{", 
     RowBox[{
      RowBox[{"#1", "[", 
       RowBox[{"[", "1", "]"}], "]"}], ",", 
      RowBox[{"#1", "[", 
       RowBox[{"[", "2", "]"}], "]"}], ",", "#2"}], "}"}], "&"}], ",", 
   RowBox[{"ff", "[", "\"\<BestFitParameters\>\"", "]"}], ",", 
   RowBox[{"ff", "[", "\"\<ParameterErrors\>\"", "]"}], ",", "List"}], 
  "]"}]], "Input",ExpressionUUID->"a84dde52-7a65-478b-92ba-f9c85bebcaa4"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"Format", "[", "a2sigma", "]"}], "=", 
   RowBox[{"SequenceForm", "[", 
    RowBox[{
     RowBox[{
      RowBox[{"Style", "[", 
       RowBox[{"a", ",", "Italic"}], "]"}], "^", "2"}], ",", "\[Sigma]"}], 
    "]"}]}], ";"}], "\n", 
 RowBox[{"Block", "[", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{
     RowBox[{"nn", "=", 
      RowBox[{"Normal", "[", "tallyData", "]"}]}], ",", "maxx", ",", "miny", 
     ",", "maxy"}], "}"}], ",", 
   RowBox[{
    RowBox[{"maxx", "=", 
     RowBox[{
      RowBox[{"Max", "[", 
       RowBox[{"Map", "[", 
        RowBox[{"First", ",", "nn"}], "]"}], "]"}], "+", "0.5"}]}], ";", 
    RowBox[{"maxy", "=", 
     RowBox[{"Max", "[", 
      RowBox[{"Map", "[", 
       RowBox[{
        RowBox[{
         RowBox[{
          RowBox[{"#", "[", 
           RowBox[{"[", 
            RowBox[{"2", ",", "1"}], "]"}], "]"}], "+", 
          RowBox[{"1.5", " ", 
           RowBox[{"#", "[", 
            RowBox[{"[", 
             RowBox[{"2", ",", "2"}], "]"}], "]"}]}]}], "&"}], ",", "nn"}], 
       "]"}], "]"}]}], ";", 
    RowBox[{"miny", "=", 
     RowBox[{"Min", "[", 
      RowBox[{"0", ",", 
       RowBox[{"Min", "[", 
        RowBox[{"Map", "[", 
         RowBox[{
          RowBox[{
           RowBox[{
            RowBox[{"#", "[", 
             RowBox[{"[", 
              RowBox[{"2", ",", "1"}], "]"}], "]"}], "-", 
            RowBox[{"1.5", " ", 
             RowBox[{"#", "[", 
              RowBox[{"[", 
               RowBox[{"2", ",", "2"}], "]"}], "]"}]}]}], "&"}], ",", "nn"}], 
         "]"}], "]"}]}], "]"}]}], ";", 
    RowBox[{"Show", "[", 
     RowBox[{
      RowBox[{"ErrorListPlot", "[", 
       RowBox[{
        RowBox[{"Map", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"{", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{
               RowBox[{"#", "[", 
                RowBox[{"[", "1", "]"}], "]"}], ",", 
               RowBox[{"#", "[", 
                RowBox[{"[", 
                 RowBox[{"2", ",", "1"}], "]"}], "]"}]}], "}"}], ",", 
             RowBox[{"ErrorBar", "[", 
              RowBox[{"#", "[", 
               RowBox[{"[", 
                RowBox[{"2", ",", "2"}], "]"}], "]"}], "]"}]}], "}"}], "&"}], 
          ",", "nn"}], "]"}], ",", 
        RowBox[{"PlotRange", "\[Rule]", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"0", ",", "maxx"}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"miny", ",", "maxy"}], "}"}]}], "}"}]}], ",", 
        RowBox[{"Epilog", "\[Rule]", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"Text", "[", 
            RowBox[{
             RowBox[{"ColumnForm", "[", 
              RowBox[{"Join", "[", 
               RowBox[{
                RowBox[{"Map", "[", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"Row", "[", 
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{"#", "[", 
                    RowBox[{"[", 
                    RowBox[{"1", ",", "1"}], "]"}], "]"}], ",", "\"\< = \>\"",
                     ",", 
                    RowBox[{"#", "[", 
                    RowBox[{"[", 
                    RowBox[{"1", ",", "2"}], "]"}], "]"}], ",", 
                    "\"\<\[PlusMinus]\>\"", ",", 
                    RowBox[{"#", "[", 
                    RowBox[{"[", "2", "]"}], "]"}]}], "}"}], "]"}], "&"}], 
                  ",", 
                  RowBox[{"Transpose", "[", 
                   RowBox[{"ff", "[", 
                    RowBox[{"{", 
                    RowBox[{
                    "\"\<BestFitParameters\>\"", ",", 
                    "\"\<ParameterErrors\>\""}], "}"}], "]"}], "]"}]}], "]"}],
                 ",", 
                RowBox[{"{", 
                 RowBox[{
                  RowBox[{"Row", "[", 
                   RowBox[{"{", 
                    RowBox[{"\"\<\[Beta] = \>\"", ",", 
                    RowBox[{"N", "[", "beta", "]"}], ",", 
                    "\"\<, \!\(\*SubscriptBox[\(N\), \(d\)]\) = \>\"", ",", 
                    "nd", ",", 
                    "\"\<, \!\(\*SubscriptBox[\(N\), \(c\)]\) = \>\"", ",", 
                    "nc"}], "}"}], "]"}], ",", 
                  RowBox[{"Row", "[", 
                   RowBox[{"{", 
                    RowBox[{"\"\<lattice = \>\"", ",", 
                    RowBox[{"Row", "[", 
                    RowBox[{"latticeDimensions", ",", "\"\<, \>\""}], "]"}]}],
                     "}"}], "]"}]}], "}"}]}], "]"}], "]"}], ",", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"maxx", "*", "0.9"}], ",", 
               RowBox[{"maxy", "*", "0.9"}]}], "}"}], ",", 
             RowBox[{"{", 
              RowBox[{"1", ",", "1"}], "}"}]}], "]"}], ",", 
           RowBox[{"Dashing", "[", ".02", "]"}], ",", "Gray", ",", 
           RowBox[{"Line", "[", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{"0", ",", "0"}], "}"}], ",", 
              RowBox[{"{", 
               RowBox[{"maxx", ",", "0"}], "}"}]}], "}"}], "]"}]}], "}"}]}], 
        ",", 
        RowBox[{"Axes", "\[Rule]", "False"}], ",", 
        RowBox[{"Frame", "\[Rule]", "True"}], ",", 
        RowBox[{"FrameLabel", "\[Rule]", 
         RowBox[{"{", 
          RowBox[{
          "\"\<area enclosed (plaquettes)\>\"", ",", 
           "\"\<Polyakov loop correlator\>\""}], "}"}]}]}], "]"}], ",", 
      RowBox[{"Plot", "[", 
       RowBox[{
        RowBox[{"ff", "[", "x", "]"}], ",", 
        RowBox[{"{", 
         RowBox[{"x", ",", "0", ",", "maxx"}], "}"}], ",", 
        RowBox[{"PlotRange", "\[Rule]", "All"}]}], "]"}]}], "]"}]}]}], 
  "]"}]}], "Input",ExpressionUUID->"8497e53e-6048-4af5-9f48-fddcf95862ec"],

Cell[BoxData[
 RowBox[{"540.", "/", 
  "12"}]], "Input",ExpressionUUID->"1ff30059-73ab-4346-b19a-22d28a149cfa"],

Cell[BoxData[
 RowBox[{"DialogInput", "[", 
  RowBox[{"Column", "[", 
   RowBox[{"{", 
    RowBox[{"\"\<Detached remote program started.\>\"", ",", " ", 
     RowBox[{"Button", "[", 
      RowBox[{"\"\<Read results.\>\"", ",", 
       RowBox[{"DialogReturn", "[", "True", "]"}]}], "]"}]}], "}"}], "]"}], 
  "]"}]], "Input",ExpressionUUID->"be44bb37-2367-480e-9796-d32d9c96acd4"],

Cell[CellGroupData[{

Cell["Trajectories", \
"Subsection",ExpressionUUID->"5174b2e9-6ea6-41ca-b9b2-3f5954fea1a3"],

Cell[CellGroupData[{

Cell["Calc", \
"Subsubsection",ExpressionUUID->"067fa35f-5347-4dc2-90fc-2442160c00ea"],

Cell[BoxData[
 RowBox[{
  RowBox[{"makeTrajectory", "[", 
   RowBox[{"label_", ",", "n_"}], "]"}], ":=", 
  RowBox[{"Block", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"avgP", ",", "gaugeField", ",", "tallyData", ",", "ff"}], "}"}], 
    ",", 
    RowBox[{
     RowBox[{"<<", "\"\<../data/3-3/periodic-16-28-5.m\>\""}], ";", 
     RowBox[{"avgP", "=", 
      RowBox[{"averagePlaquette", "[", "]"}]}], ";", 
     RowBox[{
      RowBox[{"trajectory", "[", "label", "]"}], "=", 
      RowBox[{"Table", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{"i", ">", "0"}], ",", 
           RowBox[{
            RowBox[{"Get", "[", 
             RowBox[{
             "\"\<../data/3-3/step-16-28-5-\>\"", "<>", "label", "<>", 
              "\"\<-\>\"", "<>", 
              RowBox[{"ToString", "[", "i", "]"}], "<>", "\"\<.m\>\""}], 
             "]"}], ";", 
            RowBox[{"gaugeField", "=", "gaugeField0"}]}]}], "]"}], ";", 
         RowBox[{"tallyData", "=", 
          RowBox[{"talliesToAverageErrors", "[", 
           RowBox[{"polyakovLoopTallies", "[", "\"\<smeared\>\"", "]"}], 
           "]"}]}], ";", 
         RowBox[{"ff", "=", 
          RowBox[{"exponentialModel", "[", "tallyData", "]"}]}], ";", 
         RowBox[{"Join", "[", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"i", ",", 
             RowBox[{"averagePlaquette", "[", "]"}]}], "}"}], ",", 
           RowBox[{"Inner", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"{", 
               RowBox[{
                RowBox[{"#1", "[", 
                 RowBox[{"[", "1", "]"}], "]"}], ",", 
                RowBox[{"#1", "[", 
                 RowBox[{"[", "2", "]"}], "]"}], ",", "#2"}], "}"}], "&"}], 
             ",", 
             RowBox[{"ff", "[", "\"\<BestFitParameters\>\"", "]"}], ",", 
             RowBox[{"ff", "[", "\"\<ParameterErrors\>\"", "]"}], ",", 
             "List"}], "]"}]}], "]"}]}], ",", 
        RowBox[{"{", 
         RowBox[{"i", ",", "0", ",", "n"}], "}"}]}], "]"}]}]}]}], 
   "]"}]}]], "Input",
 InitializationCell->
  True,ExpressionUUID->"fc7c8716-57dc-4020-9e3c-fb3a9c83dd11"],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{
  RowBox[{"Clear", "[", "trajectory", "]"}], ";", 
  RowBox[{"makeTrajectory", "[", 
   RowBox[{"\"\<a\>\"", ",", "4"}], "]"}], ";", 
  RowBox[{"makeTrajectory", "[", 
   RowBox[{"\"\<b\>\"", ",", "4"}], "]"}], ";", 
  RowBox[{"makeTrajectory", "[", 
   RowBox[{"\"\<c\>\"", ",", "4"}], "]"}], ";", 
  RowBox[{"makeTrajectory", "[", 
   RowBox[{"\"\<d\>\"", ",", "4"}], "]"}], ";", 
  RowBox[{"makeTrajectory", "[", 
   RowBox[{"\"\<e\>\"", ",", "10"}], "]"}], ";", 
  RowBox[{"makeTrajectory", "[", 
   RowBox[{"\"\<f\>\"", ",", "10"}], "]"}], ";", 
  RowBox[{"makeTrajectory", "[", 
   RowBox[{"\"\<g\>\"", ",", "10"}], "]"}], 
  ";"}]], "Input",ExpressionUUID->"b0c3d8ad-9720-4523-a563-ef1b9e8e1c7f"],

Cell[BoxData[
 TemplateBox[{
  "NonlinearModelFit","sszero",
   "\"The step size in the search has become less than the tolerance \
prescribed by the PrecisionGoal option, but the gradient is larger than the \
tolerance specified by the AccuracyGoal option. There is a possibility that \
the method has stalled at a point that is not a local minimum.\"",2,59,18,
   31696613969923636544,"Local"},
  "MessageTemplate"]], "Message", \
"MSG",ExpressionUUID->"5d2b5d6e-1aa5-43c4-8956-26be67b1d41e"],

Cell[BoxData[
 TemplateBox[{
  "NonlinearModelFit","sszero",
   "\"The step size in the search has become less than the tolerance \
prescribed by the PrecisionGoal option, but the gradient is larger than the \
tolerance specified by the AccuracyGoal option. There is a possibility that \
the method has stalled at a point that is not a local minimum.\"",2,59,19,
   31696613969923636544,"Local"},
  "MessageTemplate"]], "Message", \
"MSG",ExpressionUUID->"f8a1dd55-ea4f-436f-a364-eff0693aa572"],

Cell[BoxData[
 TemplateBox[{
  "NonlinearModelFit","cvmit",
   "\"Failed to converge to the requested accuracy or precision within \\!\\(\
\\*RowBox[{\\\"100\\\"}]\\) iterations.\"",2,59,20,31696613969923636544,
   "Local"},
  "MessageTemplate"]], "Message", \
"MSG",ExpressionUUID->"7e2ec45a-36ff-4464-807d-cfe228d5d088"],

Cell[BoxData[
 TemplateBox[{
  "NonlinearModelFit","cvmit",
   "\"Failed to converge to the requested accuracy or precision within \\!\\(\
\\*RowBox[{\\\"100\\\"}]\\) iterations.\"",2,59,21,31696613969923636544,
   "Local"},
  "MessageTemplate"]], "Message", \
"MSG",ExpressionUUID->"df62db74-f58f-426f-afc8-e6618083af11"],

Cell[BoxData[
 TemplateBox[{
  "NonlinearModelFit","cvmit",
   "\"Failed to converge to the requested accuracy or precision within \\!\\(\
\\*RowBox[{\\\"100\\\"}]\\) iterations.\"",2,59,22,31696613969923636544,
   "Local"},
  "MessageTemplate"]], "Message", \
"MSG",ExpressionUUID->"45777b27-5704-4423-9b8b-c9eb484c9806"],

Cell[BoxData[
 TemplateBox[{
  "General","stop",
   "\"Further output of \\!\\(\\*StyleBox[RowBox[{\\\"NonlinearModelFit\\\", \
\\\"::\\\", \\\"cvmit\\\"}], \\\"MessageName\\\"]\\) will be suppressed \
during this calculation.\"",2,59,23,31696613969923636544,"Local"},
  "MessageTemplate"]], "Message", \
"MSG",ExpressionUUID->"1eae7914-f571-4970-a644-36b90174a67f"],

Cell[BoxData[
 TemplateBox[{
  "NonlinearModelFit","sszero",
   "\"The step size in the search has become less than the tolerance \
prescribed by the PrecisionGoal option, but the gradient is larger than the \
tolerance specified by the AccuracyGoal option. There is a possibility that \
the method has stalled at a point that is not a local minimum.\"",2,59,24,
   31696613969923636544,"Local"},
  "MessageTemplate"]], "Message", \
"MSG",ExpressionUUID->"f7936053-28cd-47ce-9d3a-e92084831c24"],

Cell[BoxData[
 TemplateBox[{
  "General","stop",
   "\"Further output of \\!\\(\\*StyleBox[RowBox[{\\\"NonlinearModelFit\\\", \
\\\"::\\\", \\\"sszero\\\"}], \\\"MessageName\\\"]\\) will be suppressed \
during this calculation.\"",2,59,25,31696613969923636544,"Local"},
  "MessageTemplate"]], "Message", \
"MSG",ExpressionUUID->"78664479-cc28-49d7-8043-d411b8bb6ae5"]
}, Open  ]],

Cell[BoxData[
 RowBox[{"Save", "[", 
  RowBox[{"\"\<../data/trajectory-16-28-5.m\>\"", ",", "trajectory"}], 
  "]"}]], "Input",ExpressionUUID->"6b48b707-a48f-4857-a221-a2b7aeb74f0c"]
}, Open  ]],

Cell[CellGroupData[{

Cell["Plot", \
"Subsubsection",ExpressionUUID->"1fa80b69-72eb-4547-becb-28dee01ad14b"],

Cell[BoxData[
 RowBox[{
  RowBox[{"<<", "\"\<../data/trajectory-16-28-5.m\>\""}], 
  ";"}]], "Input",ExpressionUUID->"dfb1513e-dfb2-4b8b-a87f-988c374bdcee"],

Cell[BoxData[
 RowBox[{"ListPlot", "[", 
  RowBox[{
   RowBox[{"Map", "[", 
    RowBox[{
     RowBox[{
      RowBox[{"Map", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"{", 
          RowBox[{
           RowBox[{"#", "[", 
            RowBox[{"[", "1", "]"}], "]"}], ",", 
           RowBox[{"#", "[", 
            RowBox[{"[", "2", "]"}], "]"}]}], "}"}], "&"}], ",", 
        RowBox[{"trajectory", "[", "#", "]"}]}], "]"}], "&"}], ",", 
     RowBox[{"{", 
      RowBox[{
      "\"\<a\>\"", ",", "\"\<b\>\"", ",", "\"\<c\>\"", ",", "\"\<d\>\"", ",", 
       "\"\<e\>\"", ",", "\"\<f\>\"", ",", "\"\<g\>\""}], "}"}]}], "]"}], ",", 
   RowBox[{"Joined", "\[Rule]", "True"}], ",", 
   RowBox[{"Axes", "\[Rule]", "False"}], ",", 
   RowBox[{"Frame", "\[Rule]", "True"}]}], 
  "]"}]], "Input",ExpressionUUID->"869bd7da-d9ce-472a-95c8-740b446c2bff"],

Cell[BoxData[
 RowBox[{"ListPlot", "[", 
  RowBox[{
   RowBox[{"Map", "[", 
    RowBox[{
     RowBox[{
      RowBox[{"Map", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"{", 
          RowBox[{
           RowBox[{"#", "[", 
            RowBox[{"[", "1", "]"}], "]"}], ",", 
           RowBox[{"#", "[", 
            RowBox[{"[", 
             RowBox[{"4", ",", "2"}], "]"}], "]"}]}], "}"}], "&"}], ",", 
        RowBox[{"Select", "[", 
         RowBox[{
          RowBox[{"trajectory", "[", "#", "]"}], ",", 
          RowBox[{
           RowBox[{
            RowBox[{"#", "[", 
             RowBox[{"[", 
              RowBox[{"4", ",", "2"}], "]"}], "]"}], ">", 
            RowBox[{"#", "[", 
             RowBox[{"[", 
              RowBox[{"4", ",", "3"}], "]"}], "]"}]}], "&"}]}], "]"}]}], 
       "]"}], "&"}], ",", 
     RowBox[{"{", 
      RowBox[{
      "\"\<a\>\"", ",", "\"\<b\>\"", ",", "\"\<c\>\"", ",", "\"\<d\>\"", ",", 
       "\"\<e\>\"", ",", "\"\<f\>\"", ",", "\"\<g\>\""}], "}"}]}], "]"}], ",", 
   RowBox[{"Joined", "\[Rule]", "True"}], ",", 
   RowBox[{"Axes", "\[Rule]", "False"}], ",", 
   RowBox[{"Frame", "\[Rule]", "True"}], ",", 
   RowBox[{"PlotRange", "\[Rule]", 
    RowBox[{"{", 
     RowBox[{"0", ",", "0.05"}], "}"}]}]}], 
  "]"}]], "Input",ExpressionUUID->"8ffdf0f1-298c-45ca-b220-ea94cc21e42f"]
}, Open  ]]
}, Open  ]]
}, Open  ]],

Cell[CellGroupData[{

Cell["Lattice stationary point", \
"Section",ExpressionUUID->"61a1c75a-0614-448a-a52c-d8d957505390"],

Cell[CellGroupData[{

Cell["Trivial lattice", \
"Subsection",ExpressionUUID->"2fabcbdc-580e-402a-85cb-f4fa5d0892b2"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"nd", "=", "3"}], ";", 
  RowBox[{"nc", "=", "5"}], ";", 
  RowBox[{"latticeDimensions", "=", 
   RowBox[{"{", 
    RowBox[{"2", ",", "2", ",", "2"}], "}"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"makeTrivialLattice", "[", 
   RowBox[{"randomGauge", "\[Rule]", "True"}], "]"}], ";", 
  RowBox[{
  "averagePlaquette", "[", 
   "]"}]}]}], "Input",ExpressionUUID->"739e85c4-b726-4eed-a384-4b665563a88c"],

Cell[BoxData[
 RowBox[{
  RowBox[{"libGaugeField", "=", 
   RowBox[{"latticeSaddlePointStep", "[", 
    RowBox[{
     RowBox[{"storePairs", "\[Rule]", "True"}], ",", 
     RowBox[{"fixedDir", "->", "0"}]}], "]"}]}], 
  ";"}]], "Input",ExpressionUUID->"efcf3bc0-e184-4d44-85b4-46e3670ebc9a"],

Cell["\<\
Symmetries of the lattice action.   Gauge fixing removes one dimension worth. \
 Difference is 9 for SU(2), 24 for SU(3), 45 for SU(4), 72 for SU(5), \
independent of the size of the lattice.  In general, the difference is 3 \
(nc^2-1).

Also, all curvatures are negative, indicating that this a a local minimum of \
the action, since the action is 1-Re(Tr(plaquettte))/Nc.

The result is independent of gauge choice.\
\>", "Text",ExpressionUUID->"dd7a8878-8dac-410c-aa06-5f21a7ed2e89"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   RowBox[{"Length", "[", 
    RowBox[{"proj0", "[", 
     RowBox[{"[", "1", "]"}], "]"}], "]"}], ",", 
   RowBox[{
    RowBox[{"Length", "[", 
     RowBox[{"proj0", "[", 
      RowBox[{"[", "1", "]"}], "]"}], "]"}], "/", "nd"}]}], 
  "}"}]], "Input",ExpressionUUID->"40aeb51c-410f-4668-9040-ab24bd7e2523"],

Cell["Zero curvature would indicate a gauge symmetry.  ", \
"Text",ExpressionUUID->"5af70cb0-f758-440c-9ae6-b6a824d97aeb"],

Cell[BoxData[
 RowBox[{"Tally", "[", 
  RowBox[{"Rationalize", "[", 
   RowBox[{"Chop", "[", "pairs0", "]"}], "]"}], 
  "]"}]], "Input",ExpressionUUID->"57e0138a-4347-4e25-bce7-1525258cd9f8"]
}, Closed]],

Cell[CellGroupData[{

Cell["Compare different strategies.", \
"Subsection",ExpressionUUID->"f09fe3a3-3c1f-450f-9d4d-999ebac13ec1"],

Cell[BoxData[
 RowBox[{"<<", 
  "\"\<../data/3-3/periodic-4-7.5-3.m\>\""}]], \
"Input",ExpressionUUID->"1c021071-8d2c-4753-8598-b40dd16e21b1"],

Cell[BoxData[
 RowBox[{"<<", 
  "\"\<../data/3-3/periodic-6-8.175-3.m\>\""}]], \
"Input",ExpressionUUID->"2d348138-07c5-44d6-a83f-01ff3b46f7dd"],

Cell[BoxData[
 RowBox[{"cutoff", "=", 
  RowBox[{"Min", "[", 
   RowBox[{
    RowBox[{"Pi", " ", 
     RowBox[{".01", "^", 
      RowBox[{"(", 
       RowBox[{"1", "/", "3"}], ")"}]}]}], ",", 
    RowBox[{"Sqrt", "[", 
     RowBox[{"1", "-", 
      RowBox[{"averagePlaquette", "[", "]"}]}], "]"}]}], 
   "]"}]}]], "Input",ExpressionUUID->"fc90fa43-2da6-4a7f-be1b-7cd54f8ac457"],

Cell["Find fraction of shift that is non-gauge transformation.", \
"Text",ExpressionUUID->"e9ce60aa-441d-4899-8356-1902b7f2ae9c"],

Cell[BoxData[
 RowBox[{"Dimensions", "[", 
  RowBox[{"dynamicShifts", "=", 
   RowBox[{"NullSpace", "[", 
    RowBox[{"gp", "=", 
     RowBox[{"gaugeTransformShifts", "[", 
      RowBox[{"makeRootLattice", "[", "]"}], "]"}]}], "]"}]}], 
  "]"}]], "Input",ExpressionUUID->"7150bd61-7bcf-4771-b277-66bda357687c"],

Cell[BoxData[
 RowBox[{
  RowBox[{"gaugeFieldAll", "=", 
   RowBox[{"latticeSaddlePointStep", "[", 
    RowBox[{
     RowBox[{"storePairs", "\[Rule]", "True"}], ",", 
     RowBox[{"fixedDir", "\[Rule]", 
      RowBox[{"-", "1"}]}]}], "]"}]}], ";", 
  RowBox[{"pairsAll", "=", "pairs0"}], ";", 
  RowBox[{"ooprojAll", "=", 
   RowBox[{"oo0", ".", "proj0"}]}], 
  ";"}]], "Input",ExpressionUUID->"3cf869a5-ad91-4ac6-9351-a58d591d8188"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"(", 
    RowBox[{
     RowBox[{"Norm", "[", 
      RowBox[{"dynamicShifts", ".", "#"}], "]"}], "/", 
     RowBox[{"Norm", "[", "#", "]"}]}], ")"}], "&"}], "[", "grad0", 
  "]"}]], "Input",ExpressionUUID->"aaff5bde-219a-46e7-a5f1-b81f2e02a9d2"],

Cell["\<\
On lattices with more than one link in each direction, the diagonal is zero.  \
But off-diagonal elements are non-zero since the quadratic expansion violates \
gauge invariance.\
\>", "Text",ExpressionUUID->"63c157ed-8231-4995-a8fd-11f647769f2e"],

Cell[BoxData[
 RowBox[{"Tr", "[", 
  RowBox[{"gp", ".", "hess0", ".", 
   RowBox[{"Transpose", "[", "gp", "]"}]}], 
  "]"}]], "Input",ExpressionUUID->"63d7c4b0-1cd9-43e9-9572-dc71b2fe3068"],

Cell[BoxData[
 RowBox[{
  RowBox[{"gaugeFieldDynamic", "=", 
   RowBox[{"latticeSaddlePointStep", "[", 
    RowBox[{
     RowBox[{"storePairs", "\[Rule]", "True"}], ",", 
     RowBox[{"fixedDir", "\[Rule]", "0"}]}], "]"}]}], ";", 
  RowBox[{"pairsDynamic", "=", "pairs0"}], ";", 
  RowBox[{"ooprojDynamic", "=", 
   RowBox[{"oo0", ".", "proj0"}]}], 
  ";"}]], "Input",ExpressionUUID->"86d74fe7-1adc-4eb5-afb1-41947b59bef0"],

Cell["Map to the shift on the full lattice:", \
"Text",ExpressionUUID->"dd874f12-c1ab-454e-975a-871f80814120"],

Cell[BoxData[
 RowBox[{
  RowBox[{"ffdd", "=", "2"}], ";", 
  RowBox[{"Dimensions", "[", 
   RowBox[{"axialProj", "=", 
    RowBox[{"Block", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
        RowBox[{"proj", "=", 
         RowBox[{"Association", "[", "]"}]}], ",", "i", ",", "j"}], "}"}], 
      ",", 
      RowBox[{
       RowBox[{"Do", "[", 
        RowBox[{
         RowBox[{"Block", "[", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"coords", "=", 
             RowBox[{"latticeCoordinates", "[", "i", "]"}]}], "}"}], ",", 
           RowBox[{
            RowBox[{"proj", "[", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{
                RowBox[{"coords2grad", "[", "ffdd", "]"}], "[", 
                RowBox[{"dir", ",", "coords", ",", "k"}], "]"}], ",", 
               RowBox[{
                RowBox[{"coords2grad", "[", 
                 RowBox[{"-", "1"}], "]"}], "[", 
                RowBox[{"dir", ",", "coords", ",", "k"}], "]"}]}], "}"}], 
             "]"}], "=", "1"}]}], "]"}], ",", 
         RowBox[{"{", 
          RowBox[{"dir", ",", "nd"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"i", ",", 
           RowBox[{"latticeVolume", "[", "]"}]}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"k", ",", 
           RowBox[{
            RowBox[{"nc", "^", "2"}], "-", "1"}]}], "}"}]}], "]"}], ";", 
       RowBox[{"SparseArray", "[", 
        RowBox[{"Normal", "[", "proj", "]"}], "]"}]}]}], "]"}]}], 
   "]"}]}]], "Input",ExpressionUUID->"fb6f81ff-93ce-4bba-bd8d-9be84faecccf"],

Cell[BoxData[
 RowBox[{"setAxialGauge", "[", "ffdd", 
  "]"}]], "Input",ExpressionUUID->"e36c5c59-204b-48a4-a161-2345bffcf20e"],

Cell[BoxData[
 RowBox[{
  RowBox[{"gaugeFieldAxial", "=", 
   RowBox[{"latticeSaddlePointStep", "[", 
    RowBox[{
     RowBox[{"storePairs", "\[Rule]", "True"}], ",", 
     RowBox[{"fixedDir", "\[Rule]", "ffdd"}]}], "]"}]}], ";", 
  RowBox[{"pairsAxial", "=", "pairs0"}], ";", 
  RowBox[{"ooprojAxial", "=", 
   RowBox[{"oo0", ".", "proj0", ".", "axialProj"}]}], 
  ";"}]], "Input",ExpressionUUID->"844c2bc3-df34-4b21-8071-deb593c6bb6b"],

Cell[CellGroupData[{

Cell["Distribution of shifts", \
"Subsubsection",ExpressionUUID->"3351a8a0-4458-426b-986e-9b7034f32567"],

Cell["\<\
Need to turn on switch in function applyCutoff3 to accumulate data for this \
plot.\
\>", "Text",ExpressionUUID->"5cda3090-c9f1-42c3-9af7-0385e60e0a62"],

Cell[BoxData[
 RowBox[{"ListPlot", "[", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{
     RowBox[{"Map", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"{", 
         RowBox[{
          RowBox[{"#", "[", 
           RowBox[{"[", "1", "]"}], "]"}], ",", 
          RowBox[{"Abs", "[", 
           RowBox[{"#", "[", 
            RowBox[{"[", "2", "]"}], "]"}], "]"}]}], "}"}], "&"}], ",", 
       "goodPairs0"}], "]"}], ",", 
     RowBox[{"Map", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"{", 
         RowBox[{
          RowBox[{"#", "[", 
           RowBox[{"[", "1", "]"}], "]"}], ",", 
          RowBox[{"Abs", "[", 
           RowBox[{"#", "[", 
            RowBox[{"[", "2", "]"}], "]"}], "]"}]}], "}"}], "&"}], ",", 
       "badPairs0"}], "]"}]}], "}"}], ",", 
   RowBox[{"Axes", "\[Rule]", "False"}], ",", 
   RowBox[{"Frame", "\[Rule]", "True"}]}], 
  "]"}]], "Input",ExpressionUUID->"1fc1e9d1-47ac-42d1-967f-b99d80d43ddb"],

Cell[BoxData[
 RowBox[{"ListPlot", "[", 
  RowBox[{
   RowBox[{"Map", "[", 
    RowBox[{
     RowBox[{
      RowBox[{"{", 
       RowBox[{
        RowBox[{"#", "[", 
         RowBox[{"[", "1", "]"}], "]"}], ",", 
        RowBox[{"Abs", "[", 
         RowBox[{"#", "[", 
          RowBox[{"[", "2", "]"}], "]"}], "]"}]}], "}"}], "&"}], ",", 
     "pairsDynamic"}], "]"}], ",", 
   RowBox[{"Axes", "\[Rule]", "False"}], ",", 
   RowBox[{"Frame", "\[Rule]", "True"}]}], 
  "]"}]], "Input",ExpressionUUID->"f2423630-8b43-4e1f-a7c3-6d8f8faa07fe"],

Cell[BoxData[
 RowBox[{"Histogram", "[", 
  RowBox[{"{", 
   RowBox[{
    RowBox[{"Map", "[", 
     RowBox[{"First", ",", "pairsAll"}], "]"}], ",", 
    RowBox[{"Map", "[", 
     RowBox[{"First", ",", "pairsAxial"}], "]"}], ",", 
    RowBox[{"Map", "[", 
     RowBox[{"First", ",", "pairsDynamic"}], "]"}]}], "}"}], 
  "]"}]], "Input",ExpressionUUID->"a47972e2-d1c2-4964-b3cf-b66a94116325"],

Cell["\<\
Note that a Cauchy Distribution is generated by the ratio of two normally \
distributed variables.\
\>", "Text",ExpressionUUID->"d264501a-9c05-42f2-b945-84876a292caf"],

Cell[BoxData[
 RowBox[{"fitt", "=", 
  RowBox[{"FindDistribution", "[", 
   RowBox[{"Map", "[", 
    RowBox[{
     RowBox[{
      RowBox[{
       RowBox[{"#", "[", 
        RowBox[{"[", "2", "]"}], "]"}], "/", 
       RowBox[{"#", "[", 
        RowBox[{"[", "1", "]"}], "]"}]}], "&"}], ",", "pairsDynamic"}], "]"}],
    "]"}]}]], "Input",ExpressionUUID->"3b8bcf26-7b15-435c-811c-f55b65932537"],

Cell[BoxData[
 RowBox[{"Block", "[", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{
     RowBox[{"w", "=", "0.2"}], ",", 
     RowBox[{"max", "=", "2"}]}], "}"}], ",", 
   RowBox[{"Show", "[", 
    RowBox[{
     RowBox[{"Histogram", "[", 
      RowBox[{
       RowBox[{"Map", "[", 
        RowBox[{
         RowBox[{
          RowBox[{
           RowBox[{"#", "[", 
            RowBox[{"[", "2", "]"}], "]"}], "/", 
           RowBox[{"#", "[", 
            RowBox[{"[", "1", "]"}], "]"}]}], "&"}], ",", "pairsDynamic"}], 
        "]"}], ",", 
       RowBox[{"{", "w", "}"}], ",", 
       RowBox[{"Axes", "\[Rule]", "False"}], ",", 
       RowBox[{"Frame", "\[Rule]", "True"}], ",", 
       RowBox[{"PlotRange", "\[Rule]", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{
            RowBox[{"-", "max"}], ",", "max"}], "}"}], ",", "All"}], 
         "}"}]}]}], "]"}], ",", 
     RowBox[{"Plot", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"PDF", "[", 
         RowBox[{"fitt", ",", "x"}], "]"}], 
        RowBox[{"Length", "[", "pairsDynamic", "]"}], " ", "w"}], ",", 
       RowBox[{"{", 
        RowBox[{"x", ",", 
         RowBox[{"-", "max"}], ",", "max"}], "}"}], ",", 
       RowBox[{"PlotRange", "\[Rule]", "All"}]}], "]"}]}], "]"}]}], 
  "]"}]], "Input",ExpressionUUID->"976d614a-d6da-4f94-9d2c-fa151b6806d7"],

Cell["\<\
We see that there is a good fit in the tails and at the peak.\
\>", "Text",ExpressionUUID->"044a8f0f-69dc-4376-a0bb-d769237fc75b"],

Cell[BoxData[
 RowBox[{"Block", "[", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{
     RowBox[{"w", "=", "0.2"}], ",", 
     RowBox[{"data", "=", 
      RowBox[{"Map", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"Abs", "[", 
          RowBox[{
           RowBox[{"#", "[", 
            RowBox[{"[", "2", "]"}], "]"}], "/", 
           RowBox[{"#", "[", 
            RowBox[{"[", "1", "]"}], "]"}]}], "]"}], "&"}], ",", 
        "pairsDynamic"}], "]"}]}]}], "}"}], ",", 
   RowBox[{"Show", "[", 
    RowBox[{
     RowBox[{"Histogram", "[", 
      RowBox[{"data", ",", 
       RowBox[{"{", 
        RowBox[{"\"\<Log\>\"", ",", 
         RowBox[{"{", "w", "}"}]}], "}"}], ",", 
       RowBox[{"ScalingFunctions", "\[Rule]", "\"\<Log\>\""}], ",", 
       RowBox[{"Axes", "\[Rule]", "False"}], ",", 
       RowBox[{"Frame", "\[Rule]", "True"}], ",", 
       RowBox[{"PlotRange", "\[Rule]", "All"}]}], "]"}], ",", 
     RowBox[{"LogPlot", "[", " ", 
      RowBox[{
       RowBox[{"2", 
        RowBox[{"(", 
         RowBox[{
          RowBox[{"CDF", "[", 
           RowBox[{"fitt", ",", 
            RowBox[{
             RowBox[{"Exp", "[", "x", "]"}], " ", 
             RowBox[{"10", "^", 
              RowBox[{"(", 
               RowBox[{"w", "/", "2"}], ")"}]}]}]}], "]"}], "-", 
          RowBox[{"CDF", "[", 
           RowBox[{"fitt", ",", 
            RowBox[{
             RowBox[{"Exp", "[", "x", "]"}], 
             RowBox[{"10", "^", 
              RowBox[{"(", 
               RowBox[{
                RowBox[{"-", "w"}], "/", "2"}], ")"}]}]}]}], "]"}]}], ")"}], 
        RowBox[{"Length", "[", "data", "]"}]}], ",", 
       RowBox[{"{", 
        RowBox[{"x", ",", 
         RowBox[{"Log", "[", 
          RowBox[{"Min", "[", "data", "]"}], "]"}], ",", 
         RowBox[{"Log", "[", 
          RowBox[{"Max", "[", "data", "]"}], "]"}]}], "}"}], ",", 
       RowBox[{"PlotRange", "\[Rule]", "All"}]}], "]"}]}], "]"}]}], 
  "]"}]], "Input",ExpressionUUID->"e02b74d3-ab79-41e9-b95d-0565d9299c06"],

Cell[BoxData[
 RowBox[{"Histogram", "[", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{
     RowBox[{"Map", "[", 
      RowBox[{
       RowBox[{
        RowBox[{
         RowBox[{"#", "[", 
          RowBox[{"[", "2", "]"}], "]"}], "/", 
         RowBox[{"#", "[", 
          RowBox[{"[", "1", "]"}], "]"}]}], "&"}], ",", "pairsAll"}], "]"}], 
     ",", 
     RowBox[{"Map", "[", 
      RowBox[{
       RowBox[{
        RowBox[{
         RowBox[{"#", "[", 
          RowBox[{"[", "2", "]"}], "]"}], "/", 
         RowBox[{"#", "[", 
          RowBox[{"[", "1", "]"}], "]"}]}], "&"}], ",", "pairsAxial"}], "]"}],
      ",", 
     RowBox[{"Map", "[", 
      RowBox[{
       RowBox[{
        RowBox[{
         RowBox[{"#", "[", 
          RowBox[{"[", "2", "]"}], "]"}], "/", 
         RowBox[{"#", "[", 
          RowBox[{"[", "1", "]"}], "]"}]}], "&"}], ",", "pairsDynamic"}], 
      "]"}]}], "}"}], ",", 
   RowBox[{"{", "0.1", "}"}], ",", 
   RowBox[{"PlotRange", "\[Rule]", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
        RowBox[{"-", "2"}], ",", "2"}], "}"}], ",", "Automatic"}], "}"}]}], 
   ",", 
   RowBox[{"Axes", "\[Rule]", "False"}], ",", 
   RowBox[{"Frame", "\[Rule]", "True"}], ",", 
   RowBox[{"PlotRange", "\[Rule]", "All"}]}], 
  "]"}]], "Input",ExpressionUUID->"4c6edeb0-ef5e-4215-925a-75ff9e370f7e"]
}, Open  ]],

Cell[CellGroupData[{

Cell["Compare shift vectors", \
"Subsubsection",ExpressionUUID->"bbb308fb-cc39-4caf-afe4-96de077d9a82"],

Cell[BoxData[
 RowBox[{
  RowBox[{"cosAngle", "[", 
   RowBox[{"a_", ",", "b_"}], "]"}], ":=", 
  RowBox[{
   RowBox[{"a", ".", "b"}], "/", 
   RowBox[{"(", 
    RowBox[{
     RowBox[{"Norm", "[", "a", "]"}], " ", 
     RowBox[{"Norm", "[", "b", "]"}]}], 
    ")"}]}]}]], \
"Input",ExpressionUUID->"d2f25e1c-27a2-44cb-8db3-b0b1b05fca3b"],

Cell[BoxData[
 RowBox[{
  RowBox[{"Clear", "[", "shifts", "]"}], ";", 
  RowBox[{
   RowBox[{"makeShifts", "[", 
    RowBox[{"type_", ",", "pairs_", ",", "ooproj_"}], "]"}], ":=", 
   RowBox[{"(", 
    RowBox[{
     RowBox[{
      RowBox[{"shifts", "[", 
       RowBox[{"type", ",", "0", ",", "0"}], "]"}], "=", 
      RowBox[{"-", 
       RowBox[{
        RowBox[{"Map", "[", 
         RowBox[{
          RowBox[{
           RowBox[{
            RowBox[{"#", "[", 
             RowBox[{"[", "2", "]"}], "]"}], "/", 
            RowBox[{"#", "[", 
             RowBox[{"[", "1", "]"}], "]"}]}], "&"}], ",", "pairs"}], "]"}], 
        ".", "ooproj"}]}]}], ";", "\n", 
     RowBox[{
      RowBox[{"shifts", "[", 
       RowBox[{"type", ",", "1", ",", "0"}], "]"}], "=", 
      RowBox[{"-", 
       RowBox[{
        RowBox[{"Apply", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"applyCutoff3", "[", 
            RowBox[{"##", ",", "ooproj", ",", "1"}], "]"}], "&"}], ",", 
          RowBox[{"Transpose", "[", "pairs", "]"}]}], "]"}], ".", 
        "ooproj"}]}]}], ";", "\n", 
     RowBox[{
      RowBox[{"shifts", "[", 
       RowBox[{"type", ",", "0", ",", "1"}], "]"}], "=", 
      RowBox[{"applyCutoff2", "[", 
       RowBox[{"shifts", "[", 
        RowBox[{"type", ",", "0", ",", "0"}], "]"}], "]"}]}], ";", "\n", 
     RowBox[{
      RowBox[{"shifts", "[", 
       RowBox[{"type", ",", "1", ",", "1"}], "]"}], "=", 
      RowBox[{"applyCutoff2", "[", 
       RowBox[{"shifts", "[", 
        RowBox[{"type", ",", "1", ",", "0"}], "]"}], "]"}]}], ";"}], 
    ")"}]}]}]], \
"Input",ExpressionUUID->"ce7f505f-a804-4dfb-a24a-bf9fed0fcac0"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"Print", "[", "\"\<starting All\>\"", "]"}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"makeShifts", "[", 
   RowBox[{"\"\<All\>\"", ",", "pairsAll", ",", "ooprojAll"}], "]"}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"Print", "[", "\"\<starting Dynamic\>\"", "]"}], ";", 
  RowBox[{"makeShifts", "[", 
   RowBox[{"\"\<Dynamic\>\"", ",", "pairsDynamic", ",", "ooprojDynamic"}], 
   "]"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"Print", "[", "\"\<starting Axial\>\"", "]"}], ";", 
  RowBox[{"makeShifts", "[", 
   RowBox[{"\"\<Axial\>\"", ",", "pairsAxial", ",", "ooprojAxial"}], "]"}], 
  ";"}]}], "Input",ExpressionUUID->"0d094de9-7433-4499-9a5d-85103d33f3b8"],

Cell[BoxData[
 RowBox[{
  RowBox[{"typeOuter", "[", "type_", "]"}], ":=", 
  RowBox[{"Block", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"sh", "=", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"shifts", "[", 
         RowBox[{"type", ",", "0", ",", "0"}], "]"}], ",", 
        RowBox[{"shifts", "[", 
         RowBox[{"type", ",", "1", ",", "0"}], "]"}], ",", 
        RowBox[{"shifts", "[", 
         RowBox[{"type", ",", "0", ",", "1"}], "]"}], ",", 
        RowBox[{"shifts", "[", 
         RowBox[{"type", ",", "1", ",", "1"}], "]"}]}], "}"}]}], "}"}], ",", 
    RowBox[{"TableForm", "[", 
     RowBox[{"Outer", "[", 
      RowBox[{"cosAngle", ",", "sh", ",", "sh", ",", "1"}], "]"}], "]"}]}], 
   "]"}]}]], "Input",ExpressionUUID->"e1016f09-e08e-4135-80f4-eaa49d3c54df"],

Cell[BoxData[
 RowBox[{"typeOuter", "[", "\"\<All\>\"", 
  "]"}]], "Input",ExpressionUUID->"77bac56d-fd67-44b1-b2ed-028f5e919d5b"],

Cell[BoxData[
 RowBox[{"typeOuter", "[", "\"\<Dynamic\>\"", 
  "]"}]], "Input",ExpressionUUID->"6b415e11-14d2-4106-8e01-f4b3640c28ff"],

Cell[BoxData[
 RowBox[{"typeOuter", "[", "\"\<Axial\>\"", 
  "]"}]], "Input",ExpressionUUID->"eb2b12df-e702-4116-af87-60617f7fca47"],

Cell[BoxData[
 RowBox[{"cosAngle", "[", 
  RowBox[{
   RowBox[{"shifts", "[", 
    RowBox[{"\"\<All\>\"", ",", "1", ",", "1"}], "]"}], ",", 
   RowBox[{"shifts", "[", 
    RowBox[{"\"\<Dynamic\>\"", ",", "1", ",", "1"}], "]"}]}], 
  "]"}]], "Input",ExpressionUUID->"980c51ba-2e9c-4868-b0c2-29cb89e317ea"],

Cell[BoxData[
 RowBox[{"cosAngle", "[", 
  RowBox[{
   RowBox[{"shifts", "[", 
    RowBox[{"\"\<Dynamic\>\"", ",", "1", ",", "1"}], "]"}], ",", 
   RowBox[{"shifts", "[", 
    RowBox[{"\"\<Axial\>\"", ",", "1", ",", "1"}], "]"}]}], 
  "]"}]], "Input",ExpressionUUID->"fab3e66d-c418-4cd3-9262-6a90514a8777"],

Cell[BoxData[
 RowBox[{"cosAngle", "[", 
  RowBox[{
   RowBox[{"shifts", "[", 
    RowBox[{"\"\<All\>\"", ",", "1", ",", "1"}], "]"}], ",", 
   RowBox[{"shifts", "[", 
    RowBox[{"\"\<Axial\>\"", ",", "1", ",", "1"}], "]"}]}], 
  "]"}]], "Input",ExpressionUUID->"b58ffdff-fc48-4dce-ab73-30d106345a3b"],

Cell[BoxData[
 RowBox[{"TableForm", "[", 
  RowBox[{"Table", "[", 
   RowBox[{
    RowBox[{
     RowBox[{
      RowBox[{"(", 
       RowBox[{
        RowBox[{"Norm", "[", 
         RowBox[{"dynamicShifts", ".", "#"}], "]"}], "/", 
        RowBox[{"Norm", "[", "#", "]"}]}], ")"}], "&"}], "[", 
     RowBox[{"shifts", "[", 
      RowBox[{"\"\<All\>\"", ",", "i", ",", "j"}], "]"}], "]"}], ",", 
    RowBox[{"{", 
     RowBox[{"i", ",", "0", ",", "1"}], "}"}], ",", 
    RowBox[{"{", 
     RowBox[{"j", ",", "0", ",", "1"}], "}"}]}], "]"}], 
  "]"}]], "Input",ExpressionUUID->"3393e1e4-bc4a-40b3-a76a-86133d8a83fb"],

Cell[BoxData[
 RowBox[{"TableForm", "[", 
  RowBox[{"Table", "[", 
   RowBox[{
    RowBox[{
     RowBox[{
      RowBox[{"(", 
       RowBox[{
        RowBox[{"Norm", "[", 
         RowBox[{"dynamicShifts", ".", "#"}], "]"}], "/", 
        RowBox[{"Norm", "[", "#", "]"}]}], ")"}], "&"}], "[", 
     RowBox[{"shifts", "[", 
      RowBox[{"\"\<Dynamic\>\"", ",", "i", ",", "j"}], "]"}], "]"}], ",", 
    RowBox[{"{", 
     RowBox[{"i", ",", "0", ",", "1"}], "}"}], ",", 
    RowBox[{"{", 
     RowBox[{"j", ",", "0", ",", "1"}], "}"}]}], "]"}], 
  "]"}]], "Input",ExpressionUUID->"fdccd8bf-b8f4-4706-a0c0-073e562863e5"],

Cell[BoxData[
 RowBox[{"TableForm", "[", 
  RowBox[{"Table", "[", 
   RowBox[{
    RowBox[{
     RowBox[{
      RowBox[{"(", 
       RowBox[{
        RowBox[{"Norm", "[", 
         RowBox[{"dynamicShifts", ".", "#"}], "]"}], "/", 
        RowBox[{"Norm", "[", "#", "]"}]}], ")"}], "&"}], "[", 
     RowBox[{"shifts", "[", 
      RowBox[{"\"\<Axial\>\"", ",", "i", ",", "j"}], "]"}], "]"}], ",", 
    RowBox[{"{", 
     RowBox[{"i", ",", "0", ",", "1"}], "}"}], ",", 
    RowBox[{"{", 
     RowBox[{"j", ",", "0", ",", "1"}], "}"}]}], "]"}], 
  "]"}]], "Input",ExpressionUUID->"b996afba-2344-46bb-b1e0-0e43a82b0974"],

Cell[BoxData[
 RowBox[{"Tally", "[", 
  RowBox[{"Chop", "[", 
   RowBox[{"Flatten", "[", 
    RowBox[{
     RowBox[{"dynamicShifts", ".", 
      RowBox[{"Transpose", "[", "dynamicShifts", "]"}]}], "-", 
     RowBox[{"IdentityMatrix", "[", "1024", "]"}]}], "]"}], "]"}], 
  "]"}]], "Input",ExpressionUUID->"8f9ae3cd-0ee3-474c-a637-bdabb249987c"],

Cell[BoxData[
 RowBox[{"Histogram", "[", 
  RowBox[{
   RowBox[{"shifts", "[", 
    RowBox[{"\"\<Dynamic\>\"", ",", "1", ",", "1"}], "]"}], ",", 
   RowBox[{"{", ".05", "}"}]}], 
  "]"}]], "Input",ExpressionUUID->"770947f2-51a0-402a-9e5d-f2552a61e205"]
}, Open  ]]
}, Open  ]]
}, Open  ]],

Cell[CellGroupData[{

Cell["Junk", "Section",ExpressionUUID->"6058e0d4-29e9-4c0b-bf03-5f86a5a84b13"],

Cell[BoxData[
 RowBox[{"phases", "=", 
  RowBox[{"centerPhases", "[", 
   RowBox[{"centerSUMatrix", "[", 
    RowBox[{"1", ",", "3"}], "]"}], 
   "]"}]}]], "Input",ExpressionUUID->"277532bf-3deb-4fef-b6d6-67aa25160b1a"],

Cell[BoxData[
 RowBox[{"N", "[", 
  RowBox[{"phases", ",", "16"}], 
  "]"}]], "Input",ExpressionUUID->"4078f171-a99e-4a43-b33a-fc161e2f414e"],

Cell[BoxData[
 RowBox[{"Chop", "[", 
  RowBox[{"lineLinks", "[", 
   RowBox[{"1", ",", 
    RowBox[{"{", 
     RowBox[{"2", ",", "3", ",", "4"}], "}"}]}], "]"}], 
  "]"}]], "Input",ExpressionUUID->"e7cf3e5c-b44d-4718-be51-22cf4ce78c61"],

Cell[BoxData[
 RowBox[{"Only", " ", "place", " ", "where", " ", 
  RowBox[{"plotAction", "[", "]"}], " ", "is", " ", 
  RowBox[{
  "called", 
   "."}]}]], "Input",ExpressionUUID->"40fc700c-7eab-4933-bf2c-3b2f5f37a662"],

Cell[BoxData[
 RowBox[{"plotAction", "[", 
  RowBox[{"1", ",", "2", ",", "3", ",", 
   RowBox[{"{", 
    RowBox[{"1", ",", "1", ",", "1"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"0", ",", 
     RowBox[{"4", " ", 
      RowBox[{
       RowBox[{"nc", "^", "2"}], "/", "3"}]}]}], "}"}]}], 
  "]"}]], "Input",ExpressionUUID->"c052c00b-f1d9-46f0-bd23-1bb2d83bdd87"],

Cell[BoxData[
 RowBox[{"latticeSaddlePoint", "[", "5", 
  "]"}]], "Input",ExpressionUUID->"73683594-847e-4113-a0a3-576649dddedb"],

Cell[BoxData[
 RowBox[{"stats", "=", 
  RowBox[{
  "latticeSaddlePoint", "[", "50", 
   "]"}]}]], "Input",ExpressionUUID->"b240671b-9f8c-40a1-94c1-8cac5fe8a9d1"],

Cell[BoxData[
 RowBox[{"ListLogPlot", "[", 
  RowBox[{"Map", "[", 
   RowBox[{
    RowBox[{
     RowBox[{"#", "[", 
      RowBox[{"[", 
       RowBox[{"{", 
        RowBox[{"1", ",", "3"}], "}"}], "]"}], "]"}], "&"}], ",", "stats"}], 
   "]"}], "]"}]], \
"Input",ExpressionUUID->"77eed4f3-7414-4960-b3f4-a9e7e68ef686"],

Cell[BoxData[
 RowBox[{"ListLogPlot", "[", 
  RowBox[{"Map", "[", 
   RowBox[{
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"#", "[", 
        RowBox[{"[", "1", "]"}], "]"}], ",", 
       RowBox[{"norm", "/.", 
        RowBox[{
         RowBox[{"#", "[", 
          RowBox[{"[", "4", "]"}], "]"}], "[", "\"\<BestFitParameters\>\"", 
         "]"}]}]}], "}"}], "&"}], ",", "stats"}], "]"}], 
  "]"}]], "Input",ExpressionUUID->"570da784-b5f8-447e-9c5f-47ec6ef5f759"],

Cell[BoxData[
 RowBox[{"ListLogPlot", "[", 
  RowBox[{"Map", "[", 
   RowBox[{
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"#", "[", 
        RowBox[{"[", "1", "]"}], "]"}], ",", 
       RowBox[{"ampL", "/.", 
        RowBox[{
         RowBox[{"#", "[", 
          RowBox[{"[", "4", "]"}], "]"}], "[", "\"\<BestFitParameters\>\"", 
         "]"}]}]}], "}"}], "&"}], ",", "stats"}], "]"}], 
  "]"}]], "Input",ExpressionUUID->"cfd0fd2f-fb03-41e1-9542-3f338b342f15"],

Cell[BoxData[
 RowBox[{"stats", "=", 
  RowBox[{
  "latticeSaddlePoint", "[", "14", 
   "]"}]}]], "Input",ExpressionUUID->"2b12fb8b-143a-4ca9-a9a3-23fbc0a68389"],

Cell["Save resulting lattice", \
"Text",ExpressionUUID->"a97e92d4-94bc-4489-bbcb-0ef6337b72fa"],

Cell[BoxData[
 RowBox[{"Save", "[", 
  RowBox[{"\"\<periodic-3-3-22-42-1-fastcool.m\>\"", ",", 
   RowBox[{"{", 
    RowBox[{
    "nd", ",", "nc", ",", "beta", ",", "latticeDimensions", ",", 
     "latticeLayout", ",", "gaugeField", ",", "linearSiteIndex"}], "}"}]}], 
  "]"}]], "Input",ExpressionUUID->"a18df784-83d1-4e71-bbd0-bf1f9ac17071"]
}, Open  ]]
}, Open  ]]
},
WindowSize->{961, 600},
WindowMargins->{{Automatic, 50}, {41, Automatic}},
PrivateNotebookOptions->{"FileOutlineCache"->False},
TrackCellChangeTimes->False,
FrontEndVersion->"11.2 for Linux x86 (64-bit) (September 10, 2017)",
StyleDefinitions->"Default.nb"
]

