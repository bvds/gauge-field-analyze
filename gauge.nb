Notebook[{
Cell[BoxData[
 RowBox[{
  RowBox[{"SetDirectory", "[", 
   RowBox[{"NotebookDirectory", "[", "]"}], "]"}], ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.7673569687731447`*^9, 
  3.7673569687738857`*^9}},ExpressionUUID->"2d04608b-9946-4c28-ab78-\
bf003fc0a624"],

Cell["\<\
Disable current notebook FileOutlineCache and CellChangeTimes.  See: \
https://stackoverflow.com/questions/2816628/version-control-of-mathematica-\
notebooks \
\>", "Text",ExpressionUUID->"c8b91507-5d14-469e-9fe1-3e146e8bfa42"],

Cell[CellGroupData[{

Cell["Library", \
"Section",ExpressionUUID->"31efac24-1e46-467d-80dc-82c8a417d0ca"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", " ", 
   RowBox[{"One", " ", 
    RowBox[{"can", "'"}], "t", " ", "use", " ", "the", " ", "pattern", " ", 
    "n_:", "nc", " ", "because", " ", "nc", " ", "may", " ", 
    RowBox[{"change", "."}]}], " ", "*)"}], "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{
     RowBox[{"randomSUMatrix", "[", "]"}], ":=", 
     RowBox[{"randomSUMatrix", "[", "nc", "]"}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"randomSUMatrix", "[", "n_", "]"}], ":=", 
     RowBox[{"Block", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"mat", "=", 
         RowBox[{"RandomVariate", "[", 
          RowBox[{"CircularUnitaryMatrixDistribution", "[", "n", "]"}], 
          "]"}]}], "}"}], ",", 
       RowBox[{"mat", "/", 
        RowBox[{
         RowBox[{"Det", "[", "mat", "]"}], "^", 
         RowBox[{"(", 
          RowBox[{"1", "/", "n"}], ")"}]}]}]}], "]"}]}], ";", 
    RowBox[{
     RowBox[{"centerSUMatrix", "[", "j_", "]"}], ":=", 
     RowBox[{"centerSUMatrix", "[", 
      RowBox[{"j", ",", "nc"}], "]"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"centerSUMatrix", "[", 
      RowBox[{"j_", ",", "n_"}], "]"}], ":=", 
     RowBox[{
      RowBox[{"IdentityMatrix", "[", "n", "]"}], " ", 
      RowBox[{"Exp", "[", 
       RowBox[{"2", " ", "Pi", " ", "I", " ", 
        RowBox[{"j", "/", "n"}]}], "]"}]}]}], ";", 
    RowBox[{
     RowBox[{"zeroMatrix", "[", "]"}], ":=", 
     RowBox[{"zeroMatrix", "[", "nc", "]"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"zeroMatrix", "[", "n_", "]"}], ":=", 
     RowBox[{"Array", "[", 
      RowBox[{
       RowBox[{"0", "&"}], ",", 
       RowBox[{"{", 
        RowBox[{"n", ",", "n"}], "}"}]}], "]"}]}], ";", 
    RowBox[{
     RowBox[{"matrixEqual", "[", 
      RowBox[{"m1_", ",", "m2_", ",", 
       RowBox[{"tol_:", "$MachineEpsilon"}]}], "]"}], ":=", 
     RowBox[{"Block", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"norm", "=", 
         RowBox[{"Norm", "[", 
          RowBox[{
           RowBox[{"Flatten", "[", 
            RowBox[{"m1", "-", "m2"}], "]"}], ",", "Infinity"}], "]"}]}], 
        "}"}], ",", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"norm", "<", 
          RowBox[{"tol", " ", 
           RowBox[{"Sqrt", "[", 
            RowBox[{
             RowBox[{"Length", "[", "m1", "]"}], " ", 
             RowBox[{"Length", "[", 
              RowBox[{"m1", "[", 
               RowBox[{"[", "1", "]"}], "]"}], "]"}]}], "]"}]}]}], ",", 
         "True", ",", 
         RowBox[{
          RowBox[{"Print", "[", 
           RowBox[{"\"\<Matrices not equal, norm:  \>\"", ",", "norm"}], 
           "]"}], ";", "False"}]}], "]"}]}], "]"}]}], ";", 
    RowBox[{
     RowBox[{"SUMatrixQ", "[", 
      RowBox[{
       RowBox[{"mat_", "?", "SquareMatrixQ"}], ",", 
       RowBox[{"tol_:", "$MachineEpsilon"}]}], "]"}], ":=", 
     RowBox[{"Block", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         RowBox[{"diffs", "=", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{
             RowBox[{"Det", "[", "mat", "]"}], "-", "1"}], ",", 
            RowBox[{
             RowBox[{"mat", ".", 
              RowBox[{"ConjugateTranspose", "[", "mat", "]"}]}], "-", 
             RowBox[{"IdentityMatrix", "[", 
              RowBox[{"Length", "[", "mat", "]"}], "]"}]}]}], "}"}]}], ",", 
         "norm"}], "}"}], ",", 
       RowBox[{
        RowBox[{"norm", "=", 
         RowBox[{"Norm", "[", 
          RowBox[{
           RowBox[{"Flatten", "[", "diffs", "]"}], ",", "Infinity"}], "]"}]}],
         ";", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{"norm", "<", 
           RowBox[{"tol", " ", 
            RowBox[{"Length", "[", "mat", "]"}]}]}], ",", "True", ",", 
          RowBox[{
           RowBox[{"Print", "[", 
            RowBox[{"\"\<Not SU matrix, error:  \>\"", ",", " ", "norm"}], 
            "]"}], ";", 
           RowBox[{"Print", "[", 
            RowBox[{"\"\<Details:  \>\"", ",", "diffs"}], "]"}], ";", 
           "False"}]}], "]"}]}]}], "]"}]}], ";", 
    RowBox[{
     RowBox[{"suGenerators", "::", "usage"}], "=", 
     "\"\<Construct the generators for SU(N).  Normalization Tr[T_a T_b] = \
delta_{ab}/2.\>\""}], ";", 
    RowBox[{
     RowBox[{"suGenerators", "[", "]"}], ":=", 
     RowBox[{"suGenerators", "[", "nc", "]"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"suGenerators", "[", "n_", "]"}], ":=", 
     RowBox[{
      RowBox[{"suGenerators", "[", "n", "]"}], "=", 
      RowBox[{"Join", "[", 
       RowBox[{
        RowBox[{"Flatten", "[", 
         RowBox[{
          RowBox[{"Table", "[", 
           RowBox[{
            RowBox[{"If", "[", 
             RowBox[{
              RowBox[{
               RowBox[{"(", 
                RowBox[{
                 RowBox[{"i", "\[Equal]", "k1"}], "&&", 
                 RowBox[{"j", "\[Equal]", "k2"}]}], ")"}], "||", 
               RowBox[{"(", 
                RowBox[{
                 RowBox[{"i", "\[Equal]", "k2"}], "&&", 
                 RowBox[{"j", "\[Equal]", "k1"}]}], ")"}]}], ",", 
              RowBox[{"1", "/", "2"}], ",", "0"}], "]"}], ",", 
            RowBox[{"{", 
             RowBox[{"i", ",", "2", ",", "n"}], "}"}], ",", 
            RowBox[{"{", 
             RowBox[{"j", ",", 
              RowBox[{"i", "-", "1"}]}], "}"}], ",", 
            RowBox[{"{", 
             RowBox[{"k1", ",", "n"}], "}"}], ",", 
            RowBox[{"{", 
             RowBox[{"k2", ",", "n"}], "}"}]}], "]"}], ",", "1"}], "]"}], ",", 
        RowBox[{"Flatten", "[", 
         RowBox[{
          RowBox[{"Table", "[", 
           RowBox[{
            RowBox[{"Which", "[", 
             RowBox[{
              RowBox[{
               RowBox[{"i", "\[Equal]", "k1"}], "&&", 
               RowBox[{"j", "\[Equal]", "k2"}]}], ",", 
              RowBox[{"I", "/", "2"}], ",", 
              RowBox[{
               RowBox[{"i", "\[Equal]", "k2"}], "&&", 
               RowBox[{"j", "\[Equal]", "k1"}]}], ",", 
              RowBox[{
               RowBox[{"-", "I"}], "/", "2"}], ",", "True", ",", "0"}], "]"}],
             ",", 
            RowBox[{"{", 
             RowBox[{"i", ",", "2", ",", "n"}], "}"}], ",", 
            RowBox[{"{", 
             RowBox[{"j", ",", 
              RowBox[{"i", "-", "1"}]}], "}"}], ",", 
            RowBox[{"{", 
             RowBox[{"k1", ",", "n"}], "}"}], ",", 
            RowBox[{"{", 
             RowBox[{"k2", ",", "n"}], "}"}]}], "]"}], ",", "1"}], "]"}], ",", 
        RowBox[{"Table", "[", 
         RowBox[{
          RowBox[{"Which", "[", 
           RowBox[{
            RowBox[{"k1", "!=", "k2"}], ",", "0", ",", 
            RowBox[{"k1", "<", "i"}], ",", 
            RowBox[{"1", "/", 
             RowBox[{"Sqrt", "[", 
              RowBox[{"2", " ", "i", " ", 
               RowBox[{"(", 
                RowBox[{"i", "-", "1"}], ")"}]}], "]"}]}], ",", 
            RowBox[{"k1", "\[Equal]", "i"}], ",", 
            RowBox[{
             RowBox[{"(", 
              RowBox[{"1", "-", "i"}], ")"}], "/", 
             RowBox[{"Sqrt", "[", 
              RowBox[{"2", " ", "i", " ", 
               RowBox[{"(", 
                RowBox[{"i", "-", "1"}], ")"}]}], "]"}]}], ",", "True", ",", 
            "0"}], "]"}], ",", 
          RowBox[{"{", 
           RowBox[{"i", ",", "2", ",", "n"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"k1", ",", "n"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"k2", ",", "n"}], "}"}]}], "]"}]}], "]"}]}]}], ";", 
    RowBox[{
     RowBox[{"suSymmetric", "[", "]"}], ":=", 
     RowBox[{"suSymmetric", "[", "nc", "]"}]}], ";", 
    RowBox[{
     RowBox[{"suSymmetric", "[", "n_", "]"}], ":=", " ", 
     RowBox[{
      RowBox[{"suSymmetric", "[", "n", "]"}], "=", 
      RowBox[{"(*", " ", 
       RowBox[{
        RowBox[{
        "Construct", " ", "the", " ", "symmetric", " ", "coefficients", " ", 
         "d_", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"a", ",", "b", ",", "c"}], "}"}], ".", "  ", "This"}], " ",
          "tensor", " ", "is", " ", "sparse"}], ",", " ", 
        RowBox[{
        "but", " ", "we", " ", "will", " ", "be", " ", "inefficient", " ", 
         "for", " ", 
         RowBox[{"now", "."}]}]}], " ", "*)"}], 
      RowBox[{"Block", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"gen", "=", 
          RowBox[{"suGenerators", "[", "n", "]"}]}], "}"}], ",", 
        RowBox[{"2", " ", 
         RowBox[{"Outer", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"Tr", "[", 
             RowBox[{
              RowBox[{"(", 
               RowBox[{
                RowBox[{"#1", ".", "#2"}], "+", 
                RowBox[{"#2", ".", "#1"}]}], ")"}], ".", "#3"}], "]"}], "&"}],
            ",", "gen", ",", "gen", ",", "gen", ",", "1"}], "]"}]}]}], 
       "]"}]}]}], ";"}]}]}]], "Input",
 InitializationCell->
  True,ExpressionUUID->"9a0d4813-a1f7-4da2-b04f-c5e675ccd229"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"getLink", "[", 
     RowBox[{"dir_", ",", "coords_List"}], "]"}], ":=", 
    RowBox[{"gaugeField", "[", 
     RowBox[{"[", 
      RowBox[{"dir", ",", 
       RowBox[{"linearSiteIndex", "[", "coords", "]"}]}], "]"}], "]"}]}], 
   ";"}], " "}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"setLink", "[", 
     RowBox[{"dir_", ",", "coords_List", ",", "mat_"}], "]"}], ":=", 
    RowBox[{
     RowBox[{"gaugeField", "[", 
      RowBox[{"[", 
       RowBox[{"dir", ",", 
        RowBox[{"linearSiteIndex", "[", "coords", "]"}]}], "]"}], "]"}], "=", 
     "mat"}]}], ";"}], " "}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"latticeVolume", "[", "]"}], ":=", 
   RowBox[{"latticeVolume", "[", "latticeDimensions", "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"latticeVolume", "[", "dimensions_", "]"}], ":=", 
   RowBox[{"Apply", "[", 
    RowBox[{"Times", ",", " ", "dimensions"}], "]"}]}], ";", 
  RowBox[{
   RowBox[{"latticeCoordinates", "::", "usage"}], "=", 
   "\"\<Given an integer-valued site index, return lattice coordinates.  This \
is not necessarily the inverse of linearSiteIndex.  It is simply a way to \
iterate over the whole lattice.\>\""}], ";", 
  RowBox[{
   RowBox[{"latticeCoordinates", "[", "i_", "]"}], ":=", 
   RowBox[{"latticeCoordinates", "[", 
    RowBox[{"i", ",", "latticeDimensions"}], "]"}]}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"latticeCoordinates", "[", 
    RowBox[{"ii_", ",", "dimensions_"}], "]"}], ":=", 
   RowBox[{"Block", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"i", "=", 
        RowBox[{"ii", "-", "1"}]}], ",", "j"}], "}"}], ",", 
     RowBox[{"Map", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"(", 
         RowBox[{
          RowBox[{
           RowBox[{"{", 
            RowBox[{"i", ",", "j"}], "}"}], "=", 
           RowBox[{"QuotientRemainder", "[", 
            RowBox[{"i", ",", "#"}], "]"}]}], ";", 
          RowBox[{"j", "+", "1"}]}], ")"}], "&"}], ",", "dimensions"}], 
      "]"}]}], "]"}]}], ";", 
  RowBox[{
   RowBox[{"latticeIndex", "::", "usage"}], "=", 
   "\"\<Inverse of latticeCoordinates.\>\""}], ";", 
  RowBox[{
   RowBox[{"latticeIndex", "[", "coords_List", "]"}], ":=", 
   RowBox[{"latticeIndex", "[", 
    RowBox[{"coords", ",", "latticeDimensions"}], "]"}]}], ";", 
  RowBox[{
   RowBox[{"latticeIndex", "[", 
    RowBox[{"coords_List", ",", "dimensions_"}], "]"}], ":=", 
   RowBox[{"Block", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"i", "=", "1"}], ",", 
       RowBox[{"delta", "=", "1"}]}], "}"}], ",", 
     RowBox[{
      RowBox[{"Do", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"i", "+=", 
          RowBox[{
           RowBox[{"(", 
            RowBox[{
             RowBox[{"coords", "[", 
              RowBox[{"[", "k", "]"}], "]"}], "-", "1"}], ")"}], "*", 
           "delta"}]}], ";", 
         RowBox[{"delta", "*=", 
          RowBox[{"dimensions", "[", 
           RowBox[{"[", "k", "]"}], "]"}]}]}], ",", 
        RowBox[{"{", 
         RowBox[{"k", ",", 
          RowBox[{"Length", "[", "dimensions", "]"}]}], "}"}]}], "]"}], ";", 
      "i"}]}], "]"}]}], ";", 
  RowBox[{
   RowBox[{"shift", "::", "usage"}], "=", 
   "\"\<Wrap-around, assuming periodic boundary conditions.\>\""}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"shift", "[", 
    RowBox[{"dir_", ",", "coordIn_List", ",", 
     RowBox[{"size_:", "1"}]}], "]"}], ":=", 
   RowBox[{"Block", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"cc", "=", "coordIn"}], "}"}], ",", 
     RowBox[{
      RowBox[{
       RowBox[{"cc", "[", 
        RowBox[{"[", "dir", "]"}], "]"}], "=", 
       RowBox[{"1", "+", 
        RowBox[{"Mod", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"cc", "[", 
            RowBox[{"[", "dir", "]"}], "]"}], "+", "size", "-", "1"}], ",", 
          RowBox[{"latticeDimensions", "[", 
           RowBox[{"[", "dir", "]"}], "]"}]}], "]"}]}]}], ";", "cc"}]}], 
    "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"plaquette", "[", 
    RowBox[{"dir1_", ",", "dir2_", ",", " ", "coords_List"}], "]"}], ":=", 
   RowBox[{"Re", "[", 
    RowBox[{"Tr", "[", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"getLink", "[", 
       RowBox[{"dir1", ",", "coords"}], "]"}], ".", 
      RowBox[{"getLink", "[", 
       RowBox[{"dir2", ",", 
        RowBox[{"shift", "[", 
         RowBox[{"dir1", ",", "coords"}], "]"}]}], "]"}], ".", 
      RowBox[{"ConjugateTranspose", "[", 
       RowBox[{"getLink", "[", 
        RowBox[{"dir1", ",", 
         RowBox[{"shift", "[", 
          RowBox[{"dir2", ",", "coords"}], "]"}]}], "]"}], "]"}], ".", 
      RowBox[{"ConjugateTranspose", "[", 
       RowBox[{"getLink", "[", 
        RowBox[{"dir2", ",", "coords"}], "]"}], "]"}]}], "]"}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"averagePlaquette", "[", "]"}], ":=", 
   RowBox[{"Chop", "[", 
    RowBox[{
     RowBox[{"Sum", "[", 
      RowBox[{
       RowBox[{"Re", "[", 
        RowBox[{"plaquette", "[", 
         RowBox[{"dir1", ",", "dir2", ",", 
          RowBox[{"latticeCoordinates", "[", "k", "]"}]}], "]"}], "]"}], ",", 
       
       RowBox[{"{", 
        RowBox[{"k", ",", 
         RowBox[{"latticeVolume", "[", "]"}]}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"dir1", ",", "2", ",", "nd"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"dir2", ",", 
         RowBox[{"dir1", "-", "1"}]}], "}"}]}], "]"}], "*", 
     RowBox[{"2", "/", 
      RowBox[{"(", 
       RowBox[{
        RowBox[{"latticeVolume", "[", "]"}], "*", "nc", "*", "nd", "*", 
        RowBox[{"(", 
         RowBox[{"nd", "-", "1"}], ")"}]}], ")"}]}]}], "]"}]}], ";", 
  RowBox[{
   RowBox[{"makeTrivialLattice", "::", "usage"}], "=", 
   "\"\<All links identity for a given nd,nc,latticeDimensions.\>\""}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"Options", "[", "makeTrivialLattice", "]"}], "=", 
   RowBox[{"{", 
    RowBox[{"randomGauge", "\[Rule]", "False"}], "}"}]}], ";", " ", 
  RowBox[{
   RowBox[{"makeTrivialLattice", "[", 
    RowBox[{"OptionsPattern", "[", "]"}], "]"}], ":=", 
   RowBox[{"(", 
    RowBox[{
     RowBox[{"gaugeField", "=", 
      RowBox[{"Table", "[", 
       RowBox[{
        RowBox[{"IdentityMatrix", "[", "nc", "]"}], ",", 
        RowBox[{"{", "nd", "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"latticeVolume", "[", "]"}], "}"}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"Clear", "[", "linearSiteIndex", "]"}], ";", 
     RowBox[{"Do", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"linearSiteIndex", "[", 
         RowBox[{"latticeCoordinates", "[", "i", "]"}], "]"}], "=", "i"}], 
       ",", 
       RowBox[{"{", 
        RowBox[{"i", ",", 
         RowBox[{"latticeVolume", "[", "]"}]}], "}"}]}], "]"}], ";", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{"OptionValue", "[", "randomGauge", "]"}], ",", 
       RowBox[{"Do", "[", 
        RowBox[{
         RowBox[{"Block", "[", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{
             RowBox[{"coords", "=", 
              RowBox[{"latticeCoordinates", "[", "i", "]"}]}], ",", 
             RowBox[{"u", "=", 
              RowBox[{"randomSUMatrix", "[", "]"}]}]}], "}"}], ",", 
           RowBox[{"Do", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"setLink", "[", 
               RowBox[{"dir", ",", "coords", ",", 
                RowBox[{"u", ".", 
                 RowBox[{"getLink", "[", 
                  RowBox[{"dir", ",", "coords"}], "]"}]}]}], "]"}], ";", 
              RowBox[{"setLink", "[", 
               RowBox[{"dir", ",", 
                RowBox[{"shift", "[", 
                 RowBox[{"dir", ",", "coords", ",", 
                  RowBox[{"-", "1"}]}], "]"}], ",", 
                RowBox[{
                 RowBox[{"getLink", "[", 
                  RowBox[{"dir", ",", 
                   RowBox[{"shift", "[", 
                    RowBox[{"dir", ",", "coords", ",", 
                    RowBox[{"-", "1"}]}], "]"}]}], "]"}], ".", 
                 RowBox[{"ConjugateTranspose", "[", "u", "]"}]}]}], "]"}]}], 
             ",", 
             RowBox[{"{", 
              RowBox[{"dir", ",", "nd"}], "}"}]}], "]"}]}], "]"}], ",", 
         RowBox[{"{", 
          RowBox[{"i", ",", 
           RowBox[{"latticeVolume", "[", "]"}]}], "}"}]}], "]"}]}], "]"}]}], 
    ")"}]}]}]}], "Input",
 InitializationCell->
  True,ExpressionUUID->"a8585708-e667-42f9-99e1-1656b00db9c2"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"polyakovLoop", "[", 
    RowBox[{"dir_", ",", "anchor_"}], "]"}], ":=", 
   RowBox[{"(*", " ", 
    RowBox[{"Simple", " ", 
     RowBox[{"loop", "."}]}], " ", "*)"}], 
   RowBox[{"Block", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"u", "=", 
       RowBox[{"IdentityMatrix", "[", "nc", "]"}]}], "}"}], ",", 
     RowBox[{
      RowBox[{"Do", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"If", "[", 
          RowBox[{"False", ",", 
           RowBox[{"Print", "[", 
            RowBox[{"{", 
             RowBox[{"i", ",", 
              RowBox[{"Tr", "[", "u", "]"}]}], "}"}], "]"}]}], "]"}], ";", 
         RowBox[{"u", "=", 
          RowBox[{"u", ".", 
           RowBox[{"getLink", "[", 
            RowBox[{"dir", ",", 
             RowBox[{"shift", "[", 
              RowBox[{"dir", ",", "anchor", ",", 
               RowBox[{"i", "-", "1"}]}], "]"}]}], "]"}]}]}]}], ",", 
        RowBox[{"{", 
         RowBox[{"i", ",", 
          RowBox[{"latticeDimensions", "[", 
           RowBox[{"[", "dir", "]"}], "]"}]}], "}"}]}], "]"}], ";", 
      RowBox[{"Tr", "[", "u", "]"}]}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"polyakovLoop", "[", 
    RowBox[{"dir0_", ",", "anchor_", ",", 
     RowBox[{"{", "dir1_", "}"}], ",", 
     RowBox[{"{", "width1_", "}"}]}], "]"}], ":=", 
   RowBox[{"(*", " ", 
    RowBox[{
     RowBox[{
      RowBox[{"Smeared", " ", "over", " ", "a", " ", "1"}], "-", 
      RowBox[{
      "dimensional", " ", "strip", " ", "of", " ", "a", " ", "given", " ", 
       RowBox[{"width", ".", "  ", "Normalization"}], " ", "is", " ", "so", 
       " ", "that", " ", "the", " ", "result", " ", "is", " ", "the", " ", 
       "same", " ", "as", " ", "the", " ", "simple", " ", "loop", " ", "for", 
       " ", "lattice", " ", "links"}]}], " ", "=", " ", "1."}], " ", "*)"}], 
   " ", 
   RowBox[{"Block", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"aa", "=", "anchor"}], ",", "slice", ",", "tmpSlice", ",", 
       "uu"}], "}"}], ",", 
     RowBox[{
      RowBox[{"slice", "=", 
       RowBox[{"Table", "[", 
        RowBox[{
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{"i", "\[Equal]", "1"}], ",", 
           RowBox[{"IdentityMatrix", "[", "nc", "]"}], ",", 
           RowBox[{"zeroMatrix", "[", "]"}]}], "]"}], ",", 
         RowBox[{"{", 
          RowBox[{"i", ",", "width1"}], "}"}]}], "]"}]}], ";", 
      RowBox[{"Do", "[", 
       RowBox[{
        RowBox[{
         RowBox[{
          RowBox[{"aa", "[", 
           RowBox[{"[", "dir0", "]"}], "]"}], "=", "k"}], ";", 
         RowBox[{"tmpSlice", "=", "slice"}], ";", "\[IndentingNewLine]", 
         RowBox[{"uu", "=", 
          RowBox[{"zeroMatrix", "[", "]"}]}], ";", 
         RowBox[{"Do", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"uu", "+=", 
             RowBox[{"slice", "[", 
              RowBox[{"[", 
               RowBox[{"i", "-", "1"}], "]"}], "]"}]}], ";", 
            RowBox[{"uu", "=", 
             RowBox[{"uu", ".", 
              RowBox[{"getLink", "[", 
               RowBox[{"dir1", ",", 
                RowBox[{"shift", "[", 
                 RowBox[{"dir1", ",", "aa", ",", 
                  RowBox[{"i", "-", "2"}]}], "]"}]}], "]"}]}]}], ";", 
            RowBox[{
             RowBox[{"tmpSlice", "[", 
              RowBox[{"[", "i", "]"}], "]"}], "+=", "uu"}]}], ",", 
           RowBox[{"{", 
            RowBox[{"i", ",", "2", ",", "width1"}], "}"}]}], "]"}], ";", 
         RowBox[{"uu", "=", 
          RowBox[{"zeroMatrix", "[", "]"}]}], ";", 
         RowBox[{"Do", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"uu", "+=", 
             RowBox[{"slice", "[", 
              RowBox[{"[", 
               RowBox[{"i", "+", "1"}], "]"}], "]"}]}], ";", 
            RowBox[{"uu", "=", 
             RowBox[{"uu", ".", 
              RowBox[{"ConjugateTranspose", "[", 
               RowBox[{"getLink", "[", 
                RowBox[{"dir1", ",", 
                 RowBox[{"shift", "[", 
                  RowBox[{"dir1", ",", "aa", ",", 
                   RowBox[{"i", "-", "1"}]}], "]"}]}], "]"}], "]"}]}]}], ";", 
            
            RowBox[{
             RowBox[{"tmpSlice", "[", 
              RowBox[{"[", "i", "]"}], "]"}], "+=", "uu"}]}], ",", 
           RowBox[{"{", 
            RowBox[{"i", ",", 
             RowBox[{"width1", "-", "1"}], ",", "1", ",", 
             RowBox[{"-", "1"}]}], "}"}]}], "]"}], ";", "\[IndentingNewLine]", 
         RowBox[{"(*", " ", 
          RowBox[{
          "Normalize", " ", "to", " ", "match", " ", "simple", " ", 
           "Polyakov", " ", "loop", " ", "normalization"}], " ", "*)"}], 
         "\[IndentingNewLine]", 
         RowBox[{"tmpSlice", " ", "*=", " ", 
          RowBox[{"1", "/", "width1"}]}], ";", 
         RowBox[{"If", "[", 
          RowBox[{"False", ",", 
           RowBox[{"Print", "[", 
            RowBox[{"{", 
             RowBox[{"k", ",", 
              RowBox[{"Map", "[", 
               RowBox[{"Tr", ",", "slice"}], "]"}], ",", 
              RowBox[{"Map", "[", 
               RowBox[{"Tr", ",", "tmpSlice"}], "]"}]}], "}"}], "]"}]}], 
          "]"}], ";", "\[IndentingNewLine]", 
         RowBox[{"(*", " ", 
          RowBox[{
          "Move", " ", "strip", " ", "across", " ", "links", " ", "in", " ", 
           "the", " ", "dir0", " ", 
           RowBox[{"direction", "."}]}], " ", "*)"}], 
         RowBox[{"Do", "[", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{
            RowBox[{"slice", "[", 
             RowBox[{"[", "i", "]"}], "]"}], "=", 
            RowBox[{
             RowBox[{"tmpSlice", "[", 
              RowBox[{"[", "i", "]"}], "]"}], ".", 
             RowBox[{"getLink", "[", 
              RowBox[{"dir0", ",", 
               RowBox[{"shift", "[", 
                RowBox[{"dir1", ",", "aa", ",", 
                 RowBox[{"i", "-", "1"}]}], "]"}]}], "]"}]}]}], ",", 
           RowBox[{"{", 
            RowBox[{"i", ",", "width1"}], "}"}]}], "]"}]}], ",", 
        RowBox[{"{", 
         RowBox[{"k", ",", 
          RowBox[{"latticeDimensions", "[", 
           RowBox[{"[", "dir0", "]"}], "]"}]}], "}"}]}], "]"}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"aa", "[", 
        RowBox[{"[", "dir0", "]"}], "]"}], "=", "1"}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"uu", "=", 
       RowBox[{"slice", "[", 
        RowBox[{"[", "width1", "]"}], "]"}]}], ";", 
      RowBox[{"Do", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"uu", "=", 
          RowBox[{"uu", ".", 
           RowBox[{"ConjugateTranspose", "[", 
            RowBox[{"getLink", "[", 
             RowBox[{"dir1", ",", 
              RowBox[{"shift", "[", 
               RowBox[{"dir1", ",", "aa", ",", 
                RowBox[{"i", "-", "1"}]}], "]"}]}], "]"}], "]"}]}]}], ";", 
         RowBox[{"uu", "+=", 
          RowBox[{"slice", "[", 
           RowBox[{"[", "i", "]"}], "]"}]}]}], ",", 
        RowBox[{"{", 
         RowBox[{"i", ",", 
          RowBox[{"width1", "-", "1"}], ",", "1", ",", 
          RowBox[{"-", "1"}]}], "}"}]}], "]"}], ";", 
      RowBox[{"Tr", "[", "uu", "]"}]}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"loopThickness", "[", "]"}], ":=", 
   RowBox[{"beta", " ", 
    RowBox[{
     RowBox[{"Sqrt", "[", 
      RowBox[{"2", " ", "Pi"}], "]"}], "/", 
     RowBox[{"nc", "^", "2"}]}]}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"polyakovLoopTallies", "[", "\"\<smeared\>\"", "]"}], ":=", 
   RowBox[{"Block", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"tallies", "=", 
       RowBox[{"Association", "[", 
        RowBox[{"{", "}"}], "]"}]}], "}"}], ",", 
     RowBox[{
      RowBox[{"Do", "[", 
       RowBox[{
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{"dir0", "\[NotEqual]", "dir1"}], ",", 
          RowBox[{"polyakovLoopAdd", "[", 
           RowBox[{"tallies", ",", "dir0", ",", "dir1"}], "]"}]}], "]"}], ",", 
        RowBox[{"{", 
         RowBox[{"dir0", ",", "nd"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"dir1", ",", "nd"}], "}"}]}], "]"}], ";", "tallies"}]}], 
    "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"polyakovLoopTallies", "[", "\"\<simple\>\"", "]"}], ":=", 
   RowBox[{"Block", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"tallies", "=", 
       RowBox[{"Association", "[", 
        RowBox[{"{", "}"}], "]"}]}], "}"}], ",", 
     RowBox[{
      RowBox[{"Do", "[", 
       RowBox[{
        RowBox[{"polyakovLoopAdd", "[", 
         RowBox[{"tallies", ",", "dir"}], "]"}], ",", 
        RowBox[{"{", 
         RowBox[{"dir", ",", "nd"}], "}"}]}], "]"}], ";", "tallies"}]}], 
    "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"SetAttributes", "[", 
   RowBox[{"polyakovLoopAdd", ",", "HoldFirst"}], "]"}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"polyakovLoopAdd", "[", 
    RowBox[{"tallies_", ",", "dir0_", ",", "dir1_"}], "]"}], ":=", 
   RowBox[{"Block", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"face", "=", "latticeDimensions"}], ",", "pp", ",", 
       RowBox[{"width1", "=", 
        RowBox[{
         RowBox[{"Floor", "[", 
          RowBox[{
           RowBox[{"loopThickness", "[", "]"}], "+", "0.5"}], "]"}], "+", 
         "1"}]}], ",", "skip", ",", "nf"}], "}"}], ",", 
     RowBox[{
      RowBox[{
       RowBox[{"face", "[", 
        RowBox[{"[", "dir0", "]"}], "]"}], "=", "1"}], ";", 
      RowBox[{"skip", "=", 
       RowBox[{"Max", "[", 
        RowBox[{"1", ",", 
         RowBox[{"width1", "-", "1"}]}], "]"}]}], ";", 
      RowBox[{"nf", "=", 
       RowBox[{"Apply", "[", 
        RowBox[{"Times", ",", "face"}], "]"}]}], ";", 
      RowBox[{"pp", "=", 
       RowBox[{"Table", "[", 
        RowBox[{
         RowBox[{"Block", "[", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"coords", "=", 
             RowBox[{"latticeCoordinates", "[", 
              RowBox[{"k", ",", "face"}], "]"}]}], "}"}], ",", 
           RowBox[{"If", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"Mod", "[", 
               RowBox[{
                RowBox[{
                 RowBox[{"coords", "[", 
                  RowBox[{"[", "dir1", "]"}], "]"}], "-", "1"}], ",", 
                "skip"}], "]"}], "\[Equal]", "0"}], ",", 
             RowBox[{"polyakovLoop", "[", 
              RowBox[{"dir0", ",", "coords", ",", 
               RowBox[{"{", "dir1", "}"}], ",", 
               RowBox[{"{", "width1", "}"}]}], "]"}], ",", "Null"}], "]"}]}], 
          "]"}], ",", 
         RowBox[{"{", 
          RowBox[{"k", ",", "nf"}], "}"}]}], "]"}]}], ";", 
      RowBox[{"Do", "[", 
       RowBox[{
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"NumberQ", "[", 
            RowBox[{"pp", "[", 
             RowBox[{"[", "k1", "]"}], "]"}], "]"}], "&&", 
           RowBox[{"NumberQ", "[", 
            RowBox[{"pp", "[", 
             RowBox[{"[", "k2", "]"}], "]"}], "]"}]}], ",", 
          RowBox[{"Block", "[", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{
              RowBox[{"x1", "=", 
               RowBox[{"latticeCoordinates", "[", 
                RowBox[{"k1", ",", "face"}], "]"}]}], ",", 
              RowBox[{"x2", "=", 
               RowBox[{"latticeCoordinates", "[", 
                RowBox[{"k2", ",", "face"}], "]"}]}], ",", "dx", ",", "z", 
              ",", "lt"}], "}"}], ",", 
            RowBox[{
             RowBox[{"dx", "=", 
              RowBox[{
               RowBox[{"Mod", "[", 
                RowBox[{
                 RowBox[{"x1", "-", "x2", "+", 
                  RowBox[{"face", "/", "2"}]}], ",", "face"}], "]"}], "-", 
               RowBox[{"face", "/", "2"}]}]}], ";", 
             RowBox[{"If", "[", 
              RowBox[{
               RowBox[{
                RowBox[{"2", "*", 
                 RowBox[{
                  RowBox[{"dx", "[", 
                   RowBox[{"[", "dir1", "]"}], "]"}], "^", "2"}]}], "<", 
                RowBox[{"dx", ".", "dx"}]}], ",", "\[IndentingNewLine]", 
               RowBox[{
                RowBox[{"lt", "=", 
                 RowBox[{"Lookup", "[", 
                  RowBox[{"tallies", ",", 
                   RowBox[{"Norm", "[", "dx", "]"}], ",", 
                   RowBox[{"{", 
                    RowBox[{"0", ",", "0", ",", "0"}], "}"}]}], "]"}]}], ";", 
                
                RowBox[{
                 RowBox[{"lt", "[", 
                  RowBox[{"[", "1", "]"}], "]"}], "+=", "1"}], ";", 
                "\[IndentingNewLine]", 
                RowBox[{"(*", " ", 
                 RowBox[{
                 "Imaginary", " ", "part", " ", "cancels", " ", "out", " ", 
                  "when", " ", "averaging", " ", "over", " ", "face"}], " ", 
                 "*)"}], " ", "\[IndentingNewLine]", 
                RowBox[{"z", "=", 
                 RowBox[{"Re", "[", 
                  RowBox[{
                   RowBox[{"pp", "[", 
                    RowBox[{"[", "k1", "]"}], "]"}], " ", 
                   RowBox[{"Conjugate", "[", 
                    RowBox[{"pp", "[", 
                    RowBox[{"[", "k2", "]"}], "]"}], "]"}]}], "]"}]}], ";", 
                RowBox[{
                 RowBox[{"lt", "[", 
                  RowBox[{"[", "2", "]"}], "]"}], "+=", "z"}], ";", 
                RowBox[{
                 RowBox[{"lt", "[", 
                  RowBox[{"[", "3", "]"}], "]"}], "+=", 
                 RowBox[{"z", "^", "2"}]}], ";", 
                RowBox[{
                 RowBox[{"tallies", "[", 
                  RowBox[{"Norm", "[", "dx", "]"}], "]"}], "=", "lt"}]}]}], 
              "]"}]}]}], "]"}]}], "]"}], ",", 
        RowBox[{"{", 
         RowBox[{"k1", ",", 
          RowBox[{"nf", "-", "1"}]}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"k2", ",", 
          RowBox[{"k1", "+", "1"}], ",", "nf"}], "}"}]}], "]"}]}]}], "]"}]}], 
  ";", 
  RowBox[{
   RowBox[{"polyakovLoopAdd", "[", 
    RowBox[{"tallies_", ",", "dir_"}], "]"}], ":=", 
   RowBox[{"Block", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"face", "=", "latticeDimensions"}], ",", "pp", ",", "nf"}], 
      "}"}], ",", 
     RowBox[{
      RowBox[{
       RowBox[{"face", "[", 
        RowBox[{"[", "dir", "]"}], "]"}], "=", "1"}], ";", 
      RowBox[{"nf", "=", 
       RowBox[{"Apply", "[", 
        RowBox[{"Times", ",", "face"}], "]"}]}], ";", 
      RowBox[{"pp", "=", 
       RowBox[{"Table", "[", 
        RowBox[{
         RowBox[{"polyakovLoop", "[", 
          RowBox[{"dir", ",", 
           RowBox[{"latticeCoordinates", "[", 
            RowBox[{"k", ",", "face"}], "]"}]}], "]"}], ",", 
         RowBox[{"{", 
          RowBox[{"k", ",", "nf"}], "}"}]}], "]"}]}], ";", 
      RowBox[{"Do", "[", 
       RowBox[{
        RowBox[{"Block", "[", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{
            RowBox[{"x1", "=", 
             RowBox[{"latticeCoordinates", "[", 
              RowBox[{"k1", ",", "face"}], "]"}]}], ",", 
            RowBox[{"x2", "=", 
             RowBox[{"latticeCoordinates", "[", 
              RowBox[{"k2", ",", "face"}], "]"}]}], ",", "dx", ",", "z", ",", 
            "lt"}], "}"}], ",", 
          RowBox[{
           RowBox[{"dx", "=", 
            RowBox[{"Norm", "[", 
             RowBox[{
              RowBox[{"Mod", "[", 
               RowBox[{
                RowBox[{"x1", "-", "x2", "+", 
                 RowBox[{"face", "/", "2"}]}], ",", "face"}], "]"}], "-", 
              RowBox[{"face", "/", "2"}]}], "]"}]}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"lt", "=", 
            RowBox[{"Lookup", "[", 
             RowBox[{"tallies", ",", "dx", ",", 
              RowBox[{"{", 
               RowBox[{"0", ",", "0", ",", "0"}], "}"}]}], "]"}]}], ";", 
           RowBox[{
            RowBox[{"lt", "[", 
             RowBox[{"[", "1", "]"}], "]"}], "+=", "1"}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"(*", " ", 
            RowBox[{
            "Imaginary", " ", "part", " ", "cancels", " ", "out", " ", "when",
              " ", "averaging", " ", "over", " ", "face"}], " ", "*)"}], " ", 
           "\[IndentingNewLine]", 
           RowBox[{"z", "=", 
            RowBox[{"Re", "[", 
             RowBox[{
              RowBox[{"pp", "[", 
               RowBox[{"[", "k1", "]"}], "]"}], " ", 
              RowBox[{"Conjugate", "[", 
               RowBox[{"pp", "[", 
                RowBox[{"[", "k2", "]"}], "]"}], "]"}]}], "]"}]}], ";", 
           RowBox[{
            RowBox[{"lt", "[", 
             RowBox[{"[", "2", "]"}], "]"}], "+=", "z"}], ";", 
           RowBox[{
            RowBox[{"lt", "[", 
             RowBox[{"[", "3", "]"}], "]"}], "+=", 
            RowBox[{"z", "^", "2"}]}], ";", 
           RowBox[{
            RowBox[{"tallies", "[", "dx", "]"}], "=", "lt"}]}]}], "]"}], ",", 
        
        RowBox[{"{", 
         RowBox[{"k1", ",", 
          RowBox[{"nf", "-", "1"}]}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"k2", ",", 
          RowBox[{"k1", "+", "1"}], ",", "nf"}], "}"}]}], "]"}]}]}], "]"}]}], 
  ";", 
  RowBox[{
   RowBox[{"talliesToAverageErrors", "[", "tallies_", "]"}], ":=", 
   RowBox[{"Map", "[", 
    RowBox[{
     RowBox[{
      RowBox[{"{", 
       RowBox[{
        RowBox[{
         RowBox[{"#", "[", 
          RowBox[{"[", "2", "]"}], "]"}], "/", 
         RowBox[{"#", "[", 
          RowBox[{"[", "1", "]"}], "]"}]}], ",", 
        RowBox[{
         RowBox[{"Sqrt", "[", 
          RowBox[{
           RowBox[{"(", 
            RowBox[{
             RowBox[{
              RowBox[{"#", "[", 
               RowBox[{"[", "1", "]"}], "]"}], " ", 
              RowBox[{"#", "[", 
               RowBox[{"[", "3", "]"}], "]"}]}], "-", 
             RowBox[{
              RowBox[{"#", "[", 
               RowBox[{"[", "2", "]"}], "]"}], "^", "2"}]}], ")"}], "/", 
           RowBox[{"#", "[", 
            RowBox[{"[", "1", "]"}], "]"}]}], "]"}], "/", 
         RowBox[{"#", "[", 
          RowBox[{"[", "1", "]"}], "]"}]}]}], "}"}], "&"}], ",", "tallies"}], 
    "]"}]}], ";", 
  RowBox[{
   RowBox[{"Options", "[", "exponentialModel", "]"}], "=", 
   RowBox[{"{", 
    RowBox[{"printResult", "\[Rule]", "False"}], "}"}]}], ";", 
  RowBox[{
   RowBox[{"exponentialModel", "[", 
    RowBox[{"tallyData_", ",", 
     RowBox[{"OptionsPattern", "[", "]"}]}], "]"}], ":=", 
   RowBox[{"Block", "[", 
    RowBox[{"(*", " ", 
     RowBox[{
     "Protect", " ", "against", " ", "any", " ", "global", " ", "definitions",
       " ", "of", " ", "model", " ", 
      RowBox[{"paramters", "."}]}], " ", "*)"}], 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"ff", ",", "aw", ",", "norm", ",", "x"}], "}"}], ",", 
     RowBox[{
      RowBox[{"ff", "=", 
       RowBox[{"NonlinearModelFit", "[", 
        RowBox[{
         RowBox[{"Map", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"{", 
             RowBox[{
              RowBox[{"#", "[", 
               RowBox[{"[", "1", "]"}], "]"}], ",", 
              RowBox[{"#", "[", 
               RowBox[{"[", 
                RowBox[{"2", ",", "1"}], "]"}], "]"}]}], "}"}], "&"}], ",", 
           RowBox[{"Normal", "[", "tallyData", "]"}]}], "]"}], ",", 
         RowBox[{"norm", " ", 
          RowBox[{"Exp", "[", 
           RowBox[{
            RowBox[{"-", "aw"}], " ", "x"}], "]"}]}], ",", 
         RowBox[{"{", 
          RowBox[{"norm", ",", "aw"}], "}"}], ",", "x", ",", 
         RowBox[{"VarianceEstimatorFunction", "\[Rule]", 
          RowBox[{"(", 
           RowBox[{"1", "&"}], ")"}]}], ",", 
         RowBox[{"Weights", "\[Rule]", 
          RowBox[{"Map", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"1", "/", 
              RowBox[{
               RowBox[{"#", "[", 
                RowBox[{"[", 
                 RowBox[{"2", ",", "2"}], "]"}], "]"}], "^", "2"}]}], "&"}], 
            ",", 
            RowBox[{"Normal", "[", "tallyData", "]"}]}], "]"}]}]}], "]"}]}], 
      ";", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"OptionValue", "[", "printResult", "]"}], ",", 
        RowBox[{"Print", "[", 
         RowBox[{"ff", "[", "\"\<ParameterTable\>\"", "]"}], "]"}]}], "]"}], 
      ";", "ff"}]}], "]"}]}], ";"}]}], "Input",
 InitializationCell->
  True,ExpressionUUID->"faa6b70a-656d-43af-aa52-3ec15867dc53"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"SUPower", "[", 
    RowBox[{"mat_", ",", "power_"}], "]"}], ":=", 
   RowBox[{"Block", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"values", ",", "vectors", ",", "phases", ",", "phaseSum", ",", 
       RowBox[{"fix", "=", "True"}], ",", "delta", ",", "result", ",", " ", 
       RowBox[{"debug", "=", "False"}]}], "}"}], ",", 
     RowBox[{
      RowBox[{
       RowBox[{"{", 
        RowBox[{"values", ",", "vectors"}], "}"}], "=", 
       RowBox[{"Eigensystem", "[", "mat", "]"}]}], ";", 
      RowBox[{"phases", "=", 
       RowBox[{"Arg", "[", "values", "]"}]}], ";", 
      RowBox[{"phaseSum", "=", 
       RowBox[{"Chop", "[", 
        RowBox[{"Plus", "@@", "phases"}], "]"}]}], ";", " ", 
      "\[IndentingNewLine]", 
      RowBox[{"(*", " ", 
       RowBox[{"Gram", "-", 
        RowBox[{"Schmidt", " ", "orthogonalization"}]}], " ", "*)"}], 
      "\[IndentingNewLine]", 
      RowBox[{"vectors", "=", 
       RowBox[{"Orthogonalize", "[", "vectors", "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"(*", " ", 
       RowBox[{
        RowBox[{"Sanity", " ", 
         RowBox[{"check", ".", "  ", 
          RowBox[{"QDP", "++"}]}], " ", "default", " ", "is", " ", "single", 
         " ", "precision"}], ",", " ", 
        RowBox[{
        "so", " ", "we", " ", "set", " ", "the", " ", "tolerance", " ", 
         RowBox[{"high", "."}]}]}], " ", "*)"}], " ", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"Abs", "[", 
          RowBox[{
           RowBox[{"Mod", "[", 
            RowBox[{
             RowBox[{"phaseSum", "+", "Pi"}], ",", 
             RowBox[{"2", "Pi"}]}], "]"}], "-", "Pi"}], "]"}], ">", 
         RowBox[{"10", "^", 
          RowBox[{"-", "5"}]}]}], ",", 
        RowBox[{
         RowBox[{"Print", "[", 
          RowBox[{"\"\<phaseSum=\>\"", ",", "phaseSum"}], "]"}], ";", 
         RowBox[{"Abort", "[", "]"}]}]}], "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{"(*", " ", 
       RowBox[{
        RowBox[{"If", " ", "the", " ", "total", " ", "is", " ", "nonzero"}], 
        ",", " ", 
        RowBox[{"need", " ", "to", " ", "shift"}]}], " ", "*)"}], " ", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"phaseSum", "!=", "0"}], ",", 
        RowBox[{
         RowBox[{
          RowBox[{"phases", "[", 
           RowBox[{"[", "1", "]"}], "]"}], "-=", "phaseSum"}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"While", "[", 
          RowBox[{"fix", ",", 
           RowBox[{
            RowBox[{"fix", "=", "False"}], ";", 
            RowBox[{"Do", "[", 
             RowBox[{
              RowBox[{"If", "[", 
               RowBox[{
                RowBox[{
                 RowBox[{
                  RowBox[{"phases", "[", 
                   RowBox[{"[", "i", "]"}], "]"}], "-", 
                  RowBox[{"phases", "[", 
                   RowBox[{"[", "j", "]"}], "]"}]}], ">", 
                 RowBox[{"2", "*", "Pi"}]}], ",", 
                RowBox[{
                 RowBox[{"delta", "=", 
                  RowBox[{"Floor", "[", 
                   RowBox[{
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"phases", "[", 
                    RowBox[{"[", "i", "]"}], "]"}], "-", 
                    RowBox[{"phases", "[", 
                    RowBox[{"[", "j", "]"}], "]"}], "+", 
                    RowBox[{"2", "*", "Pi"}]}], ")"}], "/", 
                    RowBox[{"(", 
                    RowBox[{"4", "*", "Pi"}], ")"}]}], "]"}]}], ";", 
                 RowBox[{
                  RowBox[{"phases", "[", 
                   RowBox[{"[", "i", "]"}], "]"}], "-=", 
                  RowBox[{"2", "*", "Pi", "*", "delta"}]}], ";", 
                 RowBox[{
                  RowBox[{"phases", "[", 
                   RowBox[{"[", "j", "]"}], "]"}], "+=", 
                  RowBox[{"2", "*", "Pi", "*", "delta"}]}], ";", 
                 RowBox[{"fix", "=", "True"}]}]}], "]"}], ",", 
              RowBox[{"{", 
               RowBox[{"i", ",", 
                RowBox[{"Length", "[", "mat", "]"}]}], "}"}], ",", 
              RowBox[{"{", 
               RowBox[{"j", ",", 
                RowBox[{"Length", "[", "mat", "]"}]}], "}"}]}], "]"}]}]}], 
          "]"}]}]}], "]"}], ";", 
      RowBox[{"result", "=", 
       RowBox[{
        RowBox[{"Transpose", "[", "vectors", "]"}], ".", 
        RowBox[{"DiagonalMatrix", "[", 
         RowBox[{"Exp", "[", 
          RowBox[{"I", "*", "phases", "*", "power"}], "]"}], "]"}], ".", 
        RowBox[{"Conjugate", "[", "vectors", "]"}]}]}], ";", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"debug", " ", "&&", " ", 
         RowBox[{"Not", "[", 
          RowBox[{"SUMatrixQ", "[", "result", "]"}], "]"}]}], ",", 
        RowBox[{"Print", "[", "\"\<matrix power not SU\>\"", "]"}]}], "]"}], 
      ";", "result"}]}], "]"}]}], ";", 
  RowBox[{
   RowBox[{"centerPhases", "[", "mat_", "]"}], ":=", 
   RowBox[{"(*", " ", 
    RowBox[{"Used", " ", "for", " ", "some", " ", "testing"}], " ", "*)"}], 
   " ", 
   RowBox[{"Block", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"delta", ",", 
       RowBox[{"phases", "=", 
        RowBox[{"Arg", "[", 
         RowBox[{"Eigenvalues", "[", "mat", "]"}], "]"}]}]}], "}"}], ",", 
     RowBox[{
      RowBox[{
       RowBox[{"phases", "[", 
        RowBox[{"[", "1", "]"}], "]"}], "-=", 
       RowBox[{"Apply", "[", 
        RowBox[{"Plus", ",", "phases"}], "]"}]}], ";", 
      RowBox[{"Do", "[", 
       RowBox[{
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{
           RowBox[{
            RowBox[{"phases", "[", 
             RowBox[{"[", "i", "]"}], "]"}], "-", 
            RowBox[{"phases", "[", 
             RowBox[{"[", "j", "]"}], "]"}]}], ">", 
           RowBox[{"2", "*", "Pi"}]}], ",", 
          RowBox[{
           RowBox[{"delta", "=", 
            RowBox[{"Floor", "[", 
             RowBox[{
              RowBox[{"(", 
               RowBox[{
                RowBox[{"phases", "[", 
                 RowBox[{"[", "i", "]"}], "]"}], "-", 
                RowBox[{"phases", "[", 
                 RowBox[{"[", "j", "]"}], "]"}], "+", 
                RowBox[{"2", "*", "Pi"}]}], ")"}], "/", 
              RowBox[{"(", 
               RowBox[{"4", "*", "Pi"}], ")"}]}], "]"}]}], ";", 
           RowBox[{
            RowBox[{"phases", "[", 
             RowBox[{"[", "i", "]"}], "]"}], "-=", 
            RowBox[{"2", "*", "Pi", "*", "delta"}]}], ";", 
           RowBox[{
            RowBox[{"phases", "[", 
             RowBox[{"[", "j", "]"}], "]"}], "+=", 
            RowBox[{"2", "*", "Pi", "*", "delta"}]}]}]}], "]"}], ",", 
        RowBox[{"{", 
         RowBox[{"i", ",", 
          RowBox[{"Length", "[", "phases", "]"}]}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"j", ",", 
          RowBox[{"Length", "[", "phases", "]"}]}], "}"}]}], "]"}], ";", 
      RowBox[{"Sort", "[", 
       RowBox[{"phases", ",", 
        RowBox[{
         RowBox[{"Order", "[", 
          RowBox[{
           RowBox[{"Abs", "[", "#1", "]"}], ",", 
           RowBox[{"Abs", "[", "#2", "]"}]}], "]"}], "&"}]}], "]"}]}]}], 
    "]"}]}]}]], "Input",
 InitializationCell->
  True,ExpressionUUID->"e6cd0bb7-0323-44b6-a0ca-355b22d22e02"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"setAxialGauge", "::", "usage"}], "=", 
   "\"\<Set gauge for the current lattice configuration.  This should be \
exact, so the average plaquette should be unchanged.\>\""}], ";", 
  RowBox[{
   RowBox[{"setAxialGauge", "[", "dir_", "]"}], ":=", "\[IndentingNewLine]", 
   RowBox[{"Do", "[", 
    RowBox[{
     RowBox[{"Block", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         RowBox[{"coords", "=", 
          RowBox[{"latticeCoordinates", "[", "i", "]"}]}], ",", 
         RowBox[{"debug", "=", "False"}]}], "}"}], ",", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"coords", "[", 
           RowBox[{"[", "dir", "]"}], "]"}], "\[Equal]", "1"}], ",", 
         RowBox[{"Block", "[", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{
             RowBox[{"v", "=", 
              RowBox[{"IdentityMatrix", "[", "nc", "]"}]}], ",", "vt", ",", 
             "ct"}], "}"}], ",", 
           RowBox[{"(*", " ", 
            RowBox[{"Initial", " ", "values"}], " ", "*)"}], 
           "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"If", "[", 
             RowBox[{"False", ",", 
              RowBox[{"Do", "[", 
               RowBox[{
                RowBox[{"Print", "[", 
                 RowBox[{"{", 
                  RowBox[{"j", ",", 
                   RowBox[{"getLink", "[", 
                    RowBox[{"dir", ",", 
                    RowBox[{"shift", "[", 
                    RowBox[{"dir", ",", "coords", ",", 
                    RowBox[{"j", "-", "1"}]}], "]"}]}], "]"}]}], "}"}], "]"}],
                 ",", 
                RowBox[{"{", 
                 RowBox[{"j", ",", 
                  RowBox[{"latticeDimensions", "[", 
                   RowBox[{"[", "dir", "]"}], "]"}]}], "}"}]}], "]"}]}], 
             "]"}], ";", "\[IndentingNewLine]", 
            RowBox[{"Do", "[", 
             RowBox[{
              RowBox[{"v", "=", 
               RowBox[{"v", ".", 
                RowBox[{"getLink", "[", 
                 RowBox[{"dir", ",", 
                  RowBox[{"shift", "[", 
                   RowBox[{"dir", ",", "coords", ",", 
                    RowBox[{"j", "-", "1"}]}], "]"}]}], "]"}]}]}], ",", 
              RowBox[{"{", 
               RowBox[{"j", ",", 
                RowBox[{"latticeDimensions", "[", 
                 RowBox[{"[", "dir", "]"}], "]"}]}], "}"}]}], "]"}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"If", "[", 
             RowBox[{"debug", ",", 
              RowBox[{"Print", "[", 
               RowBox[{"\"\<Full product:\>\"", ",", " ", "v"}], "]"}]}], 
             "]"}], ";", 
            RowBox[{"v", "=", 
             RowBox[{"SUPower", "[", 
              RowBox[{"v", ",", 
               RowBox[{"1", "/", 
                RowBox[{"latticeDimensions", "[", 
                 RowBox[{"[", "dir", "]"}], "]"}]}]}], "]"}]}], ";", 
            RowBox[{"If", "[", 
             RowBox[{"debug", ",", 
              RowBox[{"Print", "[", 
               RowBox[{"\"\<Root:\>\"", ",", " ", "v"}], "]"}]}], "]"}], ";", 
            
            RowBox[{"Do", "[", 
             RowBox[{"(*", " ", 
              RowBox[{
              "Apply", " ", "gauge", " ", "choice", " ", "to", " ", "each", 
               " ", "site"}], " ", "*)"}], "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{
               RowBox[{"ct", "=", 
                RowBox[{"shift", "[", 
                 RowBox[{"dir", ",", "coords", ",", 
                  RowBox[{"j", "-", "1"}]}], "]"}]}], ";", 
               RowBox[{"vt", "=", 
                RowBox[{
                 RowBox[{"ConjugateTranspose", "[", 
                  RowBox[{"getLink", "[", 
                   RowBox[{"dir", ",", 
                    RowBox[{"shift", "[", 
                    RowBox[{"dir", ",", "ct", ",", 
                    RowBox[{"-", "1"}]}], "]"}]}], "]"}], "]"}], ".", "v"}]}],
                ";", 
               RowBox[{"Do", "[", 
                RowBox[{
                 RowBox[{
                  RowBox[{"setLink", "[", 
                   RowBox[{"dd", ",", 
                    RowBox[{"shift", "[", 
                    RowBox[{"dd", ",", "ct", ",", 
                    RowBox[{"-", "1"}]}], "]"}], ",", 
                    RowBox[{"(*", " ", 
                    RowBox[{
                    RowBox[{
                    "In", " ", "order", " ", "to", " ", "decrease", " ", 
                    "the", " ", "floating", " ", "point", " ", "error"}], ",",
                     " ", 
                    RowBox[{
                    "just", " ", "set", " ", "the", " ", "axial", " ", 
                    "direction", " ", "link", " ", "to", " ", "the", " ", 
                    "correct", " ", 
                    RowBox[{"value", "."}]}]}], " ", "*)"}], 
                    RowBox[{"If", "[", 
                    RowBox[{
                    RowBox[{"dd", "\[Equal]", "dir"}], ",", "v", ",", 
                    RowBox[{
                    RowBox[{"getLink", "[", 
                    RowBox[{"dd", ",", 
                    RowBox[{"shift", "[", 
                    RowBox[{"dd", ",", "ct", ",", 
                    RowBox[{"-", "1"}]}], "]"}]}], "]"}], ".", "vt"}]}], 
                    "]"}]}], "]"}], ";", 
                  RowBox[{"setLink", "[", 
                   RowBox[{"dd", ",", "ct", ",", 
                    RowBox[{
                    RowBox[{"ConjugateTranspose", "[", "vt", "]"}], ".", 
                    RowBox[{"getLink", "[", 
                    RowBox[{"dd", ",", "ct"}], "]"}]}]}], "]"}]}], ",", 
                 RowBox[{"{", 
                  RowBox[{"dd", ",", "nd"}], "}"}]}], "]"}]}], ",", 
              RowBox[{"{", 
               RowBox[{"j", ",", "2", ",", 
                RowBox[{"latticeDimensions", "[", 
                 RowBox[{"[", "dir", "]"}], "]"}]}], "}"}]}], "]"}], ";", 
            RowBox[{"(*", " ", 
             RowBox[{
             "Verify", " ", "that", " ", "it", " ", "all", " ", "worked", " ",
               "out"}], " ", "*)"}], "\[IndentingNewLine]", 
            RowBox[{"If", "[", 
             RowBox[{"debug", ",", 
              RowBox[{
               RowBox[{"Do", "[", 
                RowBox[{
                 RowBox[{"Print", "[", 
                  RowBox[{"{", 
                   RowBox[{"j", ",", 
                    RowBox[{"getLink", "[", 
                    RowBox[{"dir", ",", 
                    RowBox[{"shift", "[", 
                    RowBox[{"dir", ",", "coords", ",", 
                    RowBox[{"j", "-", "1"}]}], "]"}]}], "]"}]}], "}"}], "]"}],
                  ",", 
                 RowBox[{"{", 
                  RowBox[{"j", ",", 
                   RowBox[{"latticeDimensions", "[", 
                    RowBox[{"[", "dir", "]"}], "]"}]}], "}"}]}], "]"}], ";", 
               "\[IndentingNewLine]", 
               RowBox[{"Print", "[", 
                RowBox[{"\"\<Final link diff:\>\"", ",", 
                 RowBox[{"Chop", "[", 
                  RowBox[{"v", "-", 
                   RowBox[{"getLink", "[", 
                    RowBox[{"dir", ",", 
                    RowBox[{"shift", "[", 
                    RowBox[{"dir", ",", "coords", ",", 
                    RowBox[{"-", "1"}]}], "]"}]}], "]"}]}], "]"}]}], 
                "]"}]}]}], "]"}]}]}], "]"}]}], "]"}]}], "]"}], ",", 
     RowBox[{"{", 
      RowBox[{"i", ",", 
       RowBox[{"latticeVolume", "[", "]"}]}], "}"}]}], "]"}]}]}]], "Input",
 InitializationCell->
  True,ExpressionUUID->"9dfb6e45-5418-49e9-b50c-39540599264d"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"sumStaples", "::", "usage"}], "=", 
   "\"\<Returns a general matrix in color space.\>\""}], ";", 
  RowBox[{
   RowBox[{"sumStaples", "[", 
    RowBox[{"dir1_", ",", "coords_"}], "]"}], ":=", 
   RowBox[{"Block", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"total", "=", 
       RowBox[{"zeroMatrix", "[", "]"}]}], "}"}], ",", "\[IndentingNewLine]", 
     
     RowBox[{
      RowBox[{"Do", "[", 
       RowBox[{
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{"dir2", "\[NotEqual]", "dir1"}], ",", 
          RowBox[{"(*", " ", 
           RowBox[{"forward", " ", "staple"}], " ", "*)"}], 
          RowBox[{
           RowBox[{"total", " ", "+=", " ", 
            RowBox[{
             RowBox[{"getLink", "[", 
              RowBox[{"dir2", ",", 
               RowBox[{"shift", "[", 
                RowBox[{"dir1", ",", "coords"}], "]"}]}], "]"}], ".", 
             RowBox[{"ConjugateTranspose", "[", 
              RowBox[{"getLink", "[", 
               RowBox[{"dir1", ",", 
                RowBox[{"shift", "[", 
                 RowBox[{"dir2", ",", "coords"}], "]"}]}], "]"}], "]"}], ".", 
             
             RowBox[{"ConjugateTranspose", "[", 
              RowBox[{"getLink", "[", 
               RowBox[{"dir2", ",", "coords"}], "]"}], "]"}]}]}], ";", 
           RowBox[{"(*", 
            RowBox[{
             RowBox[{" ", 
              RowBox[{"backward", " ", 
               RowBox[{"staple", ".", "  ", "Note"}], " ", "that", " ", "we", 
               " ", "simply", " ", "demand", " ", "that", " ", 
               RowBox[{"Re", "[", " ", 
                RowBox[{"Tr", "[", " ", 
                 RowBox[{"F", " ", "U"}], "]"}], "]"}]}], "]"}], ",", " ", 
             RowBox[{
             "where", " ", "F", " ", "is", " ", "the", " ", "staple"}], ",", 
             " ", 
             RowBox[{
             "gives", " ", "the", " ", "plaquette", " ", "used", " ", "in", 
              " ", "the", " ", 
              RowBox[{"action", ".", "  ", "Thus"}]}], ",", " ", 
             RowBox[{
             "we", " ", "are", " ", "free", " ", "to", " ", "take", " ", 
              "the", " ", "complex", " ", "conjugate", " ", 
              RowBox[{
               RowBox[{"(", 
                RowBox[{"charge", " ", "congugate"}], ")"}], "."}]}]}], " ", 
            "*)"}], " ", 
           RowBox[{"total", " ", "+=", " ", 
            RowBox[{
             RowBox[{"ConjugateTranspose", "[", 
              RowBox[{"getLink", "[", 
               RowBox[{"dir2", ",", 
                RowBox[{"shift", "[", 
                 RowBox[{"dir2", ",", 
                  RowBox[{"shift", "[", 
                   RowBox[{"dir1", ",", "coords"}], "]"}], ",", 
                  RowBox[{"-", "1"}]}], "]"}]}], "]"}], "]"}], ".", 
             RowBox[{"ConjugateTranspose", "[", 
              RowBox[{"getLink", "[", 
               RowBox[{"dir1", ",", 
                RowBox[{"shift", "[", 
                 RowBox[{"dir2", ",", "coords", ",", 
                  RowBox[{"-", "1"}]}], "]"}]}], "]"}], "]"}], ".", 
             RowBox[{"getLink", "[", 
              RowBox[{"dir2", ",", 
               RowBox[{"shift", "[", 
                RowBox[{"dir2", ",", "coords", ",", 
                 RowBox[{"-", "1"}]}], "]"}]}], "]"}]}]}]}]}], "]"}], ",", 
        RowBox[{"{", 
         RowBox[{"dir2", ",", "nd"}], "}"}]}], "]"}], ";", "total"}]}], 
    "]"}]}], ";", 
  RowBox[{
   RowBox[{"stapleTest", "::", "usage"}], "=", 
   "\"\<Find the average plaquette using the staples times the link.  This \
should be equal to the normal average plaquette. Each plaquette contributes \
to 4 staples.\>\""}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"stapleTest", "[", "]"}], ":=", 
   RowBox[{"Chop", "[", 
    RowBox[{
     RowBox[{"Sum", "[", 
      RowBox[{
       RowBox[{"Tr", "[", 
        RowBox[{
         RowBox[{"sumStaples", "[", 
          RowBox[{"dir", ",", 
           RowBox[{"latticeCoordinates", "[", "k", "]"}]}], "]"}], ".", 
         RowBox[{"getLink", "[", 
          RowBox[{"dir", ",", 
           RowBox[{"latticeCoordinates", "[", "k", "]"}]}], "]"}]}], "]"}], 
       ",", 
       RowBox[{"{", 
        RowBox[{"k", ",", 
         RowBox[{"latticeVolume", "[", "]"}]}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"dir", ",", "nd"}], "}"}]}], "]"}], "*", 
     RowBox[{"2", "/", 
      RowBox[{"(", 
       RowBox[{
        RowBox[{"latticeVolume", "[", "]"}], "*", "nd", "*", 
        RowBox[{"(", 
         RowBox[{"nd", "-", "1"}], ")"}], "*", "nc", "*", "4"}], ")"}]}]}], 
    "]"}]}], ";"}]}], "Input",
 InitializationCell->
  True,ExpressionUUID->"f1499c35-4016-4452-81ab-eca84b727821"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"wrapIt", "[", "coords_List", "]"}], ":=", 
   RowBox[{"MapThread", "[", 
    RowBox[{
     RowBox[{
      RowBox[{"1", "+", 
       RowBox[{"Mod", "[", 
        RowBox[{
         RowBox[{"#1", "-", "1"}], ",", "#2"}], "]"}]}], "&"}], ",", 
     RowBox[{"{", 
      RowBox[{"coords", ",", "latticeDimensions"}], "}"}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"plotActionLimits", "[", "]"}], ":=", 
   RowBox[{"{", 
    RowBox[{"0", ",", 
     RowBox[{"Min", "[", 
      RowBox[{
       RowBox[{"2", " ", 
        RowBox[{
         RowBox[{"n", "^", "2"}], "/", "3"}]}], ",", "15"}], "]"}]}], "}"}]}],
   ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"plotActionPlane", "[", 
    RowBox[{"dir1_", ",", "dir2_", ",", "anchor_List", ",", "range_"}], "]"}],
    ":=", 
   RowBox[{"Block", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"coords", "=", "anchor"}], "}"}], ",", 
     RowBox[{"ListPlot3D", "[", 
      RowBox[{
       RowBox[{"Flatten", "[", 
        RowBox[{
         RowBox[{"Table", "[", 
          RowBox[{
           RowBox[{
            RowBox[{
             RowBox[{"coords", "[", 
              RowBox[{"[", "dir1", "]"}], "]"}], "=", "x1"}], ";", 
            RowBox[{
             RowBox[{"coords", "[", 
              RowBox[{"[", "dir2", "]"}], "]"}], "=", "x2"}], ";", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"x1", "+", 
               RowBox[{"1", "/", "2"}]}], ",", 
              RowBox[{"x2", "+", 
               RowBox[{"1", "/", "2"}]}], ",", 
              RowBox[{"beta", 
               RowBox[{"(", 
                RowBox[{"1", "-", 
                 RowBox[{
                  RowBox[{"plaquette", "[", 
                   RowBox[{"dir1", ",", "dir2", ",", 
                    RowBox[{"wrapIt", "[", "coords", "]"}]}], "]"}], "/", 
                  "nc"}]}], ")"}]}]}], "}"}]}], ",", 
           RowBox[{"{", 
            RowBox[{"x1", ",", "0", ",", 
             RowBox[{"latticeDimensions", "[", 
              RowBox[{"[", "dir1", "]"}], "]"}]}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"x2", ",", "0", ",", 
             RowBox[{"latticeDimensions", "[", 
              RowBox[{"[", "dir2", "]"}], "]"}]}], "}"}]}], "]"}], ",", "1"}],
         "]"}], ",", 
       RowBox[{"PlotRange", "\[Rule]", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{
            RowBox[{"1", "/", "2"}], ",", 
            RowBox[{
             RowBox[{"latticeDimensions", "[", 
              RowBox[{"[", "dir1", "]"}], "]"}], "+", 
             RowBox[{"1", "/", "2"}]}]}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"1", "/", "2"}], ",", 
            RowBox[{
             RowBox[{"latticeDimensions", "[", 
              RowBox[{"[", "dir2", "]"}], "]"}], "+", 
             RowBox[{"1", "/", "2"}]}]}], "}"}], ",", "range"}], "}"}]}]}], 
      "]"}]}], "]"}]}], ";", 
  RowBox[{
   RowBox[{"plotActionSides", "[", 
    RowBox[{
    "dir0_", ",", "dir1_", ",", "dir2_", ",", "anchor_List", ",", "range_"}], 
    "]"}], ":=", 
   RowBox[{"Block", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"coords", "=", "anchor"}], "}"}], ",", 
     RowBox[{"ListPlot3D", "[", 
      RowBox[{
       RowBox[{"Flatten", "[", 
        RowBox[{
         RowBox[{"Table", "[", 
          RowBox[{
           RowBox[{
            RowBox[{
             RowBox[{"coords", "[", 
              RowBox[{"[", "dir1", "]"}], "]"}], "=", "x1"}], ";", 
            RowBox[{
             RowBox[{"coords", "[", 
              RowBox[{"[", "dir2", "]"}], "]"}], "=", "x2"}], ";", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"x1", "+", 
               RowBox[{"If", "[", 
                RowBox[{
                 RowBox[{"i", "\[Equal]", "1"}], ",", 
                 RowBox[{"1", "/", "2"}], ",", "0"}], "]"}]}], ",", 
              RowBox[{"x2", "+", 
               RowBox[{"If", "[", 
                RowBox[{
                 RowBox[{"i", "\[Equal]", "1"}], ",", "0", ",", 
                 RowBox[{"1", "/", "2"}]}], "]"}]}], ",", 
              RowBox[{"beta", " ", 
               RowBox[{"(", 
                RowBox[{"1", "-", 
                 RowBox[{
                  RowBox[{"plaquette", "[", 
                   RowBox[{"dir0", ",", 
                    RowBox[{"If", "[", 
                    RowBox[{
                    RowBox[{"i", "\[Equal]", "1"}], ",", "dir1", ",", 
                    "dir2"}], "]"}], ",", 
                    RowBox[{"wrapIt", "[", "coords", "]"}]}], "]"}], "/", 
                  "nc"}]}], ")"}]}]}], "}"}]}], ",", 
           RowBox[{"{", 
            RowBox[{"x1", ",", "0", ",", 
             RowBox[{"latticeDimensions", "[", 
              RowBox[{"[", "dir1", "]"}], "]"}]}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"x2", ",", "0", ",", 
             RowBox[{"latticeDimensions", "[", 
              RowBox[{"[", "dir2", "]"}], "]"}]}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"i", ",", "2"}], "}"}]}], "]"}], ",", "2"}], "]"}], ",", 
       RowBox[{"PlotRange", "\[Rule]", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{
            RowBox[{"1", "/", "2"}], ",", 
            RowBox[{
             RowBox[{"latticeDimensions", "[", 
              RowBox[{"[", "dir1", "]"}], "]"}], "+", 
             RowBox[{"1", "/", "2"}]}]}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"1", "/", "2"}], ",", 
            RowBox[{
             RowBox[{"latticeDimensions", "[", 
              RowBox[{"[", "dir2", "]"}], "]"}], "+", 
             RowBox[{"1", "/", "2"}]}]}], "}"}], ",", "range"}], "}"}]}]}], 
      "]"}]}], "]"}]}], ";", 
  RowBox[{
   RowBox[{"plotAction", "[", 
    RowBox[{"dir0_", ",", "dir1_", ",", "dir2_", ",", "anchor_List", ",", 
     RowBox[{"range_:", 
      RowBox[{"{", 
       RowBox[{"0", ",", 
        RowBox[{"2", " ", 
         RowBox[{
          RowBox[{"nc", "^", "2"}], "/", "3"}]}]}], " ", "}"}]}]}], "]"}], ":=", 
   RowBox[{"Block", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"coords", "=", "anchor"}], "}"}], ",", 
     RowBox[{"ListAnimate", "[", 
      RowBox[{"Flatten", "[", 
       RowBox[{
        RowBox[{"Table", "[", 
         RowBox[{
          RowBox[{
           RowBox[{
            RowBox[{"coords", "[", 
             RowBox[{"[", "dir0", "]"}], "]"}], "=", "x0"}], ";", 
           RowBox[{"If", "[", 
            RowBox[{
             RowBox[{"i", "\[Equal]", "1"}], ",", 
             RowBox[{"plotActionPlane", "[", 
              RowBox[{"dir1", ",", "dir2", ",", "coords", ",", "range"}], 
              "]"}], ",", 
             RowBox[{"plotActionSides", "[", 
              RowBox[{
              "dir0", ",", "dir1", ",", "dir2", ",", "coords", ",", "range"}],
               "]"}]}], "]"}]}], ",", 
          RowBox[{"{", 
           RowBox[{"x0", ",", 
            RowBox[{"latticeDimensions", "[", 
             RowBox[{"[", "dir0", "]"}], "]"}]}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"i", ",", "2"}], "}"}]}], "]"}], ",", "1"}], "]"}], 
      "]"}]}], "]"}]}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"lineLinks", "[", 
    RowBox[{"dir_", ",", "anchor_List"}], "]"}], ":=", 
   RowBox[{"Block", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"coords", "=", "anchor"}], "}"}], ",", 
     RowBox[{"ColumnForm", "[", 
      RowBox[{"Table", "[", 
       RowBox[{
        RowBox[{
         RowBox[{
          RowBox[{"coords", "[", 
           RowBox[{"[", "dir", "]"}], "]"}], "=", "i"}], ";", 
         RowBox[{"getLink", "[", 
          RowBox[{"dir", ",", "coords"}], "]"}]}], ",", 
        RowBox[{"{", 
         RowBox[{"i", ",", 
          RowBox[{"latticeDimensions", "[", 
           RowBox[{"[", "dir", "]"}], "]"}]}], "}"}]}], "]"}], "]"}]}], 
    "]"}]}], ";"}]}], "Input",
 InitializationCell->
  True,ExpressionUUID->"b7aa2f88-b371-4297-9bcb-cb1b8f7d99ec"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"xmlFilter", "::", "usage"}], "=", 
   "\"\<Use expr=Import[\\\[OpenCurlyDoubleQuote]filename.xml\\\
\[CloseCurlyDoubleQuote]] to load XML file.\[IndentingNewLine]To explore the \
XML tree,use:xmlFilter[expr[[2]],{\\\[OpenCurlyDoubleQuote]tag1\\\
\[CloseCurlyDoubleQuote],...},True]\[IndentingNewLine]To extract \
something,use:xmlFilter[expr[[2]],{\\\[OpenCurlyDoubleQuote]tag1\\\
\[CloseCurlyDoubleQuote],...}]\>\""}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"xmlFilter", "[", 
    RowBox[{"expr_String", ",", 
     RowBox[{"{", "}"}], ",", "_"}], "]"}], ":=", 
   RowBox[{"ToExpression", "[", "expr", "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"xmlFilter", "[", 
    RowBox[{"expr_XMLElement", ",", 
     RowBox[{"{", "}"}], ",", 
     RowBox[{"flag_:", "False"}]}], "]"}], ":=", 
   RowBox[{"If", "[", 
    RowBox[{"flag", ",", 
     RowBox[{"expr", "[", 
      RowBox[{"[", "1", "]"}], "]"}], ",", "expr"}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"xmlFilter", "[", 
    RowBox[{
     RowBox[{"XMLElement", "[", 
      RowBox[{"a_", ",", "tags_", ",", "branches_"}], "]"}], ",", 
     RowBox[{"{", 
      RowBox[{"a_", ",", "b___"}], "}"}], ",", 
     RowBox[{"flag_:", "False"}]}], "]"}], ":=", 
   RowBox[{"Select", "[", 
    RowBox[{
     RowBox[{"Map", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"xmlFilter", "[", 
         RowBox[{"#", ",", 
          RowBox[{"{", "b", "}"}], ",", "flag"}], "]"}], "&"}], ",", 
       "branches"}], "]"}], ",", 
     RowBox[{
      RowBox[{"(", 
       RowBox[{"#", "=!=", "Null"}], ")"}], "&"}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"xmlFilter", "[", 
   RowBox[{
    RowBox[{"XMLElement", "[", 
     RowBox[{"_", ",", "tags_", ",", "branches_"}], "]"}], ",", 
    RowBox[{"{", "__", "}"}], ",", 
    RowBox[{"_", ":", "False"}]}], "]"}], ":=", "Null"}]}], "Input",
 InitializationCell->
  True,ExpressionUUID->"ca2cbcfa-6ca5-43d3-a09e-6bd7ec5ba3e7"],

Cell[BoxData[
 RowBox[{"Needs", "[", "\"\<ErrorBarPlots`\>\"", "]"}]], "Input",
 InitializationCell->
  True,ExpressionUUID->"a203557a-6cc3-489e-b1ec-7ddad4a4112c"],

Cell[CellGroupData[{

Cell["Lattice Saddle Point", \
"Subsection",ExpressionUUID->"c1f0fa5f-d477-4b31-adaa-328e09ba3c88"],

Cell["Do a link at a time.", \
"Text",ExpressionUUID->"8653b142-7112-4bee-b7a1-1980582f8f46"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"linkSaddlePointStep", "::", "usage"}], "=", 
   "\"\<One iteration of the saddle point search.  Set rescaleCutoff to a \
large number to test this against the explicit calculation.\>\""}], ";", 
  RowBox[{
   RowBox[{"Options", "[", "linkSaddlePointStep", "]"}], "=", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"rescaleCutoff", "\[Rule]", "1"}], ",", 
     RowBox[{"dampingFactor", "\[Rule]", "1"}], ",", 
     RowBox[{"printHessian", "\[Rule]", "False"}], ",", 
     RowBox[{"printShift", "\[Rule]", "False"}], ",", 
     RowBox[{"makeHess0", "\[Rule]", "False"}]}], "}"}]}], ";", 
  RowBox[{
   RowBox[{"linkSaddlePointStep", "[", 
    RowBox[{"u2Staples_", ",", "u1_", ",", 
     RowBox[{"OptionsPattern", "[", "]"}]}], "]"}], ":=", " ", 
   RowBox[{"Block", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"zzz", "=", 
        RowBox[{"OptionValue", "[", "rescaleCutoff", "]"}]}], ",", 
       RowBox[{"cutoff", "=", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{"NumberQ", "[", "beta", "]"}], ",", 
          RowBox[{"Sqrt", "[", 
           RowBox[{
            RowBox[{"nc", "^", "3"}], "/", 
            RowBox[{"(", 
             RowBox[{"12", " ", "beta"}], ")"}]}], "]"}], ",", "1"}], "]"}]}],
        ",", 
       RowBox[{"damping", "=", 
        RowBox[{"OptionValue", "[", "dampingFactor", "]"}]}], ",", 
       RowBox[{"debug", "=", "False"}], ",", 
       RowBox[{"ff", "=", 
        RowBox[{"u2Staples", ".", "u1"}]}], ",", "grad", ",", "mm", ",", "oo",
        ",", "values", ",", "deltas", ",", "sqrtU", ",", 
       RowBox[{"nc", "=", 
        RowBox[{"Length", "[", "u2Staples", "]"}]}]}], "}"}], ",", 
     RowBox[{
      RowBox[{"If", "[", 
       RowBox[{"False", ",", 
        RowBox[{"Print", "[", 
         RowBox[{"\"\<cutoff:  \>\"", ",", "cutoff"}], "]"}]}], "]"}], ";", 
      RowBox[{"grad", "=", 
       RowBox[{"Map", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"Tr", "[", 
           RowBox[{"ff", ".", "#"}], "]"}], "&"}], ",", 
         RowBox[{"suGenerators", "[", "]"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{"debug", ",", 
        RowBox[{"Print", "[", 
         RowBox[{"\"\<grad:  \>\"", ",", "grad"}], "]"}]}], "]"}], ";", 
      RowBox[{"(*", " ", 
       RowBox[{
        RowBox[{
         RowBox[{"Solve", " ", "linear", " ", "system", " ", 
          RowBox[{"mm", ".", "shifts"}]}], " ", "=", " ", 
         RowBox[{"-", 
          RowBox[{"Im", "[", "grad", "]"}]}]}], ",", " ", 
        RowBox[{
        "paying", " ", "careful", " ", "attention", " ", "to", " ", 
         "nullspace", " ", "of", " ", 
         RowBox[{"mm", ".", "  ", "Could"}], " ", "equivalently", " ", "use", 
         " ", 
         RowBox[{"LDL", "^", "T"}], " ", "factorization", " ", "with", " ", 
         "symmetric", " ", 
         RowBox[{"pivoting", "."}]}]}], "  ", "*)"}], 
      RowBox[{"mm", "=", 
       RowBox[{
        RowBox[{
         RowBox[{
          RowBox[{"Re", "[", 
           RowBox[{"Tr", "[", "ff", "]"}], "]"}], "/", 
          RowBox[{"(", 
           RowBox[{"2.0", " ", 
            RowBox[{"Length", "[", "ff", "]"}]}], ")"}]}], " ", 
         RowBox[{"IdentityMatrix", "[", 
          RowBox[{"Length", "[", "grad", "]"}], "]"}]}], "+", 
        RowBox[{
         RowBox[{
          RowBox[{"suSymmetric", "[", "]"}], ".", 
          RowBox[{"Re", "[", "grad", "]"}]}], "/", "2.0"}]}]}], ";", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"values", ",", "oo"}], "}"}], "=", 
       RowBox[{"Eigensystem", "[", "mm", "]"}]}], ";", "\[IndentingNewLine]", 
      
      RowBox[{"(*", " ", 
       RowBox[{
       "Using", " ", "the", " ", "fact", " ", "that", " ", "the", " ", 
        "periodicity", " ", "of", " ", "B_a", " ", "is", " ", "4", " ", "Pi", 
        " ", "or", " ", 
        RowBox[{"less", "."}]}], " ", "*)"}], " ", 
      RowBox[{"deltas", "=", 
       RowBox[{"MapThread", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"If", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"2", " ", "Pi", " ", "zzz", "  ", 
              RowBox[{"Abs", "[", "#2", "]"}]}], "<", 
             RowBox[{"Abs", "[", "#1", "]"}]}], ",", "0", ",", 
            RowBox[{
             RowBox[{"-", "damping"}], " ", 
             RowBox[{"#1", "/", "#2"}], " ", 
             RowBox[{"Exp", "[", 
              RowBox[{
               RowBox[{"-", 
                RowBox[{
                 RowBox[{"(", 
                  RowBox[{"#1", "/", 
                   RowBox[{"(", 
                    RowBox[{"#2", " ", "cutoff", " ", "zzz"}], ")"}]}], ")"}],
                  "^", "2"}]}], "/", "2"}], " ", "]"}]}]}], "]"}], "&"}], ",", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"oo", ".", 
            RowBox[{"Im", "[", "grad", "]"}]}], ",", "values"}], "}"}]}], 
        "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"OptionValue", "[", "printHessian", "]"}], ",", 
        RowBox[{
         RowBox[{"Print", "[", 
          RowBox[{"\"\<Hessian:  \>\"", ",", "mm"}], "]"}], ";", 
         RowBox[{"Print", "[", 
          RowBox[{"\"\<gradient:  \>\"", ",", 
           RowBox[{"Im", "[", "grad", "]"}]}], "]"}]}]}], "]"}], ";", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"OptionValue", "[", "printShift", "]"}], ",", 
        RowBox[{"Print", "[", 
         RowBox[{"\"\<shifts:  \>\"", ",", 
          RowBox[{"deltas", ".", "oo"}]}], "]"}]}], "]"}], ";", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"OptionValue", "[", "makeHess0", "]"}], ",", 
        RowBox[{
         RowBox[{"gradient0", "=", 
          RowBox[{"Join", "[", 
           RowBox[{"gradient0", ",", 
            RowBox[{"-", 
             RowBox[{"Im", "[", "grad", "]"}]}]}], "]"}]}], ";", 
         RowBox[{"hess0", "=", 
          RowBox[{"If", "[", 
           RowBox[{
            RowBox[{"MatrixQ", "[", "hess0", "]"}], ",", 
            RowBox[{"ArrayFlatten", "[", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"{", 
                RowBox[{"hess0", ",", "0"}], "}"}], ",", 
               RowBox[{"{", 
                RowBox[{"0", ",", 
                 RowBox[{"-", "mm"}]}], "}"}]}], "}"}], "]"}], ",", 
            RowBox[{"-", "mm"}]}], "]"}]}], ";", 
         RowBox[{"delta0", "=", 
          RowBox[{"Join", "[", 
           RowBox[{"delta0", ",", 
            RowBox[{"deltas", ".", "oo"}]}], "]"}]}]}]}], "]"}], ";", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"u1", ".", 
         RowBox[{"MatrixExp", "[", 
          RowBox[{"I", " ", 
           RowBox[{"deltas", ".", "oo", ".", 
            RowBox[{"suGenerators", "[", "]"}]}]}], "]"}]}], ",", 
        RowBox[{"Max", "[", 
         RowBox[{"Abs", "[", "deltas", "]"}], "]"}]}], "}"}]}]}], "]"}]}], 
  ";", 
  RowBox[{
   RowBox[{"linkSaddlePoint", "::", "usage"}], "=", 
   "\"\<Saddle point search for a single link.\>\""}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"Options", "[", "linkSaddlePoint", "]"}], "=", 
   RowBox[{"Join", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"tolerance", "\[Rule]", 
        RowBox[{"10", "^", 
         RowBox[{"-", "6"}]}]}], ",", 
       RowBox[{"maxCount", "\[Rule]", "1"}], ",", 
       RowBox[{"printHessian", "\[Rule]", "False"}], ",", 
       RowBox[{"printShift", "\[Rule]", "False"}], ",", 
       RowBox[{"printDebug", "\[Rule]", "False"}], ",", 
       RowBox[{"updateGaugeField", "\[Rule]", "True"}]}], "}"}], ",", 
     RowBox[{"Options", "[", "linkSaddlePointStep", "]"}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"linkSaddlePoint", "[", 
    RowBox[{"dir_", ",", "coords_", ",", 
     RowBox[{"opts", ":", 
      RowBox[{"OptionsPattern", "[", "]"}]}]}], "]"}], ":=", " ", 
   "\[IndentingNewLine]", 
   RowBox[{"Block", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"maxShift", "=", 
        RowBox[{"4", " ", "Pi"}]}], ",", 
       RowBox[{"u1", "=", 
        RowBox[{"SUPower", "[", 
         RowBox[{
          RowBox[{"getLink", "[", 
           RowBox[{"dir", ",", "coords"}], "]"}], ",", "0.5"}], "]"}]}], ",", 
       "u2", ",", "u2SumStaples", ",", 
       RowBox[{"count", "=", "0"}], ",", "uu"}], "}"}], ",", 
     RowBox[{
      RowBox[{"u2", "=", "u1"}], ";", "\[IndentingNewLine]", 
      RowBox[{"u2SumStaples", "=", 
       RowBox[{"u2", ".", 
        RowBox[{"sumStaples", "[", 
         RowBox[{"dir", ",", "coords"}], "]"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"While", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"maxShift", ">", 
          RowBox[{"OptionValue", "[", "tolerance", "]"}]}], "&&", 
         RowBox[{"count", "<", 
          RowBox[{"OptionValue", "[", "maxCount", "]"}]}]}], ",", 
        RowBox[{
         RowBox[{"count", "++"}], ";", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"u1", ",", "maxShift"}], "}"}], "=", 
          RowBox[{"linkSaddlePointStep", "[", 
           RowBox[{"u2SumStaples", ",", "u1", ",", 
            RowBox[{"Apply", "[", 
             RowBox[{"Sequence", ",", 
              RowBox[{"FilterRules", "[", 
               RowBox[{
                RowBox[{"{", "opts", "}"}], ",", 
                RowBox[{"Options", "[", "linkSaddlePointStep", "]"}]}], 
               "]"}]}], "]"}]}], "]"}]}], ";", 
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{"OptionValue", "[", "printDebug", "]"}], ",", 
           RowBox[{"Print", "[", 
            RowBox[{"\"\<Max shift:  \>\"", ",", "maxShift"}], "]"}]}], 
          "]"}]}]}], "]"}], ";", 
      RowBox[{"uu", "=", 
       RowBox[{"u1", ".", "u2"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"OptionValue", "[", "printDebug", "]"}], ",", 
        RowBox[{"SUMatrixQ", "[", "uu", "]"}]}], "]"}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"OptionValue", "[", "updateGaugeField", "]"}], ",", 
        RowBox[{"setLink", "[", 
         RowBox[{"dir", ",", "coords", ",", "uu"}], "]"}]}], "]"}], ";", 
      RowBox[{"{", 
       RowBox[{"uu", ",", "maxShift"}], "}"}]}]}], "]"}]}], ";", 
  RowBox[{
   RowBox[{"Options", "[", "latticeSaddlePoint", "]"}], "=", 
   RowBox[{"Join", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"maxCount", "\[Rule]", "1"}], ",", 
       RowBox[{"tolerance", "\[Rule]", 
        RowBox[{"10", "^", 
         RowBox[{"-", "6"}]}]}]}], "}"}], ",", 
     RowBox[{"Options", "[", "linkSaddlePoint", "]"}]}], "]"}]}], ";", 
  RowBox[{
   RowBox[{"latticeSaddlePoint", "[", 
    RowBox[{"opt", ":", 
     RowBox[{"OptionsPattern", "[", "]"}]}], "]"}], ":=", 
   RowBox[{"Block", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"count", "=", "0"}], ",", 
       RowBox[{"maxShift", "=", 
        RowBox[{"4", " ", "Pi"}]}], ",", "linkShift", ",", 
       RowBox[{"stats", "=", 
        RowBox[{"{", "}"}]}], ",", "stat", ",", "uu", ",", "newGaugeField"}], 
      "}"}], ",", 
     RowBox[{
      RowBox[{"While", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"count", "<", 
          RowBox[{"OptionValue", "[", "maxCount", "]"}]}], "&&", 
         RowBox[{"maxShift", ">", 
          RowBox[{"OptionValue", "[", "tolerance", "]"}]}]}], ",", 
        RowBox[{
         RowBox[{"maxShift", "=", "0"}], ";", 
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{"OptionValue", "[", "makeHess0", "]"}], ",", 
           RowBox[{
            RowBox[{"gradient0", "=", 
             RowBox[{"{", "}"}]}], ";", 
            RowBox[{"hess0", "=", "Null"}], ";", 
            RowBox[{"delta0", "=", 
             RowBox[{"{", "}"}]}]}]}], "]"}], ";", 
         RowBox[{"newGaugeField", "=", 
          RowBox[{"Table", "[", 
           RowBox[{
            RowBox[{
             RowBox[{
              RowBox[{"{", 
               RowBox[{"uu", ",", "linkShift"}], "}"}], "=", 
              RowBox[{"linkSaddlePoint", "[", 
               RowBox[{"dir", ",", 
                RowBox[{"latticeCoordinates", "[", "k", "]"}], ",", " ", 
                RowBox[{"maxCount", "->", "1"}], ",", 
                RowBox[{"Apply", "[", 
                 RowBox[{"Sequence", ",", 
                  RowBox[{"FilterRules", "[", 
                   RowBox[{
                    RowBox[{"{", "opt", "}"}], ",", 
                    RowBox[{"Options", "[", "linkSaddlePoint", "]"}]}], 
                   "]"}]}], "]"}]}], "]"}]}], ";", 
             RowBox[{"maxShift", "=", 
              RowBox[{"Max", "[", 
               RowBox[{"linkShift", ",", "maxShift"}], "]"}]}], ";", "uu"}], 
            ",", 
            RowBox[{"{", 
             RowBox[{"dir", ",", "nd"}], "}"}], ",", 
            RowBox[{"{", 
             RowBox[{"k", ",", 
              RowBox[{"latticeVolume", "[", "]"}]}], "}"}]}], "]"}]}], ";", 
         RowBox[{"Print", "[", 
          RowBox[{"stat", "=", 
           RowBox[{"{", 
            RowBox[{"count", ",", " ", "maxShift", ",", 
             RowBox[{"averagePlaquette", "[", "]"}]}], "}"}]}], "]"}], ";", 
         RowBox[{"If", "[", 
          RowBox[{"False", ",", 
           RowBox[{"AppendTo", "[", 
            RowBox[{"stat", ",", 
             RowBox[{"exponentialModel", "[", 
              RowBox[{
               RowBox[{"talliesToAverageErrors", "[", 
                RowBox[{"polyakovLoopTallies", "[", "\"\<simple\>\"", "]"}], 
                "]"}], ",", 
               RowBox[{"printResult", "\[Rule]", "True"}]}], "]"}]}], "]"}]}],
           "]"}], ";", 
         RowBox[{"AppendTo", "[", 
          RowBox[{"stats", ",", "stat"}], "]"}], ";", 
         RowBox[{"count", "++"}]}]}], "]"}], ";", 
      RowBox[{"{", 
       RowBox[{"newGaugeField", ",", "stats"}], "}"}]}]}], "]"}]}], 
  ";"}]}], "Input",
 InitializationCell->
  True,ExpressionUUID->"9e5d8c5f-de60-45a9-b500-e4a61b6145fb"],

Cell["\<\
Whole lattice at once. 
fixedDir applies the same shift to all links in each Polyakov loop winding \
around the lattice in direction fixedDir.  Thus, it is compatible with \
choosing an Axial gauge in that direction.  This should remove most gauge \
invariant shifts\
\>", "Text",ExpressionUUID->"04dced60-ef4e-4513-b1c5-a96d48f6a69e"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"nGrad", "[", "fixed_", "]"}], ":=", 
   RowBox[{
    RowBox[{"If", "[", 
     RowBox[{
      RowBox[{"fixed", "<", "1"}], ",", "nd", ",", 
      RowBox[{"nd", "-", "1", "+", 
       RowBox[{"1", "/", 
        RowBox[{"latticeDimensions", "[", 
         RowBox[{"[", "fixed", "]"}], "]"}]}]}]}], "]"}], 
    RowBox[{"latticeVolume", "[", "]"}], "*", 
    RowBox[{"(", 
     RowBox[{
      RowBox[{"nc", "^", "2"}], "-", "1"}], ")"}]}]}], ";", 
  RowBox[{
   RowBox[{"coords2grad", "::", "usage"}], "=", 
   "\"\<Use latticeIndex, rather than linearSiteIndex to order the sites, so \
we can handle fixed>0.\>\""}], ";", 
  RowBox[{
   RowBox[{
    RowBox[{"coords2grad", "[", "fixed_", "]"}], "[", 
    RowBox[{"dir_", ",", "coordsIn_", ",", "generator_"}], "]"}], ":=", 
   RowBox[{"generator", "+", 
    RowBox[{
     RowBox[{"(", 
      RowBox[{
       RowBox[{"nc", "^", "2"}], "-", "1"}], ")"}], "*", 
     RowBox[{"Block", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         RowBox[{"coords", "=", "coordsIn"}], ",", 
         RowBox[{"dimensions", "=", "latticeDimensions"}]}], "}"}], ",", 
       RowBox[{
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{"fixed", "\[Equal]", "dir"}], ",", 
          RowBox[{
           RowBox[{
            RowBox[{"coords", "[", 
             RowBox[{"[", "fixed", "]"}], "]"}], "=", "1"}], ";", 
           RowBox[{
            RowBox[{"dimensions", "[", 
             RowBox[{"[", "fixed", "]"}], "]"}], "=", "1"}]}]}], "]"}], ";", 
        RowBox[{
         RowBox[{"latticeIndex", "[", 
          RowBox[{"coords", ",", "dimensions"}], "]"}], "-", "1", "+", " ", 
         RowBox[{
          RowBox[{"latticeVolume", "[", "]"}], "*", 
          RowBox[{"Sum", "[", 
           RowBox[{
            RowBox[{"If", "[", 
             RowBox[{
              RowBox[{"fixed", "\[Equal]", "k"}], ",", 
              RowBox[{"1", "/", 
               RowBox[{"latticeDimensions", "[", 
                RowBox[{"[", "k", "]"}], "]"}]}], ",", "1"}], "]"}], ",", 
            RowBox[{"{", 
             RowBox[{"k", ",", 
              RowBox[{"dir", "-", "1"}]}], "}"}]}], "]"}]}]}]}]}], 
      "]"}]}]}]}], ";", 
  RowBox[{
   RowBox[{
    RowBox[{"gradLinkTake", "[", "fixed_", "]"}], "[", 
    RowBox[{"dir_", ",", "coords_"}], "]"}], ":=", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"1", ",", 
      RowBox[{
       RowBox[{"nc", "^", "2"}], "-", "1"}]}], "}"}], "+", 
    RowBox[{
     RowBox[{"coords2grad", "[", "fixed", "]"}], "[", 
     RowBox[{"dir", ",", "coords", ",", "0"}], "]"}]}]}], ";", 
  RowBox[{
   RowBox[{"makeRootLattice", "[", "]"}], ":=", 
   RowBox[{"Map", "[", 
    RowBox[{
     RowBox[{
      RowBox[{"SUPower", "[", 
       RowBox[{"#", ",", "0.5"}], "]"}], "&"}], ",", "gaugeField", ",", 
     RowBox[{"{", "2", "}"}]}], "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"getRootLink", "[", "rgf_", "]"}], "[", 
    RowBox[{"dir_", ",", "coords_"}], "]"}], ":=", 
   RowBox[{"rgf", "[", 
    RowBox[{"[", 
     RowBox[{"dir", ",", 
      RowBox[{"linearSiteIndex", "[", "coords", "]"}]}], "]"}], "]"}]}], ";", 
  
  RowBox[{
   RowBox[{"symAdd", "::", "index"}], "=", "\"\<Invalid index.\>\""}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"SetAttributes", "[", 
   RowBox[{"symAdd", ",", "HoldFirst"}], "]"}], ";", 
  RowBox[{
   RowBox[{"symAdd", "[", 
    RowBox[{"m_", ",", "i_", ",", "j_", ",", "value_"}], "]"}], ":=", 
   RowBox[{"If", "[", 
    RowBox[{
     RowBox[{
      RowBox[{"i", "<", "0"}], "||", 
      RowBox[{"j", "<", "0"}]}], ",", 
     RowBox[{
      RowBox[{"Message", "[", 
       RowBox[{"symAdd", "::", "index"}], "]"}], ";", "$Failed"}], ",", 
     RowBox[{
      RowBox[{
       RowBox[{"m", "[", 
        RowBox[{"[", 
         RowBox[{"i", ",", "j"}], "]"}], "]"}], "+=", "value"}], ";", 
      RowBox[{
       RowBox[{"m", "[", 
        RowBox[{"[", 
         RowBox[{"j", ",", "i"}], "]"}], "]"}], "+=", "value"}]}]}], "]"}]}], 
  ";", 
  RowBox[{
   RowBox[{"Options", "[", "latticeHessian", "]"}], "=", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"allLinks", "\[Rule]", "True"}], ",", 
     RowBox[{"fixedDir", "\[Rule]", 
      RowBox[{"-", "1"}]}]}], "}"}]}], ";", 
  RowBox[{
   RowBox[{"latticeHessian", "::", "usage"}], "=", 
   "\"\<Set allLinks to False to compare with single-link code.\>\""}], ";", 
  RowBox[{
   RowBox[{"latticeHessian", "[", 
    RowBox[{"getRootLink_", ",", 
     RowBox[{"OptionsPattern", "[", "]"}]}], "]"}], ":=", 
   RowBox[{"Block", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"fixed", "=", 
       RowBox[{"OptionValue", "[", "fixedDir", "]"}]}], "}"}], ",", 
     RowBox[{"Block", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         RowBox[{"hess", "=", 
          RowBox[{"SparseArray", "[", 
           RowBox[{
            RowBox[{"{", "}"}], ",", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"nGrad", "[", "fixed", "]"}], ",", 
              RowBox[{"nGrad", "[", "fixed", "]"}]}], "}"}]}], "]"}]}], ",", 
         RowBox[{"grad", "=", 
          RowBox[{"Array", "[", 
           RowBox[{
            RowBox[{"0", "&"}], ",", 
            RowBox[{"nGrad", "[", "fixed", "]"}]}], "]"}]}], ",", 
         RowBox[{"gen", "=", 
          RowBox[{"suGenerators", "[", "]"}]}], ",", 
         RowBox[{"sym", "=", 
          RowBox[{"0.5", "*", 
           RowBox[{"Outer", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"(", 
               RowBox[{
                RowBox[{"#1", ".", "#2"}], "+", 
                RowBox[{"#2", ".", "#1"}]}], ")"}], "&"}], ",", 
             RowBox[{"suGenerators", "[", "]"}], ",", 
             RowBox[{"suGenerators", "[", "]"}], ",", "1"}], "]"}]}]}], ",", 
         "coords"}], "}"}], ",", 
       RowBox[{
        RowBox[{"Do", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"coords", "=", 
            RowBox[{"latticeCoordinates", "[", "i", "]"}]}], ";", 
           RowBox[{"(*", " ", 
            RowBox[{"Number", " ", "of", " ", "color", " ", "matrix", " ", 
             RowBox[{"multiplications", ":", "\[IndentingNewLine]", 
              RowBox[{
               RowBox[{"(", 
                RowBox[{"number", " ", "of", " ", "plaquettes"}], ")"}], " ", 
               
               RowBox[{"(", 
                RowBox[{"16", " ", "+", " ", 
                 RowBox[{"nc", " ", 
                  RowBox[{"(", 
                   RowBox[{"16", " ", "+", " ", 
                    RowBox[{"10", " ", "nc"}]}], ")"}]}]}], ")"}]}]}]}], " ", 
            "\[IndentingNewLine]", "*)"}], "\[IndentingNewLine]", 
           RowBox[{"Block", "[", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{
               RowBox[{"c00", "=", 
                RowBox[{
                 RowBox[{"ConjugateTranspose", "[", 
                  RowBox[{"getRootLink", "[", 
                   RowBox[{"dir2", ",", "coords"}], "]"}], "]"}], ".", 
                 RowBox[{"getRootLink", "[", 
                  RowBox[{"dir1", ",", "coords"}], "]"}]}]}], ",", 
               RowBox[{"c10", "=", 
                RowBox[{
                 RowBox[{"getRootLink", "[", 
                  RowBox[{"dir1", ",", "coords"}], "]"}], ".", 
                 RowBox[{"getRootLink", "[", 
                  RowBox[{"dir2", ",", 
                   RowBox[{"shift", "[", 
                    RowBox[{"dir1", ",", "coords"}], "]"}]}], "]"}]}]}], ",", 
               
               RowBox[{"c11", "=", 
                RowBox[{
                 RowBox[{"getRootLink", "[", 
                  RowBox[{"dir2", ",", 
                   RowBox[{"shift", "[", 
                    RowBox[{"dir1", ",", "coords"}], "]"}]}], "]"}], ".", 
                 RowBox[{"ConjugateTranspose", "[", 
                  RowBox[{"getRootLink", "[", 
                   RowBox[{"dir1", ",", 
                    RowBox[{"shift", "[", 
                    RowBox[{"dir2", ",", "coords"}], "]"}]}], "]"}], 
                  "]"}]}]}], ",", 
               RowBox[{"c01", "=", 
                RowBox[{
                 RowBox[{"ConjugateTranspose", "[", 
                  RowBox[{"getRootLink", "[", 
                   RowBox[{"dir1", ",", 
                    RowBox[{"shift", "[", 
                    RowBox[{"dir2", ",", "coords"}], "]"}]}], "]"}], "]"}], 
                 ".", 
                 RowBox[{"ConjugateTranspose", "[", 
                  RowBox[{"getRootLink", "[", 
                   RowBox[{"dir2", ",", "coords"}], "]"}], "]"}]}]}], ",", 
               "s1", ",", "s2", ",", "s3", ",", "s4", ",", "v00", ",", "v10", 
               ",", "v11", ",", "v01", ",", "w1", ",", "w2", ",", "w3", ",", 
               "w4"}], "}"}], ",", "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{"s1", "=", 
               RowBox[{"c00", ".", "c10"}]}], ";", 
              RowBox[{"s2", "=", 
               RowBox[{"c10", ".", "c11"}]}], ";", 
              RowBox[{"s3", "=", 
               RowBox[{"c11", ".", "c01"}]}], ";", 
              RowBox[{"s4", "=", 
               RowBox[{"c01", ".", "c00"}]}], ";", 
              RowBox[{"v00", "=", 
               RowBox[{"c01", ".", "s1"}]}], " ", 
              RowBox[{"(*", " ", 
               RowBox[{"=", 
                RowBox[{"s4", ".", "c10"}]}], " ", "*)"}], ";", 
              "\[IndentingNewLine]", 
              RowBox[{"v10", "=", 
               RowBox[{"c00", ".", "s2"}]}], " ", 
              RowBox[{"(*", " ", 
               RowBox[{"=", 
                RowBox[{"s1", ".", "c11"}]}], " ", "*)"}], ";", 
              RowBox[{"v11", "=", 
               RowBox[{"c10", ".", "s3"}]}], " ", 
              RowBox[{"(*", " ", 
               RowBox[{"=", 
                RowBox[{"s2", ".", "c01"}]}], " ", "*)"}], ";", 
              RowBox[{"v01", "=", 
               RowBox[{"c11", ".", "s4"}]}], " ", 
              RowBox[{"(*", " ", 
               RowBox[{"=", 
                RowBox[{"s3", ".", "c00"}]}], " ", "*)"}], ";", 
              RowBox[{"w1", "=", 
               RowBox[{"s4", ".", "s2"}]}], ";", 
              RowBox[{"w2", "=", 
               RowBox[{"s1", ".", "s3"}]}], ";", 
              RowBox[{"w3", "=", 
               RowBox[{"s2", ".", "s4"}]}], ";", 
              RowBox[{"w4", "=", 
               RowBox[{"s3", ".", "s1"}]}], ";", 
              RowBox[{"Do", "[", 
               RowBox[{
                RowBox[{"Block", "[", 
                 RowBox[{
                  RowBox[{"{", 
                   RowBox[{
                    RowBox[{"g1", "=", 
                    RowBox[{
                    RowBox[{"coords2grad", "[", "fixed", "]"}], "[", 
                    RowBox[{"dir1", ",", "coords", ",", "ca1"}], "]"}]}], ",", 
                    RowBox[{"g2", "=", 
                    RowBox[{
                    RowBox[{"coords2grad", "[", "fixed", "]"}], "[", 
                    RowBox[{"dir2", ",", 
                    RowBox[{"shift", "[", 
                    RowBox[{"dir1", ",", "coords"}], "]"}], ",", "ca1"}], 
                    "]"}]}], ",", 
                    RowBox[{"g3", "=", 
                    RowBox[{
                    RowBox[{"coords2grad", "[", "fixed", "]"}], "[", 
                    RowBox[{"dir1", ",", 
                    RowBox[{"shift", "[", 
                    RowBox[{"dir2", ",", "coords"}], "]"}], ",", "ca1"}], 
                    "]"}]}], ",", 
                    RowBox[{"g4", "=", 
                    RowBox[{
                    RowBox[{"coords2grad", "[", "fixed", "]"}], "[", 
                    RowBox[{"dir2", ",", "coords", ",", "ca1"}], "]"}]}], ",",
                     "\[IndentingNewLine]", 
                    RowBox[{"ss42", "=", 
                    RowBox[{"s4", ".", 
                    RowBox[{"gen", "[", 
                    RowBox[{"[", "ca1", "]"}], "]"}], ".", "s2"}]}], ",", 
                    RowBox[{"ss13", "=", 
                    RowBox[{"s1", ".", 
                    RowBox[{"gen", "[", 
                    RowBox[{"[", "ca1", "]"}], "]"}], ".", "s3"}]}], ",", 
                    "\[IndentingNewLine]", 
                    RowBox[{"vv0011", "=", 
                    RowBox[{"v00", ".", 
                    RowBox[{"gen", "[", 
                    RowBox[{"[", "ca1", "]"}], "]"}], ".", "c11"}]}], ",", 
                    RowBox[{"vv1001", "=", 
                    RowBox[{"v10", ".", 
                    RowBox[{"gen", "[", 
                    RowBox[{"[", "ca1", "]"}], "]"}], ".", "c01"}]}], ",", 
                    RowBox[{"vv1100", "=", 
                    RowBox[{"v11", ".", 
                    RowBox[{"gen", "[", 
                    RowBox[{"[", "ca1", "]"}], "]"}], ".", "c00"}]}], ",", 
                    RowBox[{"vv0110", "=", 
                    RowBox[{"v01", ".", 
                    RowBox[{"gen", "[", 
                    RowBox[{"[", "ca1", "]"}], "]"}], ".", "c10"}]}]}], "}"}],
                   ",", "\[IndentingNewLine]", 
                  RowBox[{"(*", " ", 
                   RowBox[{"Negative", " ", "for", " ", "inverse", " ", 
                    RowBox[{"links", "."}]}], " ", "*)"}], 
                  "\[IndentingNewLine]", 
                  RowBox[{
                   RowBox[{
                    RowBox[{"grad", "[", 
                    RowBox[{"[", "g1", "]"}], "]"}], "+=", 
                    RowBox[{"-", 
                    RowBox[{"Im", "[", 
                    RowBox[{"Tr", "[", 
                    RowBox[{"w3", ".", 
                    RowBox[{"gen", "[", 
                    RowBox[{"[", "ca1", "]"}], "]"}]}], "]"}], "]"}]}]}], ";", 
                   RowBox[{
                    RowBox[{"grad", "[", 
                    RowBox[{"[", "g3", "]"}], "]"}], "+=", 
                    RowBox[{"Im", "[", 
                    RowBox[{"Tr", "[", 
                    RowBox[{"w1", ".", 
                    RowBox[{"gen", "[", 
                    RowBox[{"[", "ca1", "]"}], "]"}]}], "]"}], "]"}]}], ";", 
                   "\[IndentingNewLine]", 
                   RowBox[{
                    RowBox[{"grad", "[", 
                    RowBox[{"[", "g2", "]"}], "]"}], "+=", 
                    RowBox[{"-", 
                    RowBox[{"Im", "[", 
                    RowBox[{"Tr", "[", 
                    RowBox[{"w4", ".", 
                    RowBox[{"gen", "[", 
                    RowBox[{"[", "ca1", "]"}], "]"}]}], "]"}], "]"}]}]}], ";", 
                   RowBox[{
                    RowBox[{"grad", "[", 
                    RowBox[{"[", "g4", "]"}], "]"}], "+=", 
                    RowBox[{"Im", "[", 
                    RowBox[{"Tr", "[", 
                    RowBox[{"w2", ".", 
                    RowBox[{"gen", "[", 
                    RowBox[{"[", "ca1", "]"}], "]"}]}], "]"}], "]"}]}], ";", 
                   RowBox[{"Do", "[", 
                    RowBox[{
                    RowBox[{"Block", "[", 
                    RowBox[{
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{"gg1", "=", 
                    RowBox[{"g1", "-", "ca1", "+", "ca2"}]}], ",", 
                    RowBox[{"gg2", "=", 
                    RowBox[{"g2", "-", "ca1", "+", "ca2"}]}], ",", 
                    RowBox[{"gg3", "=", 
                    RowBox[{"g3", "-", "ca1", "+", "ca2"}]}], ",", 
                    RowBox[{"gg4", "=", 
                    RowBox[{"g4", "-", "ca1", "+", "ca2"}]}]}], "}"}], ",", 
                    "\[IndentingNewLine]", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"hess", "[", 
                    RowBox[{"[", 
                    RowBox[{"g1", ",", "gg1"}], "]"}], "]"}], "-=", 
                    RowBox[{"Re", "[", 
                    RowBox[{"Tr", "[", 
                    RowBox[{
                    RowBox[{"sym", "[", 
                    RowBox[{"[", 
                    RowBox[{"ca1", ",", "ca2"}], "]"}], "]"}], ".", "w3"}], 
                    "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
                    RowBox[{
                    RowBox[{"hess", "[", 
                    RowBox[{"[", 
                    RowBox[{"g3", ",", "gg3"}], "]"}], "]"}], "-=", 
                    RowBox[{"Re", "[", 
                    RowBox[{"Tr", "[", 
                    RowBox[{
                    RowBox[{"sym", "[", 
                    RowBox[{"[", 
                    RowBox[{"ca1", ",", "ca2"}], "]"}], "]"}], ".", "w1"}], 
                    "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
                    RowBox[{
                    RowBox[{"hess", "[", 
                    RowBox[{"[", 
                    RowBox[{"g2", ",", "gg2"}], "]"}], "]"}], "-=", 
                    RowBox[{"Re", "[", 
                    RowBox[{"Tr", "[", 
                    RowBox[{
                    RowBox[{"sym", "[", 
                    RowBox[{"[", 
                    RowBox[{"ca1", ",", "ca2"}], "]"}], "]"}], ".", "w4"}], 
                    "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
                    RowBox[{
                    RowBox[{"hess", "[", 
                    RowBox[{"[", 
                    RowBox[{"g4", ",", "gg4"}], "]"}], "]"}], "-=", 
                    RowBox[{"Re", "[", 
                    RowBox[{"Tr", "[", 
                    RowBox[{
                    RowBox[{"sym", "[", 
                    RowBox[{"[", 
                    RowBox[{"ca1", ",", "ca2"}], "]"}], "]"}], ".", "w2"}], 
                    "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
                    RowBox[{"If", "[", 
                    RowBox[{
                    RowBox[{"OptionValue", "[", "allLinks", "]"}], ",", 
                    "\[IndentingNewLine]", 
                    RowBox[{
                    RowBox[{"symAdd", "[", 
                    RowBox[{"hess", ",", "g1", ",", "gg3", ",", 
                    RowBox[{"Re", "[", 
                    RowBox[{"Tr", "[", 
                    RowBox[{"ss42", ".", 
                    RowBox[{"gen", "[", 
                    RowBox[{"[", "ca2", "]"}], "]"}]}], "]"}], "]"}]}], "]"}],
                     ";", 
                    RowBox[{"symAdd", "[", 
                    RowBox[{"hess", ",", "g2", ",", "gg4", ",", 
                    RowBox[{"Re", "[", 
                    RowBox[{"Tr", "[", 
                    RowBox[{"ss13", ".", 
                    RowBox[{"gen", "[", 
                    RowBox[{"[", "ca2", "]"}], "]"}]}], "]"}], "]"}]}], "]"}],
                     ";", "\[IndentingNewLine]", 
                    RowBox[{"symAdd", "[", 
                    RowBox[{"hess", ",", "g2", ",", "gg3", ",", 
                    RowBox[{"Re", "[", 
                    RowBox[{"Tr", "[", 
                    RowBox[{"vv0011", ".", 
                    RowBox[{"gen", "[", 
                    RowBox[{"[", "ca2", "]"}], "]"}]}], "]"}], "]"}]}], "]"}],
                     ";", 
                    RowBox[{"symAdd", "[", 
                    RowBox[{"hess", ",", "g3", ",", "gg4", ",", 
                    RowBox[{"-", 
                    RowBox[{"Re", "[", 
                    RowBox[{"Tr", "[", 
                    RowBox[{"vv1001", ".", 
                    RowBox[{"gen", "[", 
                    RowBox[{"[", "ca2", "]"}], "]"}]}], "]"}], "]"}]}]}], 
                    "]"}], ";", 
                    RowBox[{"symAdd", "[", 
                    RowBox[{"hess", ",", "g4", ",", "gg1", ",", 
                    RowBox[{"Re", "[", 
                    RowBox[{"Tr", "[", 
                    RowBox[{"vv1100", ".", 
                    RowBox[{"gen", "[", 
                    RowBox[{"[", "ca2", "]"}], "]"}]}], "]"}], "]"}]}], "]"}],
                     ";", 
                    RowBox[{"symAdd", "[", 
                    RowBox[{"hess", ",", "g1", ",", "gg2", ",", 
                    RowBox[{"-", 
                    RowBox[{"Re", "[", 
                    RowBox[{"Tr", "[", 
                    RowBox[{"vv0110", ".", 
                    RowBox[{"gen", "[", 
                    RowBox[{"[", "ca2", "]"}], "]"}]}], "]"}], "]"}]}]}], 
                    "]"}]}]}], "]"}]}]}], "]"}], ",", 
                    RowBox[{"{", 
                    RowBox[{"ca2", ",", 
                    RowBox[{
                    RowBox[{"nc", "^", "2"}], "-", "1"}]}], "}"}]}], 
                    "]"}]}]}], "]"}], ",", 
                RowBox[{"{", 
                 RowBox[{"ca1", ",", 
                  RowBox[{
                   RowBox[{"nc", "^", "2"}], "-", "1"}]}], "}"}]}], "]"}]}]}],
             "]"}]}], ",", 
          RowBox[{"{", 
           RowBox[{"dir1", ",", 
            RowBox[{"nd", "-", "1"}]}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"dir2", ",", 
            RowBox[{"dir1", "+", "1"}], ",", "nd"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"i", ",", 
            RowBox[{"latticeVolume", "[", "]"}]}], "}"}]}], "]"}], ";", 
        RowBox[{"{", 
         RowBox[{"hess", ",", "grad"}], "}"}]}]}], "]"}]}], "]"}]}], ";", 
  RowBox[{"SetAttributes", "[", 
   RowBox[{"applyDelta", ",", "HoldFirst"}], "]"}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"applyDelta", "[", 
    RowBox[{"tgf_", ",", "delta_", ",", "fixed_"}], "]"}], ":=", 
   RowBox[{"Block", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"gradMap", "=", 
       RowBox[{"gradLinkTake", "[", "fixed", "]"}]}], "}"}], ",", 
     RowBox[{"Do", "[", 
      RowBox[{
       RowBox[{"Block", "[", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"coords", "=", 
           RowBox[{"latticeCoordinates", "[", "i", "]"}]}], "}"}], ",", 
         RowBox[{
          RowBox[{"tgf", "[", 
           RowBox[{"[", 
            RowBox[{"dir", ",", 
             RowBox[{"linearSiteIndex", "[", "coords", "]"}]}], "]"}], "]"}], 
          "=", 
          RowBox[{
           RowBox[{
            RowBox[{"getRootLink", "[", "tgf", "]"}], "[", 
            RowBox[{"dir", ",", "coords"}], "]"}], ".", 
           RowBox[{"MatrixExp", "[", 
            RowBox[{"I", " ", 
             RowBox[{
              RowBox[{"Take", "[", 
               RowBox[{"delta", ",", 
                RowBox[{"gradMap", "[", 
                 RowBox[{"dir", ",", "coords"}], "]"}]}], "]"}], ".", " ", 
              RowBox[{"suGenerators", "[", "]"}]}]}], "]"}], ".", 
           RowBox[{
            RowBox[{"getRootLink", "[", "tgf", "]"}], "[", 
            RowBox[{"dir", ",", "coords"}], "]"}]}]}]}], "]"}], ",", 
       RowBox[{"{", 
        RowBox[{"dir", ",", "nd"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"i", ",", 
         RowBox[{"latticeVolume", "[", "]"}]}], "}"}]}], "]"}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"Options", "[", "findDelta", "]"}], "=", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"dense", "\[Rule]", "True"}], ",", 
      RowBox[{"rescaleCutoff", "\[Rule]", "1"}], ",", 
      RowBox[{"dampingFactor", "\[Rule]", "1"}], ",", 
      RowBox[{"storePairs", "\[Rule]", "False"}]}], "}"}]}], ";", 
   RowBox[{
    RowBox[{"findDelta", "[", 
     RowBox[{"hess_", ",", "grad_", ",", 
      RowBox[{"OptionsPattern", "[", "]"}]}], "]"}], ":=", 
    RowBox[{
     RowBox[{"Block", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         RowBox[{"zzz", "=", 
          RowBox[{"OptionValue", "[", "rescaleCutoff", "]"}]}], ",", 
         RowBox[{"cutoff", "=", 
          RowBox[{"If", "[", 
           RowBox[{
            RowBox[{"NumberQ", "[", "beta", "]"}], ",", 
            RowBox[{"Sqrt", "[", 
             RowBox[{
              RowBox[{"nc", "^", "3"}], "/", 
              RowBox[{"(", 
               RowBox[{"12", " ", "beta"}], ")"}]}], "]"}], ",", "1"}], 
           "]"}]}], ",", 
         RowBox[{"damping", "=", 
          RowBox[{"OptionValue", "[", "dampingFactor", "]"}]}], ",", "values",
          ",", "oo"}], "}"}], ",", 
       RowBox[{
        RowBox[{
         RowBox[{"{", 
          RowBox[{"values", ",", "oo"}], "}"}], "=", 
         RowBox[{"Eigensystem", "[", 
          RowBox[{"Normal", "[", "hess", "]"}], "]"}]}], ";", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{"OptionValue", "[", "storePairs", "]"}], ",", 
          RowBox[{"pairs0", "=", 
           RowBox[{"Transpose", "[", 
            RowBox[{"{", 
             RowBox[{"values", ",", 
              RowBox[{"oo", ".", "grad"}]}], "}"}], "]"}]}]}], "]"}], ";", 
        RowBox[{
         RowBox[{"MapThread", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"If", "[", 
             RowBox[{
              RowBox[{
               RowBox[{"2", " ", "Pi", " ", "zzz", "  ", 
                RowBox[{"Abs", "[", "#2", "]"}]}], "<", 
               RowBox[{"Abs", "[", "#1", "]"}]}], ",", "0", ",", 
              RowBox[{
               RowBox[{"-", "damping"}], " ", 
               RowBox[{"#1", "/", "#2"}], " ", 
               RowBox[{"Exp", "[", 
                RowBox[{
                 RowBox[{"-", 
                  RowBox[{
                   RowBox[{"(", 
                    RowBox[{"#1", "/", 
                    RowBox[{"(", 
                    RowBox[{"#2", " ", "cutoff", " ", "zzz"}], ")"}]}], ")"}],
                    "^", "2"}]}], "/", "2"}], " ", "]"}]}]}], "]"}], "&"}], 
           ",", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"oo", ".", "grad"}], ",", "values"}], "}"}]}], "]"}], 
         ".", "oo"}]}]}], "]"}], "/;", 
     RowBox[{"OptionValue", "[", "dense", "]"}]}]}], ";"}], 
  "\[IndentingNewLine]", 
  RowBox[{"(*", " ", 
   RowBox[{
    RowBox[{
    "For", " ", "passing", " ", "options", " ", "through", " ", "to", " ", 
     RowBox[{
     "subfunctions", ":", "  ", "\[IndentingNewLine]", "https", ":"}]}], "//", 
    RowBox[{
     RowBox[{
      RowBox[{
       RowBox[{
        RowBox[{"mathematica", ".", "stackexchange", ".", "com"}], "/", 
        "questions"}], "/", "353"}], "/", "functions"}], "-", "with", "-", 
     RowBox[{"options", "/"}]}]}], " ", "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"Options", "[", "latticeSaddlePointStep", "]"}], "=", 
   RowBox[{"Join", "[", 
    RowBox[{
     RowBox[{"Options", "[", "findDelta", "]"}], ",", 
     RowBox[{"Options", "[", "latticeHessian", "]"}]}], "]"}]}], ";", 
  RowBox[{
   RowBox[{"latticeSaddlePointStep", "[", 
    RowBox[{"opts", ":", 
     RowBox[{"OptionsPattern", "[", "]"}]}], "]"}], ":=", 
   RowBox[{"Block", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"hess", ",", "grad", ",", "delta", ",", 
       RowBox[{"tmpGaugeField", "=", 
        RowBox[{"makeRootLattice", "[", "]"}]}]}], "}"}], ",", 
     RowBox[{
      RowBox[{
       RowBox[{"{", 
        RowBox[{"hess", ",", "grad"}], "}"}], "=", 
       RowBox[{"latticeHessian", "[", 
        RowBox[{
         RowBox[{"getRootLink", "[", "tmpGaugeField", "]"}], ",", 
         RowBox[{"Apply", "[", 
          RowBox[{"Sequence", ",", 
           RowBox[{"FilterRules", "[", 
            RowBox[{
             RowBox[{"{", "opts", "}"}], ",", 
             RowBox[{"Options", "[", "latticeHessian", "]"}]}], "]"}]}], 
          "]"}]}], "]"}]}], ";", 
      RowBox[{"(*", " ", 
       RowBox[{"Debug", " ", "prints"}], " ", "*)"}], "\[IndentingNewLine]", 
      RowBox[{"Which", "[", 
       RowBox[{"False", ",", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"Print", "[", 
          RowBox[{"\"\<hessian difference:  \>\"", ",", 
           RowBox[{"Chop", "[", 
            RowBox[{
             RowBox[{"Normal", "[", "hess", "]"}], "-", "hess0"}], "]"}]}], 
          "]"}], ";", "\[IndentingNewLine]", 
         RowBox[{"Print", "[", 
          RowBox[{"\"\<gradient difference:  \>\"", ",", 
           RowBox[{"Chop", "[", 
            RowBox[{"grad", "-", "gradient0"}], "]"}]}], "]"}]}], ",", 
        "\[IndentingNewLine]", "False", ",", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"Print", "[", 
          RowBox[{"\"\<hessian:\>\"", ",", 
           RowBox[{"Normal", "[", "hess", "]"}]}], "]"}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"Print", "[", 
          RowBox[{"\"\<gradient:  \>\"", ",", "grad"}], "]"}]}], ",", 
        "\[IndentingNewLine]", "False", ",", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"Print", "[", 
          RowBox[{"\"\<hessian, first link:  \>\"", ",", 
           RowBox[{"Normal", "[", 
            RowBox[{"Take", "[", 
             RowBox[{"hess", ",", 
              RowBox[{
               RowBox[{"nc", "^", "2"}], "-", "1"}], ",", 
              RowBox[{
               RowBox[{"nc", "^", "2"}], "-", "1"}]}], "]"}], "]"}]}], "]"}], 
         ";", "\[IndentingNewLine]", 
         RowBox[{"Print", "[", 
          RowBox[{"\"\<gradient, first link:  \>\"", ",", 
           RowBox[{"Take", "[", 
            RowBox[{"grad", ",", 
             RowBox[{
              RowBox[{"nc", "^", "2"}], "-", "1"}]}], "]"}]}], "]"}]}]}], 
       "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{"delta", "=", 
       RowBox[{"findDelta", "[", 
        RowBox[{"hess", ",", "grad", ",", 
         RowBox[{"Apply", "[", 
          RowBox[{"Sequence", ",", 
           RowBox[{"FilterRules", "[", 
            RowBox[{
             RowBox[{"{", "opts", "}"}], ",", 
             RowBox[{"Options", "[", "findDelta", "]"}]}], "]"}]}], "]"}]}], 
        "]"}]}], ";", 
      RowBox[{"(*", " ", 
       RowBox[{"Debug", " ", "prints"}], " ", "*)"}], "\[IndentingNewLine]", 
      RowBox[{"Which", "[", 
       RowBox[{"False", ",", 
        RowBox[{"Print", "[", 
         RowBox[{"\"\<delta difference:  \>\"", ",", 
          RowBox[{"Chop", "[", 
           RowBox[{"delta", "-", "delta0"}], "]"}]}], "]"}], ",", "False", 
        ",", "\[IndentingNewLine]", 
        RowBox[{"Print", "[", 
         RowBox[{"\"\<delta:  \>\"", ",", "delta"}], "]"}], ",", "False", ",",
         "\[IndentingNewLine]", 
        RowBox[{"Print", "[", 
         RowBox[{"\"\<delta, first link:  \>\"", ",", 
          RowBox[{"Take", "[", 
           RowBox[{"delta", ",", 
            RowBox[{
             RowBox[{"nc", "^", "2"}], "-", "1"}]}], "]"}]}], "]"}]}], "]"}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"applyDelta", "[", 
       RowBox[{"tmpGaugeField", ",", "delta", ",", 
        RowBox[{"OptionValue", "[", "fixedDir", "]"}]}], "]"}], ";", 
      "tmpGaugeField"}]}], "]"}]}]}]}], "Input",
 InitializationCell->
  True,ExpressionUUID->"b0b43bc6-d299-49c3-b7ba-54683ab769a7"]
}, Open  ]]
}, Open  ]],

Cell[CellGroupData[{

Cell["Testing", \
"Section",ExpressionUUID->"76e3bcbc-ac2e-4979-ae1b-903dcd5b1de9"],

Cell[CellGroupData[{

Cell["matrixPower, SU(N)  generators", \
"Subsection",ExpressionUUID->"dbb30539-1695-457a-b017-3b73cf822a2d"],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"x", "=", 
  RowBox[{"centerSUMatrix", "[", 
   RowBox[{"1", ",", "7"}], 
   "]"}]}]], "Input",ExpressionUUID->"555344c0-e344-4398-99ab-399bb54f2c22"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{
     SuperscriptBox["\[ExponentialE]", 
      FractionBox[
       RowBox[{"2", " ", "\[ImaginaryI]", " ", "\[Pi]"}], "7"]], ",", "0", 
     ",", "0", ",", "0", ",", "0", ",", "0", ",", "0"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"0", ",", 
     SuperscriptBox["\[ExponentialE]", 
      FractionBox[
       RowBox[{"2", " ", "\[ImaginaryI]", " ", "\[Pi]"}], "7"]], ",", "0", 
     ",", "0", ",", "0", ",", "0", ",", "0"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"0", ",", "0", ",", 
     SuperscriptBox["\[ExponentialE]", 
      FractionBox[
       RowBox[{"2", " ", "\[ImaginaryI]", " ", "\[Pi]"}], "7"]], ",", "0", 
     ",", "0", ",", "0", ",", "0"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"0", ",", "0", ",", "0", ",", 
     SuperscriptBox["\[ExponentialE]", 
      FractionBox[
       RowBox[{"2", " ", "\[ImaginaryI]", " ", "\[Pi]"}], "7"]], ",", "0", 
     ",", "0", ",", "0"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"0", ",", "0", ",", "0", ",", "0", ",", 
     SuperscriptBox["\[ExponentialE]", 
      FractionBox[
       RowBox[{"2", " ", "\[ImaginaryI]", " ", "\[Pi]"}], "7"]], ",", "0", 
     ",", "0"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"0", ",", "0", ",", "0", ",", "0", ",", "0", ",", 
     SuperscriptBox["\[ExponentialE]", 
      FractionBox[
       RowBox[{"2", " ", "\[ImaginaryI]", " ", "\[Pi]"}], "7"]], ",", "0"}], 
    "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", 
     SuperscriptBox["\[ExponentialE]", 
      FractionBox[
       RowBox[{"2", " ", "\[ImaginaryI]", " ", "\[Pi]"}], "7"]]}], "}"}]}], 
  "}"}]], "Output",ExpressionUUID->"162d79ae-2470-4b09-82ef-5b46e1749e0f"]
}, Open  ]],

Cell[BoxData[
 RowBox[{
  RowBox[{"x", "=", 
   RowBox[{"randomSUMatrix", "[", "7", "]"}]}], 
  ";"}]], "Input",ExpressionUUID->"6c7d094d-cbee-4294-80eb-6a953a7e0f74"],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"x", "=", 
  RowBox[{"gaugeField", "[", 
   RowBox[{"[", 
    RowBox[{"3", ",", "15"}], "]"}], "]"}]}]], "Input",
 CellChangeTimes->{{3.766972462904788*^9, 3.766972464175539*^9}, {
  3.767356782678484*^9, 3.7673567833886337`*^9}, {3.767357017701527*^9, 
  3.767357038858267*^9}, {3.76735796456426*^9, 3.767357975954447*^9}, {
  3.7673907291441927`*^9, 
  3.7673907295357113`*^9}},ExpressionUUID->"cfc0aeba-e57b-47db-a6ee-\
89128e519b02"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{
     RowBox[{"0.956699371337891`", "\[VeryThinSpace]", "+", 
      RowBox[{"0.040671166032553`", " ", "\[ImaginaryI]"}]}], ",", 
     RowBox[{
      RowBox[{"-", "0.049990065395832`"}], "-", 
      RowBox[{"0.066759899258614`", " ", "\[ImaginaryI]"}]}], ",", 
     RowBox[{"0.130659118294716`", "\[VeryThinSpace]", "+", 
      RowBox[{"0.242990866303444`", " ", "\[ImaginaryI]"}]}]}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"0.00153985642828`", "\[VeryThinSpace]", "-", 
      RowBox[{"0.025455404073`", " ", "\[ImaginaryI]"}]}], ",", 
     RowBox[{
      RowBox[{"-", "0.476965427398682`"}], "-", 
      RowBox[{"0.828118026256561`", " ", "\[ImaginaryI]"}]}], ",", 
     RowBox[{
      RowBox[{"-", "0.184020891785622`"}], "-", 
      RowBox[{"0.228496193885803`", " ", "\[ImaginaryI]"}]}]}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{
      RowBox[{"-", "0.144960388541222`"}], "-", 
      RowBox[{"0.247807174921036`", " ", "\[ImaginaryI]"}]}], ",", 
     RowBox[{"0.173146083950996`", "\[VeryThinSpace]", "-", 
      RowBox[{"0.22313466668129`", " ", "\[ImaginaryI]"}]}], ",", 
     RowBox[{
      RowBox[{"-", "0.420855641365051`"}], "+", 
      RowBox[{"0.812828481197357`", " ", "\[ImaginaryI]"}]}]}], "}"}]}], 
  "}"}]], "Output",ExpressionUUID->"9f543be0-f48c-446e-b52d-0cfb700b76d3"]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"SUMatrixQ", "[", "x", 
  "]"}]], "Input",ExpressionUUID->"7c0ffab6-45e8-4dba-b792-2602745013bb"],

Cell[BoxData["True"], \
"Output",ExpressionUUID->"ea71291e-4675-4b34-a39b-8fff9dba5947"]
}, Open  ]],

Cell["Take the root", \
"Text",ExpressionUUID->"c9017db1-49ec-4c31-8ae8-ca07d7c59fe5"],

Cell[BoxData[
 RowBox[{
  RowBox[{"z", "=", 
   RowBox[{"SUPower", "[", 
    RowBox[{"x", ",", "0.2"}], "]"}]}], 
  ";"}]], "Input",ExpressionUUID->"9737b979-7234-403d-a77f-da741cd131e8"],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"SUMatrixQ", "[", "z", 
  "]"}]], "Input",ExpressionUUID->"1df9ed73-c862-47a0-84db-d0408348232a"],

Cell[BoxData["True"], \
"Output",ExpressionUUID->"babfd3ce-61fc-4f86-b8ed-98c7d5ed5427"]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"Norm", "[", 
  RowBox[{
   RowBox[{
    RowBox[{"z", ".", "z", ".", "z", ".", "z", ".", "z"}], "-", 
    RowBox[{"SUPower", "[", 
     RowBox[{"x", ",", "1"}], "]"}]}], ",", "Infinity"}], 
  "]"}]], "Input",ExpressionUUID->"2c93c725-dd14-4d13-b4fd-b476efb9ce97"],

Cell[BoxData["2.3262371608973003`*^-15"], \
"Output",ExpressionUUID->"2d474e9c-4e95-455f-8481-05329d8ac0ac"]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"matrixEqual", "[", 
  RowBox[{
   RowBox[{"z", ".", "z", ".", "z", ".", "z", ".", "z"}], ",", "x"}], 
  "]"}]], "Input",ExpressionUUID->"2db875f1-e723-407d-aefd-63d570ce6bac"],

Cell[BoxData["True"], \
"Output",ExpressionUUID->"40e40490-a063-474d-aa5e-9b1d6c7f23b8"]
}, Open  ]],

Cell["Test normalization & orthogonality of the SU (N) generators", \
"Text",ExpressionUUID->"ee74d701-9f31-481b-9378-90bddc250cff"],

Cell[BoxData[
 RowBox[{"TableForm", "[", 
  RowBox[{"Block", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"x", "=", 
      RowBox[{"suGenerators", "[", "4", "]"}]}], "}"}], ",", 
    RowBox[{"Table", "[", 
     RowBox[{
      RowBox[{"Tr", "[", 
       RowBox[{
        RowBox[{"x", "[", 
         RowBox[{"[", "i", "]"}], "]"}], ".", 
        RowBox[{"x", "[", 
         RowBox[{"[", "j", "]"}], "]"}]}], "]"}], ",", 
      RowBox[{"{", 
       RowBox[{"i", ",", 
        RowBox[{"Length", "[", "x", "]"}]}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{"j", ",", 
        RowBox[{"Length", "[", "x", "]"}]}], "}"}]}], "]"}]}], "]"}], 
  "]"}]], "Input",ExpressionUUID->"0db0eee5-a0dc-4831-bfdb-a24fefefcb4a"]
}, Closed]],

Cell[CellGroupData[{

Cell["Polyakov loop, string tension", \
"Subsection",ExpressionUUID->"c0c1454d-926e-4e97-9beb-ac17940ec7c4"],

Cell["Test with trivial lattice.", \
"Text",ExpressionUUID->"4aec363d-807a-475d-991c-6016f97b4f4b"],

Cell[BoxData[
 RowBox[{
  RowBox[{"nc", "=", "3"}], ";", 
  RowBox[{"nd", "=", "3"}], ";", 
  RowBox[{"latticeDimensions", "=", 
   RowBox[{"{", 
    RowBox[{"4", ",", "6", ",", "8"}], "}"}]}], ";", 
  RowBox[{
  "makeTrivialLattice", "[", 
   "]"}]}]], "Input",ExpressionUUID->"98c5bfa6-1b35-4a89-972e-65ab06af40a6"],

Cell["\<\
Lattice with constant link in one direction.  Smeared Polyakov loop should \
give the same result as the simple Polyakov loop.\
\>", "Text",ExpressionUUID->"7d1249af-98ac-4456-afea-f64097619779"],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{
  RowBox[{"gaugeField", "=", 
   RowBox[{"Block", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"uu", "=", 
       RowBox[{"randomSUMatrix", "[", "]"}]}], "}"}], ",", 
     RowBox[{
      RowBox[{"Print", "[", 
       RowBox[{"\"\<Trace:  \>\"", ",", 
        RowBox[{"Tr", "[", "uu", "]"}]}], "]"}], ";", 
      RowBox[{"uu", "=", 
       RowBox[{"SUPower", "[", 
        RowBox[{"uu", ",", 
         RowBox[{"1", "/", 
          RowBox[{"latticeDimensions", "[", 
           RowBox[{"[", "1", "]"}], "]"}]}]}], "]"}]}], ";", 
      RowBox[{"Table", "[", 
       RowBox[{
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{"dir", "\[Equal]", "1"}], ",", "uu", ",", 
          RowBox[{"IdentityMatrix", "[", "nc", "]"}]}], "]"}], ",", 
        RowBox[{"{", 
         RowBox[{"dir", ",", "nd"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"latticeVolume", "[", "]"}], "}"}]}], "]"}]}]}], "]"}]}], 
  ";"}]], "Input",ExpressionUUID->"4513aab7-f110-459e-a6ca-77942f6d8ca0"],

Cell[BoxData[
 InterpretationBox[
  RowBox[{"\<\"Trace:  \"\>", "\[InvisibleSpace]", 
   RowBox[{
    RowBox[{"-", "0.9931499715202564`"}], "-", 
    RowBox[{"1.8506741973480212`", " ", "\[ImaginaryI]"}]}]}],
  SequenceForm["Trace:  ", 
   Complex[-0.9931499715202564, -1.8506741973480212`]],
  Editable->
   False]], "Print",ExpressionUUID->"b4fa4c81-ea88-4d24-97ef-50c02359cefe"]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"polyakovLoop", "[", 
  RowBox[{"1", ",", 
   RowBox[{"{", 
    RowBox[{"1", ",", "1", ",", "3"}], "}"}]}], 
  "]"}]], "Input",ExpressionUUID->"31645a15-dca5-404b-9853-0ee0c12163bf"],

Cell[BoxData[
 RowBox[{
  RowBox[{"-", "0.9931499715202567`"}], "-", 
  RowBox[{
  "1.8506741973480203`", " ", 
   "\[ImaginaryI]"}]}]], \
"Output",ExpressionUUID->"84da31aa-8974-4ce9-a2ce-7de2ee433bfb"]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"polyakovLoop", "[", 
  RowBox[{"1", ",", 
   RowBox[{"{", 
    RowBox[{"1", ",", "1", ",", "3"}], "}"}], ",", 
   RowBox[{"{", "2", "}"}], ",", 
   RowBox[{"{", "1", "}"}]}], 
  "]"}]], "Input",ExpressionUUID->"9e1583e4-c354-444e-b6bc-ae197a7ddaa5"],

Cell[BoxData[
 RowBox[{
  RowBox[{"-", "0.9931499715202567`"}], "-", 
  RowBox[{
  "1.8506741973480203`", " ", 
   "\[ImaginaryI]"}]}]], \
"Output",ExpressionUUID->"7099919d-965c-4f9d-b6a2-910e05b6bf86"]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"loopThickness", "[", 
  "]"}]], "Input",ExpressionUUID->"d753cf6c-6ed9-4ebd-b534-f8c0c806172a"],

Cell[BoxData["11.697598614944667`"], \
"Output",ExpressionUUID->"3b1c1991-2fe6-4e4a-85fb-6277ffe61ba0"]
}, Open  ]],

Cell[BoxData[
 RowBox[{"tallyData", "=", 
  RowBox[{"talliesToAverageErrors", "[", 
   RowBox[{"polyakovLoopTallies", "[", "\"\<simple\>\"", "]"}], 
   "]"}]}]], "Input",ExpressionUUID->"e8aef995-4fbf-4b8b-8955-39c4781344d1"],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"tallyData", "=", 
  RowBox[{"talliesToAverageErrors", "[", 
   RowBox[{"polyakovLoopTallies", "[", "\"\<smeared\>\"", "]"}], 
   "]"}]}]], "Input",ExpressionUUID->"d00fbb57-f8c1-42e9-bcad-bacffe17841c"],

Cell[BoxData[
 RowBox[{"\[LeftAssociation]", 
  RowBox[{
   RowBox[{"1", "\[Rule]", 
    RowBox[{"{", 
     RowBox[{"0.004170396888019297`", ",", "0.00030151025625792965`"}], 
     "}"}]}], ",", 
   RowBox[{"2", "\[Rule]", 
    RowBox[{"{", 
     RowBox[{"0.003478262520239419`", ",", "0.0003242503181648495`"}], 
     "}"}]}], ",", 
   RowBox[{"3", "\[Rule]", 
    RowBox[{"{", 
     RowBox[{"0.00245383294869438`", ",", "0.00028253744120390096`"}], 
     "}"}]}], ",", 
   RowBox[{"4", "\[Rule]", 
    RowBox[{"{", 
     RowBox[{"0.0017756391421765738`", ",", "0.00026818387848587976`"}], 
     "}"}]}], ",", 
   RowBox[{"5", "\[Rule]", 
    RowBox[{"{", 
     RowBox[{"0.0012755876776279198`", ",", "0.0002710803318396858`"}], 
     "}"}]}], ",", 
   RowBox[{"6", "\[Rule]", 
    RowBox[{"{", 
     RowBox[{"0.0008289473338730119`", ",", "0.00025728619989006437`"}], 
     "}"}]}], ",", 
   RowBox[{"7", "\[Rule]", 
    RowBox[{"{", 
     RowBox[{"0.0004707712360189323`", ",", "0.0002714885943937544`"}], 
     "}"}]}], ",", 
   RowBox[{"8", "\[Rule]", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"-", "0.00006309026103799468`"}], ",", 
      "0.00027498787944608624`"}], "}"}]}], ",", 
   RowBox[{"9", "\[Rule]", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"-", "0.0004873476955645394`"}], ",", 
      "0.0002872814945727909`"}], "}"}]}], ",", 
   RowBox[{"10", "\[Rule]", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"-", "0.0006414940848528436`"}], ",", 
      "0.0002890918616347785`"}], "}"}]}], ",", 
   RowBox[{"11", "\[Rule]", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"-", "0.0007619838600143781`"}], ",", 
      "0.0003737303565426513`"}], "}"}]}], ",", 
   RowBox[{
    SqrtBox["221"], "\[Rule]", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"-", "0.001145577360672568`"}], ",", "0.0003726142038113814`"}],
      "}"}]}]}], 
  "\[RightAssociation]"}]], \
"Output",ExpressionUUID->"1b1f9b42-b632-421d-84d0-217ecb385d16"]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{
  RowBox[{"ff", "=", 
   RowBox[{"exponentialModel", "[", 
    RowBox[{"tallyData", ",", 
     RowBox[{"printResult", "\[Rule]", "True"}]}], "]"}]}], 
  ";"}]], "Input",ExpressionUUID->"0ab48d40-ac71-4243-bc6d-64a343c203fe"],

Cell[BoxData[
 StyleBox[
  TagBox[GridBox[{
     {"\<\"\"\>", "\<\"Estimate\"\>", "\<\"Standard Error\"\>", "\<\"t\
\[Hyphen]Statistic\"\>", "\<\"P\[Hyphen]Value\"\>"},
     {"norm", "0.006567378552024714`", "0.0005420363643801315`", 
      "12.116121691457208`", "2.668318890622927`*^-7"},
     {"aw", "0.36563593614486445`", "0.03340321902346922`", 
      "10.946128751482526`", "6.900155210540742`*^-7"}
    },
    AutoDelete->False,
    GridBoxAlignment->{"Columns" -> {{Left}}, "Rows" -> {{Automatic}}},
    GridBoxDividers->{
     "ColumnsIndexed" -> {2 -> GrayLevel[0.7]}, 
      "RowsIndexed" -> {2 -> GrayLevel[0.7]}},
    GridBoxItemSize->{"Columns" -> {{Automatic}}, "Rows" -> {{Automatic}}},
    GridBoxSpacings->{
     "ColumnsIndexed" -> {2 -> 1}, "RowsIndexed" -> {2 -> 0.75}}],
   "Grid"], "DialogStyle",
  StripOnInput->
   False]], "Print",ExpressionUUID->"389c01a4-7919-4ad7-be64-76c7936a5d15"]
}, Open  ]],

Cell[BoxData[
 RowBox[{"Block", "[", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{
     RowBox[{"nn", "=", 
      RowBox[{"Normal", "[", "tallyData", "]"}]}], ",", "maxx", ",", "miny", 
     ",", "maxy"}], "}"}], ",", 
   RowBox[{
    RowBox[{"maxx", "=", 
     RowBox[{
      RowBox[{"Max", "[", 
       RowBox[{"Map", "[", 
        RowBox[{"First", ",", "nn"}], "]"}], "]"}], "+", "0.5"}]}], ";", 
    RowBox[{"maxy", "=", 
     RowBox[{"Max", "[", 
      RowBox[{"Map", "[", 
       RowBox[{
        RowBox[{
         RowBox[{
          RowBox[{"#", "[", 
           RowBox[{"[", 
            RowBox[{"2", ",", "1"}], "]"}], "]"}], "+", 
          RowBox[{"1.5", " ", 
           RowBox[{"#", "[", 
            RowBox[{"[", 
             RowBox[{"2", ",", "2"}], "]"}], "]"}]}]}], "&"}], ",", "nn"}], 
       "]"}], "]"}]}], ";", 
    RowBox[{"miny", "=", 
     RowBox[{"Min", "[", 
      RowBox[{"0", ",", 
       RowBox[{"Min", "[", 
        RowBox[{"Map", "[", 
         RowBox[{
          RowBox[{
           RowBox[{
            RowBox[{"#", "[", 
             RowBox[{"[", 
              RowBox[{"2", ",", "1"}], "]"}], "]"}], "-", 
            RowBox[{"1.5", " ", 
             RowBox[{"#", "[", 
              RowBox[{"[", 
               RowBox[{"2", ",", "2"}], "]"}], "]"}]}]}], "&"}], ",", "nn"}], 
         "]"}], "]"}]}], "]"}]}], ";", 
    RowBox[{"Show", "[", 
     RowBox[{
      RowBox[{"ErrorListPlot", "[", 
       RowBox[{
        RowBox[{"Map", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"{", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{
               RowBox[{"#", "[", 
                RowBox[{"[", "1", "]"}], "]"}], ",", 
               RowBox[{"#", "[", 
                RowBox[{"[", 
                 RowBox[{"2", ",", "1"}], "]"}], "]"}]}], "}"}], ",", 
             RowBox[{"ErrorBar", "[", 
              RowBox[{"#", "[", 
               RowBox[{"[", 
                RowBox[{"2", ",", "2"}], "]"}], "]"}], "]"}]}], "}"}], "&"}], 
          ",", "nn"}], "]"}], ",", 
        RowBox[{"PlotRange", "\[Rule]", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"0", ",", "maxx"}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"miny", ",", "maxy"}], "}"}]}], "}"}]}], ",", 
        RowBox[{"Epilog", "\[Rule]", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"Text", "[", 
            RowBox[{
             RowBox[{"ColumnForm", "[", 
              RowBox[{"Join", "[", 
               RowBox[{
                RowBox[{"Map", "[", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"Row", "[", 
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{"#", "[", 
                    RowBox[{"[", 
                    RowBox[{"1", ",", "1"}], "]"}], "]"}], ",", "\"\< = \>\"",
                     ",", 
                    RowBox[{"#", "[", 
                    RowBox[{"[", 
                    RowBox[{"1", ",", "2"}], "]"}], "]"}], ",", 
                    "\"\<\[PlusMinus]\>\"", ",", 
                    RowBox[{"#", "[", 
                    RowBox[{"[", "2", "]"}], "]"}]}], "}"}], "]"}], "&"}], 
                  ",", 
                  RowBox[{"Transpose", "[", 
                   RowBox[{"ff", "[", 
                    RowBox[{"{", 
                    RowBox[{
                    "\"\<BestFitParameters\>\"", ",", 
                    "\"\<ParameterErrors\>\""}], "}"}], "]"}], "]"}]}], "]"}],
                 ",", 
                RowBox[{"{", 
                 RowBox[{
                  RowBox[{"Row", "[", 
                   RowBox[{"{", 
                    RowBox[{"\"\<\[Beta] = \>\"", ",", 
                    RowBox[{"N", "[", "beta", "]"}], ",", 
                    "\"\<, \!\(\*SubscriptBox[\(N\), \(d\)]\) = \>\"", ",", 
                    "nd", ",", 
                    "\"\<, \!\(\*SubscriptBox[\(N\), \(c\)]\) = \>\"", ",", 
                    "nc"}], "}"}], "]"}], ",", 
                  RowBox[{"Row", "[", 
                   RowBox[{"{", 
                    RowBox[{"\"\<lattice = \>\"", ",", 
                    RowBox[{"Row", "[", 
                    RowBox[{"latticeDimensions", ",", "\"\<, \>\""}], "]"}]}],
                     "}"}], "]"}]}], "}"}]}], "]"}], "]"}], ",", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"maxx", "*", "0.9"}], ",", 
               RowBox[{"maxy", "*", "0.9"}]}], "}"}], ",", 
             RowBox[{"{", 
              RowBox[{"1", ",", "1"}], "}"}]}], "]"}], ",", 
           RowBox[{"Dashing", "[", ".02", "]"}], ",", "Gray", ",", 
           RowBox[{"Line", "[", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{"0", ",", "0"}], "}"}], ",", 
              RowBox[{"{", 
               RowBox[{"maxx", ",", "0"}], "}"}]}], "}"}], "]"}]}], "}"}]}], 
        ",", 
        RowBox[{"Axes", "\[Rule]", "False"}], ",", 
        RowBox[{"Frame", "\[Rule]", "True"}], ",", 
        RowBox[{"FrameLabel", "\[Rule]", 
         RowBox[{"{", 
          RowBox[{
          "\"\<separation (links)\>\"", ",", 
           "\"\<Polyakov loop correlator\>\""}], "}"}]}]}], "]"}], ",", 
      RowBox[{"Plot", "[", 
       RowBox[{
        RowBox[{"ff", "[", "x", "]"}], ",", 
        RowBox[{"{", 
         RowBox[{"x", ",", "0", ",", "maxx"}], "}"}], ",", 
        RowBox[{"PlotRange", "\[Rule]", "All"}]}], "]"}]}], "]"}]}]}], 
  "]"}]], "Input",ExpressionUUID->"eebb9c65-ad3e-4480-8d98-562b443e87e4"]
}, Closed]],

Cell[CellGroupData[{

Cell["Axial gauge", \
"Subsection",ExpressionUUID->"a1c1bbe6-f074-406a-ac7c-c6ffc4eacbaf"],

Cell[BoxData[
 RowBox[{"<<", 
  "\"\<test-4.m\>\""}]], \
"Input",ExpressionUUID->"ec3655d8-38b1-4a7d-b718-4b80aeeef422"],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"averagePlaquette", "[", 
  "]"}]], "Input",ExpressionUUID->"5dd31ab0-fae4-46d2-bd92-48606c717fd6"],

Cell[BoxData["0.9404935644386324`"], \
"Output",ExpressionUUID->"5f007e90-760f-463b-a28f-9fd832119cf7"]
}, Open  ]],

Cell[BoxData[
 RowBox[{"setAxialGauge", "[", "3", 
  "]"}]], "Input",ExpressionUUID->"89ef1a0c-4f0f-470f-8cb8-7133aac8adb9"],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"averagePlaquette", "[", 
  "]"}]], "Input",ExpressionUUID->"67ae6656-91d7-4223-bc46-982774baca07"],

Cell[BoxData["0.9404938721121576`"], \
"Output",ExpressionUUID->"437f73d5-4943-41d8-a415-ba7d45119a67"]
}, Open  ]]
}, Closed]],

Cell[CellGroupData[{

Cell["staples", \
"Subsection",ExpressionUUID->"a3cdfc84-d033-4252-a8cf-5af5f301749c"],

Cell[BoxData[
 RowBox[{"<<", 
  "\"\<test-3-3-5.m\>\""}]], \
"Input",ExpressionUUID->"8a0090dd-648b-4a98-bbe4-88d68ac28f27"],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"xxx", "=", 
  RowBox[{
  "averagePlaquette", "[", 
   "]"}]}]], "Input",ExpressionUUID->"8bb8d152-a1ab-4391-b0bf-f10ef2657976"],

Cell[BoxData["0.9404938721121576`"], \
"Output",ExpressionUUID->"2b5896f7-82b0-4550-a463-80485b77edb5"]
}, Open  ]],

Cell["Set all links to the identity", \
"Text",ExpressionUUID->"29ab58da-7987-4db3-ad7a-e1b6c642b2ad"],

Cell[BoxData[
 RowBox[{
  RowBox[{"gaugeField", "=", 
   RowBox[{"Array", "[", 
    RowBox[{
     RowBox[{
      RowBox[{"IdentityMatrix", "[", "nc", "]"}], "&"}], ",", 
     RowBox[{"{", 
      RowBox[{"nd", ",", 
       RowBox[{"latticeVolume", "[", "]"}]}], "}"}]}], "]"}]}], 
  ";"}]], "Input",ExpressionUUID->"b946bfba-43dc-4c26-bf82-3da15da84f5d"],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"sumStaples", "[", 
  RowBox[{"1", ",", 
   RowBox[{"{", 
    RowBox[{"1", ",", "1", ",", "1"}], "}"}]}], 
  "]"}]], "Input",ExpressionUUID->"b3ae56a7-b5ea-45a7-900e-faa0581cbc49"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{"4", ",", "0", ",", "0"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"0", ",", "4", ",", "0"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"0", ",", "0", ",", "4"}], "}"}]}], 
  "}"}]], "Output",ExpressionUUID->"a972b839-b4a9-448e-ac00-ce2fb91fbc4e"]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"stapleTest", "[", 
  "]"}]], "Input",ExpressionUUID->"e08438ab-1886-4139-8295-f618f20cd11a"],

Cell[BoxData["1"], \
"Output",ExpressionUUID->"8b2e72bf-9267-4ac7-84ae-2b9286a060b3"]
}, Open  ]]
}, Closed]],

Cell[CellGroupData[{

Cell["nearest stationary point for single  link and sum of staples", \
"Subsection",ExpressionUUID->"ea282df4-9160-4463-8126-eaff1b79fc30"],

Cell["\<\
Test stationary point routine against an explicit calculation for a random \
staple and starting matrix.  To compare,  remove the damping factors in the \
function saddlePointStep[] by setting rescaleCutoff to a large number and \
dampingFactor to 1.\
\>", "Text",ExpressionUUID->"a7813421-ea59-48d0-93a1-48d9b854885f"],

Cell[BoxData[
 RowBox[{
  RowBox[{"nd", "=", "3"}], ";", 
  RowBox[{"nc", "=", "3"}], 
  ";"}]], "Input",ExpressionUUID->"b7134f69-3d79-4f62-a0fd-b94d083411cd"],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"makeRandomStaple", "[", "]"}], ":=", 
   RowBox[{"Sum", "[", 
    RowBox[{
     RowBox[{"randomSUMatrix", "[", "]"}], ",", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"2", " ", "nd"}], "-", "2"}], "}"}]}], "]"}]}], ";", 
  RowBox[{"Clear", "[", "bb", "]"}], ";", 
  RowBox[{"bVector", "=", 
   RowBox[{
    RowBox[{"Table", "[", 
     RowBox[{
      RowBox[{"bb", "[", "i", "]"}], ",", 
      RowBox[{"{", 
       RowBox[{"i", ",", 
        RowBox[{
         RowBox[{"nc", "^", "2"}], "-", "1"}]}], "}"}]}], "]"}], ".", 
    RowBox[{
    "suGenerators", "[", 
     "]"}]}]}]}]], \
"Input",ExpressionUUID->"a1c3eed8-029f-4991-bfbf-da8c98937504"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{
     RowBox[{
      FractionBox[
       RowBox[{"bb", "[", "7", "]"}], "2"], "+", 
      FractionBox[
       RowBox[{"bb", "[", "8", "]"}], 
       RowBox[{"2", " ", 
        SqrtBox["3"]}]]}], ",", 
     RowBox[{
      FractionBox[
       RowBox[{"bb", "[", "1", "]"}], "2"], "-", 
      RowBox[{
       FractionBox["1", "2"], " ", "\[ImaginaryI]", " ", 
       RowBox[{"bb", "[", "4", "]"}]}]}], ",", 
     RowBox[{
      FractionBox[
       RowBox[{"bb", "[", "2", "]"}], "2"], "-", 
      RowBox[{
       FractionBox["1", "2"], " ", "\[ImaginaryI]", " ", 
       RowBox[{"bb", "[", "5", "]"}]}]}]}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{
      FractionBox[
       RowBox[{"bb", "[", "1", "]"}], "2"], "+", 
      RowBox[{
       FractionBox["1", "2"], " ", "\[ImaginaryI]", " ", 
       RowBox[{"bb", "[", "4", "]"}]}]}], ",", 
     RowBox[{
      RowBox[{"-", 
       FractionBox[
        RowBox[{"bb", "[", "7", "]"}], "2"]}], "+", 
      FractionBox[
       RowBox[{"bb", "[", "8", "]"}], 
       RowBox[{"2", " ", 
        SqrtBox["3"]}]]}], ",", 
     RowBox[{
      FractionBox[
       RowBox[{"bb", "[", "3", "]"}], "2"], "-", 
      RowBox[{
       FractionBox["1", "2"], " ", "\[ImaginaryI]", " ", 
       RowBox[{"bb", "[", "6", "]"}]}]}]}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{
      FractionBox[
       RowBox[{"bb", "[", "2", "]"}], "2"], "+", 
      RowBox[{
       FractionBox["1", "2"], " ", "\[ImaginaryI]", " ", 
       RowBox[{"bb", "[", "5", "]"}]}]}], ",", 
     RowBox[{
      FractionBox[
       RowBox[{"bb", "[", "3", "]"}], "2"], "+", 
      RowBox[{
       FractionBox["1", "2"], " ", "\[ImaginaryI]", " ", 
       RowBox[{"bb", "[", "6", "]"}]}]}], ",", 
     RowBox[{"-", 
      FractionBox[
       RowBox[{"bb", "[", "8", "]"}], 
       SqrtBox["3"]]}]}], "}"}]}], 
  "}"}]], "Output",ExpressionUUID->"fef068e2-3d24-4003-af2a-cd0f1030fae7"]
}, Open  ]],

Cell[CellGroupData[{

Cell["Run test", \
"Subsubsection",ExpressionUUID->"da7b8aa5-359a-4015-8f83-c1c7061ad4ea"],

Cell["Make random staple and starting link.", \
"Text",ExpressionUUID->"9e8bb80e-1572-4b9d-bc2b-e63fc0601168"],

Cell[BoxData[
 RowBox[{
  RowBox[{"testStaple", "=", 
   RowBox[{"makeRandomStaple", "[", "]"}]}], ";", 
  RowBox[{"uu", "=", 
   RowBox[{"randomSUMatrix", "[", "]"}]}], ";", 
  RowBox[{"sqrtU", "=", 
   RowBox[{"SUPower", "[", 
    RowBox[{"uu", ",", "0.5"}], "]"}]}], 
  ";"}]], "Input",ExpressionUUID->"9130c6e3-6caa-48da-a201-516f3848d814"],

Cell["\<\
Explicitly find the second order expansion of the exponential.\
\>", "Text",ExpressionUUID->"598ce003-f717-4a15-b9ca-f7d259cfb5c6"],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"expr", "=", 
  RowBox[{
   RowBox[{"Re", "[", 
    RowBox[{"Expand", "[", 
     RowBox[{"Tr", "[", 
      RowBox[{"testStaple", ".", "sqrtU", ".", 
       RowBox[{"Simplify", "[", 
        RowBox[{
         RowBox[{"IdentityMatrix", "[", "nc", "]"}], "+", 
         RowBox[{"I", " ", "bVector"}], "-", 
         RowBox[{
          RowBox[{"bVector", ".", "bVector"}], "/", 
          RowBox[{"2", "!"}]}]}], "]"}], ".", "sqrtU"}], "]"}], "]"}], "]"}], 
   "//.", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{
      RowBox[{"Re", "[", 
       RowBox[{"a_", "+", "b_"}], "]"}], "\[Rule]", 
      RowBox[{
       RowBox[{"Re", "[", "a", "]"}], "+", 
       RowBox[{"Re", "[", "b", "]"}]}]}], ",", 
     RowBox[{
      RowBox[{"Re", "[", 
       RowBox[{"a_", " ", 
        RowBox[{"bb", "[", "i_", "]"}]}], "]"}], "\[Rule]", 
      RowBox[{
       RowBox[{"Re", "[", "a", "]"}], " ", 
       RowBox[{"bb", "[", "i", "]"}]}]}], ",", 
     RowBox[{
      RowBox[{"Re", "[", 
       RowBox[{"a_", " ", 
        RowBox[{
         RowBox[{"bb", "[", "i_", "]"}], "^", "n_"}]}], "]"}], "\[Rule]", 
      RowBox[{
       RowBox[{"Re", "[", "a", "]"}], " ", 
       RowBox[{
        RowBox[{"bb", "[", "i", "]"}], "^", "n"}]}]}]}], 
    "}"}]}]}]], \
"Input",ExpressionUUID->"6a95ba59-19b7-49dd-9b6e-5a60dc89ad9f"],

Cell[BoxData[
 RowBox[{"2.37489372094785`", "\[VeryThinSpace]", "-", 
  RowBox[{"0.3405470782746399`", " ", 
   RowBox[{"bb", "[", "1", "]"}]}], "-", 
  RowBox[{"0.2700288121939233`", " ", 
   SuperscriptBox[
    RowBox[{"bb", "[", "1", "]"}], "2"]}], "+", 
  RowBox[{"0.8823146992444793`", " ", 
   RowBox[{"bb", "[", "2", "]"}]}], "-", 
  RowBox[{"0.14771694565643378`", " ", 
   RowBox[{"bb", "[", "1", "]"}], " ", 
   RowBox[{"bb", "[", "2", "]"}]}], "-", 
  RowBox[{"0.23167127876846458`", " ", 
   SuperscriptBox[
    RowBox[{"bb", "[", "2", "]"}], "2"]}], "-", 
  RowBox[{"0.7614653065483055`", " ", 
   RowBox[{"bb", "[", "3", "]"}]}], "-", 
  RowBox[{"0.10259814803584605`", " ", 
   RowBox[{"bb", "[", "1", "]"}], " ", 
   RowBox[{"bb", "[", "3", "]"}]}], "-", 
  RowBox[{"0.13037824682287114`", " ", 
   RowBox[{"bb", "[", "2", "]"}], " ", 
   RowBox[{"bb", "[", "3", "]"}]}], "-", 
  RowBox[{"0.09202333927457465`", " ", 
   SuperscriptBox[
    RowBox[{"bb", "[", "3", "]"}], "2"]}], "+", 
  RowBox[{"0.2687508477903911`", " ", 
   RowBox[{"bb", "[", "4", "]"}]}], "-", 
  RowBox[{"0.08046279575970144`", " ", 
   RowBox[{"bb", "[", "2", "]"}], " ", 
   RowBox[{"bb", "[", "4", "]"}]}], "-", 
  RowBox[{"0.17048846946786733`", " ", 
   RowBox[{"bb", "[", "3", "]"}], " ", 
   RowBox[{"bb", "[", "4", "]"}]}], "-", 
  RowBox[{"0.2700288121939233`", " ", 
   SuperscriptBox[
    RowBox[{"bb", "[", "4", "]"}], "2"]}], "-", 
  RowBox[{"0.08401543009780699`", " ", 
   RowBox[{"bb", "[", "5", "]"}]}], "+", 
  RowBox[{"0.08046279575970144`", " ", 
   RowBox[{"bb", "[", "1", "]"}], " ", 
   RowBox[{"bb", "[", "5", "]"}]}], "-", 
  RowBox[{"0.36682759445054436`", " ", 
   RowBox[{"bb", "[", "3", "]"}], " ", 
   RowBox[{"bb", "[", "5", "]"}]}], "-", 
  RowBox[{"0.14771694565643378`", " ", 
   RowBox[{"bb", "[", "4", "]"}], " ", 
   RowBox[{"bb", "[", "5", "]"}]}], "-", 
  RowBox[{"0.23167127876846458`", " ", 
   SuperscriptBox[
    RowBox[{"bb", "[", "5", "]"}], "2"]}], "+", 
  RowBox[{"0.583386761440738`", " ", 
   RowBox[{"bb", "[", "6", "]"}]}], "-", 
  RowBox[{"0.17048846946786733`", " ", 
   RowBox[{"bb", "[", "1", "]"}], " ", 
   RowBox[{"bb", "[", "6", "]"}]}], "+", 
  RowBox[{"0.36682759445054436`", " ", 
   RowBox[{"bb", "[", "2", "]"}], " ", 
   RowBox[{"bb", "[", "6", "]"}]}], "+", 
  RowBox[{"0.10259814803584605`", " ", 
   RowBox[{"bb", "[", "4", "]"}], " ", 
   RowBox[{"bb", "[", "6", "]"}]}], "-", 
  RowBox[{"0.13037824682287114`", " ", 
   RowBox[{"bb", "[", "5", "]"}], " ", 
   RowBox[{"bb", "[", "6", "]"}]}], "-", 
  RowBox[{"0.09202333927457465`", " ", 
   SuperscriptBox[
    RowBox[{"bb", "[", "6", "]"}], "2"]}], "+", 
  RowBox[{"0.5625982739670222`", " ", 
   RowBox[{"bb", "[", "7", "]"}]}], "-", 
  RowBox[{"0.10259814803584605`", " ", 
   RowBox[{"bb", "[", "2", "]"}], " ", 
   RowBox[{"bb", "[", "7", "]"}]}], "+", 
  RowBox[{"0.14771694565643378`", " ", 
   RowBox[{"bb", "[", "3", "]"}], " ", 
   RowBox[{"bb", "[", "7", "]"}]}], "-", 
  RowBox[{"0.17048846946786733`", " ", 
   RowBox[{"bb", "[", "5", "]"}], " ", 
   RowBox[{"bb", "[", "7", "]"}]}], "-", 
  RowBox[{"0.08046279575970144`", " ", 
   RowBox[{"bb", "[", "6", "]"}], " ", 
   RowBox[{"bb", "[", "7", "]"}]}], "-", 
  RowBox[{"0.2700288121939233`", " ", 
   SuperscriptBox[
    RowBox[{"bb", "[", "7", "]"}], "2"]}], "-", 
  RowBox[{"0.2773069865539702`", " ", 
   RowBox[{"bb", "[", "8", "]"}]}], "-", 
  RowBox[{"0.1505478317993122`", " ", 
   RowBox[{"bb", "[", "1", "]"}], " ", 
   RowBox[{"bb", "[", "8", "]"}]}], "+", 
  RowBox[{"0.059235068386852795`", " ", 
   RowBox[{"bb", "[", "2", "]"}], " ", 
   RowBox[{"bb", "[", "8", "]"}]}], "+", 
  RowBox[{"0.08528441833861136`", " ", 
   RowBox[{"bb", "[", "3", "]"}], " ", 
   RowBox[{"bb", "[", "8", "]"}]}], "-", 
  RowBox[{"0.4235760208044093`", " ", 
   RowBox[{"bb", "[", "4", "]"}], " ", 
   RowBox[{"bb", "[", "8", "]"}]}], "+", 
  RowBox[{"0.09843156374100048`", " ", 
   RowBox[{"bb", "[", "5", "]"}], " ", 
   RowBox[{"bb", "[", "8", "]"}]}], "-", 
  RowBox[{"0.0464552167916135`", " ", 
   RowBox[{"bb", "[", "6", "]"}], " ", 
   RowBox[{"bb", "[", "8", "]"}]}], "-", 
  RowBox[{"0.16125155091714788`", " ", 
   RowBox[{"bb", "[", "7", "]"}], " ", 
   RowBox[{"bb", "[", "8", "]"}]}], "-", 
  RowBox[{"0.12578680796405173`", " ", 
   SuperscriptBox[
    RowBox[{"bb", "[", "8", "]"}], 
    "2"]}]}]], "Output",ExpressionUUID->"1652e9c9-57a0-4ede-a0ed-548537e7a320"]
}, Open  ]],

Cell["Find the stationary point, based on this :", \
"Text",ExpressionUUID->"311645dc-63f3-4d62-b159-2a5da2e39cf6"],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"sp", "=", 
  RowBox[{
   RowBox[{"Solve", "[", 
    RowBox[{
     RowBox[{"Table", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"D", "[", 
         RowBox[{"expr", ",", 
          RowBox[{"bb", "[", "i", "]"}]}], "]"}], "\[Equal]", "0"}], ",", 
       RowBox[{"{", 
        RowBox[{"i", ",", 
         RowBox[{
          RowBox[{"nc", "^", "2"}], "-", "1"}]}], "}"}]}], "]"}], ",", 
     RowBox[{"Table", "[", 
      RowBox[{
       RowBox[{"bb", "[", "i", "]"}], ",", 
       RowBox[{"{", 
        RowBox[{"i", ",", 
         RowBox[{
          RowBox[{"nc", "^", "2"}], "-", "1"}]}], "}"}]}], "]"}]}], "]"}], 
   "[", 
   RowBox[{"[", "1", "]"}], 
   "]"}]}]], "Input",ExpressionUUID->"550f4ef5-06c0-4564-ba47-23d788a873b4"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   RowBox[{
    RowBox[{"bb", "[", "1", "]"}], "\[Rule]", "0.5152936266310687`"}], ",", 
   RowBox[{
    RowBox[{"bb", "[", "2", "]"}], "\[Rule]", 
    RowBox[{"-", "2.3301314123972148`"}]}], ",", 
   RowBox[{
    RowBox[{"bb", "[", "3", "]"}], "\[Rule]", "2.0371967270811706`"}], ",", 
   RowBox[{
    RowBox[{"bb", "[", "4", "]"}], "\[Rule]", 
    RowBox[{"-", "2.2716985986965317`"}]}], ",", 
   RowBox[{
    RowBox[{"bb", "[", "5", "]"}], "\[Rule]", 
    RowBox[{"-", "0.025265977037478297`"}]}], ",", 
   RowBox[{
    RowBox[{"bb", "[", "6", "]"}], "\[Rule]", 
    RowBox[{"-", "4.6472549818729565`"}]}], ",", 
   RowBox[{
    RowBox[{"bb", "[", "7", "]"}], "\[Rule]", "2.1338646167429505`"}], ",", 
   RowBox[{
    RowBox[{"bb", "[", "8", "]"}], "\[Rule]", "2.0367106451865067`"}]}], 
  "}"}]], "Output",ExpressionUUID->"a8a0f5d8-733d-4bbf-9060-d8481e2a6eed"]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"v1", "=", 
  RowBox[{"sqrtU", ".", 
   RowBox[{"MatrixExp", "[", 
    RowBox[{
     RowBox[{"I", " ", "bVector"}], "/.", "sp"}], "]"}], ".", 
   "sqrtU"}]}]], \
"Input",ExpressionUUID->"c03163ff-9f1b-4818-bd65-86fab0e3a288"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{
     RowBox[{
      RowBox[{"-", "0.6255785580732731`"}], "-", 
      RowBox[{"0.4692503846718301`", " ", "\[ImaginaryI]"}]}], ",", 
     RowBox[{
      RowBox[{"-", "0.31804719948828614`"}], "+", 
      RowBox[{"0.3700055895044924`", " ", "\[ImaginaryI]"}]}], ",", 
     RowBox[{"0.3498764654015885`", "\[VeryThinSpace]", "+", 
      RowBox[{"0.16728372830459606`", " ", "\[ImaginaryI]"}]}]}], "}"}], ",", 
   
   RowBox[{"{", 
    RowBox[{
     RowBox[{"0.2258436271151437`", "\[VeryThinSpace]", "-", 
      RowBox[{"0.06647470576406589`", " ", "\[ImaginaryI]"}]}], ",", 
     RowBox[{
      RowBox[{"-", "0.09547585293478977`"}], "-", 
      RowBox[{"0.3316754640898466`", " ", "\[ImaginaryI]"}]}], ",", 
     RowBox[{"0.791714544181181`", "\[VeryThinSpace]", "-", 
      RowBox[{"0.4456900247304179`", " ", "\[ImaginaryI]"}]}]}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{
      RowBox[{"-", "0.10897394749840028`"}], "-", 
      RowBox[{"0.5667062665225926`", " ", "\[ImaginaryI]"}]}], ",", 
     RowBox[{"0.7945573651103334`", "\[VeryThinSpace]", "-", 
      RowBox[{"0.10722026025511805`", " ", "\[ImaginaryI]"}]}], ",", 
     RowBox[{
      RowBox[{"-", "0.04867827226772917`"}], "-", 
      RowBox[{"0.14758564089849105`", " ", "\[ImaginaryI]"}]}]}], "}"}]}], 
  "}"}]], "Output",ExpressionUUID->"69ff56a4-a776-4c3d-8748-b76535859e67"]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"centerPhases", "[", "v1", 
  "]"}]], "Input",ExpressionUUID->"c0f5bc1c-9524-457c-9b77-7b68fba52094"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   RowBox[{"-", "0.5299596384259357`"}], ",", 
   RowBox[{"-", "2.3138801486982974`"}], ",", "2.8438397871242334`"}], 
  "}"}]], "Output",ExpressionUUID->"96c25404-f7be-419e-a7c8-2ce812edbbf6"]
}, Open  ]],

Cell["\<\
Now, compare this with the library routine (with damping factors removed) :\
\>", "Text",ExpressionUUID->"3fe08654-62f2-4d02-9d81-7e2b3d7a8735"],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{
  RowBox[{"{", 
   RowBox[{"u2", ",", "maxShift"}], "}"}], "=", 
  RowBox[{"linkSaddlePointStep", "[", 
   RowBox[{
    RowBox[{"sqrtU", ".", "testStaple"}], ",", "sqrtU", ",", 
    RowBox[{"rescaleCutoff", "\[Rule]", "Infinity"}], ",", 
    RowBox[{"dampingFactor", "\[Rule]", "1"}]}], 
   "]"}]}]], "Input",ExpressionUUID->"80497507-228c-4fdc-80f9-3b7206b667b4"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{
        RowBox[{"-", "0.21611238784783293`"}], "-", 
        RowBox[{"0.6358297161804467`", " ", "\[ImaginaryI]"}]}], ",", 
       RowBox[{
        RowBox[{"-", "0.35540738933402344`"}], "-", 
        RowBox[{"0.2613070161973714`", " ", "\[ImaginaryI]"}]}], ",", 
       RowBox[{"0.4168085890834326`", "\[VeryThinSpace]", "-", 
        RowBox[{"0.42507745035426014`", " ", "\[ImaginaryI]"}]}]}], "}"}], 
     ",", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{
        RowBox[{"-", "0.21869904907004137`"}], "+", 
        RowBox[{"0.689047945614611`", " ", "\[ImaginaryI]"}]}], ",", 
       RowBox[{
        RowBox[{"-", "0.029512443510916614`"}], "-", 
        RowBox[{"0.5259655203513527`", " ", "\[ImaginaryI]"}]}], ",", 
       RowBox[{"0.41611500255229295`", "\[VeryThinSpace]", "-", 
        RowBox[{"0.16346634611012317`", " ", "\[ImaginaryI]"}]}]}], "}"}], 
     ",", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"0.04527187243484024`", "\[VeryThinSpace]", "-", 
        RowBox[{"0.15604524980590562`", " ", "\[ImaginaryI]"}]}], ",", 
       RowBox[{"0.39560746909006506`", "\[VeryThinSpace]", "-", 
        RowBox[{"0.60941631777669`", " ", "\[ImaginaryI]"}]}], ",", 
       RowBox[{
        RowBox[{"-", "0.5858268236526329`"}], "-", 
        RowBox[{"0.32017768862926266`", " ", "\[ImaginaryI]"}]}]}], "}"}]}], 
    "}"}], ",", "6.131302752322737`"}], 
  "}"}]], "Output",ExpressionUUID->"da26fa80-ecf6-4b38-b0c4-a807691ecbd7"]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"v2", "=", 
  RowBox[{
  "u2", ".", 
   "sqrtU"}]}]], \
"Input",ExpressionUUID->"ac7a0f4c-2d12-4266-b88c-dfe83862a927"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{
     RowBox[{
      RowBox[{"-", "0.6255785580733022`"}], "-", 
      RowBox[{"0.46925038467179075`", " ", "\[ImaginaryI]"}]}], ",", 
     RowBox[{
      RowBox[{"-", "0.3180471994883058`"}], "+", 
      RowBox[{"0.37000558950447404`", " ", "\[ImaginaryI]"}]}], ",", 
     RowBox[{"0.34987646540161`", "\[VeryThinSpace]", "+", 
      RowBox[{"0.16728372830455518`", " ", "\[ImaginaryI]"}]}]}], "}"}], ",", 
   
   RowBox[{"{", 
    RowBox[{
     RowBox[{"0.22584362711515635`", "\[VeryThinSpace]", "-", 
      RowBox[{"0.06647470576405129`", " ", "\[ImaginaryI]"}]}], ",", 
     RowBox[{
      RowBox[{"-", "0.09547585293477612`"}], "-", 
      RowBox[{"0.3316754640898437`", " ", "\[ImaginaryI]"}]}], ",", 
     RowBox[{"0.7917145441811566`", "\[VeryThinSpace]", "-", 
      RowBox[{"0.445690024730462`", " ", "\[ImaginaryI]"}]}]}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{
      RowBox[{"-", "0.10897394749838872`"}], "-", 
      RowBox[{"0.5667062665225922`", " ", "\[ImaginaryI]"}]}], ",", 
     RowBox[{"0.7945573651103485`", "\[VeryThinSpace]", "-", 
      RowBox[{"0.10722026025503167`", " ", "\[ImaginaryI]"}]}], ",", 
     RowBox[{
      RowBox[{"-", "0.04867827226770527`"}], "-", 
      RowBox[{"0.1475856408984914`", " ", "\[ImaginaryI]"}]}]}], "}"}]}], 
  "}"}]], "Output",ExpressionUUID->"24c58720-3fa8-4c28-a1cc-d92ebb6f1da6"]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"centerPhases", "[", "v2", 
  "]"}]], "Input",ExpressionUUID->"89631d59-895b-46fd-b2a6-708ffba5df6c"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   RowBox[{"-", "0.5299596384259125`"}], ",", 
   RowBox[{"-", "2.3138801486983076`"}], ",", "2.84383978712422`"}], 
  "}"}]], "Output",ExpressionUUID->"2ac10f59-0bc9-4231-b31d-5120dbe922ad"]
}, Open  ]]
}, Open  ]]
}, Closed]],

Cell[CellGroupData[{

Cell["nearest stationary point for entire lattice", \
"Subsection",ExpressionUUID->"1b840428-3dba-4350-9abd-ef8fad741fdb"],

Cell["\<\
Test stationary point routine against an explicit calculation for a random \
lattice.  Tested for nd=3 and SU(2), SU(3) with multiple sites, and SU(4) \
with one site.\
\>", "Text",ExpressionUUID->"775818f5-3441-4cfb-87a0-fc2a48ea802e"],

Cell["Create Random lattice :", \
"Text",ExpressionUUID->"90f99fee-2842-49b5-a115-5316d7dd6a49"],

Cell[CellGroupData[{

Cell[BoxData[{
 RowBox[{
  RowBox[{"nd", "=", "3"}], ";", 
  RowBox[{"nc", "=", "3"}], ";", 
  RowBox[{"latticeDimensions", "=", 
   RowBox[{"{", 
    RowBox[{"2", ",", "2", ",", "1"}], "}"}]}], ";", 
  RowBox[{"gaugeField", "=", 
   RowBox[{"Table", "[", 
    RowBox[{
     RowBox[{"randomSUMatrix", "[", "]"}], ",", 
     RowBox[{"{", "nd", "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"latticeVolume", "[", "]"}], "}"}]}], "]"}]}], ";", 
  RowBox[{"Clear", "[", "linearSiteIndex", "]"}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"(*", " ", 
   RowBox[{
   "Switch", " ", "order", " ", "to", " ", "verify", " ", "we", " ", "are", 
    " ", "not", " ", "dependent", " ", "on", " ", 
    RowBox[{"latticeCoordinates", "[", "]"}], " ", 
    RowBox[{"indexing", "."}]}], " ", "*)"}], 
  RowBox[{
   RowBox[{"Do", "[", 
    RowBox[{
     RowBox[{
      RowBox[{"linearSiteIndex", "[", 
       RowBox[{"latticeCoordinates", "[", "i", "]"}], "]"}], "=", 
      RowBox[{"If", "[", 
       RowBox[{"True", ",", "i", ",", 
        RowBox[{
         RowBox[{"latticeVolume", "[", "]"}], "-", "i", "+", "1"}]}], "]"}]}],
      ",", 
     RowBox[{"{", 
      RowBox[{"i", ",", 
       RowBox[{"latticeVolume", "[", "]"}]}], "}"}]}], "]"}], ";", 
   RowBox[{
   "averagePlaquette", "[", 
    "]"}]}]}]}], \
"Input",ExpressionUUID->"aef1e77b-70db-47d7-b29f-29c8a6ef602f"],

Cell[BoxData[
 RowBox[{"-", 
  "0.04503147815190723`"}]], \
"Output",ExpressionUUID->"3254bd76-bd45-49ba-ab64-4be6f6a3ecbd"]
}, Open  ]],

Cell[BoxData[
 RowBox[{
  RowBox[{"Clear", "[", "bb", "]"}], ";", 
  RowBox[{
   RowBox[{"bVector", "[", 
    RowBox[{"dir_", ",", "site_"}], "]"}], ":=", 
   RowBox[{"(", 
    RowBox[{
     RowBox[{"Table", "[", 
      RowBox[{
       RowBox[{"bb", "[", 
        RowBox[{"dir", ",", "site", ",", "i"}], "]"}], ",", 
       RowBox[{"{", 
        RowBox[{"i", ",", 
         RowBox[{
          RowBox[{"nc", "^", "2"}], "-", "1"}]}], "}"}]}], "]"}], ".", 
     RowBox[{"suGenerators", "[", "]"}]}], 
    ")"}]}]}]], \
"Input",ExpressionUUID->"30907186-02ad-4415-8f1d-ae3905203408"],

Cell["\<\
Create links with second order perturbation.  Variables have same lattice \
index as links.\
\>", "Text",ExpressionUUID->"e296b2ed-594c-419b-8904-1f44a2b2df9f"],

Cell[BoxData[
 RowBox[{
  RowBox[{"uu", "=", 
   RowBox[{"Table", "[", 
    RowBox[{
     RowBox[{"Simplify", "[", 
      RowBox[{
       RowBox[{"SUPower", "[", 
        RowBox[{
         RowBox[{"gaugeField", "[", 
          RowBox[{"[", 
           RowBox[{"dir", ",", "i"}], "]"}], "]"}], ",", "0.5"}], "]"}], ".", 
       
       RowBox[{"(", 
        RowBox[{
         RowBox[{"IdentityMatrix", "[", "nc", "]"}], "+", 
         RowBox[{"I", " ", 
          RowBox[{"bVector", "[", 
           RowBox[{"dir", ",", "i"}], "]"}]}], "-", 
         RowBox[{
          RowBox[{
           RowBox[{"bVector", "[", 
            RowBox[{"dir", ",", "i"}], "]"}], ".", 
           RowBox[{"bVector", "[", 
            RowBox[{"dir", ",", "i"}], "]"}]}], "/", 
          RowBox[{"2", "!"}]}]}], ")"}], ".", 
       RowBox[{"SUPower", "[", 
        RowBox[{
         RowBox[{"gaugeField", "[", 
          RowBox[{"[", 
           RowBox[{"dir", ",", "i"}], "]"}], "]"}], ",", "0.5"}], "]"}]}], 
      "]"}], ",", 
     RowBox[{"{", 
      RowBox[{"dir", ",", "nd"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"i", ",", 
       RowBox[{"latticeVolume", "[", "]"}]}], "}"}]}], "]"}]}], 
  ";"}]], "Input",ExpressionUUID->"0c9ce925-7c3c-49ef-8c8b-6a87291ccacb"],

Cell["Sum of plaquettes, not taking the real part:", \
"Text",ExpressionUUID->"8ff7648c-bdb7-4ab9-99be-869a5b7f7d7d"],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{
  RowBox[{"rp", "=", 
   RowBox[{"Sum", "[", 
    RowBox[{
     RowBox[{
      RowBox[{"Block", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"coords", "=", 
          RowBox[{"latticeCoordinates", "[", "i", "]"}]}], "}"}], ",", 
        RowBox[{"Tr", "[", 
         RowBox[{
          RowBox[{"uu", "[", 
           RowBox[{"[", 
            RowBox[{"k1", ",", 
             RowBox[{"linearSiteIndex", "[", "coords", "]"}]}], "]"}], "]"}], 
          ".", 
          RowBox[{"uu", "[", 
           RowBox[{"[", 
            RowBox[{"k2", ",", 
             RowBox[{"linearSiteIndex", "[", 
              RowBox[{"shift", "[", 
               RowBox[{"k1", ",", "coords"}], "]"}], "]"}]}], "]"}], "]"}], 
          ".", 
          RowBox[{"ConjugateTranspose", "[", 
           RowBox[{"uu", "[", 
            RowBox[{"[", 
             RowBox[{"k1", ",", 
              RowBox[{"linearSiteIndex", "[", 
               RowBox[{"shift", "[", 
                RowBox[{"k2", ",", "coords"}], "]"}], "]"}]}], "]"}], "]"}], 
           "]"}], ".", 
          RowBox[{"ConjugateTranspose", "[", 
           RowBox[{"uu", "[", 
            RowBox[{"[", 
             RowBox[{"k2", ",", 
              RowBox[{"linearSiteIndex", "[", "coords", "]"}]}], "]"}], "]"}],
            "]"}]}], "]"}]}], "]"}], "//.", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{
         RowBox[{"Conjugate", "[", 
          RowBox[{"a_", " ", "b_"}], "]"}], "\[Rule]", 
         RowBox[{
          RowBox[{"Conjugate", "[", "a", "]"}], 
          RowBox[{"Conjugate", "[", "b", "]"}]}]}], ",", 
        RowBox[{
         RowBox[{"Conjugate", "[", 
          RowBox[{"a_", "+", "b_"}], "]"}], "\[Rule]", 
         RowBox[{
          RowBox[{"Conjugate", "[", "a", "]"}], "+", 
          RowBox[{"Conjugate", "[", "b", "]"}]}]}], ",", 
        RowBox[{
         RowBox[{"Conjugate", "[", 
          RowBox[{"bb", "[", "a__", "]"}], "]"}], "\[Rule]", 
         RowBox[{"bb", "[", "a", "]"}]}]}], "}"}]}], ",", 
     RowBox[{"{", 
      RowBox[{"k1", ",", 
       RowBox[{"nd", "-", "1"}]}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"k2", ",", 
       RowBox[{"k1", "+", "1"}], ",", "nd"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"i", ",", 
       RowBox[{"latticeVolume", "[", "]"}]}], "}"}]}], "]"}]}], ";", 
  RowBox[{"(*", " ", 
   RowBox[{
   "Average", " ", "plaquette", " ", "should", " ", "be", " ", "same", " ", 
    "as", " ", 
    RowBox[{"above", "."}]}], " ", "*)"}], 
  RowBox[{
   RowBox[{"2", "/", 
    RowBox[{"(", 
     RowBox[{"nc", " ", "nd", " ", 
      RowBox[{"(", 
       RowBox[{"nd", "-", "1"}], ")"}], " ", 
      RowBox[{"latticeVolume", "[", "]"}]}], ")"}]}], " ", 
   RowBox[{"Re", "[", 
    RowBox[{"rp", "/.", 
     RowBox[{
      RowBox[{"bb", "[", "__", "]"}], "\[Rule]", "0"}]}], 
    "]"}]}]}]], \
"Input",ExpressionUUID->"04f19bb9-b9c4-4e30-a3b1-e461c5b9f3e9"],

Cell[BoxData[
 RowBox[{"-", 
  "0.04503147815190725`"}]], \
"Output",ExpressionUUID->"6c4e46e0-a664-4956-b98f-9e982956c122"]
}, Open  ]],

Cell["Calculate gradient and Hessian at bb[dir,i,k] = 0.", \
"Text",ExpressionUUID->"7f53c297-a27e-4759-bfe8-08ef3acedbf8"],

Cell[BoxData[
 RowBox[{"gradient0", "=", 
  RowBox[{"Flatten", "[", 
   RowBox[{"Table", "[", 
    RowBox[{
     RowBox[{"Re", "[", 
      RowBox[{
       RowBox[{"D", "[", 
        RowBox[{"rp", ",", 
         RowBox[{"bb", "[", 
          RowBox[{"dir", ",", "i", ",", "k"}], "]"}]}], "]"}], "/.", 
       RowBox[{
        RowBox[{"bb", "[", "__", "]"}], "\[Rule]", "0"}]}], "]"}], ",", 
     RowBox[{"{", 
      RowBox[{"dir", ",", "nd"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"i", ",", 
       RowBox[{"latticeVolume", "[", "]"}]}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"k", ",", 
       RowBox[{
        RowBox[{"nc", "^", "2"}], "-", "1"}]}], "}"}]}], "]"}], 
   "]"}]}]], "Input",ExpressionUUID->"857290eb-f32a-450a-b7f7-7473c9bea2ef"],

Cell["\<\
For parallelization, I had to go to menu Evaluation->Parallel Kernel \
Configuration and set the number manually.  Automatic launching of additional \
kernels is broken?  Note that the parallelization is based on the leading \
dimension of the table.
Verify parallel kernels are running:\
\>", "Text",ExpressionUUID->"155e4abe-b149-4413-ba11-0bdaafb3547c"],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"ParallelEvaluate", "[", "$ProcessID", 
  "]"}]], "Input",ExpressionUUID->"d989f3fa-185e-42ec-9a70-1af929ea7129"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
  "22937", ",", "22939", ",", "22950", ",", "22979", ",", "23010", ",", 
   "23052"}], 
  "}"}]], "Output",ExpressionUUID->"5b831e1e-afe4-4a02-998c-ed773005071d"]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"Dimensions", "[", 
  RowBox[{"hess0", "=", 
   RowBox[{"Flatten", "[", 
    RowBox[{
     RowBox[{"ParallelTable", "[", 
      RowBox[{
       RowBox[{"Re", "[", 
        RowBox[{
         RowBox[{"D", "[", 
          RowBox[{"rp", ",", 
           RowBox[{"bb", "[", 
            RowBox[{"dir1", ",", "i1", ",", "k1"}], "]"}], ",", 
           RowBox[{"bb", "[", 
            RowBox[{"dir2", ",", "i2", ",", "k2"}], "]"}]}], "]"}], "/.", 
         RowBox[{
          RowBox[{"bb", "[", "__", "]"}], "\[Rule]", "0"}]}], "]"}], ",", 
       RowBox[{"{", 
        RowBox[{"dir1", ",", "nd"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"i1", ",", 
         RowBox[{"latticeVolume", "[", "]"}]}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"k1", ",", 
         RowBox[{
          RowBox[{"nc", "^", "2"}], "-", "1"}]}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"dir2", ",", "nd"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"i2", ",", 
         RowBox[{"latticeVolume", "[", "]"}]}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"k2", ",", 
         RowBox[{
          RowBox[{"nc", "^", "2"}], "-", "1"}]}], "}"}]}], "]"}], ",", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"1", ",", "2", ",", "3"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"4", ",", "5", ",", "6"}], "}"}]}], "}"}]}], "]"}]}], 
  "]"}]], "Input",ExpressionUUID->"9fc6db0e-a169-4996-94ee-6f278635c2e7"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{"96", ",", "96"}], 
  "}"}]], "Output",ExpressionUUID->"65f8a3fd-4cd4-41b8-b729-d9199f84b014"]
}, Open  ]],

Cell["Find the saddle point.", \
"Text",ExpressionUUID->"47cda69a-bf50-4ff0-ab2f-ae8ad49ba288"],

Cell[BoxData[
 RowBox[{"delta0", "=", 
  RowBox[{"-", 
   RowBox[{"LinearSolve", "[", 
    RowBox[{"hess0", ",", "gradient0"}], 
    "]"}]}]}]], \
"Input",ExpressionUUID->"737d31db-efb3-42a4-a1fe-18644cff8567"],

Cell["Equivalently, find the saddle point using the eigensystem.", \
"Text",ExpressionUUID->"ff29655f-7449-4f85-8d56-89b0f03b4d15"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"{", 
    RowBox[{"vals", ",", "oo"}], "}"}], "=", 
   RowBox[{"Eigensystem", "[", "hess0", "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{"delta0", "=", 
  RowBox[{
   RowBox[{"(", 
    RowBox[{
     RowBox[{"-", 
      RowBox[{"oo", ".", "gradient0"}]}], "/", "vals"}], ")"}], ".", 
   "oo"}]}]}], "Input",ExpressionUUID->"76ce6490-2a01-45bc-b420-e512cad5664e"],

Cell["Substitute shift back into links :", \
"Text",ExpressionUUID->"42e016f3-0c73-4b85-ba21-9a2d27e0e9a4"],

Cell[BoxData[
 RowBox[{
  RowBox[{"newGaugeField", "=", 
   RowBox[{"Table", "[", 
    RowBox[{
     RowBox[{
      RowBox[{"SUPower", "[", 
       RowBox[{
        RowBox[{"gaugeField", "[", 
         RowBox[{"[", 
          RowBox[{"dir", ",", "i"}], "]"}], "]"}], ",", "0.5"}], "]"}], ".", 
      RowBox[{"MatrixExp", "[", 
       RowBox[{"I", " ", 
        RowBox[{
         RowBox[{"Take", "[", 
          RowBox[{"delta0", ",", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{"1", ",", 
              RowBox[{
               RowBox[{"nc", "^", "2"}], "-", "1"}]}], "}"}], "+", 
            RowBox[{
             RowBox[{"(", 
              RowBox[{
               RowBox[{"nc", "^", "2"}], "-", "1"}], ")"}], 
             RowBox[{"(", 
              RowBox[{
               RowBox[{"(", 
                RowBox[{"i", "-", "1"}], ")"}], "+", 
               RowBox[{
                RowBox[{"latticeVolume", "[", "]"}], 
                RowBox[{"(", 
                 RowBox[{"dir", "-", "1"}], ")"}]}]}], ")"}]}]}]}], "]"}], 
         ".", 
         RowBox[{"suGenerators", "[", "]"}]}]}], "]"}], ".", 
      RowBox[{"SUPower", "[", 
       RowBox[{
        RowBox[{"gaugeField", "[", 
         RowBox[{"[", 
          RowBox[{"dir", ",", "i"}], "]"}], "]"}], ",", "0.5"}], "]"}]}], ",", 
     RowBox[{"{", 
      RowBox[{"dir", ",", "nd"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"i", ",", 
       RowBox[{"latticeVolume", "[", "]"}]}], "}"}]}], "]"}]}], 
  ";"}]], "Input",ExpressionUUID->"2c9b144c-09d2-45ea-9200-8c373b57e80b"],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"Block", "[", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{"holdGaugeField", "=", "gaugeField"}], "}"}], ",", 
   RowBox[{
    RowBox[{"gaugeField", "=", "newGaugeField"}], ";", 
    RowBox[{"Print", "[", 
     RowBox[{"averagePlaquette", "[", "]"}], "]"}], ";", 
    RowBox[{"gaugeField", "=", "holdGaugeField"}], ";"}]}], 
  "]"}]], "Input",ExpressionUUID->"1690e331-aca5-4d27-ac1f-3d6fe387c084"],

Cell[BoxData["0.001950014944875588`"], \
"Print",ExpressionUUID->"45e6f1fd-c6e7-4a93-97b2-985f021d4707"]
}, Open  ]],

Cell["\<\
Now, compare this with the library routine (with damping factors removed) :\
\>", "Text",ExpressionUUID->"a421db17-f2aa-4f1b-9d8e-dcd0e683349f"],

Cell[BoxData[
 RowBox[{
  RowBox[{"libGaugeField", "=", 
   RowBox[{"latticeSaddlePointStep", "[", 
    RowBox[{
     RowBox[{"allLinks", "\[Rule]", "True"}], ",", 
     RowBox[{"dampingFactor", "\[Rule]", "1"}], ",", 
     RowBox[{"rescaleCutoff", "\[Rule]", "Infinity"}]}], "]"}]}], 
  ";"}]], "Input",ExpressionUUID->"bb21a4b8-fc1e-4391-81fc-df2e74cbded0"],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"Tally", "[", 
  RowBox[{"Chop", "[", 
   RowBox[{
    RowBox[{"Flatten", "[", 
     RowBox[{"newGaugeField", "-", "libGaugeField"}], "]"}], ",", 
    RowBox[{"10", "^", 
     RowBox[{"-", "7"}]}]}], "]"}], 
  "]"}]], "Input",ExpressionUUID->"59fb20cf-7605-4cad-9859-52dc1984fa83"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{"{", 
   RowBox[{"0", ",", "108"}], "}"}], 
  "}"}]], "Output",ExpressionUUID->"6c123949-bf02-455a-b687-adac2ee5bff7"]
}, Open  ]]
}, Closed]],

Cell[CellGroupData[{

Cell["\<\
nearest stationary point for entire lattice, with one direction fixed\
\>", "Subsection",ExpressionUUID->"7488ae53-c653-461c-8060-ffc37066dfb9"],

Cell["\<\
Test stationary point routine against an explicit calculation for a random \
lattice.  \
\>", "Text",ExpressionUUID->"53cff859-267a-4b0c-9cff-c0e2f2328a56"],

Cell["Create Random lattice :", \
"Text",ExpressionUUID->"cf2bdf57-7c3c-4c71-a5d9-fe9b984f3a59"],

Cell[CellGroupData[{

Cell[BoxData[{
 RowBox[{
  RowBox[{"nd", "=", "3"}], ";", 
  RowBox[{"nc", "=", "2"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"latticeDimensions", "=", 
   RowBox[{"{", 
    RowBox[{"2", ",", "3", ",", "2"}], "}"}]}], ";", 
  RowBox[{"gaugeField", "=", 
   RowBox[{"Table", "[", 
    RowBox[{
     RowBox[{"randomSUMatrix", "[", "]"}], ",", 
     RowBox[{"{", "nd", "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"latticeVolume", "[", "]"}], "}"}]}], "]"}]}], ";", 
  RowBox[{"Clear", "[", "linearSiteIndex", "]"}], ";", 
  RowBox[{"Do", "[", 
   RowBox[{
    RowBox[{
     RowBox[{"linearSiteIndex", "[", 
      RowBox[{"latticeCoordinates", "[", "i", "]"}], "]"}], "=", "i"}], ",", 
    RowBox[{"{", 
     RowBox[{"i", ",", 
      RowBox[{"latticeVolume", "[", "]"}]}], "}"}]}], "]"}], ";", 
  RowBox[{
  "averagePlaquette", "[", 
   "]"}]}]}], "Input",ExpressionUUID->"3d8225aa-c2e6-4ed9-a9a8-ffe745843f33"],

Cell[BoxData["0.036904797353804426`"], \
"Output",ExpressionUUID->"441f0f38-1d7c-4bff-91a0-e980e9d618b1"]
}, Open  ]],

Cell[BoxData[
 RowBox[{
  RowBox[{"Clear", "[", "bb", "]"}], ";", 
  RowBox[{
   RowBox[{"bVector", "[", 
    RowBox[{"dir_", ",", "site_"}], "]"}], ":=", 
   RowBox[{"(", 
    RowBox[{
     RowBox[{"Table", "[", 
      RowBox[{
       RowBox[{"bb", "[", 
        RowBox[{"dir", ",", "site", ",", "i"}], "]"}], ",", 
       RowBox[{"{", 
        RowBox[{"i", ",", 
         RowBox[{
          RowBox[{"nc", "^", "2"}], "-", "1"}]}], "}"}]}], "]"}], ".", 
     RowBox[{"suGenerators", "[", "]"}]}], 
    ")"}]}]}]], \
"Input",ExpressionUUID->"d4273d7d-f6c1-4265-b886-18147aa9cee8"],

Cell["\<\
Constant links in one direction.  Create links with second order perturbation:\
\>", "Text",ExpressionUUID->"439e169e-8612-4bb3-be4f-804315f6de50"],

Cell[BoxData[
 RowBox[{
  RowBox[{"fDir", "=", "2"}], ";", 
  RowBox[{"uu", "=", "gaugeField"}], ";", 
  RowBox[{"Table", "[", 
   RowBox[{
    RowBox[{"Block", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
        RowBox[{"coords", "=", 
         RowBox[{"latticeCoordinates", "[", "i", "]"}]}], ",", "c2"}], "}"}], 
      ",", 
      RowBox[{
       RowBox[{"c2", "=", "coords"}], ";", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"dir", "\[Equal]", "fDir"}], ",", 
         RowBox[{
          RowBox[{"c2", "[", 
           RowBox[{"[", "fDir", "]"}], "]"}], "=", "1"}]}], "]"}], ";", 
       RowBox[{
        RowBox[{"uu", "[", 
         RowBox[{"[", 
          RowBox[{"dir", ",", 
           RowBox[{"linearSiteIndex", "[", "coords", "]"}]}], "]"}], "]"}], 
        "=", 
        RowBox[{"Simplify", "[", 
         RowBox[{
          RowBox[{"SUPower", "[", 
           RowBox[{
            RowBox[{"getLink", "[", 
             RowBox[{"dir", ",", "coords"}], "]"}], ",", "0.5"}], "]"}], ".", 
          
          RowBox[{"(", 
           RowBox[{
            RowBox[{"IdentityMatrix", "[", "nc", "]"}], "+", 
            RowBox[{"I", " ", 
             RowBox[{"bVector", "[", 
              RowBox[{"dir", ",", "c2"}], "]"}]}], "-", 
            RowBox[{
             RowBox[{
              RowBox[{"bVector", "[", 
               RowBox[{"dir", ",", "c2"}], "]"}], ".", 
              RowBox[{"bVector", "[", 
               RowBox[{"dir", ",", "c2"}], "]"}]}], "/", 
             RowBox[{"2", "!"}]}]}], ")"}], ".", 
          RowBox[{"SUPower", "[", 
           RowBox[{
            RowBox[{"getLink", "[", 
             RowBox[{"dir", ",", "coords"}], "]"}], ",", "0.5"}], "]"}]}], 
         "]"}]}]}]}], "]"}], ",", 
    RowBox[{"{", 
     RowBox[{"dir", ",", "nd"}], "}"}], ",", 
    RowBox[{"{", 
     RowBox[{"i", ",", 
      RowBox[{"latticeVolume", "[", "]"}]}], "}"}]}], "]"}], 
  ";"}]], "Input",ExpressionUUID->"3767a97d-4a7a-4872-bf9f-7375b534cada"],

Cell["Sum of plaquettes, not taking the real part:", \
"Text",ExpressionUUID->"fb7c66f3-7f20-47a1-9789-07dfbe6ad072"],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{
  RowBox[{"rp", "=", 
   RowBox[{"Sum", "[", 
    RowBox[{
     RowBox[{
      RowBox[{"Block", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"coords", "=", 
          RowBox[{"latticeCoordinates", "[", "i", "]"}]}], "}"}], ",", 
        RowBox[{"Tr", "[", 
         RowBox[{
          RowBox[{"uu", "[", 
           RowBox[{"[", 
            RowBox[{"k1", ",", 
             RowBox[{"linearSiteIndex", "[", "coords", "]"}]}], "]"}], "]"}], 
          ".", 
          RowBox[{"uu", "[", 
           RowBox[{"[", 
            RowBox[{"k2", ",", 
             RowBox[{"linearSiteIndex", "[", 
              RowBox[{"shift", "[", 
               RowBox[{"k1", ",", "coords"}], "]"}], "]"}]}], "]"}], "]"}], 
          ".", 
          RowBox[{"ConjugateTranspose", "[", 
           RowBox[{"uu", "[", 
            RowBox[{"[", 
             RowBox[{"k1", ",", 
              RowBox[{"linearSiteIndex", "[", 
               RowBox[{"shift", "[", 
                RowBox[{"k2", ",", "coords"}], "]"}], "]"}]}], "]"}], "]"}], 
           "]"}], ".", 
          RowBox[{"ConjugateTranspose", "[", 
           RowBox[{"uu", "[", 
            RowBox[{"[", 
             RowBox[{"k2", ",", 
              RowBox[{"linearSiteIndex", "[", "coords", "]"}]}], "]"}], "]"}],
            "]"}]}], "]"}]}], "]"}], "//.", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{
         RowBox[{"Conjugate", "[", 
          RowBox[{"a_", " ", "b_"}], "]"}], "\[Rule]", 
         RowBox[{
          RowBox[{"Conjugate", "[", "a", "]"}], 
          RowBox[{"Conjugate", "[", "b", "]"}]}]}], ",", 
        RowBox[{
         RowBox[{"Conjugate", "[", 
          RowBox[{"a_", "+", "b_"}], "]"}], "\[Rule]", 
         RowBox[{
          RowBox[{"Conjugate", "[", "a", "]"}], "+", 
          RowBox[{"Conjugate", "[", "b", "]"}]}]}], ",", 
        RowBox[{
         RowBox[{"Conjugate", "[", 
          RowBox[{"bb", "[", "a__", "]"}], "]"}], "\[Rule]", 
         RowBox[{"bb", "[", "a", "]"}]}]}], "}"}]}], ",", 
     RowBox[{"{", 
      RowBox[{"k1", ",", 
       RowBox[{"nd", "-", "1"}]}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"k2", ",", 
       RowBox[{"k1", "+", "1"}], ",", "nd"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"i", ",", 
       RowBox[{"latticeVolume", "[", "]"}]}], "}"}]}], "]"}]}], ";", 
  RowBox[{"(*", " ", 
   RowBox[{
   "Average", " ", "plaquette", " ", "should", " ", "be", " ", "same", " ", 
    "as", " ", 
    RowBox[{"above", "."}]}], " ", "*)"}], 
  RowBox[{
   RowBox[{"2", "/", 
    RowBox[{"(", 
     RowBox[{"nc", " ", "nd", " ", 
      RowBox[{"(", 
       RowBox[{"nd", "-", "1"}], ")"}], " ", 
      RowBox[{"latticeVolume", "[", "]"}]}], ")"}]}], " ", 
   RowBox[{"Re", "[", 
    RowBox[{"rp", "/.", 
     RowBox[{
      RowBox[{"bb", "[", "__", "]"}], "\[Rule]", "0"}]}], 
    "]"}]}]}]], \
"Input",ExpressionUUID->"e167286e-7029-4a2a-a16c-904649391f1f"],

Cell[BoxData["0.03690479735380441`"], \
"Output",ExpressionUUID->"11f45736-b6d1-4a36-8418-51ba77f9582d"]
}, Open  ]],

Cell["Calculate gradient and Hessian at bb[dir,i,k] = 0.", \
"Text",ExpressionUUID->"e92bc5b4-e610-42a5-9a37-4354d4b6c26e"],

Cell[BoxData[
 RowBox[{
  RowBox[{"Clear", "[", "gradMap", "]"}], ";", 
  RowBox[{"gradient0", "=", 
   RowBox[{"Block", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"dims0", "=", "latticeDimensions"}], ",", 
       RowBox[{"gi", "=", "1"}]}], "}"}], ",", 
     RowBox[{
      RowBox[{
       RowBox[{"dims0", "[", 
        RowBox[{"[", "fDir", "]"}], "]"}], "=", "1"}], ";", 
      RowBox[{"Flatten", "[", 
       RowBox[{"Table", "[", 
        RowBox[{
         RowBox[{"Block", "[", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"coords", "=", 
             RowBox[{"latticeCoordinates", "[", 
              RowBox[{"i", ",", 
               RowBox[{"If", "[", 
                RowBox[{
                 RowBox[{"dir", "\[Equal]", "fDir"}], ",", "dims0", ",", 
                 "latticeDimensions"}], "]"}]}], "]"}]}], "}"}], ",", 
           RowBox[{
            RowBox[{"If", "[", 
             RowBox[{
              RowBox[{"k", "\[Equal]", "1"}], ",", 
              RowBox[{
               RowBox[{"gradMap", "[", 
                RowBox[{"dir", ",", "coords"}], "]"}], "=", "gi"}]}], "]"}], 
            ";", 
            RowBox[{"gi", "+=", "1"}], ";", 
            RowBox[{
             RowBox[{"Re", "[", 
              RowBox[{"D", "[", 
               RowBox[{"rp", ",", 
                RowBox[{"bb", "[", 
                 RowBox[{"dir", ",", "coords", ",", "k"}], "]"}]}], "]"}], 
              "]"}], "/.", 
             RowBox[{
              RowBox[{"bb", "[", "__", "]"}], "\[Rule]", "0"}]}]}]}], "]"}], 
         ",", 
         RowBox[{"{", 
          RowBox[{"dir", ",", "nd"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"i", ",", 
           RowBox[{"latticeVolume", "[", 
            RowBox[{"If", "[", 
             RowBox[{
              RowBox[{"dir", "\[Equal]", "fDir"}], ",", "dims0", ",", 
              "latticeDimensions"}], "]"}], "]"}]}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"k", ",", 
           RowBox[{
            RowBox[{"nc", "^", "2"}], "-", "1"}]}], "}"}]}], "]"}], "]"}]}]}],
     "]"}]}]}]], \
"Input",ExpressionUUID->"36918714-3487-4547-af12-1a73fd867755"],

Cell["\<\
For parallelization, I had to go to menu Evaluation->Parallel Kernel \
Configuration and set the number manually.  Automatic launching of additional \
kernels is broken?  Note that the parallelization is based on the leading \
dimension of the table.
Verify parallel kernels are running:\
\>", "Text",ExpressionUUID->"7e2b0662-20aa-44ba-85a6-de52c24d4760"],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"ParallelEvaluate", "[", "$ProcessID", 
  "]"}]], "Input",ExpressionUUID->"60a5f1d4-ba7e-421b-8a7f-ada56983707a"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
  "22937", ",", "22939", ",", "22950", ",", "22979", ",", "23010", ",", 
   "23052"}], 
  "}"}]], "Output",ExpressionUUID->"ccabcf40-10ad-4196-90d1-8ccb06b33af8"]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"Dimensions", "[", 
  RowBox[{"hess0", "=", 
   RowBox[{"Block", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"dims", "=", "latticeDimensions"}], "}"}], ",", 
     RowBox[{
      RowBox[{
       RowBox[{"dims", "[", 
        RowBox[{"[", "fDir", "]"}], "]"}], "=", "1"}], ";", 
      RowBox[{"Flatten", "[", 
       RowBox[{
        RowBox[{"ParallelTable", "[", 
         RowBox[{
          RowBox[{"Re", "[", 
           RowBox[{
            RowBox[{"D", "[", 
             RowBox[{"rp", ",", 
              RowBox[{"bb", "[", 
               RowBox[{"dir1", ",", 
                RowBox[{"latticeCoordinates", "[", 
                 RowBox[{"i1", ",", 
                  RowBox[{"If", "[", 
                   RowBox[{
                    RowBox[{"dir1", "\[Equal]", "fDir"}], ",", "dims", ",", 
                    "latticeDimensions"}], "]"}]}], "]"}], ",", "k1"}], "]"}],
               ",", 
              RowBox[{"bb", "[", 
               RowBox[{"dir2", ",", 
                RowBox[{"latticeCoordinates", "[", 
                 RowBox[{"i2", ",", 
                  RowBox[{"If", "[", 
                   RowBox[{
                    RowBox[{"dir2", "\[Equal]", "fDir"}], ",", "dims", ",", 
                    "latticeDimensions"}], "]"}]}], "]"}], ",", "k2"}], 
               "]"}]}], "]"}], "/.", 
            RowBox[{
             RowBox[{"bb", "[", "__", "]"}], "\[Rule]", "0"}]}], "]"}], ",", 
          RowBox[{"{", 
           RowBox[{"dir1", ",", "nd"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"i1", ",", 
            RowBox[{"latticeVolume", "[", 
             RowBox[{"If", "[", 
              RowBox[{
               RowBox[{"dir1", "\[Equal]", "fDir"}], ",", "dims", ",", 
               "latticeDimensions"}], "]"}], "]"}]}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"k1", ",", 
            RowBox[{
             RowBox[{"nc", "^", "2"}], "-", "1"}]}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"dir2", ",", "nd"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"i2", ",", 
            RowBox[{"latticeVolume", "[", " ", 
             RowBox[{"If", "[", 
              RowBox[{
               RowBox[{"dir2", "\[Equal]", "fDir"}], ",", "dims", ",", 
               "latticeDimensions"}], "]"}], "]"}]}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"k2", ",", 
            RowBox[{
             RowBox[{"nc", "^", "2"}], "-", "1"}]}], "}"}]}], "]"}], ",", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"1", ",", "2", ",", "3"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"4", ",", "5", ",", "6"}], "}"}]}], "}"}]}], "]"}]}]}], 
    "]"}]}], "]"}]], \
"Input",ExpressionUUID->"0f2c0ae2-c2cd-4e5e-8922-0f6570ec1f29"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{"84", ",", "84"}], 
  "}"}]], "Output",ExpressionUUID->"6622ad18-eb85-4328-b476-1f101fb9a39d"]
}, Open  ]],

Cell["Find the saddle point.", \
"Text",ExpressionUUID->"bdca05dc-cccc-4eaf-b14f-90862ec4f122"],

Cell[BoxData[
 RowBox[{"delta0", "=", 
  RowBox[{"-", 
   RowBox[{"LinearSolve", "[", 
    RowBox[{"hess0", ",", "gradient0"}], 
    "]"}]}]}]], \
"Input",ExpressionUUID->"bf54baa5-c392-4de0-b84d-5ecb84731673"],

Cell["Equivalently, find the saddle point using the eigensystem.", \
"Text",ExpressionUUID->"edbe454f-3f25-4eee-8532-191372595511"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"{", 
    RowBox[{"vals", ",", "oo"}], "}"}], "=", 
   RowBox[{"Eigensystem", "[", "hess0", "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{"delta0", "=", 
  RowBox[{
   RowBox[{"(", 
    RowBox[{
     RowBox[{"-", 
      RowBox[{"oo", ".", "gradient0"}]}], "/", "vals"}], ")"}], ".", 
   "oo"}]}]}], "Input",ExpressionUUID->"2df2cc01-ab7d-4fef-853d-4ee96891a38f"],

Cell["Substitute shift back into links :", \
"Text",ExpressionUUID->"9f9b67e7-1c11-4fdd-9a7f-59cbe052736b"],

Cell[BoxData[
 RowBox[{
  RowBox[{"newGaugeField", "=", "gaugeField"}], ";", 
  RowBox[{"Do", "[", 
   RowBox[{
    RowBox[{"Block", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
        RowBox[{"coords", "=", 
         RowBox[{"latticeCoordinates", "[", "i", "]"}]}], ",", 
        RowBox[{"dims", "=", "latticeDimensions"}], ",", "c2"}], "}"}], ",", 
      RowBox[{
       RowBox[{"c2", "=", "coords"}], ";", 
       RowBox[{
        RowBox[{"c2", "[", 
         RowBox[{"[", "fDir", "]"}], "]"}], "=", "1"}], ";", 
       RowBox[{
        RowBox[{"dims", "[", 
         RowBox[{"[", "fDir", "]"}], "]"}], "=", "1"}], ";", 
       RowBox[{
        RowBox[{"newGaugeField", "[", 
         RowBox[{"[", 
          RowBox[{"dir", ",", 
           RowBox[{"linearSiteIndex", "[", "coords", "]"}]}], "]"}], "]"}], 
        "=", 
        RowBox[{
         RowBox[{"SUPower", "[", 
          RowBox[{
           RowBox[{"getLink", "[", 
            RowBox[{"dir", ",", "coords"}], "]"}], ",", "0.5"}], "]"}], ".", 
         RowBox[{"MatrixExp", "[", 
          RowBox[{"I", " ", 
           RowBox[{
            RowBox[{"Take", "[", 
             RowBox[{"delta0", ",", 
              RowBox[{
               RowBox[{"{", 
                RowBox[{"1", ",", 
                 RowBox[{
                  RowBox[{"nc", "^", "2"}], "-", "1"}]}], "}"}], "-", "1", 
               "+", 
               RowBox[{"gradMap", "[", 
                RowBox[{"dir", ",", 
                 RowBox[{"If", "[", 
                  RowBox[{
                   RowBox[{"dir", "\[Equal]", "fDir"}], ",", "c2", ",", 
                   "coords"}], "]"}]}], "]"}]}]}], "]"}], ".", 
            RowBox[{"suGenerators", "[", "]"}]}]}], "]"}], ".", 
         RowBox[{"SUPower", "[", 
          RowBox[{
           RowBox[{"getLink", "[", 
            RowBox[{"dir", ",", "coords"}], "]"}], ",", "0.5"}], 
          "]"}]}]}]}]}], "]"}], ",", 
    RowBox[{"{", 
     RowBox[{"dir", ",", "nd"}], "}"}], ",", 
    RowBox[{"{", 
     RowBox[{"i", ",", 
      RowBox[{"latticeVolume", "[", "]"}]}], "}"}]}], "]"}], 
  ";"}]], "Input",ExpressionUUID->"8c6d2a69-85ca-4c70-b329-6827e40b8033"],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"Block", "[", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{"holdGaugeField", "=", "gaugeField"}], "}"}], ",", 
   RowBox[{
    RowBox[{"gaugeField", "=", "newGaugeField"}], ";", 
    RowBox[{"Print", "[", 
     RowBox[{"averagePlaquette", "[", "]"}], "]"}], ";", 
    RowBox[{"gaugeField", "=", "holdGaugeField"}], ";"}]}], 
  "]"}]], "Input",ExpressionUUID->"d007488d-d77a-471c-a61d-3158f6c24920"],

Cell[BoxData["0.02789710851410394`"], \
"Print",ExpressionUUID->"97aa2737-6b28-451a-85ef-584732e097ab"]
}, Open  ]],

Cell["\<\
Now, compare this with the library routine (with damping factors removed) :\
\>", "Text",ExpressionUUID->"1d172010-d31e-4a95-a770-d576bef05198"],

Cell[BoxData[
 RowBox[{
  RowBox[{"libGaugeField", "=", 
   RowBox[{"latticeSaddlePointStep", "[", 
    RowBox[{
     RowBox[{"fixedDir", "\[Rule]", "fDir"}], ",", 
     RowBox[{"allLinks", "\[Rule]", "True"}], ",", 
     RowBox[{"dampingFactor", "\[Rule]", "1"}], ",", 
     RowBox[{"rescaleCutoff", "\[Rule]", "Infinity"}]}], "]"}]}], 
  ";"}]], "Input",ExpressionUUID->"d761167c-33b7-41ba-b29c-3f6347d5d0a2"],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"Tally", "[", 
  RowBox[{"Chop", "[", 
   RowBox[{"Flatten", "[", 
    RowBox[{"newGaugeField", "-", "libGaugeField"}], "]"}], "]"}], 
  "]"}]], "Input",ExpressionUUID->"a2490951-9990-44cf-b96f-1ec13e7f56d4"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{"{", 
   RowBox[{"0", ",", "144"}], "}"}], 
  "}"}]], "Output",ExpressionUUID->"04c19d52-9411-43bb-9b58-690f99b120ff"]
}, Open  ]]
}, Closed]],

Cell[CellGroupData[{

Cell["Compare the mean plaquette against Teper\[CloseCurlyQuote]s results", \
"Subsection",ExpressionUUID->"0e3721d3-9f9f-4aec-8b17-a0e0b5a6136f"],

Cell["\"w_plaq\" is average of all plaquettes.", \
"Text",ExpressionUUID->"ef9662a6-3428-44ce-9551-657dce9923b3"],

Cell[BoxData[
 RowBox[{
  RowBox[{"expr", "=", 
   RowBox[{
   "Import", "[", "\"\<../data/3-4/periodic-16-28-out.xml\>\"", "]"}]}], 
  ";"}]], "Input",ExpressionUUID->"93e6aeaa-35d6-415a-a5b1-2a02a3b5d13b"],

Cell[BoxData[
 RowBox[{
  RowBox[{"expr", "=", 
   RowBox[{
   "Import", "[", "\"\<../data/3-4/periodic-16-33-out.xml\>\"", "]"}]}], 
  ";"}]], "Input",ExpressionUUID->"45f1a60c-af24-4ccf-a0a9-aec69bcc0a8a"],

Cell[BoxData[
 RowBox[{
  RowBox[{"expr", "=", 
   RowBox[{
   "Import", "[", "\"\<../data/3-3/periodic-24-21-out.xml\>\"", "]"}]}], 
  ";"}]], "Input",ExpressionUUID->"c12afa4a-e383-4a2b-acfd-02a84aebe344"],

Cell["\<\
Pull out the average plaquette from the production lattice updates.\
\>", "Text",ExpressionUUID->"305c15a3-7e7c-4b48-ab43-e2dc8c22f5e5"],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"Length", "[", 
  RowBox[{"wp", "=", 
   RowBox[{"Flatten", "[", 
    RowBox[{"xmlFilter", "[", 
     RowBox[{
      RowBox[{"expr", "[", 
       RowBox[{"[", "2", "]"}], "]"}], ",", 
      RowBox[{"{", 
       RowBox[{
       "\"\<purgaug\>\"", ",", "\"\<doHB\>\"", ",", "\"\<MCUpdates\>\"", ",", 
        "\"\<elem\>\"", ",", "\"\<Update\>\"", ",", 
        "\"\<InlineObservables\>\"", ",", "\"\<elem\>\"", ",", 
        "\"\<Plaquette\>\"", ",", "\"\<w_plaq\>\""}], "}"}]}], "]"}], "]"}]}],
   "]"}]], "Input",ExpressionUUID->"ba8f4f67-3074-4dd8-ab48-9be37129ddd0"],

Cell[BoxData["80000"], \
"Output",ExpressionUUID->"575cfba2-7cce-4952-abbc-fe274cec0e69"]
}, Open  ]],

Cell["\<\
Mean and standard error, ignoring autocorrelations.  
For SU(4), 2+1 dimensions, L=16^3 lattice, beta=28 abd 33, the average \
plaquette values match Teper\[CloseCurlyQuote]s result.  See \
arXiv:hep-lat/0206027v1 24 Jun 2002.\
\>", "Text",ExpressionUUID->"14a1ebbf-69e7-46dd-953d-62dca914e78d"],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   RowBox[{"Mean", "[", "wp", "]"}], ",", 
   RowBox[{
    RowBox[{"StandardDeviation", "[", "wp", "]"}], "/", 
    RowBox[{"Sqrt", "[", 
     RowBox[{"Length", "[", "wp", "]"}], "]"}]}]}], 
  "}"}]], "Input",ExpressionUUID->"bb541a45-0edc-4f89-a74e-93d177e29aa1"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{"0.8676694244789538`", ",", "1.40560374756656`*^-6"}], 
  "}"}]], "Output",ExpressionUUID->"f60cbba9-6532-4889-95ee-2d2c8051f0a4"]
}, Open  ]],

Cell["\<\
What is the effect of autocorrelations on the error estimate?  Using \
https://en.wikipedia.org/wiki/Unbiased_estimation_of_standard_deviation
Find a model for the autocorrelation function (ACF), fitting to an \
exponential:\
\>", "Text",ExpressionUUID->"690ba936-9f6d-46ea-ab01-8d5adf0820e4"],

Cell[BoxData[
 RowBox[{
  RowBox[{"data", "=", 
   RowBox[{"Block", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"cutoff", "=", "20"}], "}"}], ",", 
     RowBox[{"Transpose", "[", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"Table", "[", 
         RowBox[{"k", ",", 
          RowBox[{"{", 
           RowBox[{"k", ",", "0", ",", "cutoff"}], "}"}]}], "]"}], ",", 
        RowBox[{"Log", "[", 
         RowBox[{"CorrelationFunction", "[", 
          RowBox[{"wp", ",", 
           RowBox[{"{", "cutoff", "}"}]}], "]"}], "]"}]}], "}"}], "]"}]}], 
    "]"}]}], ";"}]], \
"Input",ExpressionUUID->"e46d7efd-f26c-49cb-9f83-eefcf3a7baee"],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"ff", "=", 
  RowBox[{"Fit", "[", 
   RowBox[{
    RowBox[{"Take", "[", 
     RowBox[{"data", ",", "5"}], "]"}], ",", 
    RowBox[{"{", "x", "}"}], ",", "x"}], 
   "]"}]}]], "Input",ExpressionUUID->"502f87f3-c302-4b7a-9fac-dce132715663"],

Cell[BoxData[
 RowBox[{
  RowBox[{"-", "0.2872905383680901`"}], " ", 
  "x"}]], "Output",ExpressionUUID->"5bbf9817-15d1-45c2-af5f-c95547e2131d"]
}, Open  ]],

Cell[BoxData[
 RowBox[{"Show", "[", 
  RowBox[{
   RowBox[{"ListPlot", "[", 
    RowBox[{"data", ",", 
     RowBox[{"PlotRange", "\[Rule]", "All"}]}], "]"}], ",", 
   RowBox[{"Plot", "[", 
    RowBox[{"ff", ",", 
     RowBox[{"{", 
      RowBox[{"x", ",", "0", ",", "20"}], "}"}]}], "]"}]}], 
  "]"}]], "Input",ExpressionUUID->"0a7c8018-a533-4964-af3f-4f49342775dc"],

Cell["\<\
From the Wikipedia article, the correction to the standard error is \
Sqrt[gamma2/gamma1], where :\
\>", "Text",ExpressionUUID->"0e87aa9a-e980-43af-8632-cd793257c02e"],

Cell[BoxData[
 RowBox[{
  RowBox[{"gamma1", "[", "n_", "]"}], ":=", 
  RowBox[{"1", "-", 
   RowBox[{
    RowBox[{"2", "/", 
     RowBox[{"(", 
      RowBox[{"n", "-", "1"}], ")"}]}], " ", 
    RowBox[{"Sum", "[", 
     RowBox[{
      RowBox[{
       RowBox[{"(", 
        RowBox[{"1", "-", 
         RowBox[{"x", "/", "n"}]}], ")"}], " ", 
       RowBox[{"Exp", "[", "ff", "]"}]}], ",", 
      RowBox[{"{", 
       RowBox[{"x", ",", "1", ",", 
        RowBox[{"n", "-", "1"}]}], "}"}]}], 
     "]"}]}]}]}]], \
"Input",ExpressionUUID->"f8aa7823-a8c9-40da-95b3-6a5cc997ff6e"],

Cell[BoxData[
 RowBox[{
  RowBox[{"gamma2", "[", "n_", "]"}], ":=", 
  RowBox[{"1", "+", 
   RowBox[{"2", " ", 
    RowBox[{"Sum", "[", 
     RowBox[{
      RowBox[{
       RowBox[{"(", 
        RowBox[{"1", "-", 
         RowBox[{"x", "/", "n"}]}], ")"}], " ", 
       RowBox[{"Exp", "[", "ff", "]"}]}], ",", 
      RowBox[{"{", 
       RowBox[{"x", ",", "1", ",", 
        RowBox[{"n", "-", "1"}]}], "}"}]}], 
     "]"}]}]}]}]], \
"Input",ExpressionUUID->"eee091d7-c009-48ab-9225-64b5ad597bf6"],

Cell["Since n is large, look at leading order in n :", \
"Text",ExpressionUUID->"ac25176b-3a8b-41fe-b9d2-4acd5856e68a"],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   RowBox[{"gamma1", "[", "Infinity", "]"}], ",", 
   RowBox[{"gamma2", "[", "Infinity", "]"}]}], 
  "}"}]], "Input",ExpressionUUID->"900f3d2c-1a30-4aff-a3be-1993cc8be3bc"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{"1.`", ",", "7.009409712669671`"}], 
  "}"}]], "Output",ExpressionUUID->"0b454090-0913-44be-9c71-cc762c74e3c6"]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"2", "/", 
    RowBox[{"(", 
     RowBox[{"1", "-", 
      RowBox[{"Exp", "[", "ff", "]"}]}], ")"}]}], "-", "1"}], "/.", 
  RowBox[{
  "x", "\[Rule]", 
   "1"}]}]], "Input",ExpressionUUID->"f04096b5-7675-497b-bbfb-d91a959e30e3"],

Cell[BoxData["7.009409712669671`"], \
"Output",ExpressionUUID->"c6631b84-3251-413d-a356-6f4ab030b36b"]
}, Open  ]],

Cell["\<\
There is a modest impact on the standard error, with the error estimate now \
matching Teper\[CloseCurlyQuote]s error estimate.  Good agreement for both \
SU(3) and SU(4).\
\>", "Text",ExpressionUUID->"b0145318-b479-46c8-9602-f7fef270df58"],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   RowBox[{"Mean", "[", "wp", "]"}], ",", 
   RowBox[{
    RowBox[{"StandardDeviation", "[", "wp", "]"}], " ", 
    RowBox[{"Sqrt", "[", 
     RowBox[{
      RowBox[{"gamma2", "[", "Infinity", "]"}], "/", 
      RowBox[{"Length", "[", "wp", "]"}]}], "]"}]}]}], 
  "}"}]], "Input",ExpressionUUID->"4f7f5246-cce3-47d4-ad8f-4cbff69cdfd2"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{"0.8676694244789538`", ",", "3.7213766594582798`*^-6"}], 
  "}"}]], "Output",ExpressionUUID->"caea97e0-b0b7-42ee-acae-a43e291e2503"]
}, Open  ]]
}, Closed]],

Cell[CellGroupData[{

Cell["Compare Mathematica mean plaquette against chroma value", \
"Subsection",ExpressionUUID->"db6b05b7-f32b-4370-830f-2b6b5568a3d5"],

Cell["Compare with chroma output xml file.", \
"Text",ExpressionUUID->"7c132b3f-122b-45cc-a5dd-3ffd3d76bc32"],

Cell["These should match plane_ij_plaq.", \
"Text",ExpressionUUID->"105aa520-26e2-4a1f-9417-f76de34ac5b1"],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"InputForm", "[", 
  RowBox[{"Table", "[", 
   RowBox[{
    RowBox[{"If", "[", 
     RowBox[{
      RowBox[{"dir1", "<", "dir2"}], ",", 
      RowBox[{"Mean", "[", 
       RowBox[{"Table", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"plaquette", "[", 
           RowBox[{"dir1", ",", "dir2", ",", 
            RowBox[{"latticeCoordinates", "[", "i", "]"}]}], "]"}], "/", 
          "nc"}], ",", 
         RowBox[{"{", 
          RowBox[{"i", ",", 
           RowBox[{"latticeVolume", "[", "]"}]}], "}"}]}], "]"}], "]"}]}], 
     "]"}], ",", 
    RowBox[{"{", 
     RowBox[{"dir1", ",", "2"}], "}"}], ",", 
    RowBox[{"{", 
     RowBox[{"dir2", ",", 
      RowBox[{"dir1", "+", "1"}], ",", "3"}], "}"}]}], "]"}], 
  "]"}]], "Input",ExpressionUUID->"e21f9cc0-fe49-4ac7-ba6c-fc60929455b8"],

Cell["\<\
{{0.9424840512244733, 0.9432405719201301}, {0.9357560701712518}}\
\>", "Output",ExpressionUUID->"90541cc5-753b-49fd-bfe8-07da657edf9a"]
}, Open  ]],

Cell["This should match w_plaq", \
"Text",ExpressionUUID->"e666013d-2675-4a31-a4b3-503d1fc3d9fa"],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"InputForm", "[", 
  RowBox[{"Mean", "[", 
   RowBox[{"Flatten", "[", "%", "]"}], "]"}], 
  "]"}]], "Input",ExpressionUUID->"26445f14-cdf2-4582-ae8b-059b29f9ced8"],

Cell["0.9404935644386184", \
"Output",ExpressionUUID->"fb7019cb-6ae1-427b-88c9-d1e32f9ef256"]
}, Open  ]]
}, Closed]],

Cell[CellGroupData[{

Cell["link stationary point", \
"Subsection",ExpressionUUID->"a340fe97-3268-41ca-884e-a8cc3a02c3f4"],

Cell["\<\
Test single-link stationary point against the lattice-wide stationary point \
by including only single-link gradients.
Find agreement for single site and multiple -site lattices for SU(2), SU(3), \
and SU(4).

The Hessian matrix is block-diagonal in the lattice links.  However, in the \
case of the full lattice derivative, the eigenvectors may not be, if there \
are degenerate eigenvalues.  In that case, the rescaled shifts may be \
different for the full lattice.  This issue goes away if we remove the \
rescaling. \
\>", "Text",ExpressionUUID->"bbc3ad06-f586-438e-9458-4a077d6de427"],

Cell["Create random lattice :", \
"Text",ExpressionUUID->"ad1a844b-dd1b-4b54-a7c5-ce87c007ff82"],

Cell[BoxData[
 RowBox[{
  RowBox[{"nd", "=", "3"}], ";", 
  RowBox[{"nc", "=", "3"}], ";", 
  RowBox[{"latticeDimensions", "=", 
   RowBox[{"{", 
    RowBox[{"2", ",", "2", ",", "3"}], "}"}]}], ";", 
  RowBox[{"gaugeField", "=", 
   RowBox[{"Table", "[", 
    RowBox[{
     RowBox[{"randomSUMatrix", "[", "]"}], ",", 
     RowBox[{"{", "nd", "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"latticeVolume", "[", "]"}], "}"}]}], "]"}]}], ";", 
  RowBox[{"Clear", "[", "linearSiteIndex", "]"}], ";", 
  RowBox[{"Do", "[", 
   RowBox[{
    RowBox[{
     RowBox[{"linearSiteIndex", "[", 
      RowBox[{"latticeCoordinates", "[", "i", "]"}], "]"}], "=", "i"}], ",", 
    RowBox[{"{", 
     RowBox[{"i", ",", 
      RowBox[{"latticeVolume", "[", "]"}]}], "}"}]}], "]"}], 
  ";"}]], "Input",ExpressionUUID->"7fc4b45f-9a5f-4b6d-b4c2-bb15da3f9f67"],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"{", 
    RowBox[{"newGaugeField", ",", "stats"}], "}"}], "=", 
   RowBox[{"latticeSaddlePoint", "[", 
    RowBox[{
     RowBox[{"maxCount", "->", "1"}], ",", 
     RowBox[{"updateGaugeField", "\[Rule]", "False"}], ",", 
     RowBox[{"makeHess0", "\[Rule]", "True"}], ",", 
     RowBox[{"rescaleCutoff", "\[Rule]", "Infinity"}]}], "]"}]}], 
  ";"}]], "Input",ExpressionUUID->"e9458e63-299c-4dd3-91dd-57684916541b"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{"0", ",", "57.535795641577266`", ",", 
   RowBox[{"-", "0.024842154495235327`"}]}], 
  "}"}]], "Print",ExpressionUUID->"522364f3-be7b-407a-b736-471cf72a3826"]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"Dimensions", "[", 
  RowBox[{"libGaugeField", "=", 
   RowBox[{"latticeSaddlePointStep", "[", 
    RowBox[{
     RowBox[{"allLinks", "\[Rule]", "False"}], ",", 
     RowBox[{"rescaleCutoff", "\[Rule]", "Infinity"}]}], "]"}]}], 
  "]"}]], "Input",ExpressionUUID->"70d4bdc7-d271-44c7-8f5b-f43662618b83"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{"3", ",", "12", ",", "3", ",", "3"}], 
  "}"}]], "Output",ExpressionUUID->"5cc201bc-2e1c-4686-baac-c8fb8963fc43"]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"Tally", "[", 
  RowBox[{"Chop", "[", 
   RowBox[{"Flatten", "[", 
    RowBox[{"libGaugeField", "-", "newGaugeField"}], "]"}], "]"}], 
  "]"}]], "Input",ExpressionUUID->"97e2b4e1-114d-4411-b8c0-7919ce39e626"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{"{", 
   RowBox[{"0", ",", "324"}], "}"}], 
  "}"}]], "Output",ExpressionUUID->"adccbfa2-0c3a-4c05-b311-d1cd9e64c699"]
}, Open  ]]
}, Closed]]
}, Open  ]],

Cell[CellGroupData[{

Cell["Analysis", \
"Section",ExpressionUUID->"50804d34-6d5e-48ed-a79f-38a4d1e745cf"],

Cell[CellGroupData[{

Cell["Identity staple example, SU(3)", \
"Subsection",ExpressionUUID->"f4464fcb-ed0c-431c-b4f5-227baa261730"],

Cell["\<\
Special case where the sum of staples is proportional to the identity matrix.\
\
\>", "Text",ExpressionUUID->"7bd7c1f1-f796-4265-82ea-6a8e126860aa"],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"diagValue", "=", 
  RowBox[{
   RowBox[{"Cos", "[", "x1", "]"}], "+", 
   RowBox[{"Cos", "[", "x2", "]"}], "+", 
   RowBox[{"Cos", "[", 
    RowBox[{
     RowBox[{"-", "x1"}], "-", "x2"}], 
    "]"}]}]}]], \
"Input",ExpressionUUID->"0d67449f-c358-48e6-8b38-5d4e2f1add6a"],

Cell[BoxData[
 RowBox[{
  RowBox[{"Cos", "[", "x1", "]"}], "+", 
  RowBox[{"Cos", "[", "x2", "]"}], "+", 
  RowBox[{"Cos", "[", 
   RowBox[{"x1", "+", "x2"}], 
   "]"}]}]], "Output",ExpressionUUID->"c96b4461-e44b-4afe-aa54-881672b96f95"]
}, Open  ]],

Cell["Saddle Points", \
"Text",ExpressionUUID->"a0464767-ca93-4581-8597-e451ffe1e8f4"],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"Solve", "[", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{
     RowBox[{
      RowBox[{"D", "[", 
       RowBox[{"diagValue", ",", "x1"}], "]"}], "\[Equal]", "0"}], ",", 
     RowBox[{
      RowBox[{"D", "[", 
       RowBox[{"diagValue", ",", "x2"}], "]"}], "\[Equal]", "0"}]}], "}"}], 
   ",", 
   RowBox[{"{", 
    RowBox[{"x1", ",", "x2"}], "}"}]}], 
  "]"}]], "Input",ExpressionUUID->"af89cbe1-338e-4cef-998d-c67adf7572b6"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{
     RowBox[{"x1", "\[Rule]", 
      RowBox[{"ConditionalExpression", "[", 
       RowBox[{
        RowBox[{"2", " ", "\[Pi]", " ", 
         RowBox[{"C", "[", "1", "]"}]}], ",", 
        RowBox[{
         RowBox[{"C", "[", "1", "]"}], "\[Element]", 
         TemplateBox[{},
          "Integers"]}]}], "]"}]}], ",", 
     RowBox[{"x2", "\[Rule]", 
      RowBox[{"ConditionalExpression", "[", 
       RowBox[{
        RowBox[{"2", " ", "\[Pi]", " ", 
         RowBox[{"C", "[", "2", "]"}]}], ",", 
        RowBox[{
         RowBox[{"C", "[", "2", "]"}], "\[Element]", 
         TemplateBox[{},
          "Integers"]}]}], "]"}]}]}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"x1", "\[Rule]", 
      RowBox[{"ConditionalExpression", "[", 
       RowBox[{
        RowBox[{"2", " ", "\[Pi]", " ", 
         RowBox[{"C", "[", "1", "]"}]}], ",", 
        RowBox[{
         RowBox[{"C", "[", "1", "]"}], "\[Element]", 
         TemplateBox[{},
          "Integers"]}]}], "]"}]}], ",", 
     RowBox[{"x2", "\[Rule]", 
      RowBox[{"ConditionalExpression", "[", 
       RowBox[{
        RowBox[{"\[Pi]", "+", 
         RowBox[{"2", " ", "\[Pi]", " ", 
          RowBox[{"C", "[", "2", "]"}]}]}], ",", 
        RowBox[{
         RowBox[{"C", "[", "2", "]"}], "\[Element]", 
         TemplateBox[{},
          "Integers"]}]}], "]"}]}]}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"x1", "\[Rule]", 
      RowBox[{"ConditionalExpression", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"-", 
          FractionBox[
           RowBox[{"2", " ", "\[Pi]"}], "3"]}], "+", 
         RowBox[{"2", " ", "\[Pi]", " ", 
          RowBox[{"C", "[", "1", "]"}]}]}], ",", 
        RowBox[{
         RowBox[{"C", "[", "1", "]"}], "\[Element]", 
         TemplateBox[{},
          "Integers"]}]}], "]"}]}], ",", 
     RowBox[{"x2", "\[Rule]", 
      RowBox[{"ConditionalExpression", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"-", 
          FractionBox[
           RowBox[{"2", " ", "\[Pi]"}], "3"]}], "+", 
         RowBox[{"2", " ", "\[Pi]", " ", 
          RowBox[{"C", "[", "2", "]"}]}]}], ",", 
        RowBox[{
         RowBox[{"C", "[", "2", "]"}], "\[Element]", 
         TemplateBox[{},
          "Integers"]}]}], "]"}]}]}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"x1", "\[Rule]", 
      RowBox[{"ConditionalExpression", "[", 
       RowBox[{
        RowBox[{
         FractionBox[
          RowBox[{"2", " ", "\[Pi]"}], "3"], "+", 
         RowBox[{"2", " ", "\[Pi]", " ", 
          RowBox[{"C", "[", "1", "]"}]}]}], ",", 
        RowBox[{
         RowBox[{"C", "[", "1", "]"}], "\[Element]", 
         TemplateBox[{},
          "Integers"]}]}], "]"}]}], ",", 
     RowBox[{"x2", "\[Rule]", 
      RowBox[{"ConditionalExpression", "[", 
       RowBox[{
        RowBox[{
         FractionBox[
          RowBox[{"2", " ", "\[Pi]"}], "3"], "+", 
         RowBox[{"2", " ", "\[Pi]", " ", 
          RowBox[{"C", "[", "2", "]"}]}]}], ",", 
        RowBox[{
         RowBox[{"C", "[", "2", "]"}], "\[Element]", 
         TemplateBox[{},
          "Integers"]}]}], "]"}]}]}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"x1", "\[Rule]", 
      RowBox[{"ConditionalExpression", "[", 
       RowBox[{
        RowBox[{"\[Pi]", "+", 
         RowBox[{"2", " ", "\[Pi]", " ", 
          RowBox[{"C", "[", "1", "]"}]}]}], ",", 
        RowBox[{
         RowBox[{"C", "[", "1", "]"}], "\[Element]", 
         TemplateBox[{},
          "Integers"]}]}], "]"}]}], ",", 
     RowBox[{"x2", "\[Rule]", 
      RowBox[{"ConditionalExpression", "[", 
       RowBox[{
        RowBox[{"2", " ", "\[Pi]", " ", 
         RowBox[{"C", "[", "2", "]"}]}], ",", 
        RowBox[{
         RowBox[{"C", "[", "2", "]"}], "\[Element]", 
         TemplateBox[{},
          "Integers"]}]}], "]"}]}]}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"x1", "\[Rule]", 
      RowBox[{"ConditionalExpression", "[", 
       RowBox[{
        RowBox[{"\[Pi]", "+", 
         RowBox[{"2", " ", "\[Pi]", " ", 
          RowBox[{"C", "[", "1", "]"}]}]}], ",", 
        RowBox[{
         RowBox[{"C", "[", "1", "]"}], "\[Element]", 
         TemplateBox[{},
          "Integers"]}]}], "]"}]}], ",", 
     RowBox[{"x2", "\[Rule]", 
      RowBox[{"ConditionalExpression", "[", 
       RowBox[{
        RowBox[{"\[Pi]", "+", 
         RowBox[{"2", " ", "\[Pi]", " ", 
          RowBox[{"C", "[", "2", "]"}]}]}], ",", 
        RowBox[{
         RowBox[{"C", "[", "2", "]"}], "\[Element]", 
         TemplateBox[{},
          "Integers"]}]}], "]"}]}]}], "}"}]}], 
  "}"}]], "Output",ExpressionUUID->"f5fc5496-5e32-4e3b-bccf-06072130dda8"]
}, Open  ]],

Cell["Hessian", "Text",ExpressionUUID->"0954b861-0f81-43ae-8ad5-16da4ea3ea52"],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"hess", "=", 
  RowBox[{"Outer", "[", 
   RowBox[{
    RowBox[{
     RowBox[{"D", "[", 
      RowBox[{"diagValue", ",", "#1", ",", "#2"}], "]"}], "&"}], ",", 
    RowBox[{"{", 
     RowBox[{"x1", ",", "x2"}], "}"}], ",", 
    RowBox[{"{", 
     RowBox[{"x1", ",", "x2"}], "}"}]}], 
   "]"}]}]], "Input",ExpressionUUID->"b24c3d88-a98a-40f7-93d2-f031ab078441"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{
     RowBox[{
      RowBox[{"-", 
       RowBox[{"Cos", "[", "x1", "]"}]}], "-", 
      RowBox[{"Cos", "[", 
       RowBox[{"x1", "+", "x2"}], "]"}]}], ",", 
     RowBox[{"-", 
      RowBox[{"Cos", "[", 
       RowBox[{"x1", "+", "x2"}], "]"}]}]}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"-", 
      RowBox[{"Cos", "[", 
       RowBox[{"x1", "+", "x2"}], "]"}]}], ",", 
     RowBox[{
      RowBox[{"-", 
       RowBox[{"Cos", "[", "x2", "]"}]}], "-", 
      RowBox[{"Cos", "[", 
       RowBox[{"x1", "+", "x2"}], "]"}]}]}], "}"}]}], 
  "}"}]], "Output",ExpressionUUID->"b885954f-0f78-459a-bdee-dd65cf112f4d"]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"dh", "=", 
  RowBox[{
  "Det", "[", "hess", 
   "]"}]}]], "Input",ExpressionUUID->"2ba79ffb-a384-4fbf-9f38-f1be7adf34c1"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"Cos", "[", "x1", "]"}], " ", 
   RowBox[{"Cos", "[", "x2", "]"}]}], "+", 
  RowBox[{
   RowBox[{"Cos", "[", "x1", "]"}], " ", 
   RowBox[{"Cos", "[", 
    RowBox[{"x1", "+", "x2"}], "]"}]}], "+", 
  RowBox[{
   RowBox[{"Cos", "[", "x2", "]"}], " ", 
   RowBox[{"Cos", "[", 
    RowBox[{"x1", "+", "x2"}], 
    "]"}]}]}]], \
"Output",ExpressionUUID->"d184cc14-a9bb-40e3-9f5d-e340ffee27a3"]
}, Open  ]],

Cell[BoxData[
 RowBox[{"Block", "[", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{"limit", "=", 
     RowBox[{"Pi", " ", 
      RowBox[{"4", "/", "3"}]}]}], "}"}], ",", 
   RowBox[{"Show", "[", 
    RowBox[{
     RowBox[{"Plot3D", "[", 
      RowBox[{"diagValue", ",", 
       RowBox[{"{", 
        RowBox[{"x1", ",", 
         RowBox[{"-", "limit"}], ",", "limit"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"x2", ",", 
         RowBox[{"-", " ", "limit"}], ",", " ", "limit"}], "}"}], ",", 
       RowBox[{"RegionFunction", "\[Rule]", 
        RowBox[{"Function", "[", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"x1", ",", "x2"}], "}"}], ",", 
          RowBox[{"Block", "[", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{"x3", "=", 
              RowBox[{
               RowBox[{"-", "x1"}], "-", "x2"}]}], "}"}], ",", 
            RowBox[{
             RowBox[{
              RowBox[{"Abs", "[", 
               RowBox[{"x1", "-", "x2"}], "]"}], "<", 
              RowBox[{"2", " ", "Pi"}]}], "&&", 
             RowBox[{
              RowBox[{"Abs", "[", 
               RowBox[{"x1", "-", "x3"}], "]"}], "<", 
              RowBox[{"2", "Pi"}]}], "&&", 
             RowBox[{
              RowBox[{"Abs", "[", 
               RowBox[{"x2", "-", "x3"}], "]"}], "<", 
              RowBox[{"2", " ", "Pi"}]}]}]}], "]"}]}], "]"}]}]}], "]"}], ",", 
     
     RowBox[{"Graphics3D", "[", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"PointSize", "[", "0.02", "]"}], ",", 
        RowBox[{"Table", "[", 
         RowBox[{
          RowBox[{"Point", "[", 
           RowBox[{"{", 
            RowBox[{"x1", ",", "x2", ",", "diagValue"}], "}"}], "]"}], ",", 
          RowBox[{"{", 
           RowBox[{"x1", ",", 
            RowBox[{
             RowBox[{
              RowBox[{"-", "4"}], "/", "3"}], " ", "Pi"}], ",", 
            RowBox[{"2", " ", "Pi"}], ",", 
            RowBox[{"2", " ", "Pi"}]}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"x2", ",", 
            RowBox[{
             RowBox[{
              RowBox[{"-", "4"}], "/", "3"}], " ", "Pi"}], ",", 
            RowBox[{"2", " ", "Pi"}], ",", 
            RowBox[{"2", " ", "Pi"}]}], "}"}]}], "]"}], ",", 
        RowBox[{"Table", "[", 
         RowBox[{
          RowBox[{"Point", "[", 
           RowBox[{"{", 
            RowBox[{"x1", ",", "x2", ",", "diagValue"}], "}"}], "]"}], ",", 
          RowBox[{"{", 
           RowBox[{"x1", ",", 
            RowBox[{
             RowBox[{
              RowBox[{"-", "2"}], "/", "3"}], " ", "Pi"}], ",", 
            RowBox[{"2", " ", "Pi"}], ",", 
            RowBox[{"2", " ", "Pi"}]}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"x2", ",", 
            RowBox[{
             RowBox[{
              RowBox[{"-", "2"}], "/", "3"}], " ", "Pi"}], ",", 
            RowBox[{"2", " ", "Pi"}], ",", 
            RowBox[{"2", " ", "Pi"}]}], "}"}]}], "]"}], ",", 
        RowBox[{"Table", "[", 
         RowBox[{
          RowBox[{"Point", "[", 
           RowBox[{"{", 
            RowBox[{"x1", ",", "x2", ",", "diagValue"}], "}"}], "]"}], ",", 
          RowBox[{"{", 
           RowBox[{"x1", ",", 
            RowBox[{"-", "Pi"}], ",", "Pi", ",", "Pi"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"x2", ",", 
            RowBox[{"-", "Pi"}], ",", "Pi", ",", "Pi"}], "}"}]}], "]"}]}], 
       "}"}], "]"}]}], "]"}]}], 
  "]"}]], "Input",ExpressionUUID->"c72af4ec-7c81-415f-8f65-8af9ecc32fa1"],

Cell[CellGroupData[{

Cell["Test saddle point routine", \
"Subsubsection",ExpressionUUID->"85019890-0681-4f49-8583-e443e57c2bc5"],

Cell["Run this as a group", \
"Text",ExpressionUUID->"04d5a4f9-1452-49f3-91d1-c4b5e635e170"],

Cell[CellGroupData[{

Cell[BoxData[{
 RowBox[{
  RowBox[{"sqrtU1", "=", 
   RowBox[{"SUPower", "[", 
    RowBox[{
     RowBox[{"u1", "=", 
      RowBox[{"randomSUMatrix", "[", "3", "]"}]}], ",", "0.25"}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{"phi1", "=", 
  RowBox[{
  "centerPhases", "[", "u1", 
   "]"}]}]}], "Input",ExpressionUUID->"a34cbdc5-1800-4656-9eb9-b9036fd77ede"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{"0.3578374974226404`", ",", "1.2155889299909441`", ",", 
   RowBox[{"-", "1.5734264274135845`"}]}], 
  "}"}]], "Output",ExpressionUUID->"6523a242-2edc-4495-bff3-d97e49ab61a1"]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"{", 
    RowBox[{"sqrtU2", ",", "maxShift"}], "}"}], "=", 
   RowBox[{"linkSaddlePointStep", "[", 
    RowBox[{"sqrtU1", ",", "sqrtU1"}], "]"}]}], ";", 
  "maxShift"}]], \
"Input",ExpressionUUID->"9359b299-7106-4975-a5e7-95091bf73f7b"],

Cell[BoxData["0.005157209810357418`"], \
"Output",ExpressionUUID->"82dca74b-22d7-4dfb-90d7-d5f578aaf3d0"]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"phi2", "=", 
  RowBox[{"centerPhases", "[", 
   RowBox[{"sqrtU2", ".", "sqrtU1"}], 
   "]"}]}]], "Input",ExpressionUUID->"455cc151-6deb-4755-9696-673d3176cb5f"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{"0.17600769885836687`", ",", "0.6097917876907031`", ",", 
   RowBox[{"-", "0.78579948654907`"}]}], 
  "}"}]], "Output",ExpressionUUID->"42678645-88e7-4b70-9fc2-20404906684a"]
}, Open  ]],

Cell[BoxData[
 RowBox[{"Block", "[", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{"limit", "=", 
     RowBox[{"3", 
      RowBox[{"Pi", "/", "2"}]}]}], "}"}], ",", 
   RowBox[{"Show", "[", 
    RowBox[{
     RowBox[{"DensityPlot", "[", 
      RowBox[{"diagValue", ",", 
       RowBox[{"{", 
        RowBox[{"x1", ",", 
         RowBox[{"-", "limit"}], ",", "limit"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"x2", ",", 
         RowBox[{"-", "limit"}], ",", "limit"}], "}"}], ",", 
       RowBox[{"Epilog", "\[Rule]", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"Thickness", "[", "0.02", "]"}], ",", 
          RowBox[{"Line", "[", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"Take", "[", 
              RowBox[{"phi1", ",", "2"}], "]"}], ",", 
             RowBox[{"Take", "[", 
              RowBox[{"phi2", ",", "2"}], "]"}]}], "}"}], "]"}], ",", 
          RowBox[{"PointSize", "[", "0.02", "]"}], ",", 
          RowBox[{"Table", "[", 
           RowBox[{
            RowBox[{"Point", "[", 
             RowBox[{"{", 
              RowBox[{"y1", ",", "y2"}], "}"}], "]"}], ",", 
            RowBox[{"{", 
             RowBox[{"y1", ",", 
              RowBox[{
               RowBox[{
                RowBox[{"-", "4"}], "/", "3"}], " ", "Pi"}], ",", 
              RowBox[{"2", " ", "Pi"}], ",", 
              RowBox[{"2", " ", "Pi"}]}], "}"}], ",", 
            RowBox[{"{", 
             RowBox[{"y2", ",", 
              RowBox[{
               RowBox[{
                RowBox[{"-", "4"}], "/", "3"}], " ", "Pi"}], ",", 
              RowBox[{"2", " ", "Pi"}], ",", 
              RowBox[{"2", " ", "Pi"}]}], "}"}]}], "]"}], ",", 
          RowBox[{"Table", "[", 
           RowBox[{
            RowBox[{"Point", "[", 
             RowBox[{"{", 
              RowBox[{"y1", ",", "y2"}], "}"}], "]"}], ",", 
            RowBox[{"{", 
             RowBox[{"y1", ",", 
              RowBox[{
               RowBox[{
                RowBox[{"-", "2"}], "/", "3"}], " ", "Pi"}], ",", 
              RowBox[{"2", " ", "Pi"}], ",", 
              RowBox[{"2", " ", "Pi"}]}], "}"}], ",", 
            RowBox[{"{", 
             RowBox[{"y2", ",", 
              RowBox[{
               RowBox[{
                RowBox[{"-", "2"}], "/", "3"}], " ", "Pi"}], ",", 
              RowBox[{"2", " ", "Pi"}], ",", 
              RowBox[{"2", " ", "Pi"}]}], "}"}]}], "]"}], ",", 
          RowBox[{"Table", "[", 
           RowBox[{
            RowBox[{"Point", "[", 
             RowBox[{"{", 
              RowBox[{"y1", ",", "y2"}], "}"}], "]"}], ",", 
            RowBox[{"{", 
             RowBox[{"y1", ",", 
              RowBox[{"-", "Pi"}], ",", "Pi", ",", "Pi"}], "}"}], ",", 
            RowBox[{"{", 
             RowBox[{"y2", ",", 
              RowBox[{"-", "Pi"}], ",", "Pi", ",", "Pi"}], "}"}]}], "]"}]}], 
         "}"}]}]}], "]"}], ",", 
     RowBox[{"DensityPlot", "[", 
      RowBox[{"dh", ",", 
       RowBox[{"{", 
        RowBox[{"x1", ",", 
         RowBox[{"-", "limit"}], ",", "limit"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"x2", ",", 
         RowBox[{"-", "limit"}], ",", "limit"}], "}"}], ",", 
       RowBox[{"PlotRange", "\[Rule]", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"-", "0.1"}], ",", "0.1"}], "}"}]}]}], "]"}]}], "]"}]}], 
  "]"}]], "Input",ExpressionUUID->"c954456b-3d8f-489a-9835-7b0476313236"]
}, Closed]]
}, Closed]],

Cell[CellGroupData[{

Cell["Input", \
"Subsection",ExpressionUUID->"e924a166-cbb2-49c0-9107-c62bdb273a1a"],

Cell[BoxData[
 RowBox[{"<<", 
  "\"\<../data/3-3/periodic-4-7.5-3.m\>\""}]], \
"Input",ExpressionUUID->"523461ed-4878-488f-9d9c-7a2c59a8f613"],

Cell[BoxData[
 RowBox[{"<<", 
  "\"\<../data/3-3/periodic-6-8.175-3.m\>\""}]], \
"Input",ExpressionUUID->"71a7bd19-91cd-4285-83a9-98c02a760978"],

Cell[BoxData[
 RowBox[{"<<", 
  "\"\<../data/3-3/periodic-22-42-1.m\>\""}]], \
"Input",ExpressionUUID->"ad08c2af-9241-4c62-acd0-9229dde5d96b"],

Cell[BoxData[
 RowBox[{
  RowBox[{"<<", "\"\<../data/3-3/periodic-22-42-1-cool.m\>\""}], 
  ";"}]], "Input",ExpressionUUID->"3559588d-1f90-4b85-9ff6-4348fbbf99b1"],

Cell[BoxData[
 RowBox[{"<<", 
  "\"\<../data/3-3/periodic-22-42-5.m\>\""}]], \
"Input",ExpressionUUID->"275aab5a-9760-4e37-879b-b5bfdb89d351"],

Cell[BoxData[
 RowBox[{"<<", 
  "\"\<../data/3-3/periodic-22-80-5.m\>\""}]], \
"Input",ExpressionUUID->"2609f7c4-37f3-4701-b3a5-2e6fa1298ffa"],

Cell[BoxData[
 RowBox[{"<<", 
  "\"\<../data/3-4/periodic-16-28-1.m\>\""}]], \
"Input",ExpressionUUID->"b177112c-c694-4bc2-9057-c002b234572e"],

Cell[BoxData[
 RowBox[{"<<", 
  "\"\<../data/3-4/periodic-16-33-4.m\>\""}]], \
"Input",ExpressionUUID->"f538e35b-0e1e-4f75-b6ad-48256f16d29b"],

Cell[BoxData[
 RowBox[{"<<", 
  "\"\<../data/3-4/periodic-20-150-5.m\>\""}]], \
"Input",ExpressionUUID->"d388d44e-b21b-49ea-b215-f75b5f01ef74"],

Cell[BoxData[
 RowBox[{"<<", 
  "\"\<../data/3-3/winding-20-80-0-5.m\>\""}]], \
"Input",ExpressionUUID->"381f51f0-7afe-4522-a9c5-c62219960db0"],

Cell[BoxData[
 RowBox[{"<<", 
  "\"\<../data/3-3/winding-20-80-1-5.m\>\""}]], \
"Input",ExpressionUUID->"0c87e4e6-2f0a-4acf-a802-c65cf32f8a7f"],

Cell[BoxData[
 RowBox[{"<<", 
  "\"\<../data/3-4/winding-20-60-0-4.m\>\""}]], \
"Input",ExpressionUUID->"afc12508-8527-4205-991e-e5bd2a0e99cc"],

Cell[BoxData[
 RowBox[{"<<", 
  "\"\<../data/3-4/winding-20-60-1-4.m\>\""}]], \
"Input",ExpressionUUID->"2a0498d4-3117-4fe5-821f-663b74dc9582"],

Cell[BoxData[
 RowBox[{"<<", 
  "\"\<../data/3-6/periodic-18-90-1.m\>\""}]], \
"Input",ExpressionUUID->"23ee216f-8f8c-42c2-b6c2-ed97cae425cd"],

Cell[BoxData[
 RowBox[{"<<", 
  "\"\<../data/3-6/periodic-18-170-1.m\>\""}]], \
"Input",ExpressionUUID->"0a6e1d01-a9ca-4928-ab9a-2fe3044d00d2"],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{"nd", ",", "nc", ",", "beta", ",", "latticeDimensions", ",", 
   RowBox[{"Dimensions", "[", "gaugeField", "]"}]}], 
  "}"}]], "Input",ExpressionUUID->"345de230-f994-4a52-b850-c6261e53bc8b"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{"3", ",", "3", ",", "8.175000190734863`", ",", 
   RowBox[{"{", 
    RowBox[{"6", ",", "6", ",", "6"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"3", ",", "216", ",", "3", ",", "3"}], "}"}]}], 
  "}"}]], "Output",ExpressionUUID->"6e2ede42-15ee-49c4-ad1f-88c87312e137"]
}, Open  ]],

Cell["Test that links are approximately SU (N)", \
"Text",ExpressionUUID->"e43859b7-8ba8-432b-9329-22bfc217d634"],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"Length", "[", 
  RowBox[{"badMatrices", "=", 
   RowBox[{"Select", "[", 
    RowBox[{
     RowBox[{"Flatten", "[", 
      RowBox[{"gaugeField", ",", "1"}], "]"}], ",", 
     RowBox[{
      RowBox[{"Not", "[", 
       RowBox[{"SUMatrixQ", "[", 
        RowBox[{"#", ",", 
         RowBox[{"1.0", " ", 
          RowBox[{"10", "^", 
           RowBox[{"-", "10"}]}]}]}], "]"}], "]"}], "&"}]}], "]"}]}], 
  "]"}]], "Input",ExpressionUUID->"4450b32a-06a8-4f09-8753-4dbf6a662d7a"],

Cell[BoxData["0"], \
"Output",ExpressionUUID->"3ba6485a-b429-4502-82d5-b576f343653f"]
}, Open  ]]
}, Open  ]],

Cell[CellGroupData[{

Cell["Plaquette distribution", \
"Subsection",ExpressionUUID->"a0a47a8c-ac84-4e13-85e9-a606f0bad220"],

Cell["\<\
The plaquette values, if rescaled to the [0,1] interval, generally fit a Beta \
distribution, but we can equivalently use a Gamma distribution for small \
lattice spacings.\
\>", "Text",ExpressionUUID->"7cfff376-c221-42bb-9e0f-bbccf6ce6087"],

Cell[BoxData[
 RowBox[{
  RowBox[{"useGammaDistribution", "=", "True"}], 
  ";"}]], "Input",ExpressionUUID->"fd266c15-19c1-4cdd-be08-fb8e8adea43c"],

Cell[BoxData[
 RowBox[{"Histogram", "[", 
  RowBox[{"data", "=", 
   RowBox[{"Flatten", "[", 
    RowBox[{"Table", "[", 
     RowBox[{
      RowBox[{"Table", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"(", 
          RowBox[{"1", "-", 
           RowBox[{
            RowBox[{"plaquette", "[", 
             RowBox[{"dir1", ",", "dir2", ",", 
              RowBox[{"latticeCoordinates", "[", "i", "]"}]}], "]"}], "/", 
            "nc"}]}], ")"}], "/", 
         RowBox[{"If", "[", 
          RowBox[{"useGammaDistribution", ",", "1", ",", "2"}], "]"}]}], ",", 
        
        RowBox[{"{", 
         RowBox[{"i", ",", 
          RowBox[{"latticeVolume", "[", "]"}]}], "}"}]}], "]"}], ",", 
      RowBox[{"{", 
       RowBox[{"dir1", ",", "2"}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{"dir2", ",", 
        RowBox[{"dir1", "+", "1"}], ",", "nd"}], "}"}]}], "]"}], "]"}]}], 
  "]"}]], "Input",ExpressionUUID->"8a22188b-5413-48f8-b643-bfab83b62df3"],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   RowBox[{"Mean", "[", "data", "]"}], ",", 
   RowBox[{"dist", "=", 
    RowBox[{"FindDistribution", "[", 
     RowBox[{"data", ",", 
      RowBox[{"TargetFunctions", "\[Rule]", 
       RowBox[{"Which", "[", 
        RowBox[{"useGammaDistribution", ",", 
         RowBox[{"{", "GammaDistribution", "}"}], ",", "True", ",", 
         RowBox[{"{", "BetaDistribution", "}"}], ",", "True", ",", "All"}], 
        "]"}]}]}], "]"}]}]}], 
  "}"}]], "Input",ExpressionUUID->"ad5a307f-c449-430b-9418-f67923577568"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{"0.0650492058072443`", ",", 
   RowBox[{"GammaDistribution", "[", 
    RowBox[{"4.0372454262987585`", ",", "0.016112274320493006`"}], "]"}]}], 
  "}"}]], "Output",ExpressionUUID->"6e224d4d-9baf-4d91-942a-7cd59d3feea3"]
}, Open  ]],

Cell["Distribution for 1 - Tr(plaquette)/nc", \
"Text",ExpressionUUID->"c10d44da-f37f-45db-9a6c-50789f76fd99"],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"TableForm", "[", 
  RowBox[{"dm", "=", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "\"\<nd\>\"", ",", "\"\<nc\>\"", ",", "\"\<beta\>\"", ",", 
       "\"\<mean\>\"", ",", "\"\<alpha\>\"", ",", "\"\<beta\>\""}], "}"}], 
     ",", 
     RowBox[{"{", 
      RowBox[{
      "3", ",", "3", ",", "42.", ",", "0.0650492058072443`", ",", 
       "4.0372454261752875`", ",", "0.016112274320900954`"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{
      "3", ",", "3", ",", "80.", ",", "0.03371067322265413`", ",", 
       "4.011655372432331`", ",", "0.008403182749520672`"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{
      "3", ",", "4", ",", "28.", ",", "0.1923250246554901`", ",", 
       "7.7282971359028245`", ",", "0.02488582171194133`"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{
      "3", ",", "4", ",", "33.", ",", "0.1604205616819077`", ",", 
       "7.670953223240458`", ",", "0.02091272844591148`"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{
      "3", ",", "4", ",", "150.", ",", "0.03380841583718067`", ",", 
       "7.620434296041462`", ",", "0.004436547121053944`"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{
      "3", ",", "6", ",", "90.", ",", "0.13525994258717414`", ",", 
       "18.387360829900825`", ",", "0.007356136850654697`"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{
      "3", ",", "6", ",", "170.", ",", "0.07017369456939337`", ",", 
       "18.102497926494276`", ",", "0.0038764647207436133`"}], "}"}]}], 
    "}"}]}], "]"}]], \
"Input",ExpressionUUID->"0f395ff4-98a2-4733-a8a7-817d7e416189"],

Cell[BoxData[
 TagBox[GridBox[{
    {"\<\"nd\"\>", "\<\"nc\"\>", "\<\"beta\"\>", "\<\"mean\"\>", "\<\"alpha\"\
\>", "\<\"beta\"\>"},
    {"3", "3", "42.`", "0.0650492058072443`", "4.0372454261752875`", 
     "0.016112274320900954`"},
    {"3", "3", "80.`", "0.03371067322265413`", "4.011655372432331`", 
     "0.008403182749520672`"},
    {"3", "4", "28.`", "0.1923250246554901`", "7.7282971359028245`", 
     "0.02488582171194133`"},
    {"3", "4", "33.`", "0.1604205616819077`", "7.670953223240458`", 
     "0.02091272844591148`"},
    {"3", "4", "150.`", "0.03380841583718067`", "7.620434296041462`", 
     "0.004436547121053944`"},
    {"3", "6", "90.`", "0.13525994258717414`", "18.387360829900825`", 
     "0.007356136850654697`"},
    {"3", "6", "170.`", "0.07017369456939337`", "18.102497926494276`", 
     "0.0038764647207436133`"}
   },
   GridBoxAlignment->{
    "Columns" -> {{Left}}, "ColumnsIndexed" -> {}, "Rows" -> {{Baseline}}, 
     "RowsIndexed" -> {}},
   GridBoxSpacings->{"Columns" -> {
       Offset[0.27999999999999997`], {
        Offset[2.0999999999999996`]}, 
       Offset[0.27999999999999997`]}, "ColumnsIndexed" -> {}, "Rows" -> {
       Offset[0.2], {
        Offset[0.4]}, 
       Offset[0.2]}, "RowsIndexed" -> {}}],
  Function[BoxForm`e$, 
   TableForm[
   BoxForm`e$]]]], \
"Output",ExpressionUUID->"a6e98169-49ad-4b10-ae44-63ce52985994"]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"Fit", "[", 
  RowBox[{
   RowBox[{"Log", "[", 
    RowBox[{"Map", "[", 
     RowBox[{
      RowBox[{
       RowBox[{"#", "[", 
        RowBox[{"[", 
         RowBox[{"{", 
          RowBox[{"2", ",", "3", ",", "5"}], "}"}], "]"}], "]"}], "&"}], ",", 
      
      RowBox[{"Rest", "[", "dm", "]"}]}], "]"}], "]"}], ",", 
   RowBox[{"{", 
    RowBox[{"1", ",", "x", ",", "y"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"x", ",", "y"}], "}"}]}], 
  "]"}]], "Input",ExpressionUUID->"f66e4f9f-36de-496f-a379-3a9f320b33e5"],

Cell[BoxData[
 RowBox[{
  RowBox[{"-", "0.9570128098970327`"}], "+", 
  RowBox[{"2.1922544672143394`", " ", "x"}], "-", 
  RowBox[{
  "0.01302459307696784`", " ", 
   "y"}]}]], "Output",ExpressionUUID->"b23993e0-5537-41d8-93ef-3117b1650c80"]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"alphaf", "=", 
  RowBox[{"Fit", "[", 
   RowBox[{
    RowBox[{"Map", "[", 
     RowBox[{
      RowBox[{
       RowBox[{"#", "[", 
        RowBox[{"[", 
         RowBox[{"{", 
          RowBox[{"2", ",", "3", ",", "5"}], "}"}], "]"}], "]"}], "&"}], ",", 
      
      RowBox[{"Rest", "[", "dm", "]"}]}], "]"}], ",", 
    RowBox[{"{", 
     RowBox[{"x", ",", 
      RowBox[{"x", "^", "2"}], ",", 
      RowBox[{
       RowBox[{"x", "^", "2"}], "/", "y"}]}], "}"}], ",", 
    RowBox[{"{", 
     RowBox[{"x", ",", "y"}], "}"}]}], 
   "]"}]}]], "Input",ExpressionUUID->"a409dd0d-f15c-4183-8e07-d79836bc74d2"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"-", "0.38372636384000197`"}], " ", "x"}], "+", 
  RowBox[{"0.5678259467308348`", " ", 
   SuperscriptBox["x", "2"]}], "+", 
  FractionBox[
   RowBox[{"0.33676599859447814`", " ", 
    SuperscriptBox["x", "2"]}], 
   "y"]}]], "Output",ExpressionUUID->"074bce12-25a4-48fd-a284-6451ab50eb3b"]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"Fit", "[", 
  RowBox[{
   RowBox[{"Log", "[", 
    RowBox[{"Map", "[", 
     RowBox[{
      RowBox[{
       RowBox[{"#", "[", 
        RowBox[{"[", 
         RowBox[{"{", 
          RowBox[{"2", ",", "3", ",", "6"}], "}"}], "]"}], "]"}], "&"}], ",", 
      
      RowBox[{"Rest", "[", "dm", "]"}]}], "]"}], "]"}], ",", 
   RowBox[{"{", 
    RowBox[{"1", ",", "x", ",", "y"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"x", ",", "y"}], "}"}]}], 
  "]"}]], "Input",ExpressionUUID->"bcdca394-d224-41a6-b2b1-2f04bd8a4ac8"],

Cell[BoxData[
 RowBox[{
  RowBox[{"-", "0.2764959070649417`"}], "-", 
  RowBox[{"0.003449168587259936`", " ", "x"}], "-", 
  RowBox[{
  "1.0265824185785946`", " ", 
   "y"}]}]], "Output",ExpressionUUID->"01ba710c-2730-48e9-8973-1b11709b986d"]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"betaf", "=", 
  RowBox[{"Fit", "[", 
   RowBox[{
    RowBox[{"Map", "[", 
     RowBox[{
      RowBox[{
       RowBox[{"#", "[", 
        RowBox[{"[", 
         RowBox[{"{", 
          RowBox[{"2", ",", "3", ",", "6"}], "}"}], "]"}], "]"}], "&"}], ",", 
      
      RowBox[{"Rest", "[", "dm", "]"}]}], "]"}], ",", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"1", "/", "y"}], ",", 
      RowBox[{"1", "/", 
       RowBox[{"(", 
        RowBox[{"x", " ", "y"}], ")"}]}], ",", 
      RowBox[{"1", "/", 
       RowBox[{"y", "^", "2"}]}]}], "}"}], ",", 
    RowBox[{"{", 
     RowBox[{"x", ",", "y"}], "}"}]}], 
   "]"}]}]], "Input",ExpressionUUID->"248cc4d8-aae2-44d6-bada-b8513bca3bde"],

Cell[BoxData[
 RowBox[{
  FractionBox["1.271846550539407`", 
   SuperscriptBox["y", "2"]], "+", 
  FractionBox["0.655794521122695`", "y"], "-", 
  FractionBox["0.01909058801264915`", 
   RowBox[{
   "x", " ", 
    "y"}]]}]], "Output",ExpressionUUID->"1d1c9555-f783-463d-8976-a285ccdb70e3"]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"Series", "[", 
  RowBox[{
   RowBox[{"alphaf", " ", "betaf"}], ",", 
   RowBox[{"{", 
    RowBox[{"y", ",", "Infinity", ",", "2"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"x", ",", "Infinity", ",", 
     RowBox[{"-", "1"}]}], "}"}]}], 
  "]"}]], "Input",ExpressionUUID->"6f36a86f-091a-4dc8-a144-4e20f46de9b1"],

Cell[BoxData[
 InterpretationBox[
  RowBox[{
   FractionBox[
    InterpretationBox[
     RowBox[{
      RowBox[{"0.3723771448173887`", " ", 
       SuperscriptBox["x", "2"]}], "-", 
      RowBox[{"0.26248577822853797`", " ", "x"}], "+", 
      InterpretationBox[
       SuperscriptBox[
        RowBox[{"O", "[", 
         FractionBox["1", "x"], "]"}], "0"],
       SeriesData[$CellContext`x, 
        DirectedInfinity[1], {}, -2, 0, 1],
       Editable->False]}],
     SeriesData[$CellContext`x, 
      DirectedInfinity[1], {0.3723771448173887, -0.26248577822853797`}, -2, 0,
       1],
     Editable->False], "y"], "+", 
   FractionBox[
    InterpretationBox[
     RowBox[{
      RowBox[{"0.9430367684350571`", " ", 
       SuperscriptBox["x", "2"]}], "-", 
      RowBox[{"0.4944701131367715`", " ", "x"}], "+", 
      InterpretationBox[
       SuperscriptBox[
        RowBox[{"O", "[", 
         FractionBox["1", "x"], "]"}], "0"],
       SeriesData[$CellContext`x, 
        DirectedInfinity[1], {}, -2, 0, 1],
       Editable->False]}],
     SeriesData[$CellContext`x, 
      DirectedInfinity[1], {0.9430367684350571, -0.4944701131367715}, -2, 0, 
      1],
     Editable->False], 
    SuperscriptBox["y", "2"]], "+", 
   InterpretationBox[
    SuperscriptBox[
     RowBox[{"O", "[", 
      FractionBox["1", "y"], "]"}], "3"],
    SeriesData[$CellContext`y, 
     DirectedInfinity[1], {}, 1, 3, 1],
    Editable->False]}],
  SeriesData[$CellContext`y, 
   DirectedInfinity[1], {
    SeriesData[$CellContext`x, 
     DirectedInfinity[1], {0.3723771448173887, -0.26248577822853797`}, -2, 0, 
     1], 
    SeriesData[$CellContext`x, 
     DirectedInfinity[1], {0.9430367684350571, -0.4944701131367715}, -2, 0, 
     1]}, 1, 3, 1],
  Editable->
   False]], "Output",ExpressionUUID->"260aaa9e-0a11-41cb-9065-ca41791530bc"]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"dist", "=", 
  RowBox[{"GammaDistribution", "[", 
   RowBox[{
    RowBox[{
     RowBox[{"nc", "^", "2"}], "/", "2"}], ",", 
    RowBox[{"2", "/", 
     RowBox[{"(", 
      RowBox[{"3", " ", "beta"}], ")"}]}]}], 
   "]"}]}]], "Input",ExpressionUUID->"27f47a73-784d-4773-816e-8deb6e6050fa"],

Cell[BoxData[
 RowBox[{"GammaDistribution", "[", 
  RowBox[{
   FractionBox["9", "2"], ",", "0.015873015873015872`"}], 
  "]"}]], "Output",ExpressionUUID->"801793c9-815b-4ba2-8528-ec306a670fc6"]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"Mean", "[", 
  RowBox[{"GammaDistribution", "[", 
   RowBox[{"a1", ",", "b1"}], "]"}], 
  "]"}]], "Input",ExpressionUUID->"d238737e-9bf8-4024-84b3-b5d620ad3a86"],

Cell[BoxData[
 RowBox[{"a1", " ", 
  "b1"}]], "Output",ExpressionUUID->"8232898d-e935-4628-a85f-3561ff9d2dd9"]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"TableForm", "[", 
  RowBox[{"Map", "[", 
   RowBox[{
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"#", "[", 
        RowBox[{"[", "2", "]"}], "]"}], ",", 
       RowBox[{"#", "[", 
        RowBox[{"[", "3", "]"}], "]"}], ",", 
       RowBox[{"#", "[", 
        RowBox[{"[", "4", "]"}], "]"}], ",", 
       RowBox[{
        RowBox[{
         RowBox[{"#", "[", 
          RowBox[{"[", "2", "]"}], "]"}], "^", "2"}], "/", 
        RowBox[{"(", 
         RowBox[{"3", " ", 
          RowBox[{"#", "[", 
           RowBox[{"[", "3", "]"}], "]"}]}], ")"}]}], ",", 
       RowBox[{
        RowBox[{
         RowBox[{"#", "[", 
          RowBox[{"[", "2", "]"}], "]"}], "^", "4"}], "/", 
        RowBox[{"(", 
         RowBox[{
          RowBox[{
           RowBox[{"#", "[", 
            RowBox[{"[", "3", "]"}], "]"}], "^", "2"}], " ", "2", " ", "Pi"}],
          ")"}]}]}], "}"}], "&"}], ",", "dm"}], "]"}], 
  "]"}]], "Input",ExpressionUUID->"3706dcee-eadb-432a-9d4d-8ed87b5a0d18"],

Cell[BoxData[
 TagBox[GridBox[{
    {"\<\"nc\"\>", "\<\"beta\"\>", "\<\"mean\"\>", 
     FractionBox[
      SuperscriptBox["\<\"nc\"\>", "2"], 
      RowBox[{"3", " ", "\<\"beta\"\>"}]], 
     FractionBox[
      SuperscriptBox["\<\"nc\"\>", "4"], 
      RowBox[{"2", " ", 
       SuperscriptBox["\<\"beta\"\>", "2"], " ", "\[Pi]"}]]},
    {"3", "42.`", "0.0650492058072443`", "0.07142857142857142`", 
     "0.0073081351419747856`"},
    {"3", "80.`", "0.03371067322265413`", "0.0375`", "0.0020143047485068`"},
    {"4", "28.`", "0.1923250246554901`", "0.19047619047619047`", 
     "0.05196896100959848`"},
    {"4", "33.`", "0.1604205616819077`", "0.16161616161616163`", 
     "0.03741383418872838`"},
    {"4", "150.`", "0.03380841583718067`", "0.035555555555555556`", 
     "0.0018108295747344535`"},
    {"6", "90.`", "0.13525994258717414`", "0.13333333333333333`", 
     "0.025464790894703257`"},
    {"6", "170.`", "0.07017369456939337`", "0.07058823529411765`", 
     "0.0071371905275811895`"}
   },
   GridBoxAlignment->{
    "Columns" -> {{Left}}, "ColumnsIndexed" -> {}, "Rows" -> {{Baseline}}, 
     "RowsIndexed" -> {}},
   GridBoxSpacings->{"Columns" -> {
       Offset[0.27999999999999997`], {
        Offset[2.0999999999999996`]}, 
       Offset[0.27999999999999997`]}, "ColumnsIndexed" -> {}, "Rows" -> {
       Offset[0.2], {
        Offset[0.4]}, 
       Offset[0.2]}, "RowsIndexed" -> {}}],
  Function[BoxForm`e$, 
   TableForm[
   BoxForm`e$]]]], \
"Output",ExpressionUUID->"a05856f9-43df-4129-994a-bdebec212a5d"]
}, Open  ]],

Cell[BoxData[
 RowBox[{"Block", "[", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{"width", "=", "0.0025"}], "}"}], ",", 
   RowBox[{"Show", "[", 
    RowBox[{
     RowBox[{"Histogram", "[", 
      RowBox[{"data", ",", 
       RowBox[{"{", "width", "}"}], ",", 
       RowBox[{"Axes", "\[Rule]", "False"}], ",", 
       RowBox[{"Frame", "\[Rule]", "True"}]}], "]"}], ",", 
     RowBox[{"Plot", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"Length", "[", "data", "]"}], " ", "width", " ", 
        RowBox[{
         RowBox[{"PDF", "[", "dist", "]"}], "[", "x", "]"}]}], ",", 
       RowBox[{"{", 
        RowBox[{"x", ",", "0", ",", 
         RowBox[{"3", " ", 
          RowBox[{"Mean", "[", "data", "]"}]}]}], "}"}]}], "]"}]}], "]"}]}], 
  "]"}]], "Input",ExpressionUUID->"16751e91-9fc7-44fd-8a85-dacfe0aa715d"]
}, Closed]],

Cell[CellGroupData[{

Cell["Lattice stationary point", \
"Subsection",ExpressionUUID->"aa898b09-9cda-4a98-9633-7bc8327b62f7"],

Cell[CellGroupData[{

Cell["Trivial lattice", \
"Subsubsection",ExpressionUUID->"5dc71044-15a4-48a0-aca3-28f2cee996fa"],

Cell[CellGroupData[{

Cell[BoxData[{
 RowBox[{
  RowBox[{"nd", "=", "3"}], ";", 
  RowBox[{"nc", "=", "3"}], ";", 
  RowBox[{"latticeDimensions", "=", 
   RowBox[{"{", 
    RowBox[{"2", ",", "2", ",", "2"}], "}"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"makeTrivialLattice", "[", 
   RowBox[{"randomGauge", "\[Rule]", "True"}], "]"}], ";", 
  RowBox[{
  "averagePlaquette", "[", 
   "]"}]}]}], "Input",ExpressionUUID->"fa06c0e1-583a-453c-8050-7d55393f585d"],

Cell[BoxData["1.0000000000000002`"], \
"Output",ExpressionUUID->"dc48942c-0935-4477-8fce-4e9afcd9bb1c"]
}, Open  ]],

Cell[BoxData[
 RowBox[{
  RowBox[{"libGaugeField", "=", 
   RowBox[{"latticeSaddlePointStep", "[", 
    RowBox[{"storePairs", "\[Rule]", "True"}], "]"}]}], 
  ";"}]], "Input",ExpressionUUID->"be2b0ad3-439f-46ad-bf21-15b47bea1d6c"],

Cell["\<\
Number of degrees of freedom.  Naive gauge fixing would remove one dimension. \
 Difference is 6 for SU(2), 16 for SU(3), 30 for SU(4), 48 for SU(5), \
independent of the size of the lattice.  In general, the difference is 2 \
(nc^2-1).

Also, all curvatures are negative, indicating that this a a local minimum of \
the action, since the action is 1-Re(Tr(plaquettte))/Nc.

The result is independent of gauge choice.\
\>", "Text",ExpressionUUID->"b7131ec8-3d19-41bb-b465-8a8f79973908"],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   RowBox[{"Length", "[", "pairs0", "]"}], ",", 
   RowBox[{
    RowBox[{"Length", "[", "pairs0", "]"}], "/", "nd"}]}], 
  "}"}]], "Input",ExpressionUUID->"b69e43fa-2f8d-4205-b12b-febdaecb8cdc"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{"192", ",", "64"}], 
  "}"}]], "Output",ExpressionUUID->"8d950393-7e2b-47a2-af5b-b9fdfad964d8"]
}, Open  ]],

Cell["Zero curvature would indicate a gauge symmetry.  ", \
"Text",ExpressionUUID->"e9e2300b-bc23-4131-9cda-4201e83f56dd"],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"Tally", "[", 
  RowBox[{"Rationalize", "[", 
   RowBox[{"Chop", "[", "pairs0", "]"}], "]"}], 
  "]"}]], "Input",ExpressionUUID->"c672218a-e13a-42e8-8c81-e01ffcb2f70b"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"-", "6"}], ",", "0"}], "}"}], ",", "16"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"-", "4"}], ",", "0"}], "}"}], ",", "48"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"-", "2"}], ",", "0"}], "}"}], ",", "48"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"0", ",", "0"}], "}"}], ",", "80"}], "}"}]}], 
  "}"}]], "Output",ExpressionUUID->"c52db901-1ac4-4195-bed6-aacb714f745f"]
}, Open  ]]
}, Closed]],

Cell[CellGroupData[{

Cell["Real lattice", \
"Subsubsection",ExpressionUUID->"efb42ad8-3d87-4fb4-8162-76f3d652dea8"],

Cell["\<\
latticeSaddlePointStep is, in general, invariant under gauge transformations.\
\
\>", "Text",ExpressionUUID->"8f27b0c2-3a0e-4e90-b6f6-5e75dd0740ca"],

Cell[BoxData[
 RowBox[{"<<", 
  "\"\<../data/3-3/periodic-4-7.5-3.m\>\""}]], \
"Input",ExpressionUUID->"850d9cf9-80ad-4373-9164-4acf3259a7d0"],

Cell[BoxData[
 RowBox[{
  RowBox[{"libGaugeField1", "=", 
   RowBox[{"latticeSaddlePointStep", "[", 
    RowBox[{
     RowBox[{"storePairs", "\[Rule]", "True"}], ",", 
     RowBox[{"fixedDir", "\[Rule]", 
      RowBox[{"-", "1"}]}]}], "]"}]}], 
  ";"}]], "Input",ExpressionUUID->"01eb122a-8cea-4dde-b157-feb82c3f283d"],

Cell[BoxData[
 RowBox[{
  RowBox[{"pairs0a", "=", "pairs0"}], 
  ";"}]], "Input",ExpressionUUID->"4f93a9de-7035-4721-885e-2795a2be6246"],

Cell[BoxData[
 RowBox[{"Sort", "[", 
  RowBox[{"Chop", "[", 
   RowBox[{
    RowBox[{"Map", "[", 
     RowBox[{
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         RowBox[{"#", "[", 
          RowBox[{"[", "1", "]"}], "]"}], ",", 
         RowBox[{"Abs", "[", 
          RowBox[{"#", "[", 
           RowBox[{"[", "2", "]"}], "]"}], "]"}]}], "}"}], "&"}], ",", 
      "pairs0"}], "]"}], ",", 
    RowBox[{"10", "^", 
     RowBox[{"-", "6"}]}]}], "]"}], 
  "]"}]], "Input",ExpressionUUID->"2ea724b5-b1c8-442f-8db8-ae315b06c0ed"],

Cell[BoxData[
 RowBox[{"setAxialGauge", "[", "2", 
  "]"}]], "Input",ExpressionUUID->"b1af627b-ad1b-47c6-ac7e-8202bf0a6b00"],

Cell[BoxData[
 RowBox[{
  RowBox[{"libGaugeField2", "=", 
   RowBox[{"latticeSaddlePointStep", "[", 
    RowBox[{
     RowBox[{"storePairs", "\[Rule]", "True"}], ",", 
     RowBox[{"fixedDir", "\[Rule]", "1"}]}], "]"}]}], 
  ";"}]], "Input",ExpressionUUID->"19f5bd01-636f-4379-bda3-33c2c21eb6bd"],

Cell[BoxData[
 RowBox[{"ListPlot", "[", 
  RowBox[{
   RowBox[{"Map", "[", 
    RowBox[{
     RowBox[{
      RowBox[{"{", 
       RowBox[{
        RowBox[{"#", "[", 
         RowBox[{"[", "1", "]"}], "]"}], ",", 
        RowBox[{"Abs", "[", 
         RowBox[{"#", "[", 
          RowBox[{"[", "2", "]"}], "]"}], "]"}]}], "}"}], "&"}], ",", 
     "pairs0"}], "]"}], ",", 
   RowBox[{"Axes", "\[Rule]", "False"}], ",", 
   RowBox[{"Frame", "\[Rule]", "True"}]}], 
  "]"}]], "Input",ExpressionUUID->"8d9621f3-7c4a-4f15-b47a-68a1d0ceee4d"],

Cell[BoxData[
 RowBox[{"ListPlot", "[", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{
     RowBox[{"Map", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"{", 
         RowBox[{
          RowBox[{"#", "[", 
           RowBox[{"[", "1", "]"}], "]"}], ",", 
          RowBox[{"Abs", "[", 
           RowBox[{"#", "[", 
            RowBox[{"[", "2", "]"}], "]"}], "]"}]}], "}"}], "&"}], ",", 
       "pairs0"}], "]"}], ",", 
     RowBox[{"Map", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"{", 
         RowBox[{
          RowBox[{"#", "[", 
           RowBox[{"[", "1", "]"}], "]"}], ",", 
          RowBox[{"Abs", "[", 
           RowBox[{"#", "[", 
            RowBox[{"[", "2", "]"}], "]"}], "]"}]}], "}"}], "&"}], ",", 
       "pairs0a"}], "]"}]}], "}"}], ",", 
   RowBox[{"Axes", "\[Rule]", "False"}], ",", 
   RowBox[{"PlotStyle", "\[Rule]", 
    RowBox[{"{", 
     RowBox[{"Red", ",", "Blue"}], "}"}]}], ",", 
   RowBox[{"Frame", "\[Rule]", "True"}]}], 
  "]"}]], "Input",ExpressionUUID->"a0ebea47-b146-4db7-a21c-447870ca4546"],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   RowBox[{"Length", "[", "pairs0a", "]"}], ",", 
   RowBox[{"Length", "[", "pairs0", "]"}]}], 
  "}"}]], "Input",ExpressionUUID->"a7553032-fc23-48be-9986-ccc6546e9acb"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{"1536", ",", "1152"}], 
  "}"}]], "Output",ExpressionUUID->"d6127851-b2b4-4098-80ee-eab8966de22f"]
}, Open  ]],

Cell[BoxData[
 RowBox[{"Histogram", "[", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{
     RowBox[{"Map", "[", 
      RowBox[{"First", ",", "pairs0a"}], "]"}], ",", 
     RowBox[{"Map", "[", 
      RowBox[{"First", ",", "pairs0"}], "]"}]}], "}"}], ",", "50"}], 
  "]"}]], "Input",ExpressionUUID->"0a2f19fd-6a55-484c-a67f-8e407ae1d616"],

Cell[BoxData[
 RowBox[{"  ", 
  RowBox[{"'", "New", " ", 
   RowBox[{
   "Folder", 
    "'"}]}]}]], \
"Input",ExpressionUUID->"0df1c79a-8a19-4c26-8ee2-21aa6a437e97"],

Cell[BoxData[
 RowBox[{"Histogram3D", "[", 
  RowBox[{
   RowBox[{"Map", "[", 
    RowBox[{
     RowBox[{
      RowBox[{"{", 
       RowBox[{
        RowBox[{"#", "[", 
         RowBox[{"[", "1", "]"}], "]"}], ",", 
        RowBox[{"Abs", "[", 
         RowBox[{"#", "[", 
          RowBox[{"[", "2", "]"}], "]"}], "]"}]}], "}"}], "&"}], ",", 
     "pairs0"}], "]"}], ",", 
   RowBox[{"AxesLabel", "\[Rule]", 
    RowBox[{"{", 
     RowBox[{"\"\<curvature\>\"", ",", "\"\<gradient\>\""}], "}"}]}]}], 
  "]"}]], "Input",ExpressionUUID->"877264f3-3011-4c8e-a6ba-21e11555f1e6"]
}, Open  ]]
}, Open  ]],

Cell[CellGroupData[{

Cell["Junk", \
"Subsection",ExpressionUUID->"a92408d4-f001-40b1-85ad-94f79aa17479"],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"phases", "=", 
  RowBox[{"centerPhases", "[", 
   RowBox[{"centerSUMatrix", "[", 
    RowBox[{"1", ",", "3"}], "]"}], 
   "]"}]}]], "Input",ExpressionUUID->"686d2b6b-ee73-41bc-913b-17e1265fdf07"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   FractionBox[
    RowBox[{"2", " ", "\[Pi]"}], "3"], ",", 
   FractionBox[
    RowBox[{"2", " ", "\[Pi]"}], "3"], ",", 
   RowBox[{"-", 
    FractionBox[
     RowBox[{"4", " ", "\[Pi]"}], "3"]}]}], 
  "}"}]], "Output",ExpressionUUID->"03357285-a29e-4264-9e7a-438b56c8dea2"]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"N", "[", 
  RowBox[{"phases", ",", "16"}], 
  "]"}]], "Input",ExpressionUUID->"7efc902e-0982-442d-9351-8caf64282079"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
  "2.09439510239319549230842892218633613323`16.", ",", 
   "2.09439510239319549230842892218633613323`16.", ",", 
   RowBox[{"-", "4.18879020478639098461685784437267226645`16."}]}], 
  "}"}]], "Output",ExpressionUUID->"2c0859eb-1e6a-4dfb-accc-4a09ba147334"]
}, Open  ]],

Cell[BoxData[
 RowBox[{"Chop", "[", 
  RowBox[{"lineLinks", "[", 
   RowBox[{"1", ",", 
    RowBox[{"{", 
     RowBox[{"2", ",", "3", ",", "4"}], "}"}]}], "]"}], 
  "]"}]], "Input",ExpressionUUID->"1d780d2a-b4a6-4278-bcc0-f75e106c6cd4"],

Cell[BoxData[
 RowBox[{"plotAction", "[", 
  RowBox[{"1", ",", "2", ",", "3", ",", 
   RowBox[{"{", 
    RowBox[{"1", ",", "1", ",", "1"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"0", ",", 
     RowBox[{"4", " ", 
      RowBox[{
       RowBox[{"nc", "^", "2"}], "/", "3"}]}]}], "}"}]}], 
  "]"}]], "Input",ExpressionUUID->"ba76764a-4909-4732-8f1b-eeae0a1a519a"],

Cell[BoxData[
 RowBox[{"latticeSaddlePoint", "[", "5", 
  "]"}]], "Input",ExpressionUUID->"84cd5e73-3a9a-4185-b2bd-67fec59043ff"],

Cell[BoxData[
 RowBox[{"stats", "=", 
  RowBox[{
  "latticeSaddlePoint", "[", "50", 
   "]"}]}]], "Input",ExpressionUUID->"39cd555d-179f-4c65-b660-0cc1041ddcb0"],

Cell[BoxData[
 RowBox[{"ListLogPlot", "[", 
  RowBox[{"Map", "[", 
   RowBox[{
    RowBox[{
     RowBox[{"#", "[", 
      RowBox[{"[", 
       RowBox[{"{", 
        RowBox[{"1", ",", "3"}], "}"}], "]"}], "]"}], "&"}], ",", "stats"}], 
   "]"}], 
  "]"}]], "Input",ExpressionUUID->"fe2c5a12-8f30-48dc-97d9-beb1e3611f95"],

Cell[BoxData[
 RowBox[{"ListLogPlot", "[", 
  RowBox[{"Map", "[", 
   RowBox[{
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"#", "[", 
        RowBox[{"[", "1", "]"}], "]"}], ",", 
       RowBox[{"norm", "/.", 
        RowBox[{
         RowBox[{"#", "[", 
          RowBox[{"[", "4", "]"}], "]"}], "[", "\"\<BestFitParameters\>\"", 
         "]"}]}]}], "}"}], "&"}], ",", "stats"}], "]"}], 
  "]"}]], "Input",ExpressionUUID->"3a5eba66-dcda-48cd-811a-84f1b3feb07a"],

Cell[BoxData[
 RowBox[{"ListLogPlot", "[", 
  RowBox[{"Map", "[", 
   RowBox[{
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"#", "[", 
        RowBox[{"[", "1", "]"}], "]"}], ",", 
       RowBox[{"aw", "/.", 
        RowBox[{
         RowBox[{"#", "[", 
          RowBox[{"[", "4", "]"}], "]"}], "[", "\"\<BestFitParameters\>\"", 
         "]"}]}]}], "}"}], "&"}], ",", "stats"}], "]"}], 
  "]"}]], "Input",ExpressionUUID->"f29e21a9-c220-44a0-ac09-ce1085150205"],

Cell[BoxData[
 RowBox[{"stats", "=", 
  RowBox[{
  "latticeSaddlePoint", "[", "14", 
   "]"}]}]], "Input",ExpressionUUID->"90951bf1-1e70-40ff-89ca-d4f993fbf3bf"],

Cell["Save resulting lattice", \
"Text",ExpressionUUID->"8bd4fa06-fe44-4021-8d56-44540a6ec977"],

Cell[BoxData[
 RowBox[{"Save", "[", 
  RowBox[{"\"\<periodic-3-3-22-42-1-fastcool.m\>\"", ",", 
   RowBox[{"{", 
    RowBox[{
    "nd", ",", "nc", ",", "beta", ",", "latticeDimensions", ",", 
     "latticeLayout", ",", "gaugeField", ",", "linearSiteIndex"}], "}"}]}], 
  "]"}]], "Input",ExpressionUUID->"7b407bca-c25e-4871-ad42-6b55adab4d4d"]
}, Open  ]]
}, Open  ]]
},
WindowSize->{765, 655},
WindowMargins->{{Automatic, 20}, {30, Automatic}},
PrivateNotebookOptions->{"FileOutlineCache"->False},
TrackCellChangeTimes->False,
FrontEndVersion->"11.2 for Linux x86 (64-bit) (September 10, 2017)",
StyleDefinitions->"Default.nb"
]

